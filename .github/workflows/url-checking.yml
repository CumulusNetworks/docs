name: 'URL Checker'

on:
  push:
    branches:
      - plumbis-stage

jobs:
  check_urls:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: peaceiris/actions-hugo@v2
      with:
        hugo-version: "0.65.3"
        extended: true
    - uses: actions/setup-node@v1
    - run: npm install broken-link-checker -g
    - run: ls
    - run: hugo server --baseURL localhost:1313 --disableLiveReload &
    - run: sleep 15
    - run: (set -o pipefail; blc http://localhost:1313 --exclude linkedin.com --exclude github.com --exclude .pdf --exclude .xls --exclude cumulus-vx --exclude cumulus-rmp --exclude /rn/ --exclude /cumulus-linux/ --exclude /cumulus-netq/ -r -e | grep --color='auto' "Getting links from\|BROKEN")
