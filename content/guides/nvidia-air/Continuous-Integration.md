---
title: Continuous Integration
author: NVIDIA
weight: 50
version: "1.0"
---

NVIDIA Air supports the ability to integrate a Netwoirk Continuous Integration (NetCI) pipeline. It provides workflows to onboard production code and have it tested against a digital simulation of the network.

## Scope

* Currently, only Gitlab is supported as the centralized code repository

## Requirements

In order to use the NVIDIA Air Continuous Integration as a Service (CIaaS), the following requirements must be met.

1. Infrastructure as Code
2. Topology of Data Center

### Infrastructure as Code

The configurations and deployment mechanism must be stored in a centralized git repository. Common git repositories include {{<exlink url="https://github.com" text="Github">}} and {{<exlink url="https://gitlab.com" text="Gitlab">}}.

Infrastructure as code can exist in many way. Below are two methods that can be used for implementing a CI solution.

#### Simple IAC

The simplest form of IAC involves backing up and restoring configurations using a centralized configuration repository. Use this publicly available {{<exlink url="https://gitlab.com/cumulus-consulting/features/simple-iac/" text="Simple IAC">}} repository that can be used to backup and restore files. Any changes committed to this repository would result in a pipeline run of the CI workflow.

#### Advanced IAC

 An example of an advanced solution can be obtained through the NVIDIA {{<exlink url="https://gitlab.com/cumulus-consulting/goldenturtle/cumulus_ansible_modules/" text="Production Ready Automation">}}. This code centralizes not only the configuration backup, but it creates a fully comprehensive automation deployment method including data structures, templates and feature-specific tasks.

### Topology of Data Center

There are two methods to build the topology of the data center. For new environments, the Air topology builder tool can be used to create the the topology. For existing environments, using a script to convert existing configurations into a topology file is easier.

#### Topology Builder

This workflow is outlined in more detail in the section labelled {{<link url="Custom-Topology/" text="Build a Custom Topology">}}.

Using the blank canvas, a full topology can be generated using the GUI:

{{<img src="/images/guides/nvidia-air/CustomTopology.png" width="800px">}}

#### Topology From Existing Network

This workflow is outlined in more detail in the section labelled {{<link url="Custom-Topology/" text="Create a Custom Topology from the Production Network">}}.

## Access NetCI

NVIDIA Air's contiuous integration functionality is available via the direct link for {{<exlink url="https://air.nvidia.com/netci/" text="NetCI">}}.

Login by creating a new account.

## Adding a NetCI Workflow

After the first login, the user is presented with the option to launch a wizard to `Get Started`:

{{<img src="/images/guides/nvidia-air/NetCI-GetStarted.png" width="800px">}}

### Connect a Repository

Meeting the first requirement of IaC, the user must link to their git repository and provide the NVIDIA Air NetCI platform access to read the repository.

{{<img src="/images/guides/nvidia-air/NetCI-ConnectRepository.png" width="800px">}}


#### Repository URL

The repository URL is the parent level URL directly accessible over the internet.

Examples of this include:

```
https://gitlab.com/cumulus-consulting/goldenturtle/cumulus_ansible_modules
```

Ensure that there is no `trailing slash` as it will cause an error from reading the repository.

After the contents are filled out, the output will look as follows:

{{<img src="/images/guides/nvidia-air/NetCI-ConnectRepositoryPopulated.png" width="800px">}}

#### Access Token

The access token must be generated by the repository and can normally be done through the GUI. Below there are two examples of how to generate the token from Gitlab and Github.

##### Gitlab

In Gitlab, after logging in, select `Preferences`:

{{<img src="/images/guides/nvidia-air/NetCI-GitlabPreferences.png" width="200px">}}

Then selected Access Tokens:

{{<img src="/images/guides/nvidia-air/NetCI-GitlabAccessTokens.png" width="200px">}}

Then create an Access Token by giving it a name and make sure to select `read_repository` and `api` as the selected scope.

{{<img src="/images/guides/nvidia-air/NetCI-GitlabTokenExample.png" width="600px">}}

Take the newly generated personal access token and copy it to the appropriate field in the NVIDIA Air NetCI text box.


### Add a Network

The network defines the architecture that will be launched in the NVIDIA Air as a simulation and the configuration that will be deployed into the simulation. All following required input is relative to the repository.

{{<img src="/images/guides/nvidia-air/NetCI-AddNetwork.png" width="600px">}}

* **Name**: Any user defined name for the network and CI environment to be tested
* **Topology File Path**: This is the relative path within the repository linked in the previous section that points to a `.dot` format topology file that defines the network
* **Configuration Deployment Command**: This is the command that when executed from the root directory of the repository can successfully deploy and provision the entire network

An example looks of the filled out form is below:

{{<img src="/images/guides/nvidia-air/NetCI-AddNetworkPopulated.png" width="600px">}}

### Enable Tests

Tests for the NetCI environment are predefined and rely primarly on Netq as the backend validation tool.

{{<img src="/images/guides/nvidia-air/NetCI-EnableTests.png" width="600px">}}

### Summary

The entire configuration is provided in a summarized form at the end.

{{<img src="/images/guides/nvidia-air/NetCI-Summary.png" width="600px">}}

## Networks

Any defined networks are defined and tracked in the `Networks` tab.

### Test Results

All test results are presented in the `Networks` section by clicking and expanding the defined network.

{{<img src="/images/guides/nvidia-air/NetCI-ManualTest.png" width="300px">}}

Each stage can be clicked and expanded to provide greater details on each stage results.

## Repositories

All configured repositories are defined and tracked in the `Repositories` tab.

## Tests

The `Tests` section lists all supported tests and allows the user to run a single test at a time against the network infrastructure.

{{<img src="/images/guides/nvidia-air/NetCI-Tests.png" width="600px">}}

### Add Tests

The NetCI environment supports uploading individual tests. The tests are defined in YAML format. Below are two examples:

Example 1:

```
Verify Underlay BGP: # test title
  version: 1.0.0 # optional version string, NetCI will auto-increment this when you make changes
  group: Baseline - Network Configuration # Test group name
  target: localhost # Node name where the steps should be run (localhost == oob-mgmt-server for Airwolf)
  # optional description, supports markdown
  description: Check all ipv4 unicast BGP peering within the SDN network
  steps: # all commands are run as 'cumulus' user
    - ansible -m shell -a \'echo \"cumulus@\$(hostname):mgmt-vrf:\~\$ net show bgp ipv4 unicast summary \"; net show bgp ipv4 unicast summary;echo \" \"\' network \| grep -v SUCCESS
  summary_regex: '.*' # optional regex; Each test will have "results" and a "summary". "results" is the full stdout/stderr, "summary" is only the part of stdout/stderr matching this regex
```

Example 2:

```
Nessus Scan switch:
  group: Operations and Security
  target: spine01
  description: Ensure fully configured switch can trigger and accept nessus scan.
  steps:
    - run_script
  script:python: |
    def deploy_ansible_config():
        ...
    def run_nessus_scan():
        ...
    def main():
        deploy_ansible_config()
        run_nessus_scan()
    if __name__ == '__main__':
        main()
```

{{<img src="/images/guides/nvidia-air/NetCI-AddTest.png" width="300px">}}
