<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Multi-Chassis Link Aggregation - MLAG | Cumulus Networks Documentation</title>

  
  <link href="https://fonts.googleapis.com/css?family=Oxygen|Oxygen+Mono:300,400,700" rel="stylesheet">

  
  
  
  <link rel="stylesheet" href="/docs.cumulusnetworks.com/book.min.a378d8a2da6f5357a83a43dff33d6f77fb70401e0399d5ba78faf81d7a1ae1a8.css">

  
  <link rel="icon" href="/docs.cumulusnetworks.com/icons/favicon.png" type="image/x-icon">

  
  <!--
  Made with Book Theme
  https://github.com/alex-shpak/hugo-book
  -->

  
  
  <script src = "/docs.cumulusnetworks.com/js/codecopy.js"> </script>

</head>


<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  
  <header id="site-nav">
    <div class="header-wrapper flex">
      <a href="/">
        <img src="/header-logo.png" alt="Cumulus Networks">
        <img src="/cumulus-networks-rt-white.svg" alt="Cumulus Networks" class="header-mobile">
        <span>Docs</span>
      </a>
      <ul class="flex">
        <li><a href="//cumulusnetworks.com">HOME</a></li>
        <li><a href="//support.cumulusnetworks.com/">SUPPORT</a></li>
        <li><a href="//docs.cumulusnetworks.com/">DOCS</a></li>
        <li><a href="//education.cumulusnetworks.com">EDUCATION</a></li>
        <li><a href="//cumulusnetworks.com/blog/">BLOG</a></li>
        <li><a href="//forums.cumulusnetworks.com/">FORUMS</a></li>
      </ul>
      <div class="burger-menu">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </header>
  <div id="product-nav" class="flex">
      
    
    <ul>
    
      <li class = "active" ><a href = docs.cumulusnetworks.com/cumulus-linux/ >
        Cumulus Linux </a> </li>
    
      <li><a href = docs.cumulusnetworks.com/cumulus-netq/ >
        Cumulus NetQ </a> </li>
    
      <li><a href = docs.cumulusnetworks.com/cumulus-vx/ >
        Cumulus VX </a> </li>
    
      <li>
        <div id="products-dropdown" class="dropdown">
            <button class="btn" type="button" id="dropdownMenuButton">
              Products
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <a class="dropdown-item" href="">Cumulus RMP</a>
              <a class="dropdown-item" href="">Cumulus Chassis</a>
              <a class="dropdown-item" href="">Cumulus Host Pack</a>
            </div>
        </div>
      </li>
    </ul>
    <div class="search-container">
      <div id="doc-search-box">
        <input type="text" class="doc-search-input" placeholder="Search" value="">
        <span><button type="submit"><img src="/icons/search_20x20.svg" alt=""></button></span>
      </div>
      <div id="dropdown" class="dropdown">
          <button class="btn" type="button" id="dropdownMenuButton">
            v3.7.7
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/cumulus-linux/"> v3.7.7</a>
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-linux-25esr/"> v2.5.12</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-linux-30/"> v3.0.1</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-linux-31/"> v3.1.2</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-linux-321/"> v3.2.1</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-linux-330/"> v3.3.0</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-linux-332/"> v3.3.2</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-linux-343/"> v3.4.3</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-linux-35/"> v3.5</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-linux-36/"> v3.6</a>
            
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
          </div>
      </div>
    </div>
  </div>
  <main class="flex container">
    <aside class="book-menu fixed">

      <nav role="navigation">
        <h2 class="book-brand">
          <a href="docs.cumulusnetworks.com">Cumulus Networks Documentation</a>
        </h2>
        
        




  <ul id = "top" class = "cn-book-section-container">
  
    

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/" >
    Cumulus Linux User Guide
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Quick-Start-Guide/" >
    Quick Start Guide
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Installation-Management/" >
    Installation Management
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Installation-Management/Managing-Cumulus-Linux-Disk-Images/" >
    Managing Cumulus Linux Disk Images
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Installation-Management/Installing-a-New-Cumulus-Linux-Image/" >
    Installing a New Cumulus Linux Image
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Installation-Management/Upgrading-Cumulus-Linux/" >
    Upgrading Cumulus Linux
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Installation-Management/Using-Snapshots/" >
    Using Snapshots
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Installation-Management/Adding-and-Updating-Packages/" >
    Adding and Updating Packages
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Installation-Management/Zero-Touch-Provisioning-ZTP/" >
    Zero Touch Provisioning - ZTP
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/System-Configuration/" >
    System Configuration
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/System-Configuration/Authentication-Authorization-and-Accounting/" >
    Authentication, Authorization and Accounting
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/System-Configuration/Authentication-Authorization-and-Accounting/SSH-for-Remote-Access/" >
    SSH for Remote Access
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/System-Configuration/Authentication-Authorization-and-Accounting/User-Accounts/" >
    User Accounts
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/System-Configuration/Authentication-Authorization-and-Accounting/Using-sudo-to-Delegate-Privileges/" >
    Using sudo to Delegate Privileges
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/System-Configuration/Authentication-Authorization-and-Accounting/LDAP-Authentication-and-Authorization/" >
    LDAP Authentication and Authorization
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/System-Configuration/Authentication-Authorization-and-Accounting/TACACS-Plus/" >
    TACACS Plus
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/System-Configuration/Authentication-Authorization-and-Accounting/RADIUS-AAA/" >
    RADIUS AAA
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/System-Configuration/Netfilter-ACLs/" >
    Netfilter - ACLs
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/System-Configuration/Netfilter-ACLs/Default-Cumulus-Linux-ACL-Configuration/" >
    Default Cumulus Linux ACL Configuration
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/System-Configuration/Netfilter-ACLs/Filtering-Learned-MAC-Addresses/" >
    Filtering Learned MAC Addresses
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/System-Configuration/Network-Command-Line-Utility-NCLU/" >
    Network Command Line Utility - NCLU
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/System-Configuration/Setting-Date-and-Time/" >
    Setting Date and Time
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/System-Configuration/Services-and-Daemons-in-Cumulus-Linux/" >
    Services and Daemons in Cumulus Linux
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/System-Configuration/Configuring-switchd/" >
    Configuring switchd
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/System-Configuration/Power-over-Ethernet-PoE/" >
    Power over Ethernet - PoE
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/System-Configuration/Configuring-a-Global-Proxy/" >
    Configuring a Global Proxy
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/System-Configuration/HTTP-API/" >
    HTTP API
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-1-and-Switch-Ports/" >
    Layer 1 and Switch Ports
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-1-and-Switch-Ports/Interface-Configuration-and-Management/" >
    Interface Configuration and Management
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-1-and-Switch-Ports/Interface-Configuration-and-Management/Switch-Port-Attributes/" >
    Switch Port Attributes
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-1-and-Switch-Ports/Interface-Configuration-and-Management/ifplugd/" >
    ifplugd
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-1-and-Switch-Ports/Buffer-and-Queue-Management/" >
    Buffer and Queue Management
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-1-and-Switch-Ports/Buffer-and-Queue-Management/Hardware-enabled-DDOS-Protection/" >
    Hardware-enabled DDOS Protection
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-1-and-Switch-Ports/DHCP-Relays/" >
    DHCP Relays
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-1-and-Switch-Ports/DHCP-Servers/" >
    DHCP Servers
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-1-and-Switch-Ports/Facebook-Voyager-Optical-Interfaces/" >
    Facebook Voyager Optical Interfaces
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-1-and-Switch-Ports/802.1X-Interfaces/" >
    802.1X Interfaces
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-1-and-Switch-Ports/Prescriptive-Topology-Manager-PTM/" >
    Prescriptive Topology Manager - PTM
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-2/" >
    Layer 2
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-2/Link-Layer-Discovery-Protocol/" >
    Link Layer Discovery Protocol
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-2/Link-Layer-Discovery-Protocol/Voice-VLAN/" >
    Voice VLAN
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-2/Ethernet-Bridging-VLANs/" >
    Ethernet Bridging - VLANs
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-2/Ethernet-Bridging-VLANs/VLAN-aware-Bridge-Mode/" >
    VLAN-aware Bridge Mode
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-2/Ethernet-Bridging-VLANs/Traditional-Bridge-Mode/" >
    Traditional Bridge Mode
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-2/Ethernet-Bridging-VLANs/VLAN-Tagging/" >
    VLAN Tagging
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-2/Spanning-Tree-and-Rapid-Spanning-Tree/" >
    Spanning Tree and Rapid Spanning Tree
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-2/Bonding-Link-Aggregation/" >
    Bonding - Link Aggregation
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-2/Multi-Chassis-Link-Aggregation-MLAG/"  class="active" >
    Multi-Chassis Link Aggregation - MLAG
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-2/LACP-Bypass/" >
    LACP Bypass
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-2/Virtual-Router-Redundancy-VRR-and-VRRP/" >
    Virtual Router Redundancy - VRR and VRRP
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-2/IGMP-and-MLD-Snooping/" >
    IGMP and MLD Snooping
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Network-Virtualization/" >
    Network Virtualization
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Network-Virtualization/Static-VXLAN-Configurations/" >
    Static VXLAN Configurations
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Network-Virtualization/Static-VXLAN-Configurations/Static-VXLAN-Tunnels/" >
    Static VXLAN Tunnels
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Network-Virtualization/Static-VXLAN-Configurations/Static-MAC-Bindings-with-VXLAN/" >
    Static MAC Bindings with VXLAN
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Network-Virtualization/Lightweight-Network-Virtualization-Overview/" >
    Lightweight Network Virtualization Overview
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Network-Virtualization/Lightweight-Network-Virtualization-Overview/LNV-Full-Example/" >
    LNV Full Example
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Network-Virtualization/Virtualization-Integrations/" >
    Virtualization Integrations
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Network-Virtualization/Virtualization-Integrations/Integrating-Hardware-VTEPs-with-Midokura-MidoNet-and-OpenStack/" >
    Integrating Hardware VTEPs with Midokura MidoNet and OpenStack
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Network-Virtualization/Virtualization-Integrations/Integrating-Hardware-VTEPs-with-VMware-NSX-V/" >
    Integrating Hardware VTEPs with VMware NSX-V
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Network-Virtualization/Virtualization-Integrations/Integrating-Hardware-VTEPs-with-VMware-NSX-MH/" >
    Integrating Hardware VTEPs with VMware NSX-MH
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Network-Virtualization/Virtualization-Integrations/OVSDB-Server-High-Availability/" >
    OVSDB Server High Availability
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Network-Virtualization/Ethernet-Virtual-Private-Network-EVPN/" >
    Ethernet Virtual Private Network - EVPN
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Network-Virtualization/VXLAN-Active-Active-Mode/" >
    VXLAN Active-Active Mode
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Network-Virtualization/VXLAN-Routing/" >
    VXLAN Routing
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Network-Virtualization/VXLAN-Scale/" >
    VXLAN Scale
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Network-Virtualization/Hybrid-Cloud-Connectivity-with-QinQ-and-VXLANs/" >
    Hybrid Cloud Connectivity with QinQ and VXLANs
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Network-Virtualization/Troubleshooting-VXLANs/" >
    Troubleshooting VXLANs
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-3/" >
    Layer 3
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-3/FRRouting-Overview/" >
    FRRouting Overview
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-3/FRRouting-Overview/Upgrading-from-Quagga-to-FRRouting/" >
    Upgrading from Quagga to FRRouting
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-3/Configuring-FRRouting/" >
    Configuring FRRouting
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-3/Configuring-FRRouting/Comparing-NCLU-and-vtysh-Commands/" >
    Comparing NCLU and vtysh Commands
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-3/Routing/" >
    Routing
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-3/Introduction-to-Routing-Protocols/" >
    Introduction to Routing Protocols
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-3/Network-Topology/" >
    Network Topology
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-3/Address-Resolution-Protocol-ARP/" >
    Address Resolution Protocol - ARP
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-3/Open-Shortest-Path-First-OSPF/" >
    Open Shortest Path First - OSPF
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-3/Open-Shortest-Path-First-v3-OSPFv3/" >
    Open Shortest Path First v3 - OSPFv3
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-3/Border-Gateway-Protocol-BGP/" >
    Border Gateway Protocol - BGP
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-3/Policy-based-Routing/" >
    Policy-based Routing
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-3/Bidirectional-Forwarding-Detection-BFD/" >
    Bidirectional Forwarding Detection - BFD
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-3/Equal-Cost-Multipath-Load-Sharing-Hardware-ECMP/" >
    Equal Cost Multipath Load Sharing - Hardware ECMP
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-3/Redistribute-Neighbor/" >
    Redistribute Neighbor
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-3/Virtual-Routing-and-Forwarding-VRF/" >
    Virtual Routing and Forwarding - VRF
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-3/Management-VRF/" >
    Management VRF
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-3/GRE-Tunneling/" >
    GRE Tunneling
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-3/Protocol-Independent-Multicast-PIM/" >
    Protocol Independent Multicast - PIM
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Layer-3/Segment-Routing/" >
    Segment Routing
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Monitoring-and-Troubleshooting/" >
    Monitoring and Troubleshooting
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Monitoring-and-Troubleshooting/Monitoring-System-Hardware/" >
    Monitoring System Hardware
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Monitoring-and-Troubleshooting/Monitoring-System-Hardware/Network-Switch-Port-LED-and-Status-LED-Guidelines/" >
    Network Switch Port LED and Status LED Guidelines
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Monitoring-and-Troubleshooting/Understanding-the-cl-support-Output-File/" >
    Understanding the cl-support Output File
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Monitoring-and-Troubleshooting/Understanding-the-cl-support-Output-File/Troubleshooting-Log-Files/" >
    Troubleshooting Log Files
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Monitoring-and-Troubleshooting/Understanding-the-cl-support-Output-File/Troubleshooting-the-etc-Directory/" >
    Troubleshooting the etc Directory
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Monitoring-and-Troubleshooting/Troubleshooting-Network-Interfaces/" >
    Troubleshooting Network Interfaces
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Monitoring-and-Troubleshooting/Troubleshooting-Network-Interfaces/Monitoring-Interfaces-and-Transceivers-Using-ethtool/" >
    Monitoring Interfaces and Transceivers Using ethtool
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Monitoring-and-Troubleshooting/Troubleshooting-Network-Interfaces/Monitoring-Interfaces-and-Transceivers-Using-ethtool-ethtool-Counter-Definitions/" >
    Monitoring Interfaces and Transceivers Using ethtool ethtool Counter Definitions
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Monitoring-and-Troubleshooting/Network-Troubleshooting/" >
    Network Troubleshooting
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Monitoring-and-Troubleshooting/Network-Troubleshooting/Using-NCLU-to-Troubleshoot-Your-Network-Configuration/" >
    Using NCLU to Troubleshoot Your Network Configuration
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Monitoring-and-Troubleshooting/Network-Troubleshooting/Monitoring-System-Statistics-and-Network-Traffic-with-sFlow/" >
    Monitoring System Statistics and Network Traffic with sFlow
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Monitoring-and-Troubleshooting/Simple-Network-Management-Protocol-SNMP-Monitoring/" >
    Simple Network Management Protocol (SNMP) Monitoring
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Monitoring-and-Troubleshooting/Simple-Network-Management-Protocol-SNMP-Monitoring/Using-Nutanix-Prism-as-a-Monitoring-Tool/" >
    Using Nutanix Prism as a Monitoring Tool
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Monitoring-and-Troubleshooting/Single-User-Mode-Boot-Recovery/" >
    Single User Mode - Boot Recovery
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Monitoring-and-Troubleshooting/Resource-Diagnostics-Using-cl-resource-query/" >
    Resource Diagnostics Using cl-resource-query
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Monitoring-and-Troubleshooting/Monitoring-Virtual-Device-Counters/" >
    Monitoring Virtual Device Counters
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Monitoring-and-Troubleshooting/ASIC-Monitoring/" >
    ASIC Monitoring
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Monitoring-and-Troubleshooting/Monitoring-Best-Practices/" >
    Monitoring Best Practices
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Monitoring-and-Troubleshooting/switchd-Log-Message-Reference/" >
    switchd Log Message Reference
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Monitoring-and-Troubleshooting/FRRouting-Log-Message-Reference/" >
    FRRouting Log Message Reference
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Network-Solutions/" >
    Network Solutions
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Network-Solutions/Data-Center-Host-to-ToR-Architecture/" >
    Data Center Host to ToR Architecture
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Network-Solutions/Cumulus-Networks-Services-Demos/" >
    Cumulus Networks Services Demos
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Network-Solutions/Docker-on-Cumulus-Linux/" >
    Docker on Cumulus Linux
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Network-Solutions/OpenStack-Neutron-ML2-and-Cumulus-Linux/" >
    OpenStack Neutron ML2 and Cumulus Linux
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Network-Solutions/Anycast-Design-Guide/" >
    Anycast Design Guide
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Network-Solutions/RDMA-over-Converged-Ethernet-RoCE/" >
    RDMA over Converged Ethernet - RoCE
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-linux/Network-Solutions/Cumulus-Hyperconverged-Solution-with-Nutanix/" >
    Cumulus Hyperconverged Solution with Nutanix
  </a>


    </li>
    
  </ul>


  </li>


    
    
  </ul>


  </li>


  
  </ul>









      </nav>

      
      
      
      

      <script src = "/docs.cumulusnetworks.com/js/menuBundle.js"> </script>


    </aside>

    <div class="book-page">

      
      <header class="align-center justify-between book-header">
        <label for="menu-control">
          <img src="/docs.cumulusnetworks.com/svg/menu.svg" alt="Menu" />
        </label>
        <strong>Multi-Chassis Link Aggregation - MLAG</strong>
      </header>

      
      
<article class="markdown">
<h1>Multi-Chassis Link Aggregation - MLAG</h1>

<p>Multi-Chassis Link Aggregation (MLAG) enables a server or switch with a
two-port bond, such as a link aggregation group/LAG, EtherChannel, port
group or trunk, to connect those ports to different switches and operate
as if they are connected to a single, logical switch. This provides
greater redundancy and greater system throughput.</p>


<div class="notices info" > <p><strong>MLAG or CLAG?</strong></p>

<p>The Cumulus Linux implementation of MLAG is referred to by other vendors
as CLAG, MC-LAG or VPC. You will even see references to CLAG in Cumulus
Linux, including the management daemon, named <code>clagd</code>, and other options
in the code, such as <code>clag-id</code>, which exist for historical purposes. The
Cumulus Linux implementation is truly a multi-chassis link aggregation
protocol, so we call it MLAG.</p>
 </div>


<p>Dual-connected devices can create LACP bonds that contain links to each
physical switch. Therefore, active-active links from the dual-connected
devices are supported even though they are connected to two different
physical switches.</p>

<p>A basic setup looks like this:</p>








<img class = "confluence-embedded-image confluence-thumbnail" src = "/images/download/thumbnails/8362677/host_ha1.png" alt = "/images/download/thumbnails/8362677/host_ha1.png"


width = 300

 />



<div class="notices tip" > <p>You can see an example of how to set up this configuration by running:</p>

<pre><code>cumulus@switch:~$ net example clag basic-clag
</code></pre>
 </div>


<p>The two switches, S1 and S2, known as <em>peer switches</em>, cooperate so that
they appear as a single device to host H1&rsquo;s bond. H1 distributes traffic
between the two links to S1 and S2 in any way that you configure on the
host. Similarly, traffic inbound to H1 can traverse S1 or S2 and arrive
at H1.</p>

<h2 id="span-id-src-8362677-multi-chassislinkaggregation-mlag-reqs-class-confluence-anchor-link-span-span-mlag-requirements-span"><span id="src-8362677_Multi-ChassisLinkAggregation-MLAG-reqs" class="confluence-anchor-link"></span><span>MLAG Requirements</span></h2>

<p>MLAG has these requirements:</p>

<ul>
<li><p>There must be a direct connection between the two peer switches
implementing MLAG (S1 and S2). This is typically a bond for
increased reliability and bandwidth.</p></li>

<li><p>There must be only two peer switches in one MLAG configuration, but
you can have multiple configurations in a network for
<em>switch-to-switch MLAG</em> (see below).</p></li>

<li><p>The peer switches implementing MLAG must be running Cumulus Linux
version 2.5 or later.</p></li>

<li><p>You must specify a unique <code>clag-id</code> for every dual-connected bond on
each peer switch; the value must be between 1 and 65535 and must be
the same on both peer switches in order for the bond to be
considered <em>dual-connected</em>.</p></li>

<li><p>The dual-connected devices (servers or switches) can use LACP (IEEE
802.3ad/802.1ax) to form the
<a href="/cumulus-linux/Layer-2/Bonding---Link-Aggregation">bond</a>. In this
case, the peer switches must also use LACP.</p>


<div class="notices tip" > <p>If for some reason you cannot use LACP, you can also use
    <a href="Bonding---Link-Aggregation.html#src-8362653_Bonding-LinkAggregation-balance_xor" target="_blank">balance-xor
    mode</a>
    to dual-connect host-facing bonds in an MLAG environment. If you do,
    you must still configure the same <code>clag_id</code> parameter on the MLAG
    bonds, and it must be the same on both MLAG switches. Otherwise, the
    MLAG switch pair treats the bonds as if they are single-connected.</p>
 </div>
</li>
</ul>

<p>More elaborate configurations are also possible. The number of links
between the host and the switches can be greater than two, and does not
have to be symmetrical:</p>








<img class = "confluence-embedded-image confluence-thumbnail" src = "/images/download/thumbnails/8362677/host_ha2.png" alt = "/images/download/thumbnails/8362677/host_ha2.png"


width = 300

 />


<p>Additionally, because S1 and S2 appear as a single switch to other
bonding devices, you can also connect pairs of MLAG switches to each
other in a switch-to-switch MLAG setup:</p>








<img class = "confluence-embedded-image" src = "/images/download/attachments/8362677/2pair_mlag.png" alt = "/images/download/attachments/8362677/2pair_mlag.png"


 />


<p>In this case, L1 and L2 are also MLAG peer switches, and present a
two-port bond from a single logical system to S1 and S2. S1 and S2 do
the same as far as L1 and L2 are concerned. For a switch-to-switch MLAG
configuration, each switch pair must have a unique system MAC address.
In the above example, switches L1 and L2 each have the same system MAC
address configured. Switch pair S1 and S2 each have the same system MAC
address configured; however, it is a different system MAC address than
the one used by the switch pair L1 and L2.</p>

<h2 id="span-lacp-and-dual-connectedness-span"><span>LACP and Dual-Connectedness</span></h2>

<p>For MLAG to operate correctly, the peer switches must know which links
are <em>dual-connected</em> or are connected to the same host or switch. To do
this, specify a <code>clag-id</code> for every dual-connected bond on each peer
switch; the <code>clag-id</code> must be the same for the corresponding bonds on
both peer switches. Typically, <a href="http://en.wikipedia.org/wiki/Link_Aggregation_Control_Protocol#Link_Aggregation_Control_Protocol" target="_blank">Link Aggregation Control Protocol
(LACP)</a>,
the IEEE standard protocol for managing bonds, is used for verifying
dual-connectedness. LACP runs on the dual-connected device and on each
of the peer switches. On the dual-connected device, the only
configuration requirement is to create a bond that is managed by LACP.</p>

<p>However, if for some reason you cannot use LACP in your environment, you
can configure the bonds in <a href="Bonding---Link-Aggregation.html#src-8362653_Bonding-LinkAggregation-balance_xor" target="_blank">balance-xor
mode</a>.
When using balance-xor mode to dual-connect host-facing bonds in an MLAG
environment, you must configure the <code>clag_id</code> parameter on the MLAG
bonds, which must be the same on both MLAG switches. Otherwise, the
bonds are treated by the MLAG switch pair as if they are
single-connected. In short, dual-connectedness is solely determined by
matching <code>clag_id</code> and any misconnection will <strong>not</strong> be detected.</p>

<p>On each of the peer switches, you must place the links that are
connected to the dual-connected host or switch in the bond. This is true
even if the links are a single port on each peer switch, where each port
is placed into a bond, as shown below:</p>








<img class = "confluence-embedded-image confluence-thumbnail" src = "/images/download/thumbnails/8362677/2l_3h.png" alt = "/images/download/thumbnails/8362677/2l_3h.png"


width = 300

 />


<p>All of the dual-connected bonds on the peer switches have their system
ID set to the MLAG system ID. Therefore, from the point of view of the
hosts, each of the links in its bond is connected to the same system,
and so the host uses both links.</p>

<p>Each peer switch periodically makes a list of the LACP partner MAC
addresses for all of their bonds and sends that list to its peer (using
the <code>clagd</code> service; see below). The LACP partner MAC address is the MAC
address of the system at the other end of a bond (hosts H1, H2, and H3
in the figure above). When a switch receives this list from its peer, it
compares the list to the LACP partner MAC addresses on its switch. If
any matches are found and the <code>clag-id</code> for those bonds match, then that
bond is a dual-connected bond. You can also find the LACP partner MAC
address by the running <code>net show bridge macs</code> command or by examining
the <code>/sys/class/net/&lt;bondname&gt;/bonding/ad_partner_mac sysfs</code> file for
each bond.</p>

<h2 id="span-id-src-8362677-multi-chassislinkaggregation-mlag-configuring-class-confluence-anchor-link-span-span-configure-mlag-span"><span id="src-8362677_Multi-ChassisLinkAggregation-MLAG-configuring" class="confluence-anchor-link"></span><span>Configure MLAG</span></h2>

<p>To configure MLAG, you need to:</p>

<ul>
<li><p>Create a bond that uses LACP, on the dual-connected devices.</p></li>

<li><p>Configure the interfaces, including bonds, VLANs, bridges and peer
links, on each peer switch.</p></li>
</ul>


<div class="notices note" > <p><strong>Keep MLAG Configurations in Sync</strong></p>

<p>MLAG synchronizes the dynamic state between the two peer switches but it
does not synchronize the switch configurations. After modifying the
configuration of one peer switch, you must make the same changes to the
configuration on the other peer switch. This applies to all
configuration changes, including:</p>

<ul>
<li><p>Port configuration; for example, VLAN membership,
<a href="#src-8362677_Multi-ChassisLinkAggregation-MLAG-mtu">MTU</a>, and
bonding parameters.</p></li>

<li><p>Bridge configuration; for example, spanning tree parameters or
bridge properties.</p></li>

<li><p>Static address entries; for example, static FDB entries and static
IGMP entries.</p></li>

<li><p>QoS configuration; for example, ACL entries.</p></li>
</ul>

<p>You can verify the configuration of VLAN membership with the <code>net show
clag verify-vlans</code> <code>verbose</code> command.
<details>
<summary>Click to see the output &hellip; </summary></p>

<pre><code>cumulus@leaf01:~$ net show clag verify-vlans verbose
Our Bond Interface   VlanId   Peer Bond Interface
------------------   ------   -------------------
server01                  1   server01           
server01                 10   server01           
server01                 20   server01           
server01                 30   server01           
server01                 40   server01           
server01                 50   server01           
uplink                    1   uplink             
uplink                   10   uplink             
uplink                   20   uplink             
uplink                   30   uplink             
uplink                   40   uplink             
uplink                   50   uplink             
uplink                  100   uplink             
uplink                  101   uplink             
uplink                  102   uplink             
uplink                  103   uplink             
uplink                  104   uplink             
...                 
</code></pre>

<p></details></p>
 </div>


<h3 id="span-reserved-mac-address-range-span"><span>Reserved MAC Address Range</span></h3>

<p>To prevent MAC address conflicts with other interfaces in the same
bridged network, Cumulus Networks has <a href="https://support.cumulusnetworks.com/hc/en-us/articles/203837076" target="_blank">reserved a range of MAC
addresses</a>
specifically to use with MLAG. This range of MAC addresses is
44:38:39:ff:00:00 to 44:38:39:ff:ff:ff.</p>

<p>Cumulus Networks recommends you use this range of MAC addresses when
configuring MLAG.</p>


<div class="notices note" > <p><strong>Important</strong></p>

<p>You cannot use the same MAC address for different MLAG pairs. Make sure
you specify a different <code>clag sys-mac</code> setting for each MLAG pair in the
network.</p>
 </div>


<h3 id="span-configure-the-host-or-switch-span"><span>Configure the Host or Switch</span></h3>

<p>On your dual-connected device, create a bond that uses LACP. The method
you use varies with the type of device you are configuring. The
following image is a basic MLAG configuration, showing all the essential
elements; a more detailed two-leaf/two-spine configuration is shown
<a href="#src-8362677_Multi-ChassisLinkAggregation-MLAG-example">below</a>.</p>








<img class = "confluence-embedded-image" src = "/images/download/attachments/8362677/mlag_basic.png" alt = "/images/download/attachments/8362677/mlag_basic.png"


width = 500

 />


<h3 id="span-configure-the-interfaces-span"><span>Configure the Interfaces</span></h3>

<p>Place every interface that connects to the MLAG pair from a
dual-connected device into a
<a href="/cumulus-linux/Layer-2/Bonding---Link-Aggregation">bond</a>, even if the
bond contains only a single link on a single physical switch (even
though the MLAG pair contains two or more links). Layer 2 data travels
over this bond. In the examples throughout this chapter, <em>peerlink</em> is
the name of the bond.</p>

<p>Single-attached hosts, also known as <em>orphan ports</em>, can be just a
member of the bridge.</p>

<p>Additionally, configure the fast mode of LACP on the bond to allow more
timely updates of the LACP state. These bonds are then placed in a
bridge, which must include the peer link between the switches.</p>

<p>To enable communication between the <code>clagd</code> services on the peer
switches, do the following:</p>

<ul>
<li><p>Choose an unused VLAN (also known as a <em>switched virtual interface</em>
or <em>SVI</em> here).</p></li>

<li><p>Assign the SVI an unrouteable link-local address to give the peer
switches layer 3 connectivity between each other.</p></li>

<li><p>Configure the VLAN as a <a href="Interface-Configuration-and-Management.html#src-8363023_InterfaceConfigurationandManagement-subinterface" target="_blank">VLAN
subinterface</a>
on the peer link bond rather than the VLAN-aware bridge, called
<em>peerlink</em>. If you&rsquo;re configuring the subinterface with
<a href="/cumulus-linux/System-Configuration/Network-Command-Line-Utility---NCLU">NCLU</a>,
the VLAN subinterface is named 4094 by default (the subinterface
named <em>peerlink.4094</em> below). If you are configuring the peer link
without NCLU, Cumulus Networks still recommends you use 4094 for the
peer link VLAN if possible. This ensures that the VLAN is completely
independent of the bridge and spanning tree forwarding decisions.</p></li>

<li><p>Include untagged traffic on the peer link, as this avoids issues
with STP.</p></li>

<li><p>Specify a backup interface, which is any layer 3 backup interface
for your peer links in case the peer link goes down. While a backup
interface is optional, Cumulus Networks recommends you configure
one. More information about configuring the <a href="#src-8362677_Multi-ChassisLinkAggregation-MLAG-backup">backup
link</a> and
understanding various
<a href="#src-8362677_Multi-ChassisLinkAggregation-MLAG-scenarios">redundancyscenarios</a>
is available below.</p></li>
</ul>

<p>For example, if <em>peerlink</em> is the inter-chassis bond, and VLAN 4094 is
the peer link VLAN, configure <em>peerlink.4094</em> as follows:</p>


<div class="notices tip" > <p><strong>Configuring the peerlink Interface</strong></p>

<pre><code>cumulus@leaf01:~$ net add bond peerlink bond slaves swp49-50
cumulus@leaf01:~$ net add interface peerlink.4094 ip address 169.254.1.1/30
cumulus@leaf01:~$ net add interface peerlink.4094 clag peer-ip 169.254.1.2
cumulus@leaf01:~$ net add interface peerlink.4094 clag backup-ip 192.0.2.50
cumulus@leaf01:~$ net add interface peerlink.4094 clag sys-mac 44:38:39:FF:40:94
cumulus@leaf01:~$ net pending
cumulus@leaf01:~$ net commit
</code></pre>

<p>Do <em>not</em> add VLAN 4094 to the bridge VLAN list; VLAN 4094 for the peer
link subinterface should not also be configured as a bridged VLAN with
bridge VIDs under the bridge.</p>

<p>The above commands save the configuration in the
<code>/etc/network/interfaces</code> file.</p>

<pre><code>auto peerlink
iface peerlink
  bond-slaves swp49 swp50

auto peerlink.4094
iface peerlink.4094  
  address 169.254.1.1/30  
  clagd-peer-ip 169.254.1.2  
  clagd-backup-ip 192.0.2.50  
  clagd-sys-mac 44:38:39:FF:40:94
</code></pre>

<p>To enable MLAG, <em>peerlink</em> must be added to a traditional or VLAN-aware
bridge. The commands below add <em>peerlink</em> to a VLAN-aware bridge:</p>

<pre><code>cumulus@leaf01:~$ net add bridge bridge ports peerlink
cumulus@leaf01:~$ net pending
cumulus@leaf01:~$ net commit
</code></pre>

<p>This creates the following configuration in the
<code>/etc/network/interfaces</code> file:</p>

<pre><code>auto bridge
iface bridge
  bridge-ports peerlink
  bridge-vlan-aware yes
</code></pre>

<div class="confbox admonition admonition-note">

<span class="admonition-icon confluence-information-macro-icon"></span>

<div class="admonition-body">


<div class="notices tip" > <p>If you change the MLAG configuration by editing the <code>interfaces</code> file,
the changes take effect when you bring the peer link interface up with
<code>ifup</code>. Do <strong>not</strong> use <code>systemctl restart clagd.service</code> to apply the
new configuration.</p>
 </div>

<p></div></p>

<p></div></p>
 </div>



<div class="notices warning" > <p><strong>Don&rsquo;t Use 169.254.0.1</strong></p>

<p>Do not use 169.254.0.1 as the MLAG peer link IP address; Cumulus Linux
uses this address exclusively for <a href="/cumulus-linux/Layer-3/Border-Gateway-Protocol---BGP">BGP
unnumbered</a>
interfaces.</p>
 </div>


<h3 id="span-id-src-8362677-multi-chassislinkaggregation-mlag-roles-class-confluence-anchor-link-span-span-switch-roles-and-priority-setting-span"><span id="src-8362677_Multi-ChassisLinkAggregation-MLAG-roles" class="confluence-anchor-link"></span><span>Switch Roles and Priority Setting</span></h3>

<p>Each MLAG-enabled switch in the pair has a <em>role</em>. When the peering
relationship is established between the two switches, one switch is put
into the <em>primary</em> role, and the other into the <em>secondary</em> role. When
an MLAG-enabled switch is in the secondary role, it does not send STP
BPDUs on dual-connected links; it only sends BPDUs on single-connected
links. The switch in the primary role sends STP BPDUs on all single- and
dual-connected links.</p>

<table>
<thead>
<tr>
<th>Sends BPDUs Via</th>
<th>Primary</th>
<th>Secondary</th>
</tr>
</thead>

<tbody>
<tr>
<td>Single-connected links</td>
<td>Yes</td>
<td>Yes</td>
</tr>

<tr>
<td>Dual-connected links</td>
<td>Yes</td>
<td>No</td>
</tr>
</tbody>
</table>

<p>By default, the role is determined by comparing the MAC addresses of the
two sides of the peering link; the switch with the lower MAC address
assumes the primary role. You can override this by setting the
<code>clagd-priority</code> option for the peer link:</p>

<pre><code>cumulus@leaf01:~$ net add interface peerlink.4094 clag priority 2048
cumulus@leaf01:~$ net pending
cumulus@leaf01:~$ net commit
</code></pre>

<p>The switch with the lower priority value is given the primary role; the
default value is 32768 and the range is 0 to 65535. Read the <code>clagd(8)</code>
and <code>clagctl(8)</code> man pages for more information.</p>

<p>When the <code>clagd</code> service is exited during switch reboot or the service
is stopped in the primary switch, the peer switch that is in the
secondary role becomes the primary.</p>

<p>However, if the primary switch goes down without stopping the <code>clagd</code>
service for any reason, or if the peer link goes down, the secondary
switch does <strong>not</strong> change its role. In case the peer switch is
determined to be not alive, the switch in the secondary role rolls back
the LACP system ID to be the bond interface MAC address instead of the
<code>clagd-sys-mac</code> and the switch in primary role uses the <code>clagd-sys-mac</code>
as the LACP system ID on the bonds.</p>

<h2 id="span-id-src-8362677-multi-chassislinkaggregation-mlag-example-class-confluence-anchor-link-span-span-example-mlag-configuration-span"><span id="src-8362677_Multi-ChassisLinkAggregation-MLAG-example" class="confluence-anchor-link"></span><span>Example MLAG Configuration</span></h2>

<p>The example configuration below configures two bonds for MLAG, each with
a single port, a peer link that is a bond with two member ports, and
three VLANs on each port.</p>


<div class="notices tip" > <p>You can see a more traditional layer 2 example configuration in NCLU;
run <code>net example clag l2-with-server-vlan-trunks</code>. For a very basic
configuration with just one pair of switches and a single host, run <code>net
example clag l2-with-server-vlan-trunks</code>.</p>
 </div>









<img class = "confluence-embedded-image confluence-external-resource" src = "/images/raw.githubusercontent.com/CumulusNetworks/cldemo-config-mlag/master/bgp-unnumbered.png" alt = "/images/raw.githubusercontent.com/CumulusNetworks/cldemo-config-mlag/master/bgp-unnumbered.png"

height = 400


 />


<p>You configure these interfaces using
<a href="/cumulus-linux/System-Configuration/Network-Command-Line-Utility---NCLU">NCLU</a>,
so the bridges are in <a href="/cumulus-linux/Layer-2/Ethernet-Bridging---VLANs/VLAN-aware-Bridge-Mode">VLAN-aware
mode</a>.
The bridges use these Cumulus Linux-specific keywords:</p>

<ul>
<li><p><code>bridge-vids</code>, which defines the allowed list of tagged 802.1q VLAN
IDs for all bridge member interfaces. You can specify non-contiguous
ranges with a space-separated list, like<br />
<code>bridge-vids 100-200 300 400-500</code>.</p></li>

<li><p><code>bridge-pvid</code>, which defines the untagged VLAN ID for each port.
This is commonly referred to as the <em>native VLAN</em>.</p></li>
</ul>

<p>The bridge configurations below indicate that each bond carries tagged
frames on VLANs 10, 20, 30, 40, 50, and 100 to 200 (as specified by
<code>bridge-vids</code>), but untagged frames on VLAN 1 (as specified by
<code>bridge-pvid</code>). Also, take note on how you configure the VLAN
subinterfaces used for <code>clagd</code> communication (<em>peerlink.4094</em> in the
sample configuration below). Finally, the host configurations for
server01 through server04 are not shown here. The configurations for
each corresponding node are almost identical, except for the IP
addresses used for managing the <code>clagd</code> service.</p>


<div class="notices note" > <p><strong>VLAN Precautions</strong></p>

<p>At minimum, this VLAN subinterface should not be in your layer 2 domain,
and you should give it a very high VLAN ID (up to 4094). Read more about
the <a href="VLAN-aware-Bridge-Mode.html#src-8362673_VLAN-awareBridgeMode-vlan_range" target="_blank">range of VLAN IDs you can
use</a>.</p>
 </div>


<p>The commands to create the configurations for both spines look like the
following. Note that the <code>clag-id</code> and <code>clagd-sys-mac</code> must be the same
for the corresponding bonds on spine01 and spine02:</p>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p><strong>spine01</strong></p>
<pre><code>cumulus@spine01:~$ net show configuration commands
net add interface swp1-4
net add loopback lo ip address 10.0.0.21/32
net add interface eth0 ip address dhcp</code></pre>
<p>These commands create the following configuration in the <code>/etc/network/interfaces</code> file:</p>
<pre><code>cumulus@spine01:~$ cat /etc/network/interfaces
auto lo
iface lo inet loopback
    address 10.0.0.21/32

auto eth0
iface eth0 inet dhcp

# downlinks
auto swp1
iface swp1

auto swp2
iface swp2

auto swp3
iface swp3

auto swp4
iface swp4</code></pre></td>
<td><p><strong>spine02</strong></p>
<pre><code>cumulus@spine02:~$ net show configuration commands
net add interface swp1-4
net add loopback lo ip address 10.0.0.22/32
net add interface eth0 ip address dhcp</code></pre>
<p>These commands create the following configuration in the <code>/etc/network/interfaces</code> file:</p>
<pre><code>cumulus@spine02:~$ cat /etc/network/interfaces
auto lo
iface lo inet loopback
    address 10.0.0.22/32

auto eth0
iface eth0 inet dhcp

# downlinks
auto swp1
iface swp1

auto swp2
iface swp2

auto swp3
iface swp3

auto swp4
iface swp4</code></pre></td>
</tr>
</tbody>
</table>

<p>Here is an example configuration for the switches leaf01 through leaf04.
Note that the <code>clag-id</code> and <code>clagd-sys-mac</code> must be the same for the
corresponding bonds on leaf01 and leaf02 as well as leaf03 and leaf04:</p>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p><strong>leaf01</strong></p>
<pre><code>cumulus@leaf01:~$ net show configuration commands
net add loopback lo ip address 10.0.0.11/32
net add bgp autonomous-system 65011
net add bgp router-id 10.0.0.11
net add bgp ipv4 unicast network 10.0.0.11/32
net add routing prefix-list ipv4 dc-leaf-in seq 10 permit 0.0.0.0/0
net add routing prefix-list ipv4 dc-leaf-in seq 20 permit 10.0.0.0/24 le 32
net add routing prefix-list ipv4 dc-leaf-in seq 30 permit 172.16.2.0/24
net add routing prefix-list ipv4 dc-leaf-out seq 10 permit 172.16.1.0/24
net add bgp neighbor fabric peer-group
net add bgp neighbor fabric remote-as external
net add bgp ipv4 unicast neighbor fabric prefix-list dc-leaf-in in
net add bgp ipv4 unicast neighbor fabric prefix-list dc-leaf-out out
net add bgp neighbor swp51-52 interface peer-group fabric
net add vlan 100 ip address 172.16.1.1/24
net add bgp ipv4 unicast network 172.16.1.1/24
net add clag peer sys-mac 44:38:39:FF:00:01 interface swp49-50 primary backup-ip 192.168.1.12
net add clag port bond server1 interface swp1 clag-id 1
net add clag port bond server2 interface swp2 clag-id 2
net add bond server1-2 bridge access 100
net add bond server1-2 stp portadminedge
net add bond server1-2 stp bpduguard</code></pre>
<p>These commands create the following configuration in the <code>/etc/network/interfaces</code> file:</p>
<pre><code>cumulus@leaf01:~$ cat /etc/network/interfaces
auto lo
iface lo inet loopback
    address 10.0.0.11/32

auto eth0
iface eth0 inet dhcp

auto swp1
iface swp1

auto swp2
iface swp2

# peerlink
auto swp49
iface swp49
    post-up ip link set $IFACE promisc on     # Only required on VX

auto swp50
iface swp50
    post-up ip link set $IFACE promisc on     # Only required on VX

# uplinks
auto swp51
iface swp51

auto swp52
iface swp52

# bridge to hosts
auto bridge
iface bridge
    bridge-ports peerlink server1 server2
    bridge-vids 100
    bridge-vlan-aware yes

auto peerlink
iface peerlink
    bond-slaves swp49 swp50

auto peerlink.4094
iface peerlink.4094
    clagd-backup-ip 192.168.1.12
    clagd-peer-ip 169.254.1.2
    clagd-priority 1000
    clagd-sys-mac 44:38:39:FF:00:01

auto server1
iface server1
    bond-slaves swp1
    bridge-access 100
    clag-id 1
    mstpctl-bpduguard yes
    mstpctl-portadminedge yes

auto server2
iface server2
    bond-slaves swp2
    bridge-access 100
    clag-id 2
    mstpctl-bpduguard yes
    mstpctl-portadminedge yes

auto vlan100
iface vlan100
    address 172.16.1.1/24
    vlan-id 100
    vlan-raw-device bridge</code></pre></td>
<td><p><strong>leaf02</strong></p>
<pre><code>cumulus@leaf02:~$ net show conf commands
net add loopback lo ip address 10.0.0.12/32
net add bgp autonomous-system 65012
net add bgp router-id 10.0.0.12
net add bgp ipv4 unicast network 10.0.0.12/32
net add routing prefix-list ipv4 dc-leaf-in seq 10 permit 0.0.0.0/0
net add routing prefix-list ipv4 dc-leaf-in seq 20 permit 10.0.0.0/24 le 32
net add routing prefix-list ipv4 dc-leaf-in seq 30 permit 172.16.2.0/24
net add routing prefix-list ipv4 dc-leaf-out seq 10 permit 172.16.1.0/24
net add bgp neighbor fabric peer-group
net add bgp neighbor fabric remote-as external
net add bgp ipv4 unicast neighbor fabric prefix-list dc-leaf-in in
net add bgp ipv4 unicast neighbor fabric prefix-list dc-leaf-out out
net add bgp neighbor swp51-52 interface peer-group fabric
net add vlan 100 ip address 172.16.1.2/24
net add bgp ipv4 unicast network 172.16.1.2/24
net add clag peer sys-mac 44:38:39:FF:00:01 interface swp49-50 secondary backup-ip 192.168.1.11
net add clag port bond server1 interface swp1 clag-id 1
net add clag port bond server2 interface swp2 clag-id 2
net add bond server1-2 bridge access 100
net add bond server1-2 stp portadminedge
net add bond server1-2 stp bpduguard
</code></pre>
<p>These commands create the following configuration in the <code>/etc/network/interfaces</code> file:</p>
<pre><code>cumulus@leaf02:~$ cat /etc/network/interfaces
auto lo
iface lo inet loopback
    address 10.0.0.12/32

auto eth0
iface eth0 inet dhcp

auto swp1
iface swp1

auto swp2
iface swp2

# peerlink
auto swp49
iface swp49
    post-up ip link set $IFACE promisc on     # Only required on VX

auto swp50
iface swp50
    post-up ip link set $IFACE promisc on     # Only required on VX

# uplinks
auto swp51
iface swp51

auto swp52
iface swp52

# bridge to hosts
auto bridge
iface bridge
    bridge-ports peerlink server1 server2
    bridge-vids 100
    bridge-vlan-aware yes

auto peerlink
iface peerlink
    bond-slaves swp49 swp50

auto peerlink.4094
iface peerlink.4094
    clagd-backup-ip 192.168.1.11
    clagd-peer-ip 169.254.1.1
    clagd-sys-mac 44:38:39:FF:00:01

auto server1
iface server1
    bond-slaves swp1
    bridge-access 100
    clag-id 1
    mstpctl-bpduguard yes
    mstpctl-portadminedge yes

auto server2
iface server2
    bond-slaves swp2
    bridge-access 100
    clag-id 2
    mstpctl-bpduguard yes
    mstpctl-portadminedge yes

auto vlan100
iface vlan100
    address 172.16.1.2/24
    vlan-id 100
    vlan-raw-device bridge</code></pre></td>
</tr>
<tr class="even">
<td><p><strong>leaf03</strong></p>
<pre><code>cumulus@leaf03:~$ net show conf commands
net add loopback lo ip address 10.0.0.13/32
net add bgp autonomous-system 65013
net add bgp router-id 10.0.0.13
net add bgp ipv4 unicast network 10.0.0.13/32
net add routing prefix-list ipv4 dc-leaf-in seq 10 permit 0.0.0.0/0
net add routing prefix-list ipv4 dc-leaf-in seq 20 permit 10.0.0.0/24 le 32
net add routing prefix-list ipv4 dc-leaf-in seq 30 permit 172.16.2.0/24
net add routing prefix-list ipv4 dc-leaf-out seq 10 permit 172.16.1.0/24
net add bgp neighbor fabric peer-group
net add bgp neighbor fabric remote-as external
net add bgp ipv4 unicast neighbor fabric prefix-list dc-leaf-in in
net add bgp ipv4 unicast neighbor fabric prefix-list dc-leaf-out out
net add bgp neighbor swp51-52 interface peer-group fabric
net add vlan 100 ip address 172.16.1.3/24
net add bgp ipv4 unicast network 172.16.1.3/24
net add clag peer sys-mac 44:38:39:FF:00:02 interface swp49-50 primary backup-ip 192.168.1.14
net add clag port bond server3 interface swp1 clag-id 3
net add clag port bond server4 interface swp2 clag-id 4
net add bond server3-4 bridge access 100
net add bond server3-4 stp portadminedge
net add bond server3-4 stp bpduguard</code></pre>
<p>These commands create the following configuration in the <code>/etc/network/interfaces</code> file:</p>
<pre><code>cumulus@leaf03:~$ cat /etc/network/interfaces
auto lo
iface lo inet loopback
    address 10.0.0.13/32


auto eth0
iface eth0 inet dhcp


auto swp1
iface swp1


auto swp2
iface swp2


# peerlink
auto swp49
iface swp49
    post-up ip link set $IFACE promisc on     # Only required on VX


auto swp50
iface swp50
    post-up ip link set $IFACE promisc on     # Only required on VX


# uplinks
auto swp51
iface swp51


auto swp52
iface swp52


# bridge to hosts
auto bridge
iface bridge
    bridge-ports peerlink server3 server4
    bridge-vids 100
    bridge-vlan-aware yes


auto peerlink
iface peerlink
    bond-slaves swp49 swp50


auto peerlink.4094
iface peerlink.4094
    clagd-backup-ip 192.168.1.14
    clagd-peer-ip 169.254.1.2
    clagd-priority 1000
    clagd-sys-mac 44:38:39:FF:00:02


auto server3
iface server3
    bond-slaves swp1
    bridge-access 100
    clag-id 3
    mstpctl-bpduguard yes
    mstpctl-portadminedge yes


auto server4
iface server4
    bond-slaves swp2
    bridge-access 100
    clag-id 4
    mstpctl-bpduguard yes
    mstpctl-portadminedge yes

auto vlan100
iface vlan100
    address 172.16.1.3/24
    vlan-id 100
    vlan-raw-device bridge</code></pre></td>
<td><p><strong>leaf04</strong></p>
<pre><code>cumulus@leaf04:~$ net show configuration commands
net add loopback lo ip address 10.0.0.14/32
net add bgp autonomous-system 65014
net add bgp router-id 10.0.0.14
net add bgp ipv4 unicast network 10.0.0.14/32
net add routing prefix-list ipv4 dc-leaf-in seq 10 permit 0.0.0.0/0
net add routing prefix-list ipv4 dc-leaf-in seq 20 permit 10.0.0.0/24 le 32
net add routing prefix-list ipv4 dc-leaf-in seq 30 permit 172.16.2.0/24
net add routing prefix-list ipv4 dc-leaf-out seq 10 permit 172.16.1.0/24
net add bgp neighbor fabric peer-group
net add bgp neighbor fabric remote-as external
net add bgp ipv4 unicast neighbor fabric prefix-list dc-leaf-in in
net add bgp ipv4 unicast neighbor fabric prefix-list dc-leaf-out out
net add bgp neighbor swp51-52 interface peer-group fabric
net add vlan 100 ip address 172.16.1.4/24
net add bgp ipv4 unicast network 172.16.1.4/24
net add clag peer sys-mac 44:38:39:FF:00:02 interface swp49-50 secondary backup-ip 192.168.1.13
net add clag port bond server3 interface swp1 clag-id 3
net add clag port bond server4 interface swp2 clag-id 4
net add bond server3-4 bridge access 100
net add bond server3-4 stp portadminedge
net add bond server3-4 stp bpduguard</code></pre>
<p>These commands create the following configuration in the <code>/etc/network/interfaces</code> file:</p>
<pre><code>cumulus@leaf04:~$ cat /etc/network/interfaces
auto lo
iface lo inet loopback
    address 10.0.0.14/32


auto eth0
iface eth0 inet dhcp


auto swp1
iface swp1


auto swp2
iface swp2


# peerlink
auto swp49
iface swp49
    post-up ip link set $IFACE promisc on     # Only required on VX


auto swp50
iface swp50
    post-up ip link set $IFACE promisc on     # Only required on VX


# uplinks
auto swp51
iface swp51


auto swp52
iface swp52


# bridge to hosts
auto bridge
iface bridge
    bridge-ports peerlink server3 server4
    bridge-vids 100
    bridge-vlan-aware yes


auto peerlink
iface peerlink
    bond-slaves swp49 swp50


auto peerlink.4094
iface peerlink.4094
    clagd-backup-ip 192.168.1.13
    clagd-peer-ip 169.254.1.1
    clagd-sys-mac 44:38:39:FF:00:02


auto server3
iface server3
    bond-slaves swp1
    bridge-access 100
    clag-id 3
    mstpctl-bpduguard yes
    mstpctl-portadminedge yes


auto server4
iface server4
    bond-slaves swp2
    bridge-access 100
    clag-id 4
    mstpctl-bpduguard yes
    mstpctl-portadminedge yes

auto vlan100
iface vlan100
    address 172.16.1.4/24
    vlan-id 100
    vlan-raw-device bridge</code></pre></td>
</tr>
</tbody>
</table>

<h2 id="span-disable-clagd-on-an-interface-span"><span>Disable clagd on an Interface</span></h2>

<p>In the configurations above, the <code>clagd-peer-ip</code> and <code>clagd-sys-mac</code>
parameters are mandatory, while the rest are optional. When mandatory
<code>clagd</code> commands are present under a peer link subinterface, by default
<code>clagd-enable</code> is set to <em>yes</em> and does not need to be specified; to
disable <code>clagd</code> on the subinterface, set <code>clagd-enable</code> to <em>no</em>:</p>

<pre><code>cumulus@spine01:~$ net add interface peerlink.4094 clag enable no
cumulus@spine01:~$ net pending
cumulus@spine01:~$ net commit
</code></pre>

<p>Use <code>clagd-priority</code> to set the role of the MLAG peer switch to primary
or secondary. Each peer switch in an MLAG pair must have the same
<code>clagd-sys-mac</code> setting. Each <code>clagd-sys-mac</code> setting must be unique to
each MLAG pair in the network. For more details, refer to <code>man clagd</code>.</p>

<h2 id="span-check-the-mlag-configuration-status-span"><span>Check the MLAG Configuration Status</span></h2>

<p>You can check the status of your MLAG configuration using the <code>net show
clag</code> command.</p>

<pre><code>cumulus@leaf01:~$ net show clag
The peer is alive
    Peer Priority, ID, and Role: 4096 44:38:39:FF:00:01 primary
     Our Priority, ID, and Role: 8192 44:38:39:FF:00:02 secondary
          Peer Interface and IP: peerlink.4094 169.254.1.1  
                      Backup IP: 192.168.1.12 (inactive)
                     System MAC: 44:38:39:FF:00:01


CLAG Interfaces
Our Interface      Peer Interface     CLAG Id   Conflicts              Proto-Down Reason
----------------   ----------------   -------   --------------------   -----------------
         server1   server1            1         -                      -              
         server2   server2            2         -                      -      
</code></pre>

<p>A command line utility called <code>clagctl</code> is available for interacting
with a running <code>clagd</code> service to get status or alter operational
behavior. For a detailed explanation of the utility, refer to the
<code>clagctl(8)</code>man page.
<details>
<summary>See the clagctl Output &hellip; </summary></p>

<p>The following is a sample output of the MLAG operational status
displayed by <code>clagctl</code>:</p>

<pre><code>The peer is alive
    Peer Priority, ID, and Role: 4096 44:38:39:FF:00:01 primary
     Our Priority, ID, and Role: 8192 44:38:39:FF:00:02 secondary
          Peer Interface and IP: peerlink.4094 169.254.1.1  
                      Backup IP: 192.168.1.12 (inactive)
                     System MAC: 44:38:39:FF:00:01
CLAG Interfaces
Our Interface      Peer Interface     CLAG Id   Conflicts              Proto-Down Reason
----------------   ----------------   -------   --------------------   -----------------
         server1   server1            1         -                      -              
         server2   server2            2         -                      -
</code></pre>

<p></details></p>

<h2 id="span-configure-mlag-with-a-traditional-mode-bridge-span"><span>Configure MLAG with a Traditional Mode Bridge</span></h2>

<p>You can configure MLAG with a bridge in <a href="/cumulus-linux/Layer-2/Ethernet-Bridging---VLANs/Traditional-Bridge-Mode">traditional
mode</a>
instead of <a href="/cumulus-linux/Layer-2/Ethernet-Bridging---VLANs/VLAN-aware-Bridge-Mode">VLAN-aware
mode</a>.</p>

<p>To configure MLAG with a traditional mode bridge, the peer link and all
dual-connected links must be configured as
<a href="/cumulus-linux/Layer-2/Ethernet-Bridging---VLANs/Traditional-Bridge-Mode">untagged/native</a>
ports on a bridge (note the absence of any VLANs in the <code>bridge-ports</code>
line and the lack of the <code>bridge-vlan-aware</code> parameter below):</p>

<pre><code>auto br0
iface br0
  bridge-ports peerlink spine1-2 host1 host2
</code></pre>

<p>The following example shows you how to allow VLAN 100 across the peer
link:</p>

<pre><code>auto br0.100
iface br0.100
  bridge-ports peerlink.100 bond1.100
</code></pre>

<p>For a deeper comparison of traditional versus VLAN-aware bridge modes,
read this <a href="https://support.cumulusnetworks.com/hc/en-us/articles/204909397" target="_blank">knowledge base
article</a>.</p>

<h2 id="span-id-src-8362677-multi-chassislinkaggregation-mlag-protodown-class-confluence-anchor-link-span-span-peer-link-interfaces-and-the-protodown-state-span"><span id="src-8362677_Multi-ChassisLinkAggregation-MLAG-protodown" class="confluence-anchor-link"></span><span>Peer Link Interfaces and the protodown State</span></h2>

<p>In addition to the standard UP and DOWN administrative states, an
interface that is a member of an MLAG bond can also be in a <code>protodown</code>
state. When MLAG detects a problem that might result in connectivity
issues such as traffic black-holing or a network meltdown if the link
carrier was left in an UP state, it can put that interface into
<code>protodown</code> state. Such connectivity issues include:</p>

<ul>
<li><p>When the peer link goes down but the peer switch is up (that is, the
backup link is active).</p></li>

<li><p>When the bond is configured with an MLAG ID, but the <code>clagd</code> service
is not running (whether it was deliberately stopped or simply died).</p></li>

<li><p>When an MLAG-enabled node is booted or rebooted, the MLAG bonds are
placed in a <code>protodown</code> state until the node establishes a
connection to its peer switch, or five minutes have elapsed.</p></li>
</ul>

<p>When an interface goes into a <code>protodown</code> state, it results in a local
OPER DOWN (carrier down) on the interface. As of Cumulus Linux 2.5.5,
the <code>protodown</code> state can be manipulated with the <code>ip link set</code> command.
Given its use in preventing network meltdowns, manually manipulating
<code>protodown</code> is not recommended outside the scope of interaction with the
Cumulus Networks support team.</p>

<p>The following <code>ip link show</code> command output shows an interface in
<code>protodown</code> state. Notice that the link carrier is down (NO-CARRIER):</p>

<pre><code>cumulus@switch:~$ net show bridge link swp1
3: swp1 state DOWN: &lt;NO-CARRIER,BROADCAST,MULTICAST,MASTER,UP&gt; mtu 9216 master pfifo_fast master host-bond1 state DOWN mode DEFAULT qlen 500 protodown on
   link/ether 44:38:39:00:69:84 brd ff:ff:ff:ff:ff:ff
</code></pre>

<h3 id="span-id-src-8362677-multi-chassislinkaggregation-mlag-backup-class-confluence-anchor-link-span-span-specify-a-backup-link-span"><span id="src-8362677_Multi-ChassisLinkAggregation-MLAG-backup" class="confluence-anchor-link"></span><span>Specify a Backup Link</span></h3>

<p>You can specify a backup link for your peer links in case the peer link
goes down. When this happens, the <code>clagd</code> service uses the backup link
to check the health of the peer switch. To configure a backup link, add
<code>clagd-backup-ip &lt;ADDRESS&gt;</code>to the peer link configuration:</p>

<pre><code>cumulus@spine01:~$ net add interface peerlink.4094 clag backup-ip 192.0.2.50
cumulus@spine01:~$ net pending
cumulus@spine01:~$ net commit
</code></pre>

<p>The backup IP address must be different than the peer link IP address
(<code>clagd-peer-ip</code>). It must be reachable by a route that does not use the
peer link and it must be in the same network namespace as the peer link
IP address.</p>

<p>Cumulus Networks recommends you use the switch&rsquo;s loopback or management
IP address for this purpose. Which one should you choose?</p>

<ul>
<li><p>If your MLAG configuration has <strong>routed uplinks</strong> (a modern approach
to the data center fabric network), then configure <code>clagd</code> to use
the peer switch <strong>loopback</strong> address for the health check. When the
peer link is down, the secondary switch must route towards the
loopback address using uplinks (towards spine layer). If the primary
switch is also suffering a more significant problem (for example,
<code>switchd</code> is unresponsive /or stopped), then the secondary switch
eventually promotes itself to primary and traffic now flows
normally.</p>

<p>To ensure IP connectivity between the loopbacks, you must carefully
consider what implications this has on the BGP ASN configured:</p>

<ul>
<li><p>The two MLAG member switches must use unique BGP ASNs, <strong>or</strong>,</p></li>

<li><p>If the two MLAG member switches use the same BGP ASN, then you
must bypass the BGP loop prevention check on AS_PATH attribute.</p></li>
</ul></li>

<li><p>If your MLAG configuration has <strong>bridged uplinks</strong> (such as a campus
network or a large, flat layer 2 network), then configure <code>clagd</code> to
use the peer switch <strong>eth0</strong> address for the health check. When the
peer link is down, the secondary switch must route towards the eth0
address using the OOB network (provided you have implemented an OOB
network).</p></li>
</ul>

<p>You can also specify the backup UDP port. The port defaults to 5342, but
you can configure it as an argument in <code>clagd-args</code> using <code>--backupPort
&lt;PORT&gt;</code>.</p>

<pre><code>cumulus@spine01:~$ net add interface peerlink.4094 clag args --backupPort 5400
cumulus@spine01:~$ net pending
cumulus@spine01:~$ net commit
</code></pre>

<p>To see the backup IP address, run the <code>net show clag</code> command:</p>

<pre><code>cumulus@spine01:~$ net show clag
The peer is alive
     Our Priority, ID, and Role: 32768 44:38:39:00:00:41 primary
    Peer Priority, ID, and Role: 32768 44:38:39:00:00:42 secondary
          Peer Interface and IP: peerlink.4094 169.254.1.1
                      Backup IP: 192.168.0.22 (active)
                     System MAC: 44:38:39:FF:40:90

CLAG Interfaces
Our Interface      Peer Interface     CLAG Id   Conflicts              Proto-Down Reason
----------------   ----------------   -------   --------------------   -----------------
       leaf03-04   leaf03-04          1034      -                      -              
       exit01-02   -                  2930      -                      -              
       leaf01-02   leaf01-02          1012      -                      -
</code></pre>

<h3 id="span-id-src-8362677-multi-chassislinkaggregation-mlag-vrf-backup-class-confluence-anchor-link-span-span-specify-a-backup-link-to-a-vrf-span"><span id="src-8362677_Multi-ChassisLinkAggregation-MLAG-vrf_backup" class="confluence-anchor-link"></span><span>Specify a Backup Link to a VRF</span></h3>

<p>You can configure the backup link to a
<a href="/cumulus-linux/Layer-3/Virtual-Routing-and-Forwarding---VRF">VRF</a> or
<a href="/cumulus-linux/Layer-3/Management-VRF">management VRF</a>. Include the
name of the VRF or management VRF with the <code>clagd-backup-ip</code>command.
Here is a sample configuration:</p>

<pre><code>cumulus@spine01:~$ net add interface peerlink.4094 clag backup-ip 192.168.0.22 vrf mgmt
cumulus@spine01:~$ net pending
cumulus@spine01:~$ net commit
</code></pre>

<p>You cannot use the VRF on a peer link subinterface.</p>

<p>Verify the backup link by running the <code>net show clag backup-ip</code> command:</p>

<pre><code>cumulus@leaf01:~$ net show clag backup-ip
Backup info:
IP: 192.168.0.12; State: active; Role: primary
Peer priority and id: 32768 44:38:39:00:00:12; Peer role: secondary          
</code></pre>

<p><strong>Comparing VRF and Management VRF Configurations</strong></p>

<p>The configuration for both a VRF and management VRF is exactly the same.
The following example shows a configuration where the backup interface
is in a VRF:</p>

<pre><code>cumulus@leaf01:~$ net show configuration

...

auto swp52s0
iface swp52s0
    address 192.0.2.1/24
    vrf green

auto green
iface green
    vrf-table auto

auto peer5.4000
iface peer5.4000
        address 192.0.2.15/24
        clagd-peer-ip 192.0.2.16
        clagd-backup-ip 192.0.2.2 vrf green
        clagd-sys-mac 44:38:39:01:01:01    
...
</code></pre>

<p>You can verify the configuration with the <code>net show clag status verbose</code>
command:</p>

<pre><code>cumulus@leaf01:~$ net show clag status verbose
The peer is alive
    Peer Priority, ID, and Role: 32768 00:02:00:00:00:13 primary
     Our Priority, ID, and Role: 32768 c4:54:44:f6:44:5a secondary
          Peer Interface and IP: peer5.4000 192.0.2.2
                      Backup IP: 192.0.2.2 vrf green (active)
                     System MAC: 44:38:39:01:01:01

CLAG Interfaces
Our Interface      Peer Interface     CLAG Id   Conflicts              Proto-Down Reason
----------------   ----------------   -------   --------------------   -----------------
           bond4   bond4              4         -                      -              
           bond1   bond1              1         -                      -              
           bond2   bond2              2         -                      -              
           bond3   bond3              3         -                      -     

...
</code></pre>

<h2 id="span-monitor-dual-connected-peers-span"><span>Monitor Dual-Connected Peers</span></h2>

<p>Upon receipt of a valid message from its peer, the switch knows that
<code>clagd</code> is alive and executing on that peer. This causes <code>clagd</code> to
change the system ID of each bond that is assigned a <code>clag-id</code> from the
default value (the MAC address of the bond) to the system ID assigned to
both peer switches. This makes the hosts connected to each switch act as
if they are connected to the same system so that they use all ports
within their bond. Additionally, <code>clagd</code> determines which bonds are
dual-connected and modifies the forwarding and learning behavior to
accommodate these dual-connected bonds.</p>

<p>If the peer does not receive any messages for three update intervals,
then that peer switch is assumed to no longer be acting as an MLAG peer.
In this case, the switch reverts all configuration changes so that it
operates as a standard non-MLAG switch. This includes removing all
statically assigned MAC addresses, clearing the egress forwarding mask,
and allowing addresses to move from any port to the peer port. After a
message is again received from the peer, MLAG operation starts again as
described earlier. You can configure a custom timeout setting by adding
<code>--peerTimeout &lt;VALUE&gt;</code> to <code>clagd-args</code>, like this:</p>

<pre><code>cumulus@spine01:~$ net add interface peerlink.4094 clag args --peerTimeout 900
cumulus@spine01:~$ net pending
cumulus@spine01:~$ net commit
</code></pre>

<p>After bonds are identified as dual-connected, <code>clagd</code> sends more
information to the peer switch for those bonds. The MAC addresses (and
VLANs) that are dynamically learned on those ports are sent along with
the LACP partner MAC address for each bond. When a switch receives MAC
address information from its peer, it adds MAC address entries on the
corresponding ports. As the switch learns and ages out MAC addresses, it
informs the peer switch of these changes to its MAC address table so
that the peer can keep its table synchronized. Periodically, at 45% of
the bridge ageing time, a switch sends its entire MAC address table to
the peer, so that peer switch can verify that its MAC address table is
properly synchronized.</p>

<p>The switch sends an update frequency value in the messages to its peer,
which tells <code>clagd</code> how often the peer will send these messages. You can
configure a different frequency by adding <code>--lacpPoll &lt;SECONDS&gt;</code> to
<code>clagd-args</code>:</p>

<pre><code>cumulus@spine01:~$ net add interface peerlink.4094 clag args --lacpPoll 900
cumulus@spine01:~$ net pending
cumulus@spine01:~$ net commit
</code></pre>

<h2 id="span-configure-layer-3-routed-uplinks-span"><span>Configure Layer 3 Routed Uplinks</span></h2>

<p>In this scenario, the spine switches connect at layer 3, as shown in the
image below. Alternatively, the spine switches can be singly connected
to each core switch at layer 3 (not shown below).</p>








<img class = "confluence-embedded-image" src = "/images/download/attachments/8362677/mlag_cfg_l3.png" alt = "/images/download/attachments/8362677/mlag_cfg_l3.png"


width = 500

 />


<p>In this design, the spine switches route traffic between the server
hosts in the layer 2 domains and the core. The servers (host1 thru
host4) each have a layer 2 connection up to the spine layer where the
default gateway for the host subnets resides. However, since the spine
switches as gateway devices communicate at layer 3, you need to
configure a protocol such as
<a href="/cumulus-linux/Layer-2/Virtual-Router-Redundancy---VRR-and-VRRP">VRR</a>
(virtual router redundancy) between the spine switch pair to support
active/active forwarding.</p>

<p>Then, to connect the spine switches to the core switches, you need to
determine whether the routing is static or dynamic. If it is dynamic,
you must choose which protocol 
<a href="/cumulus-linux/Layer-3/Open-Shortest-Path-First---OSPF">OSPF</a> or
<a href="/cumulus-linux/Layer-3/Border-Gateway-Protocol---BGP">BGP</a>  to use.
When enabling a routing protocol in an MLAG environment, it is also
necessary to manage the uplinks, because by default MLAG is not aware of
layer 3 uplink interfaces. In the event of a peer link failure, MLAG
does not remove static routes or bring down a BGP or OSPF adjacency
unless a separate link state daemon such as <code>ifplugd</code>is used.</p>

<p><strong>MLAG and Peer Link Peering</strong></p>

<p>When using MLAG with VRR, Cumulus Networks recommends you set up a
routed adjacency across the peerlink.4094 interface. If a routed
connection is not built across the peer link, then during uplink failure
on one of the switches in the MLAG pair, egress traffic can be
blackholed if it hashes to the leaf whose uplinks are down.</p>

<p>To set up the adjacency, configure a
<a href="Border-Gateway-Protocol---BGP.html#src-8362926_BorderGatewayProtocol-BGP-unnumbered" target="_blank">BGP</a>
or
<a href="Open-Shortest-Path-First---OSPF.html#src-8362922_OpenShortestPathFirst-OSPF-ospf_unnum" target="_blank">OSPF</a>
unnumbered peering, as appropriate for your network.</p>

<p>For example, if you are using BGP, use a configuration like this:</p>

<pre><code>cumulus@switch:~$ net add bgp neighbor peerlink.4094 interface remote-as internal
cumulus@switch:~$ net commit
</code></pre>

<p>If you are using OSPF, use a configuration like this:</p>

<pre><code>cumulus@switch:~$ net add interface peerlink.4094 ospf area 0.0.0.1
cumulus@switch:~$ net commit
</code></pre>

<p>If you are using
<a href="/cumulus-linux/Network-Virtualization/Ethernet-Virtual-Private-Network---EVPN">EVPN</a>
and MLAG, you need to enable the EVPN address family across the
peerlink.4094 interface as well:</p>

<pre><code>cumulus@switch:~$ net add bgp neighbor peerlink.4094 interface remote-as internal
cumulus@switch:~$ net add bgp l2vpn evpn neighbor peerlink.4094 activate
cumulus@switch:~$ net commit
</code></pre>

<p>Be aware of an existing issue when you use NCLU to create an iBGP
peering, it creates an eBGP peering instead. For more information, see
<a href="https://support.cumulusnetworks.com/hc/en-us/articles/360007793174-Cumulus-Linux-3-7-Release-Notes#RN1222" target="_blank">release
note 1222</a>.</p>

<h2 id="span-igmp-snooping-with-mlag-span"><span>IGMP Snooping with MLAG</span></h2>

<p><a href="/cumulus-linux/Layer-2/IGMP-and-MLD-Snooping">IGMP snooping</a> processes
IGMP reports received on a bridge port in a bridge to identify hosts
that are configured to receive multicast traffic destined to that group.
An IGMP query message received on a port is used to identify the port
that is connected to a router and configured to receive multicast
traffic.</p>

<p>IGMP snooping is enabled by default on the bridge. IGMP snooping
multicast database entries and router port entries are synced to the
peer MLAG switch. If there is no multicast router in the VLAN, you can
configure the IGMP querier on the switch to generate IGMP query
messages. For more information, read the <a href="/cumulus-linux/Layer-2/IGMP-and-MLD-Snooping">IGMP and MLD
Snooping</a> chapter.</p>

<h2 id="span-monitor-the-status-of-the-clagd-service-span"><span>Monitor the Status of the clagd Service</span></h2>

<p>Due to the critical nature of the <code>clagd</code> service, <code>systemd</code>
continuously monitors the status of <code>clagd</code>. <code>systemd</code> monitors the
<code>clagd</code> service through the use of notify messages every 30 seconds. If
the <code>clagd</code> service dies or becomes unresponsive for any reason and
<code>systemd</code> receives no messages after 60 seconds, <code>systemd</code> restarts
<code>clagd</code>. <code>systemd</code> logs these failures in <code>/var/log/syslog</code>, and, on the
first failure, generates a <code>cl-support</code>file as well.</p>

<p>This monitoring is automatically configured and enabled as long as
<code>clagd</code> is enabled (that is, <code>clagd-peer-ip</code> and <code>clagd-sys-mac</code> are
configured for an interface) and the <code>clagd</code> service is running. When
<code>clagd</code> is explicitly stopped, for example with the <code>systemctl stop
clagd.service</code> command, monitoring of <code>clagd</code> is also stopped.</p>

<p><strong>Check clagd Status</strong></p>

<p>You can check the status of <code>clagd</code> monitoring by using the
<code>cl-service-summary</code> command:</p>

<pre><code>cumulus@switch:~$ sudo cl-service-summary summary
The systemctl daemon 5.4 uptime: 15m

...

Service clagd        enabled    active

...
</code></pre>

<p>Or the <code>systemctl status</code> command:</p>

<pre><code>cumulus@switch:~$ sudo systemctl status clagd.service
 clagd.service - Cumulus Linux Multi-Chassis LACP Bonding Daemon
   Loaded: loaded (/lib/systemd/system/clagd.service; enabled)
   Active: active (running) since Mon 2016-10-03 20:31:50 UTC; 4 days ago
     Docs: man:clagd(8)
 Main PID: 1235 (clagd)
   CGroup: /system.slice/clagd.service
           1235 /usr/bin/python /usr/sbin/clagd --daemon 169.254.255.2 peerlink.4094 44:38:39:FF:40:90 --prior...
           1307 /sbin/bridge monitor fdb


Feb 01 23:19:30 leaf01 clagd[1717]: Cleanup is executing.
Feb 01 23:19:31 leaf01 clagd[1717]: Cleanup is finished
Feb 01 23:19:31 leaf01 clagd[1717]: Beginning execution of clagd version 1.3.0
Feb 01 23:19:31 leaf01 clagd[1717]: Invoked with: /usr/sbin/clagd --daemon 169.254.255.2 peerlink.4094 44:38:39:FF:40:94 --pri...168.0.12
Feb 01 23:19:31 leaf01 clagd[1717]: Role is now secondary
Feb 01 23:19:31 leaf01 clagd[1717]: Initial config loaded
Feb 01 23:19:31 leaf01 systemd[1]: Started Cumulus Linux Multi-Chassis LACP Bonding Daemon.
Feb 01 23:24:31 leaf01 clagd[1717]: HealthCheck: reload timeout.
Feb 01 23:24:31 leaf01 clagd[1717]: Role is now primary; Reload timeout
Hint: Some lines were ellipsized, use -l to show in full.
</code></pre>

<h2 id="span-mlag-best-practices-span"><span>MLAG Best Practices</span></h2>

<p>For MLAG to function properly, you must configure the dual-connected
host interfaces identically on the pair of peering switches. See the
note above in the <a href="#src-8362677_Multi-ChassisLinkAggregation-MLAG-configuring">Configuring
MLAG</a>
section.</p>

<h3 id="span-id-src-8362677-multi-chassislinkaggregation-mlag-mtu-class-confluence-anchor-link-span-span-mtu-in-an-mlag-configuration-span"><span id="src-8362677_Multi-ChassisLinkAggregation-MLAG-mtu" class="confluence-anchor-link"></span><span>MTU in an MLAG Configuration</span></h3>

<p>The best way to configure
<a href="/cumulus-linux/Layer-1-and-Switch-Ports/Interface-Configuration-and-Management/Switch-Port-Attributes">MTU</a>
in MLAG is to set the MTU at the system level, as per the documentation
for <a href="Switch-Port-Attributes.html#src-8363026_SwitchPortAttributes-global_mtu" target="_blank">setting a policy for a global system
MTU</a>.</p>

<p>Otherwise, traffic is determined by the bridge MTU. Bridge MTU in turn
is determined by the lowest MTU setting of an interface that is a member
of the bridge. If you want to set an MTU other than the default of 1500
bytes, you must configure the MTU on each physical interface and bond
interface that are members of the MLAG bridges in the entire bridged
domain.</p>

<p>For example, if an MTU of 9216 is desired through the MLAG domain in the
example shown above, on all four leaf switches, configure <code>mtu 9216</code> for
each of the following bond interfaces, as they are members of the bridge
named <em>bridge</em>: peerlink, uplink, server01.</p>

<pre><code>cumulus@leaf01:~$ net add bond peerlink mtu 9216
cumulus@leaf01:~$ net add bond uplink mtu 9216
cumulus@leaf01:~$ net add bond server01 mtu 9216
cumulus@leaf01:~$ net pending
cumulus@leaf01:~$ net commit
</code></pre>

<p>The above commands produce the following configuration in the
<code>/etc/network/interfaces</code> file:</p>

<pre><code>auto bridge
iface bridge
  bridge-ports peerlink uplink server01

auto peerlink
iface peerlink
    mtu 9216

auto server01
iface server01
    mtu 9216

auto uplink
iface uplink
    mtu 9216
</code></pre>

<p>Likewise, to ensure the MTU 9216 path is respected through the spine
switches above, also change the MTU setting for bridge <em>bridge</em> by
configuring <code>mtu 9216</code> for each of the following members of bridge
<em>bridge</em> on both spine01 and spine02: leaf01-02, leaf03-04, exit01-02,
peerlink.</p>

<pre><code>cumulus@spine01:~$ net add bond leaf01-02 mtu 9216
cumulus@spine01:~$ net add bond leaf03-04 mtu 9216
cumulus@spine01:~$ net add bond exit01-02 mtu 9216
cumulus@spine01:~$ net add bond peerlink mtu 9216
cumulus@spine01:~$ net pending
cumulus@spine01:~$ net commit
</code></pre>

<p>The above commands produce the following configuration in the
<code>/etc/network/interfaces</code> file:</p>

<pre><code>auto bridge
iface bridge
  bridge-ports leaf01-02 leaf03-04 exit01-02 peerlink

auto exit01-02
iface exit01-02
    mtu 9216

auto leaf01-02
iface leaf01-02
    mtu 9216

auto leaf03-04
iface leaf03-04
    mtu 9216

auto peerlink
iface peerlink
    mtu 9216
</code></pre>

<h3 id="span-peer-link-sizing-span"><span>Peer Link Sizing</span></h3>

<p>The peer link carries very little traffic when compared to the bandwidth
consumed by dataplane traffic. In a typical MLAG configuration, most
every connection between the two switches in the MLAG pair is
dual-connected, so the only traffic going across the peer link is
traffic from the <code>clagd</code> process and some LLDP or LACP traffic; the
traffic received on the peer link is not forwarded out of the
dual-connected bonds.</p>

<p>However, there are some instances where a host is connected to only one
switch in the MLAG pair; for example:</p>

<ul>
<li><p>You have a hardware limitation on the host where there is only one
PCIE slot, and therefore, one NIC on the system, so the host is only
single-connected across that interface.</p></li>

<li><p>The host does not support 802.3ad and you cannot create a bond on
it.</p></li>

<li><p>You are accounting for a link failure, where the host may become
single connected until the failure is rectified.</p></li>
</ul>

<p>In general, you need to determine how much bandwidth is traveling across
the single-connected interfaces, and allocate half of that bandwidth to
the peer link. We recommend half of the single-connected bandwidth
because, on average, one half of the traffic destined to the
single-connected host arrives on the switch directly connected to the
single-connected host and the other half arrives on the switch that is
not directly connected to the single-connected host. When this happens,
only the traffic that arrives on the switch that is not directly
connected to the single-connected host needs to traverse the peer link,
which is how you calculate 50% of the traffic.</p>

<p>In addition, you might want to add extra links to the peer link bond to
handle link failures in the peer link bond itself.</p>

<p>In the illustration below, each host has two 10G links, with each 10G
link going to each switch in the MLAG pair. Each host has 20G of
dual-connected bandwidth, so all three hosts have a total of 60G of
dual-connected bandwidth. We recommend you allocate at least 15G of
bandwidth to each peer link bond, which represents half of the
single-connected bandwidth.</p>








<img class = "confluence-embedded-image" src = "/images/download/attachments/8362677/MLAG_UD-729.png" alt = "/images/download/attachments/8362677/MLAG_UD-729.png"

height = 250


 />


<p>Scaling this example out to a full rack, when planning for link
failures, you need only allocate enough bandwidth to meet your site&rsquo;s
strategy for handling failure scenarios. Imagine a full rack with 40
servers and two switches. You might plan for four to six servers to lose
connectivity to a single switch and become single connected before you
respond to the event. So expanding upon our previous example, if you
have 40 hosts each with 20G of bandwidth dual-connected to the MLAG
pair, you might allocate 20G to 30G of bandwidth to the peer link 
which accounts for half of the single-connected bandwidth for four to
six hosts.</p>

<h3 id="span-id-src-8362677-multi-chassislinkaggregation-mlag-scenarios-class-confluence-anchor-link-span-span-failover-redundancy-scenarios-span"><span id="src-8362677_Multi-ChassisLinkAggregation-MLAG-scenarios" class="confluence-anchor-link"></span><span>Failover Redundancy Scenarios</span></h3>

<p>To get a better understanding of how STP and LACP behave in response to
various failover redundancy scenarios, read <a href="https://support.cumulusnetworks.com/hc/en-us/articles/217942577-Understanding-MLAG-Redundancy-Scenarios" target="_blank">this knowledge base
article</a>.</p>

<h2 id="span-stp-interoperability-with-mlag-span"><span>STP Interoperability with MLAG</span></h2>

<p>Cumulus Networks recommends that you always enable STP in your layer 2
network.</p>

<p>With MLAG, Cumulus Networks recommends you enable BPDU guard on the
host-facing bond interfaces. For more information about BPDU guard, see
<a href="Spanning-Tree-and-Rapid-Spanning-Tree.html#src-8362689_SpanningTreeandRapidSpanningTree-bpdu" target="_blank">BPDU Guard and Bridge
Assurance</a>.</p>


<div class="notices tip" > <p><strong>Debug STP with MLAG</strong></p>

<p>Running <code>net show &lt;interface&gt; spanning-tree</code> displays MLAG information
that can be useful when debugging:</p>

<pre><code>cumulus@switch:~$ net show bridge spanning-tree
bridge:peerlink CIST info
  enabled            yes                     role                 Designated
  port id            8.002                   state                forwarding
  ..............
  bpdufilter port    no                     
  clag ISL           yes                     clag ISL Oper UP     yes
  clag role          primary                 clag dual conn mac   00:00:00:00:00:00
  clag remote portID F.FFF                   clag system mac      44:38:39:FF:40:90
</code></pre>
 </div>


<h3 id="span-best-practices-for-stp-with-mlag-span"><span>Best Practices for STP with MLAG</span></h3>

<ul>
<li><p>The STP global configuration must be the same on both peer switches.</p></li>

<li><p>The STP configuration for dual-connected ports should be the same on
both peer switches.</p></li>

<li><p>The STP priority must be the same on both peer switches. You set the
priority with this command:</p>

<pre><code>cumulus@switch:~$ net add bridge stp treeprio PRIORITY_VALUE
cumulus@switch:~$ net commit
</code></pre></li>

<li><p>Use
<a href="/cumulus-linux/System-Configuration/Network-Command-Line-Utility---NCLU">NCLU</a>
(<code>net</code>) commands for all spanning tree configurations, including
bridge priority, path cost and so forth. Do not use <code>brctl</code> commands
for spanning tree, except for <code>brctl stp on/off</code>, as changes are not
reflected to <code>mstpd</code> and can create conflicts.</p></li>
</ul>

<h2 id="span-troubleshooting-span"><span>Troubleshooting</span></h2>

<p>Here are some troubleshooting tips.</p>

<h3 id="span-view-the-mlag-log-file-span"><span>View the MLAG Log File</span></h3>

<p>By default, when <code>clagd</code> is running, it logs its status to the
<code>/var/log/clagd.log</code> file and <code>syslog</code>. Example log file output is
below:</p>

<pre><code>cumulus@spine01:~$ sudo tail /var/log/clagd.log
2016-10-03T20:31:50.471400+00:00 spine01 clagd[1235]: Initial config loaded
2016-10-03T20:31:52.479769+00:00 spine01 clagd[1235]: The peer switch is active.
2016-10-03T20:31:52.496490+00:00 spine01 clagd[1235]: Initial data sync to peer done.
2016-10-03T20:31:52.540186+00:00 spine01 clagd[1235]: Role is now primary; elected
2016-10-03T20:31:54.250572+00:00 spine01 clagd[1235]: HealthCheck: role via backup is primary
2016-10-03T20:31:54.252642+00:00 spine01 clagd[1235]: HealthCheck: backup active
2016-10-03T20:31:54.537967+00:00 spine01 clagd[1235]: Initial data sync from peer done.
2016-10-03T20:31:54.538435+00:00 spine01 clagd[1235]: Initial handshake done.
2016-10-03T20:31:58.527464+00:00 spine01 clagd[1235]: leaf03-04 is now dual connected.
2016-10-03T22:47:35.255317+00:00 spine01 clagd[1235]: leaf01-02 is now dual connected.
</code></pre>

<h3 id="span-id-src-8362677-multi-chassislinkaggregation-mlag-drops-class-confluence-anchor-link-span-span-large-packet-drops-on-the-peer-link-interface-span"><span id="src-8362677_Multi-ChassisLinkAggregation-MLAG-drops" class="confluence-anchor-link"></span><span>Large Packet Drops on the Peer Link Interface</span></h3>

<p>A large volume of packet drops across one of the peer link interfaces
can be expected. These drops serve to prevent looping of BUM (broadcast,
unknown unicast, multicast) packets. When a packet is received across
the peer link, if the destination lookup results in an egress interface
that is a dual-connected bond, the switch does not forward the packet to
prevent loops. This results in a drop being recorded on the peer link.</p>

<p>You can detect this issue by running the <code>net show counters</code> or <code>ethtool
-S &lt;interface&gt;</code> command.</p>

<p>Using
<a href="/cumulus-linux/System-Configuration/Network-Command-Line-Utility---NCLU">NCLU</a>,
the number of dropped packets is displayed in the RX_DRP column when
you run <code>net show counters</code>:</p>

<pre><code>cumulus@switch:~$ net show counters

Kernel Interface table
Iface              MTU    Met    RX_OK    RX_ERR    RX_DRP    RX_OVR    TX_OK    TX_ERR    TX_DRP    TX_OVR  Flg
---------------  -----  -----    -------  --------  --------  --------  -------  --------  --------  ------  -----
peerlink        1500       0      19226721     0      2952460  0       55115330     0       364      0       BMmRU
peerlink.4094   1500       0      0            0      0        0       5379243      0       0        0       BMRU
swp51           1500       0      6587220      0      2129676  0       38957769     0       202      0       BMsRU
swp52           1500       0      12639501     0      822784   0       16157561     0       162      0       BMsRU
</code></pre>

<p>When you run <code>ethtool -S</code> on a peer link interface, the drops are
indicated by the <code>HwIfInDiscards</code> counter:</p>

<pre><code>cumulus@switch:~$ sudo ethtool -S swp51
NIC statistics:
HwIfInOctets: 669507330
HwIfInUcastPkts: 658871
HwIfInBcastPkts: 2231559
HwIfInMcastPkts: 3696790
HwIfOutOctets: 2752224343
HwIfOutUcastPkts: 1001632
HwIfOutMcastPkts: 3743199
HwIfOutBcastPkts: 34212938
HwIfInDiscards: 2129675
</code></pre>

<h3 id="span-duplicate-lacp-partner-mac-warning-span"><span>Duplicate LACP Partner MAC Warning</span></h3>

<p>When you run <code>clagctl</code>, you may see output like this:</p>

<pre><code>bond01 bond01 52 duplicate lacp - partner mac
</code></pre>

<p>This occurs when you have multiple LACP bonds between the same two LACP
endpoints  for example, an MLAG switch pair is one endpoint and an ESXi
host is another. These bonds have duplicate LACP identifiers, which are
MAC addresses. This same warning could be triggered when you have a
cabling or configuration error.</p>

<h2 id="span-caveats-and-errata-span"><span>Caveats and Errata</span></h2>

<ul>
<li><p>If both the backup and peer connectivity are lost within a 30-second
window, the switch in the secondary role misinterprets the event
sequence, believing the peer switch is down, so it takes over as the
primary.</p></li>

<li><p>MLAG is disabled on the chassis, including the <a href="https://cumulusnetworks.com/products/cumulus-express/getting-started/backpack/" target="_blank">Facebook
Backpack</a>
and EdgeCore OMP-800.</p></li>
</ul>
</article>

      <script src="https://utteranc.es/client.js"
        repo="CumulusNetworks/docs-internal"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
      </script>

    </div>
    

      


  

    <aside class="book-toc fixed">

  
    <div class="toc">
    
      <button>
      <a href="https://github.com/CumulusNetworks/docs/edit/master/content/cumulus-linux/Layer-2/Multi-Chassis-Link-Aggregation---MLAG.md" target="_blank" rel="noopener"><img src="/docs.cumulusnetworks.com/svg/pencil-circle.svg" alt="Edit" /> Edit this page</a>
      </button>
    
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#span-id-src-8362677-multi-chassislinkaggregation-mlag-reqs-class-confluence-anchor-link-span-span-mlag-requirements-span"><span id="src-8362677_Multi-ChassisLinkAggregation-MLAG-reqs" class="confluence-anchor-link"></span><span>MLAG Requirements</span></a></li>
<li><a href="#span-lacp-and-dual-connectedness-span"><span>LACP and Dual-Connectedness</span></a></li>
<li><a href="#span-id-src-8362677-multi-chassislinkaggregation-mlag-configuring-class-confluence-anchor-link-span-span-configure-mlag-span"><span id="src-8362677_Multi-ChassisLinkAggregation-MLAG-configuring" class="confluence-anchor-link"></span><span>Configure MLAG</span></a>
<ul>
<li><a href="#span-reserved-mac-address-range-span"><span>Reserved MAC Address Range</span></a></li>
<li><a href="#span-configure-the-host-or-switch-span"><span>Configure the Host or Switch</span></a></li>
<li><a href="#span-configure-the-interfaces-span"><span>Configure the Interfaces</span></a></li>
<li><a href="#span-id-src-8362677-multi-chassislinkaggregation-mlag-roles-class-confluence-anchor-link-span-span-switch-roles-and-priority-setting-span"><span id="src-8362677_Multi-ChassisLinkAggregation-MLAG-roles" class="confluence-anchor-link"></span><span>Switch Roles and Priority Setting</span></a></li>
</ul></li>
<li><a href="#span-id-src-8362677-multi-chassislinkaggregation-mlag-example-class-confluence-anchor-link-span-span-example-mlag-configuration-span"><span id="src-8362677_Multi-ChassisLinkAggregation-MLAG-example" class="confluence-anchor-link"></span><span>Example MLAG Configuration</span></a></li>
<li><a href="#span-disable-clagd-on-an-interface-span"><span>Disable clagd on an Interface</span></a></li>
<li><a href="#span-check-the-mlag-configuration-status-span"><span>Check the MLAG Configuration Status</span></a></li>
<li><a href="#span-configure-mlag-with-a-traditional-mode-bridge-span"><span>Configure MLAG with a Traditional Mode Bridge</span></a></li>
<li><a href="#span-id-src-8362677-multi-chassislinkaggregation-mlag-protodown-class-confluence-anchor-link-span-span-peer-link-interfaces-and-the-protodown-state-span"><span id="src-8362677_Multi-ChassisLinkAggregation-MLAG-protodown" class="confluence-anchor-link"></span><span>Peer Link Interfaces and the protodown State</span></a>
<ul>
<li><a href="#span-id-src-8362677-multi-chassislinkaggregation-mlag-backup-class-confluence-anchor-link-span-span-specify-a-backup-link-span"><span id="src-8362677_Multi-ChassisLinkAggregation-MLAG-backup" class="confluence-anchor-link"></span><span>Specify a Backup Link</span></a></li>
<li><a href="#span-id-src-8362677-multi-chassislinkaggregation-mlag-vrf-backup-class-confluence-anchor-link-span-span-specify-a-backup-link-to-a-vrf-span"><span id="src-8362677_Multi-ChassisLinkAggregation-MLAG-vrf_backup" class="confluence-anchor-link"></span><span>Specify a Backup Link to a VRF</span></a></li>
</ul></li>
<li><a href="#span-monitor-dual-connected-peers-span"><span>Monitor Dual-Connected Peers</span></a></li>
<li><a href="#span-configure-layer-3-routed-uplinks-span"><span>Configure Layer 3 Routed Uplinks</span></a></li>
<li><a href="#span-igmp-snooping-with-mlag-span"><span>IGMP Snooping with MLAG</span></a></li>
<li><a href="#span-monitor-the-status-of-the-clagd-service-span"><span>Monitor the Status of the clagd Service</span></a></li>
<li><a href="#span-mlag-best-practices-span"><span>MLAG Best Practices</span></a>
<ul>
<li><a href="#span-id-src-8362677-multi-chassislinkaggregation-mlag-mtu-class-confluence-anchor-link-span-span-mtu-in-an-mlag-configuration-span"><span id="src-8362677_Multi-ChassisLinkAggregation-MLAG-mtu" class="confluence-anchor-link"></span><span>MTU in an MLAG Configuration</span></a></li>
<li><a href="#span-peer-link-sizing-span"><span>Peer Link Sizing</span></a></li>
<li><a href="#span-id-src-8362677-multi-chassislinkaggregation-mlag-scenarios-class-confluence-anchor-link-span-span-failover-redundancy-scenarios-span"><span id="src-8362677_Multi-ChassisLinkAggregation-MLAG-scenarios" class="confluence-anchor-link"></span><span>Failover Redundancy Scenarios</span></a></li>
</ul></li>
<li><a href="#span-stp-interoperability-with-mlag-span"><span>STP Interoperability with MLAG</span></a>
<ul>
<li><a href="#span-best-practices-for-stp-with-mlag-span"><span>Best Practices for STP with MLAG</span></a></li>
</ul></li>
<li><a href="#span-troubleshooting-span"><span>Troubleshooting</span></a>
<ul>
<li><a href="#span-view-the-mlag-log-file-span"><span>View the MLAG Log File</span></a></li>
<li><a href="#span-id-src-8362677-multi-chassislinkaggregation-mlag-drops-class-confluence-anchor-link-span-span-large-packet-drops-on-the-peer-link-interface-span"><span id="src-8362677_Multi-ChassisLinkAggregation-MLAG-drops" class="confluence-anchor-link"></span><span>Large Packet Drops on the Peer Link Interface</span></a></li>
<li><a href="#span-duplicate-lacp-partner-mac-warning-span"><span>Duplicate LACP Partner MAC Warning</span></a></li>
</ul></li>
<li><a href="#span-caveats-and-errata-span"><span>Caveats and Errata</span></a></li>
</ul></li>
</ul>
</nav>
    </div>
  

</aside>






  </main>
  <footer class="footer-top">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <div class="footer-content">
            <div class="mb-4">
                <img src="https://static.cumulusnetworks.com/static/images/shared/cumulus-networks-rt-white-trademarked.ff839f1b2570.svg">
                <p> <script type="text/javascript">document.write(new Date().getFullYear());</script> Cumulus Networks.<br>
                Site by <a href="//unomena.com/" target="_blank">Unomena</a>.</p>
            </div>
            <ul class="mb-4">
              <li><h4>Products</h4></li>
              <li><a href="//cumulusnetworks.com/products/cumulus-linux/">Cumulus Linux</a></li>
              <li><a href="//cumulusnetworks.com/products/netq/">Cumulus NetQ</a></li>
              <li><a href="//cumulusnetworks.com/products/cumulus-express/">Cumulus Express</a></li>
            </ul>
            <ul class="mb-4">
              <li><h4>Learn</h4></li>
              <li><a href="//cumulusnetworks.com/learn/web-scale-networking-education/">Going web-scale</a></li>
              <li><a href="//cumulusnetworks.com/learn/events/">Events</a></li>
              <li><a href="//cumulusnetworks.com/blog/">Blog</a></li>
            </ul>
            <ul class="mb-4">
              <li><h4>About</h4></li>
              <li><a href="//cumulusnetworks.com/about/">Our story</a></li>
              <li><a href="//cumulusnetworks.com/about/careers/">Careers</a></li>
              <li><a href="//cumulusnetworks.com/about/media-coverage/">Media coverage</a></li>
              <li><a href="//docs.cumulusnetworks.com/" target="_blank">Tech docs</a></li>
              <li><a href="//cumulusnetworks.com/community/">Community</a></li>
            </ul>
            <ul>
              <li>
                <a href="//twitter.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M23 6.628l-2-.5 1-2-2.464.7A4.48 4.48 0 0 0 12 8.128v1c-3.539.73-6.634-1.2-9.5-4.5q-.75 4 1.5 6l-3-.5c.405 2.069 1.362 3.7 4 4l-2.5 1c1 2 2.566 2.31 5 2.5a10.748 10.748 0 0 1-6.5 2c12.755 5.669 20-2.664 20-10V8.3z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//www.facebook.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                      .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M17.768 7.5H13.5V5.6a.972.972 0 0 1 1.012-1.1c.418 0 2.988.01 2.988.01V.5h-4.329C9.244.5 8.5 3.474 8.5 5.355V7.5h-3v4h3v12h5v-12h3.851z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//linkedin.com/company/cumulus-networks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                      .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M6.5 22.5h-5v-13h5zm9-9a2 2 0 0 0-2 2v7h-5v-13h5v1.485a6.307 6.307 0 0 1 3.99-1.495c2.962 0 5.01 2.2 5.01 6.355V22.5h-5v-7a2 2 0 0 0-2-2zM6.5 5A2.5 2.5 0 1 1 4 2.5 2.5 2.5 0 0 1 6.5 5z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//vimeo.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M.5 7.393l.933 1.224S3.36 7.1 4 7.859s3.1 9.925 3.915 11.617c.714 1.483 2.684 3.444 4.845 2.042s9.34-7.529 10.626-14.769-8.642-5.723-9.693.583c2.627-1.577 4.03.642 2.686 3.154s-2.569 4.145-3.211 4.145-1.135-1.679-1.868-4.613c-.76-3.035-.755-8.5-3.911-7.882C4.412 2.721.5 7.393.5 7.393z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//www.github.com/cumulusnetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                        <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                        </style>
                    </defs>
                    <path class="a" d="M19.459 17c0-5.969-4.126-3.532-7.5-3.532s-7.5-2.375-7.5 3.532a3.5 3.5 0 0 0 3.5 3.5h8a3.5 3.5 0 0 0 3.5-3.5z"></path>
                    <path class="a" d="M21.489 10.214l.032.023s2.646-4.572-.6-7.237c-2 0-5.058 3.3-5.058 3.3l.022.016A14.152 14.152 0 0 0 8.1 6.3C8.083 6.285 5.037 3 3.042 3c-3.173 2.6-.729 7.012-.614 7.217a8.876 8.876 0 0 0-1.395 5.743c.241 3.126 2.847 6.54 5.982 6.54H16.9c3.135 0 5.742-3.414 5.982-6.54a8.857 8.857 0 0 0-1.393-5.746z"></path>
                    <ellipse class="a" cx="15.48" cy="17" rx="1" ry="1.5"></ellipse>
                    <ellipse class="a" cx="8.48" cy="17" rx="1" ry="1.5"></ellipse>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//slack.cumulusnetworks.com/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                        <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                        </style>
                    </defs>
                    <rect class="a" x=".5" y=".5" width="23" height="23" rx="6" ry="6"></rect>
                    <circle class="a" cx="12" cy="12" r="6"></circle>
                    <circle class="a" cx="19" cy="5" r="1.5"></circle>
                  </svg>
                </a>
              </li>
              <li>
                <p>Cumulus Networks<sup></sup>  Data center networking software for the open, modern data center.</p>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </footer>
  <div class="footer-bottom">
      <div class="container">
          <div class="row">
              <div class="col-12">
                  <ul>
                      <li><a href="//cumulusnetworks.com/legal/trademarks/">Trademarks</a></li>
                      <li><a href="//cumulusnetworks.com/legal/privacy/">Privacy</a></li>
                      <li><a href="//cumulusnetworks.com/legal/">Terms of service</a></li>
                  </ul>
              </div>
          </div>
      </div>
  </div>

  
  

</body>

</html>
