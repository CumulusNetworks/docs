<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Vagrant and Libvirt with KVM or QEMU | Cumulus Networks Documentation</title>

  
  <link href="https://fonts.googleapis.com/css?family=Oxygen|Oxygen+Mono:300,400,700" rel="stylesheet">

  
  
  
  <link rel="stylesheet" href="/docs.cumulusnetworks.com/book.min.a378d8a2da6f5357a83a43dff33d6f77fb70401e0399d5ba78faf81d7a1ae1a8.css">

  
  <link rel="icon" href="/docs.cumulusnetworks.com/icons/favicon.png" type="image/x-icon">

  
  <!--
  Made with Book Theme
  https://github.com/alex-shpak/hugo-book
  -->

  
  
  <script src = "/docs.cumulusnetworks.com/js/codecopy.js"> </script>

</head>


<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  
  <header id="site-nav">
    <div class="header-wrapper flex">
      <a href="/">
        <img src="/header-logo.png" alt="Cumulus Networks">
        <img src="/cumulus-networks-rt-white.svg" alt="Cumulus Networks" class="header-mobile">
        <span>Docs</span>
      </a>
      <ul class="flex">
        <li><a href="//cumulusnetworks.com">HOME</a></li>
        <li><a href="//support.cumulusnetworks.com/">SUPPORT</a></li>
        <li><a href="//docs.cumulusnetworks.com/">DOCS</a></li>
        <li><a href="//education.cumulusnetworks.com">EDUCATION</a></li>
        <li><a href="//cumulusnetworks.com/blog/">BLOG</a></li>
        <li><a href="//forums.cumulusnetworks.com/">FORUMS</a></li>
      </ul>
      <div class="burger-menu">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </header>
  <div id="product-nav" class="flex">
      
    
    <ul>
    
      <li><a href = docs.cumulusnetworks.com/cumulus-linux/ >
        Cumulus Linux </a> </li>
    
      <li><a href = docs.cumulusnetworks.com/cumulus-netq/ >
        Cumulus NetQ </a> </li>
    
      <li class = "active" ><a href = docs.cumulusnetworks.com/cumulus-vx/ >
        Cumulus VX </a> </li>
    
      <li>
        <div id="products-dropdown" class="dropdown">
            <button class="btn" type="button" id="dropdownMenuButton">
              Products
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <a class="dropdown-item" href="">Cumulus RMP</a>
              <a class="dropdown-item" href="">Cumulus Chassis</a>
              <a class="dropdown-item" href="">Cumulus Host Pack</a>
            </div>
        </div>
      </li>
    </ul>
    <div class="search-container">
      <div id="doc-search-box">
        <input type="text" class="doc-search-input" placeholder="Search" value="">
        <span><button type="submit"><img src="/icons/search_20x20.svg" alt=""></button></span>
      </div>
      <div id="dropdown" class="dropdown">
          <button class="btn" type="button" id="dropdownMenuButton">
            v3.4
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/cumulus-vx/"> v3.4</a>
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-vx-25/"> v2.5</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-vx-30/"> v3.0</a>
            
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
          </div>
      </div>
    </div>
  </div>
  <main class="flex container">
    <aside class="book-menu fixed">

      <nav role="navigation">
        <h2 class="book-brand">
          <a href="docs.cumulusnetworks.com">Cumulus Networks Documentation</a>
        </h2>
        
        




  <ul id = "top" class = "cn-book-section-container">
  
    

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/cumulus-vx/" >
    Cumulus VX Documentation
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/cumulus-vx/Getting-Started/" >
    Getting Started
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-vx/Getting-Started/VMware-vSphere-ESXi-5.5/" >
    VMware vSphere - ESXi 5.5
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-vx/Getting-Started/VMware-Fusion/" >
    VMware Fusion
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-vx/Getting-Started/VMware-Workstation/" >
    VMware Workstation
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-vx/Getting-Started/VirtualBox/" >
    VirtualBox
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-vx/Getting-Started/Libvirt-and-KVM-QEMU/" >
    Libvirt and KVM - QEMU
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-vx/Getting-Started/ONIE-Virtual-Machine/" >
    ONIE Virtual Machine
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/cumulus-vx/Development-Environments/" >
    Development Environments
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-vx/Development-Environments/Vagrant-and-VirtualBox/" >
    Vagrant and VirtualBox
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-vx/Development-Environments/Vagrant-and-Libvirt-with-KVM-or-QEMU/"  class="active" >
    Vagrant and Libvirt with KVM or QEMU
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-vx/Development-Environments/GNS3-and-VirtualBox/" >
    GNS3 and VirtualBox
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-vx/Development-Environments/GNS3-and-QEMU-KVM/" >
    GNS3 and QEMU - KVM
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-vx/Whats-New-in-Cumulus-VX/" >
    What&#39;s New in Cumulus VX
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-vx/Comparing-Cumulus-VX-to-other-Cumulus-Networks-Products/" >
    Comparing Cumulus VX to other Cumulus Networks Products
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-vx/Cumulus-VX-Support-Policy/" >
    Cumulus VX Support Policy
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-vx/Create-a-Two-Leaf-Two-Spine-Topology/" >
    Create a Two-Leaf, Two-Spine Topology
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-vx/Next-Steps/" >
    Next Steps
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/cumulus-vx/Cumulus-VX-Getting-Started-Guide/" >
    Cumulus VX Getting Started Guide
  </a>


    </li>
    
  </ul>


  </li>


  
  </ul>









      </nav>

      
      
      
      

      <script src = "/docs.cumulusnetworks.com/js/menuBundle.js"> </script>


    </aside>

    <div class="book-page">

      
      <header class="align-center justify-between book-header">
        <label for="menu-control">
          <img src="/docs.cumulusnetworks.com/svg/menu.svg" alt="Menu" />
        </label>
        <strong>Vagrant and Libvirt with KVM or QEMU</strong>
      </header>

      
      
<article class="markdown">
<h1>Vagrant and Libvirt with KVM or QEMU</h1>

<p>The solution described in this chapter requires four components:</p>

<ul>
<li><p><strong>libvirt</strong> provides an abstraction language to define and launch
VMs, but is normally used just to launch single VMs. It uses XML to
represent and define the VM.</p></li>

<li><p><strong>KVM</strong> w orks exclusively with QEMU and p erforms hardware
acceleration for x86 VMs with Intel and AMD CPUs. KVM and QEMU are
hypervisors that emulate the VMs; t he pair is often called KVM/QEMU
or just KVM.</p></li>

<li><p><strong>QEMU</strong> is a machine emulator that can allow the host machine to
emulate the CPU architecture of the guest machine. Because QEMU does
not provide hardware acceleration, it works well with KVM.</p></li>

<li><p><strong>Vagrant</strong> is an orchestration tool that makes it easier to manage
groups of VMs by interconnecting them programmatically. Vagrant
helps to tie all the components together and provides a
user-friendly language to launch suites of VMs. Vagrant allows
multiple Cumulus VX VMs to be interconnected to simulate a network.
Vagrant also allows Cumulus VX VMs to be interconnected with other
VMs (such as Ubuntu or CentOS) to emulate real world networks.</p></li>
</ul>








<img class = "confluence-embedded-image" src = "/images/download/attachments/5126718/Simulation-Documents.png" alt = "/images/download/attachments/5126718/Simulation-Documents.png"

height = 150


 />


<p>The following sections describe how to install <code>libvirt</code>, KVM/QEMU, and
Vagrant on a Linux server.</p>

<h2 id="span-install-libvirt-span"><span>Install libvirt</span></h2>

<ol>
<li><p><details></p>

<p>Check the Linux version of the host. This guide is validated and
verified for Ubuntu 16.04 LTS starting from a clean install:</p>

<pre><code>user@ubuntubox:~$ lsb_release -a
No LSB modules are available.
Distributor ID: Ubuntu
Description:    Ubuntu 16.04 LTS
Release:    16.04
Codename:   xenial

user@ubuntubox:~$ uname -a
Linux ubuntubox 4.4.0-22-generic #40-Ubuntu SMP Thu May 12 22:03:46 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux
</code></pre>

<p>After verifying the version, install <code>libvirt</code> and <code>QEMU</code>. The
following commands install the necessary components to get <code>libvirt</code>
and <code>QEMU</code> operational.</p>

<pre><code>user@ubuntubox:~$ sudo apt-get update -y
user@ubuntubox:~$ sudo apt-get install libvirt-bin libvirt-dev qemu-utils qemu
user@ubuntubox:~$ sudo /etc/init.d/libvirt-bin restart
</code></pre>

<p><summary>Click here if running Ubuntu 14.04&hellip; </summary></p>

<p>The version of <code>libvirt</code> which ships in Ubuntu 14.04 is too old to
be used in many of the simulations built by Cumulus.</p>

<p>The <code>linuxsimba</code>/<code>libvirt-udp-tunnel</code> package repository provides an
updated <code>libvirtd</code> version that provides enhancements required to
launch Cumulus VX. The example below shows how to add the
repository:</p>

<pre><code>user@ubuntubox:~$ sudo add-apt-repository ppa:linuxsimba/libvirt-udp-tunnel 
</code></pre>

<p>This repository contains a version of <code>libvirt</code> that has the
necessary patches to support the construction of UDP tunnels, which
are used for the point-to-point links in a VM simulation.</p>

<p>This version of <code>libvirt</code> needs to have a default storage pool
created using the process below.</p>

<pre><code>user@ubuntubox:~$ sudo virsh pool-define-as --name default --type dir --target /var/lib/libvirt/images
user@ubuntubox:~$ sudo virsh pool-autostart default
user@ubuntubox:~$ sudo virsh pool-build default
user@ubuntubox:~$ sudo virsh pool-start default
</code></pre>

<p></details></p></li>

<li><p>After the installation completes, log out, then log in and verify
the <code>libvirt</code> version.</p>

<pre><code>user@ubuntubox:~$ libvirtd --version
libvirtd (libvirt) 1.3.1
</code></pre>


<div class="notices note" > <pre><code>&lt;span style=&quot;color: #222222;&quot;&gt; `libvirt` versions 1.2.20 or higher
have native support for the UDP tunnels, which are used for the
point-to-point links in VM simulation. &lt;/span&gt;
</code></pre>
 </div>
</li>

<li><p>Add your user to the <code>libvirtd</code> group (if not already present) so
your user can perform <code>virsh</code> commands.</p>

<pre><code>user@ubuntubox:~$ sudo addgroup libvirtd
user@ubuntubox:~$ sudo usermod -a -G libvirtd USERNAME
</code></pre>


<div class="notices note" > <pre><code>To apply the new group to your existing user, log out and in again.
</code></pre>
 </div>
</li>

<li><p>Confirm that your Linux kernel and BIOS settings permit the use of
KVM hardware acceleration.</p>

<pre><code>user@ubuntubox:~$ kvm-ok
INFO: /dev/kvm exists
KVM acceleration can be used
</code></pre></li>
</ol>

<p>After completing these steps, <code>libvirt</code> and KVM/QEMU are installed. The
Linux server is now ready to run VMs.</p>

<h2 id="span-install-vagrant-span"><span>Install Vagrant</span></h2>

<p>You must install Vagrant <strong>after</strong> you install <code>libvirt</code>. Vagrant might
not properly detect the necessary files if it is installed before
<code>libvirt</code>. Cumulus VX requires version 1.7 or later. Version 2.0.2 or
later is recommended.</p>

<ol>
<li><p>Install Vagrant from the <code>deb</code> package. Cumulus Networks cannot
guarantee the functionality of any version of Vagrant. In this
guide, Vagrant version 2.0.2 is used.</p>

<pre><code>user@ubuntubox:~$ wget https://releases.hashicorp.com/vagrant/2.0.2/vagrant_2.0.2_x86_64.deb
--2018-05-04 09:36:22--  https://releases.hashicorp.com/vagrant/2.0.2/vagrant_2.0.2_x86_64.deb
Resolving releases.hashicorp.com (releases.hashicorp.com)... 151.101.57.183, 2a04:4e42:e::439
Connecting to releases.hashicorp.com (releases.hashicorp.com)|151.101.57.183|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 43678320 (42M) [application/x-debian-package]
Saving to: ‘vagrant_2.0.2_x86_64.deb’
vagrant_2.0.2_x86_6 100%[===================&gt;]  41.65M  33.1MB/s    in 1.3s    
2018-05-04 09:36:23 (33.1 MB/s) - ‘vagrant_2.0.2_x86_64.deb’ saved [43678320/43678320]
</code></pre></li>

<li><p>Install Vagrant using <code>dpkg</code>:</p>

<pre><code>user@ubuntubox:~$ sudo dpkg -i vagrant_2.0.2_x86_64.deb 
Selecting previously unselected package vagrant.
(Reading database ... 387062 files and directories currently installed.)
Preparing to unpack vagrant_2.0.2_x86_64.deb ...
Unpacking vagrant (1:2.0.2) ...
Setting up vagrant (1:2.0.2) ...
</code></pre></li>

<li><p>Verify the Vagrant version:</p>

<pre><code>user@ubuntubox:~$ vagrant --version
Vagrant 2.0.2
</code></pre></li>

<li><p>Install the necessary plugins for Vagrant:</p>

<pre><code>user@ubuntubox# vagrant plugin install vagrant-libvirt
Installing the 'vagrant-libvirt' plugin. This can take a few minutes...
Installed the plugin 'vagrant-libvirt (0.0.43)'!
 
user@ubuntubox# vagrant plugin install vagrant-mutate
Installing the 'vagrant-mutate' plugin. This can take a few minutes...
Installed the plugin 'vagrant-mutate (1.2.0)'!
</code></pre>


<div class="notices note" > <pre><code>Vagrant plugin installation is unique to each user; make sure to
install plugins as the user who will run the simulations.
</code></pre>
 </div>
</li>

<li><p>Install the CumulusCommunity/cumulus-vx box image:</p>

<pre><code>vagrant box add CumulusCommunity/cumulus-vx --provider=libvirt
</code></pre>


<div class="notices note" > <pre><code>Vagrant box image installation is unique to each user; make sure to
install images as the user who will run the simulations.
</code></pre>
 </div>
</li>

<li><p>Test that everything is working:</p>

<pre><code>user@ubuntubox:~$ mkdir ./testdir ; cd ./testdir
user@ubuntubox:~/testdir$ vagrant init CumulusCommunity/cumulus-vx
 
A `Vagrantfile` has been placed in this directory. You are now ready to `vagrant up` your first virtual environment! Please readthe comments in the Vagrantfile as well as documentation on`vagrantup.com` for more information on using Vagrant.
 
user@ubuntubox:~/testdir$ vagrant up --provider=libvirt
&lt;...snip...&gt;
user@ubuntubox:~/testdir$ vagrant status
Current machine states:
        default running (libvirt)
</code></pre></li>

<li><p><span style="color: #222222;"> To show all running KVM/<code>libvirt</code>
VMs:<br />
</span></p>

<pre><code>user@ubuntubox:~/testdir$ virsh list --all 
 
Id    Name                           State 
---------------------------------------------------- 
2     test_default                   running 
 
#Look at libvirt's XML definition of the VM used to create the VM:
user@ubuntubox:~/testdir$ virsh dumpxml [name of domain]
</code></pre></li>

<li><p>The <code>libvirt</code> domain is running. To stop this machine, you can run
<code>vagrant halt</code>. To destroy the machine, you can run <code>vagrant
destroy.</code></p>

<pre><code>user@ubuntubox:~/testdir$ vagrant destroy -f
</code></pre></li>
</ol>

<p>After completing these steps, Vagrant is now set up.</p>

<h2 id="span-create-the-vagrantfile-and-launch-kvm-instances-span"><span>Create the Vagrantfile and Launch KVM Instances</span></h2>

<ol>
<li><p><details></p>

<p>Create the desired Vagrantfile using the Cumulus <a href="https://github.com/CumulusNetworks/topology_converter" target="_blank">topology
converter</a> or
by downloading the Cumulus-created
<a href="https://github.com/CumulusNetworks/cldemo-vagrant" target="_blank">cldemo-vagrant</a>
reference topology. The following steps use the cldemo-vagrant
topology.</p>

<p><summary>If you plan on simulating Cumulus VX 2.5.x read this
note&hellip; </summary></p>

<p>Make sure your Vagrantfiles do not attempt to set the hostname of
the VM as that is not supported for older versions of Cumulus VX. If
you see a <code>device.vm.name</code> line as in the following example, remove
it:</p>

<pre><code>user@ubuntubox:~$ sudo vi Vagrantfile

... 

device.vm.hostname = &quot;leaf01&quot;

...

user@ubuntubox:~$ git clone https://github.com/CumulusNetworks/cldemo-vagrant.git
Cloning into 'cldemo-vagrant'...
remote: Counting objects: 1015, done.
remote: Compressing objects: 100% (23/23), done.
remote: Total 1015 (delta 4), reused 11 (delta 1), pack-reused 991
Receiving objects: 100% (1015/1015), 1.83 MiB | 1.00 MiB/s, done.
Resolving deltas: 100% (557/557), done.
Checking connectivity... done.
</code></pre>

<p></details></p></li>

<li><p>After the repo is cloned, change to its directory:</p>

<pre><code>user@ubuntubox:~$ cd cldemo-vagrant/
user@ubuntubox:~/cldemo-vagrant$
</code></pre></li>

<li><p>Copy the Vagrantfile-KVM into place.</p>

<pre><code>user@ubuntubox:~/cldemo-vagrant$ cp ./Vagrantfile-kvm ./Vagrantfile
user@ubuntubox:~/cldemo-vagrant$
</code></pre></li>

<li><p>Check the status of the VMs to see that none of them have been
created yet:</p>

<pre><code>user@ubuntubox:~/cldemo-vagrant$ vagrant status
Current machine states:
oob-mgmt-server           not created (libvirt)
oob-mgmt-switch           not created (libvirt)
exit02                    not created (libvirt)
exit01                    not created (libvirt)
spine02                   not created (libvirt)
spine01                   not created (libvirt)
leaf04                    not created (libvirt)
leaf02                    not created (libvirt)
leaf03                    not created (libvirt)
leaf01                    not created (libvirt)
edge01                    not created (libvirt)
server01                  not created (libvirt)
server03                  not created (libvirt)
server02                  not created (libvirt)
server04                  not created (libvirt)
internet                  not created (libvirt)
This environment represents multiple VMs. The VMs are all listed
above with their current state. For more information about a specific
VM, run `vagrant status NAME`.
</code></pre>


<div class="notices note" > <pre><code>All Vagrant commands performed against a simulation such as `vagrant
up` or `vagrant destroy` must be issued from the directory that
contains the Vagrantfile.
</code></pre>
 </div>
</li>

<li><p>Bring up all the images using <code>--provider libvirt:</code></p>

<pre><code>user@ubuntubox:~/cldemo-vagrant$ vagrant up --provider=libvirt
Bringing machine 'oob-mgmt-server' up with 'libvirt' provider...
Bringing machine 'oob-mgmt-switch' up with 'libvirt' provider...
Bringing machine 'exit02' up with 'libvirt' provider...
Bringing machine 'exit01' up with 'libvirt' provider...
Bringing machine 'spine02' up with 'libvirt' provider...
Bringing machine 'spine01' up with 'libvirt' provider...
Bringing machine 'leaf04' up with 'libvirt' provider...
Bringing machine 'leaf02' up with 'libvirt' provider...
Bringing machine 'leaf03' up with 'libvirt' provider...
Bringing machine 'leaf01' up with 'libvirt' provider...
Bringing machine 'edge01' up with 'libvirt' provider...
Bringing machine 'server01' up with 'libvirt' provider...
Bringing machine 'server03' up with 'libvirt' provider...
Bringing machine 'server02' up with 'libvirt' provider...
Bringing machine 'server04' up with 'libvirt' provider...
Bringing machine 'internet' up with 'libvirt' provider...
</code></pre></li>

<li><p>After following all the steps above, the VMs are created and
accessible. Issue the following command to access the out-of-band
management server VM:</p>

<pre><code>user@ubuntubox:~/cldemo-vagrant$ vagrant ssh oob-mgmt-server
                                                 _
      _______   x x x                           | |
 ._  &lt;_______~ x X x   ___ _   _ _ __ ___  _   _| |_   _ ___
(' \  ,' || `,        / __| | | | '_ ` _ \| | | | | | | / __|
 `._:^   ||   :&gt;     | (__| |_| | | | | | | |_| | | |_| \__ \
     ^T~~~~~~T'       \___|\__,_|_| |_| |_|\__,_|_|\__,_|___/
     ~&quot;     ~&quot;
 
############################################################################
#
#                     Out Of Band Management Station
#
############################################################################
cumulus@oob-mgmt-server:~$ 
</code></pre></li>

<li><p>Experiment with your simulation.</p></li>

<li><p>Explore the various demos available as part of the cldemo-vagrant
family of repositories located here:
<a href="https://github.com/CumulusNetworks/cldemo-vagrant#available-demos" target="_blank">https://github.com/CumulusNetworks/cldemo-vagrant#available-demos</a></p></li>

<li><p>Destroy the simulation when finished.</p>

<pre><code>user@ubuntubox:~/cldemo-vagrant$ vagrant destroy -f
</code></pre></li>
</ol>

<p><span style="color: #222222;"><br />
</span></p>

<article id="html-search-results" class="ht-content" style="display: none;">

</article>

<footer id="ht-footer">

</footer>
</article>

      <script src="https://utteranc.es/client.js"
        repo="CumulusNetworks/docs-internal"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
      </script>

    </div>
    

      


  

    <aside class="book-toc fixed">

  
    <div class="toc">
    
      <button>
      <a href="https://github.com/CumulusNetworks/docs/edit/master/content/cumulus-vx/Development-Environments/Vagrant-and-Libvirt-with-KVM-or-QEMU.md" target="_blank" rel="noopener"><img src="/docs.cumulusnetworks.com/svg/pencil-circle.svg" alt="Edit" /> Edit this page</a>
      </button>
    
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#span-install-libvirt-span"><span>Install libvirt</span></a></li>
<li><a href="#span-install-vagrant-span"><span>Install Vagrant</span></a></li>
<li><a href="#span-create-the-vagrantfile-and-launch-kvm-instances-span"><span>Create the Vagrantfile and Launch KVM Instances</span></a></li>
</ul></li>
</ul>
</nav>
    </div>
  

</aside>






  </main>
  <footer class="footer-top">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <div class="footer-content">
            <div class="mb-4">
                <img src="https://static.cumulusnetworks.com/static/images/shared/cumulus-networks-rt-white-trademarked.ff839f1b2570.svg">
                <p>© <script type="text/javascript">document.write(new Date().getFullYear());</script> Cumulus Networks.<br>
                Site by <a href="//unomena.com/" target="_blank">Unomena</a>.</p>
            </div>
            <ul class="mb-4">
              <li><h4>Products</h4></li>
              <li><a href="//cumulusnetworks.com/products/cumulus-linux/">Cumulus Linux</a></li>
              <li><a href="//cumulusnetworks.com/products/netq/">Cumulus NetQ</a></li>
              <li><a href="//cumulusnetworks.com/products/cumulus-express/">Cumulus Express</a></li>
            </ul>
            <ul class="mb-4">
              <li><h4>Learn</h4></li>
              <li><a href="//cumulusnetworks.com/learn/web-scale-networking-education/">Going web-scale</a></li>
              <li><a href="//cumulusnetworks.com/learn/events/">Events</a></li>
              <li><a href="//cumulusnetworks.com/blog/">Blog</a></li>
            </ul>
            <ul class="mb-4">
              <li><h4>About</h4></li>
              <li><a href="//cumulusnetworks.com/about/">Our story</a></li>
              <li><a href="//cumulusnetworks.com/about/careers/">Careers</a></li>
              <li><a href="//cumulusnetworks.com/about/media-coverage/">Media coverage</a></li>
              <li><a href="//docs.cumulusnetworks.com/" target="_blank">Tech docs</a></li>
              <li><a href="//cumulusnetworks.com/community/">Community</a></li>
            </ul>
            <ul>
              <li>
                <a href="//twitter.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M23 6.628l-2-.5 1-2-2.464.7A4.48 4.48 0 0 0 12 8.128v1c-3.539.73-6.634-1.2-9.5-4.5q-.75 4 1.5 6l-3-.5c.405 2.069 1.362 3.7 4 4l-2.5 1c1 2 2.566 2.31 5 2.5a10.748 10.748 0 0 1-6.5 2c12.755 5.669 20-2.664 20-10V8.3z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//www.facebook.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                      .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M17.768 7.5H13.5V5.6a.972.972 0 0 1 1.012-1.1c.418 0 2.988.01 2.988.01V.5h-4.329C9.244.5 8.5 3.474 8.5 5.355V7.5h-3v4h3v12h5v-12h3.851z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//linkedin.com/company/cumulus-networks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                      .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M6.5 22.5h-5v-13h5zm9-9a2 2 0 0 0-2 2v7h-5v-13h5v1.485a6.307 6.307 0 0 1 3.99-1.495c2.962 0 5.01 2.2 5.01 6.355V22.5h-5v-7a2 2 0 0 0-2-2zM6.5 5A2.5 2.5 0 1 1 4 2.5 2.5 2.5 0 0 1 6.5 5z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//vimeo.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M.5 7.393l.933 1.224S3.36 7.1 4 7.859s3.1 9.925 3.915 11.617c.714 1.483 2.684 3.444 4.845 2.042s9.34-7.529 10.626-14.769-8.642-5.723-9.693.583c2.627-1.577 4.03.642 2.686 3.154s-2.569 4.145-3.211 4.145-1.135-1.679-1.868-4.613c-.76-3.035-.755-8.5-3.911-7.882C4.412 2.721.5 7.393.5 7.393z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//www.github.com/cumulusnetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                        <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                        </style>
                    </defs>
                    <path class="a" d="M19.459 17c0-5.969-4.126-3.532-7.5-3.532s-7.5-2.375-7.5 3.532a3.5 3.5 0 0 0 3.5 3.5h8a3.5 3.5 0 0 0 3.5-3.5z"></path>
                    <path class="a" d="M21.489 10.214l.032.023s2.646-4.572-.6-7.237c-2 0-5.058 3.3-5.058 3.3l.022.016A14.152 14.152 0 0 0 8.1 6.3C8.083 6.285 5.037 3 3.042 3c-3.173 2.6-.729 7.012-.614 7.217a8.876 8.876 0 0 0-1.395 5.743c.241 3.126 2.847 6.54 5.982 6.54H16.9c3.135 0 5.742-3.414 5.982-6.54a8.857 8.857 0 0 0-1.393-5.746z"></path>
                    <ellipse class="a" cx="15.48" cy="17" rx="1" ry="1.5"></ellipse>
                    <ellipse class="a" cx="8.48" cy="17" rx="1" ry="1.5"></ellipse>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//slack.cumulusnetworks.com/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                        <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                        </style>
                    </defs>
                    <rect class="a" x=".5" y=".5" width="23" height="23" rx="6" ry="6"></rect>
                    <circle class="a" cx="12" cy="12" r="6"></circle>
                    <circle class="a" cx="19" cy="5" r="1.5"></circle>
                  </svg>
                </a>
              </li>
              <li>
                <p>Cumulus Networks<sup>®</sup> — Data center networking software for the open, modern data center.</p>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </footer>
  <div class="footer-bottom">
      <div class="container">
          <div class="row">
              <div class="col-12">
                  <ul>
                      <li><a href="//cumulusnetworks.com/legal/trademarks/">Trademarks</a></li>
                      <li><a href="//cumulusnetworks.com/legal/privacy/">Privacy</a></li>
                      <li><a href="//cumulusnetworks.com/legal/">Terms of service</a></li>
                  </ul>
              </div>
          </div>
      </div>
  </div>

  
  

</body>

</html>
