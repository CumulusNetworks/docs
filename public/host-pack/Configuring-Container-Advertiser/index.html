<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Configuring Container Advertiser | Cumulus Networks Documentation</title>

  
  <link href="https://fonts.googleapis.com/css?family=Oxygen|Oxygen+Mono:300,400,700" rel="stylesheet">

  
  
  
  <link rel="stylesheet" href="/docs.cumulusnetworks.com/book.min.a378d8a2da6f5357a83a43dff33d6f77fb70401e0399d5ba78faf81d7a1ae1a8.css">

  
  <link rel="icon" href="/docs.cumulusnetworks.com/icons/favicon.png" type="image/x-icon">

  
  <!--
  Made with Book Theme
  https://github.com/alex-shpak/hugo-book
  -->

  
  
  <script src = "/docs.cumulusnetworks.com/js/codecopy.js"> </script>

</head>


<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  
  <header id="site-nav">
    <div class="header-wrapper flex">
      <a href="/">
        <img src="/header-logo.png" alt="Cumulus Networks">
        <img src="/cumulus-networks-rt-white.svg" alt="Cumulus Networks" class="header-mobile">
        <span>Docs</span>
      </a>
      <ul class="flex">
        <li><a href="//cumulusnetworks.com">HOME</a></li>
        <li><a href="//support.cumulusnetworks.com/">SUPPORT</a></li>
        <li><a href="//docs.cumulusnetworks.com/">DOCS</a></li>
        <li><a href="//education.cumulusnetworks.com">EDUCATION</a></li>
        <li><a href="//cumulusnetworks.com/blog/">BLOG</a></li>
        <li><a href="//forums.cumulusnetworks.com/">FORUMS</a></li>
      </ul>
      <div class="burger-menu">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </header>
  <div id="product-nav" class="flex">
      
    
    <ul>
    
      <li><a href = docs.cumulusnetworks.com/cumulus-linux/ >
        Cumulus Linux </a> </li>
    
      <li><a href = docs.cumulusnetworks.com/cumulus-netq/ >
        Cumulus NetQ </a> </li>
    
      <li><a href = docs.cumulusnetworks.com/cumulus-vx/ >
        Cumulus VX </a> </li>
    
      <li>
        <div id="products-dropdown" class="dropdown">
            <button class="btn" type="button" id="dropdownMenuButton">
              Products
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <a class="dropdown-item" href="">Cumulus RMP</a>
              <a class="dropdown-item" href="">Cumulus Chassis</a>
              <a class="dropdown-item" href="">Cumulus Host Pack</a>
            </div>
        </div>
      </li>
    </ul>
    <div class="search-container">
      <div id="doc-search-box">
        <input type="text" class="doc-search-input" placeholder="Search" value="">
        <span><button type="submit"><img src="/icons/search_20x20.svg" alt=""></button></span>
      </div>
      <div id="dropdown" class="dropdown">
          <button class="btn" type="button" id="dropdownMenuButton">
            v1.0
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/host-pack/"> v1.0</a>
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
          </div>
      </div>
    </div>
  </div>
  <main class="flex container">
    <aside class="book-menu fixed">

      <nav role="navigation">
        <h2 class="book-brand">
          <a href="docs.cumulusnetworks.com">Cumulus Networks Documentation</a>
        </h2>
        
        




  <ul id = "top" class = "cn-book-section-container">
  
    

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/host-pack/" >
    Cumulus Host Pack
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/host-pack/Installing-FRRouting-on-the-Host/" >
    Installing FRRouting on the Host
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/host-pack/Configuring-FRRouting-on-the-Host/" >
    Configuring FRRouting on the Host
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/host-pack/Installing-NetQ-on-the-Host/" >
    Installing NetQ on the Host
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/host-pack/Configuring-NetQ-on-the-Host/" >
    Configuring NetQ on the Host
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/host-pack/Installing-Docker/" >
    Installing Docker
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/host-pack/Configuring-Container-Advertiser/"  class="active" >
    Configuring Container Advertiser
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/host-pack/Monitoring-Linux-Hosts-with-NetQ/" >
    Monitoring Linux Hosts with NetQ
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/host-pack/Monitoring-Container-Environments-with-NetQ/" >
    Monitoring Container Environments with NetQ
  </a>


    </li>
    
  </ul>


  </li>


  
  </ul>









      </nav>

      
      
      
      

      <script src = "/docs.cumulusnetworks.com/js/menuBundle.js"> </script>


    </aside>

    <div class="book-page">

      
      <header class="align-center justify-between book-header">
        <label for="menu-control">
          <img src="/docs.cumulusnetworks.com/svg/menu.svg" alt="Menu" />
        </label>
        <strong>Configuring Container Advertiser</strong>
      </header>

      
      
<article class="markdown">
<h1>Configuring Container Advertiser</h1>

<p><details></p>

<p>Container Advertiser and FRRouting (FRR) work together on the host to
advertise containers into the routed fabric.</p>

<h2 id="span-container-advertiser-architecture-span"><span>Container Advertiser Architecture</span></h2>

<p>As Docker creates and destroys containers, the Container Advertiser
listens to the docker-engine API events stream. When a container
creation event is detected, a corresponding /32 host route is created in
table 30 of the Linux kernel routing tables. Similarly, when a container
destruction event is detected, the corresponding /32 host route is
removed.</p>

<p>Once the route is created, FRR sees the newly added route in the kernel
routing table and redistributes the route into BGP or OSPF depending
upon which <a href="/version/hostpack/Configuring-FRRouting-on-the-Host">routing protocol you
enabled</a>. This demo
uses BGP unnumbered as the routing protocol. Using BGP unnumbered in
this scenario means that no IPv4 addresses need to be configured on the
uplinks from the server.</p>








<img class = "confluence-embedded-image" src = "/images/download/attachments/7110691/crohdad-arch.png" alt = "/images/download/attachments/7110691/crohdad-arch.png"

height = 400


 />


<h3 id="span-redistribute-the-container-routing-table-into-frrouting-span"><span>Redistribute the Container Routing Table into FRRouting</span></h3>

<p>The following sample configuration — stored in the <code>/etc/frr/frr.conf</code>
file — demonstrates how you can advertise containers using FRRouting.</p>

<pre><code>frr defaults datacenter
ip import-table 30
username cumulus nopassword
!
service integrated-vtysh-config
!
log syslog informational
!
interface eth1
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface eth2
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
router bgp 65000
 bgp bestpath as-path multipath-relax
 neighbor eth1 interface remote-as external
 neighbor eth2 interface remote-as external
 !
 address-family ipv4 unicast
  redistribute table 30
 exit-address-family
!
line vty
!
</code></pre>

<h3 id="span-supported-docker-network-driver-types-span"><span>Supported Docker Network Driver Types</span></h3>

<p>When using Docker, containers can be attached to custom user-created
networks, as in the example network created below.</p>

<pre><code>user@host:~$ docker network create --driver=bridge --subnet 172.18.0.0/24 --gateway 172.18.0.254 \
--opt  'com.docker.network.bridge.name=docker-newnet' \
--opt  'com.docker.network.bridge.enable_icc=true' \
--opt  'com.docker.network.bridge.enable_ip_masquerade=false' \
new_network
</code></pre>

<p>Container Advertiser only advertises IP addresses from containers that
are on Docker bridges with NAT disabled, as shown in the example above.</p>

<p>Container Advertiser only supports the advertisement of containers
attached to networks created with one of two drivers: <em>bridge</em> and
<em>macvlan</em>.</p>

<h2 id="span-run-container-advertiser-span"><span>Run Container Advertiser</span></h2>

<p>The container advertiser can be used on the host, just like any other
container.</p>

<ol>
<li><p><details></p>

<p><strong>Optional:</strong> Pull the Container Advertiser image from the Cumulus
Networks hub. If you don&rsquo;t pull the image here, it will be done in
the next step for you automatically.</p>

<pre><code>user@host:~$ curl -X GET  https://hub.cumulusnetworks.com/v2/_catalog
</code></pre>

<p><summary>Click to see the output &hellip; </summary></p>

<pre><code>user@host:~$ sudo docker pull hub.cumulusnetworks.com/chp-crohdad:latest
latest: Pulling from chp-roh
ae79f2514705: Pull complete 
5ad56d5fc149: Pull complete 
170e558760e8: Pull complete 
395460e233f5: Pull complete 
6f01dc62e444: Pull complete 
f417f88fae3f: Pull complete 
e8c477c3664b: Pull complete 
53ab13163b7a: Pull complete 
16ea638db969: Pull complete 
266b626a7906: Pull complete 
385fd54db587: Pull complete 
cba74222fa7e: Pull complete 
6b7f7e0b8547: Pull complete 
fa063c8b0c0a: Pull complete 
Digest: sha256:557168b6728aa44305f7d1099769acc98e246c64369ebe59fb53bac23aa40dfb
Status: Downloaded newer image for hub.cumulusnetworks.com/chp-crohdad:latest
</code></pre>

<p></details></p></li>

<li><p>Start the container.</p>

<ol>
<li><p>Create the container in privileged mode, naming the container
<em>crohdad</em>.</p>

<pre><code>user@host:~$ docker run -t -d --net=host --privileged --restart unless-stopped \
     -v /var/run/docker.sock:/var/run/docker.sock \
     -v /etc/iproute2/rt_tables:/etc/iproute2/rt_tables \
     -v /dev/log:/dev/log \
    --name crohdad hub.cumulusnetworks.com/chp-crohdad:latest
</code></pre>


<div class="notices note" > <pre><code>    The container must run in privileged mode to interact with the
    Linux kernel to create the new routing table (table 30 by
    default) and populate /32 host routes into that table.
</code></pre>
 </div>
</li>
</ol></li>

<li><p>Validate the container is running.</p>

<ol>
<li><p>Check all containers on the system.</p>

<pre><code>user@host:~$ docker ps -a
CONTAINER ID        IMAGE                                        COMMAND                  CREATED             STATUS              PORTS               NAMES
dcfbe94e9502        hub.cumulusnetworks.com/chp-crohdad:latest   &quot;/usr/bin/crohdad_...&quot;   25 seconds ago      Up 24 seconds                           crohdad
</code></pre>


<div class="notices note" > <pre><code>    Running `docker ps` (without the `-a` option) only shows active
    (&quot;up&quot;) containers on the system; the `-a` option shows all
    containers.
</code></pre>
 </div>
</li>

<li><p>View logs from the container.</p>

<pre><code>user@host:~$ docker logs crohdad
RUNNING CRoHDAd: /root/crohdad.py  &amp;
################################################
#                                              #
#     Cumulus Routing On the Host              #
#       Docker Advertisement Daemon            #
#             --cRoHDAd--                      #
#         originally written by Eric Pulvino   #
#                                              #
################################################
 STARTING UP.
    *Adding All Host Routes to Table 30*
      Run &quot;ip route show table 30&quot; to see routes.
    Flushing any pre-existing routes from table 30.
 
  Auto-Detecting existing containers and adding host routes...
  Listening for Container Activity...
 
[hit enter key to exit] or run 'docker stop &lt;container&gt;'
</code></pre></li>
</ol></li>
</ol>

<h2 id="span-container-advertiser-options-span"><span>Container Advertiser Options</span></h2>

<p>The container advertiser has a number of different options that can be
specified. By default it starts with no additional options defined. To
see all available options run the following command:</p>

<pre><code>user@host:~$ docker run -it --name=crohdad hub.cumulusnetworks.com/chp-crohdad:latest -h
</code></pre>

<h3 id="span-write-events-to-the-host-syslog-span"><span>Write Events to the Host syslog</span></h3>

<p>Container Advertiser attempts to write events to the host <code>syslog</code> by
default if the <code>/dev/log</code> file is available inside the container.</p>

<p>To disable this functionality use the <code>-l</code> flag.</p>

<pre><code>user@host:~$ docker run -t -d --net=host --privileged \
     -v /var/run/docker.sock:/var/run/docker.sock \
     -v /etc/iproute2/rt_tables:/etc/iproute2/rt_tables \
    --name crohdad hub.cumulusnetworks.com/chp-crohdad:latest -l
</code></pre>


<div class="notices note" > <p>When using the <code>-l</code> flag, the volume mount for the <code>/dev/log</code> file is
not required.</p>
 </div>


<h3 id="span-control-container-advertisement-by-subnet-span"><span>Control Container Advertisement by Subnet</span></h3>

<p>Container Advertiser can be restricted to only advertise containers that
are created/destroyed within specific subnets. By default, all subnets
are advertised.</p>

<p>Subnet advertisements can be restricted using one or more &ldquo;-s&rdquo; flags.</p>

<pre><code>user@host:~$ docker run -t -d --net=host --privileged --restart unless-stopped  \
     -v /var/run/docker.sock:/var/run/docker.sock \
     -v /etc/iproute2/rt_tables:/etc/iproute2/rt_tables \
    --name crohdad hub.cumulusnetworks.com/chp-crohdad:latest -s 172.18.0.0/24 -s 172.19.0.0/24
</code></pre>

<p>In the example above, only containers that are created and associated to
IP addresses in the following ranges 172.18.0.0/24 and 172.19.0.0/24
will be advertised.</p>

<h3 id="span-view-all-supported-options-span"><span>View All Supported Options</span></h3>

<p>Run the container with the <code>-h</code> flag which displays the help options.</p>

<pre><code>user@host:~$ docker run -it --name=crohdad hub.cumulusnetworks.com/chp-crohdad:latest -h
</code></pre>

<p><summary>Click to see example output&hellip; </summary></p>

<pre><code>user@host:~$ docker run -it --name=crohdad hub.cumulusnetworks.com/chp-crohdad:latest -h
RUNNING CRoHDAd: /root/crohdad.py -h &amp;
usage: crohdad.py [-h] [-d] [-f] [-l] [-t TABLE_NUMBER] [-n] [-s SUBNETS] [-v]

Cumulus Routing on the Host Docker Advertisement Daemon (CRoHDAD) -- A Daemon
to advertise Docker container IP addresses into Routing Fabrics running with
Quagga/FRR.

optional arguments:
  -h, --help            show this help message and exit
  -d, --debug           enables verbose logging output.
  -f, --no-flush-routes
                        disables table flush of existing host-routes at
                        startup.
  -l, --log-to-syslog-off
                        disable logging to syslog.
  -t TABLE_NUMBER, --table_number TABLE_NUMBER
                        route table number to add/remove host routes (see:
                        /etc/iproute2/rt_tables). Default is 30
  -n, --no-add-on-start
                        automatically detects existing containers and adds
                        their host routes upon initial script start-up.
  -s SUBNETS, --subnets SUBNETS
                        Allows the user to specify the acceptable container
                        subnets which can be advertised via CRoHDAD when seen
                        on containers. Defaults to advertising everything.
                        example ./crohdad.py --subnets 172.19.0.0/24 --subnets
                        172.17.0.0/24
  -v, --version         Using this option displays the version of CRoHDAd and
                        exits.


[hit enter key to exit] or run 'docker stop &lt;container&gt;'
</code></pre>

<h2 id="span-deploy-the-container-advertiser-with-ansible-span"><span>Deploy the Container Advertiser with Ansible</span></h2>

<p>Below is a task for an Ansible playbook that you can use to deploy the
Container Advertiser.</p>

<pre><code>- name: Deploy Container Advertiser
  docker_container:
    name: crohdad
    privileged: true
    interactive: true
    network_mode: host
    restart_policy: unless-stopped
    tty: true
    recreate: yes
    image: hub.cumulusnetworks.com/chp-crohdad:latest
    volumes:
      - &quot;/var/run/docker.sock:/var/run/docker.sock&quot;
      - &quot;/etc/iproute2/rt_tables:/etc/iproute2/rt_tables&quot;
      - &quot;/dev/log:/dev/log&quot;
</code></pre>


<div class="notices note" > <p>Ansible v2.1 or greater is required to use the <code>docker_container</code>
module.</p>
 </div>


<h2 id="span-start-the-container-advertiser-automatically-when-the-system-boots-span"><span>Start the Container Advertiser Automatically when the System Boots</span></h2>

<p>This configuration automatically restarts the container if it dies at
any point using standard systemd constructs.</p>

<ol>
<li><p>Create the <code>systemd</code> unit file
<code>/etc/systemd/system/container-advertiser.service</code> and populate the
file with the following content.</p>

<pre><code>[Unit]
Description=Container Advertiser
After=docker.service network-online.target
Requires=docker.service
 
[Service]
Restart=always
TimeoutStartSec=0
 
#One ExecStart/ExecStop line to prevent hitting bugs in certain systemd versions
ExecStart=/bin/sh -c '/usr/bin/docker rm -f crohdad; \
/usr/bin/docker pull hub.cumulusnetworks.com/chp-crohdad:latest; \
/usr/bin/docker run -t --net=host --privileged \
-v /var/run/docker.sock:/var/run/docker.sock \
-v /etc/iproute2/rt_tables:/etc/iproute2/rt_tables \
-v /dev/log:/dev/log \
--name crohdad hub.cumulusnetworks.com/chp-crohdad:latest'
 
ExecStop=-/bin/sh -c '/usr/bin/docker stop crohdad; \
/usr/bin/docker rm -f crohdad'
 
[Install]
WantedBy=multi-user.target
</code></pre></li>

<li><p>Set the container to start at boot time by enabling the
<code>container-advertiser</code> service.</p>

<pre><code>root@host:# systemctl enable container-advertiser.service
</code></pre></li>

<li><p><strong>Optional:</strong> Start the Container Advertiser.</p>

<pre><code>root@host:# systemctl start container-advertiser.service
</code></pre></li>
</ol>

<h2 id="span-further-example-configurations-span"><span>Further Example Configurations</span></h2>

<p>To see a Vagrant-based demo of the Container Advertiser in action, visit
the <a href="https://github.com/CumulusNetworks/cldemo-roh-dad" target="_blank">Cumulus Networks GitHub
repository</a>.</p>

<article id="html-search-results" class="ht-content" style="display: none;">

</article>

<footer id="ht-footer">

</footer>

<p></details></p>
</article>

      <script src="https://utteranc.es/client.js"
        repo="CumulusNetworks/docs-internal"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
      </script>

    </div>
    

      


  

    <aside class="book-toc fixed">

  
    <div class="toc">
    
      <button>
      <a href="https://github.com/CumulusNetworks/docs/edit/master/content/host-pack/Configuring-Container-Advertiser.md" target="_blank" rel="noopener"><img src="/docs.cumulusnetworks.com/svg/pencil-circle.svg" alt="Edit" /> Edit this page</a>
      </button>
    
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#span-container-advertiser-architecture-span"><span>Container Advertiser Architecture</span></a>
<ul>
<li><a href="#span-redistribute-the-container-routing-table-into-frrouting-span"><span>Redistribute the Container Routing Table into FRRouting</span></a></li>
<li><a href="#span-supported-docker-network-driver-types-span"><span>Supported Docker Network Driver Types</span></a></li>
</ul></li>
<li><a href="#span-run-container-advertiser-span"><span>Run Container Advertiser</span></a></li>
<li><a href="#span-container-advertiser-options-span"><span>Container Advertiser Options</span></a>
<ul>
<li><a href="#span-write-events-to-the-host-syslog-span"><span>Write Events to the Host syslog</span></a></li>
<li><a href="#span-control-container-advertisement-by-subnet-span"><span>Control Container Advertisement by Subnet</span></a></li>
<li><a href="#span-view-all-supported-options-span"><span>View All Supported Options</span></a></li>
</ul></li>
<li><a href="#span-deploy-the-container-advertiser-with-ansible-span"><span>Deploy the Container Advertiser with Ansible</span></a></li>
<li><a href="#span-start-the-container-advertiser-automatically-when-the-system-boots-span"><span>Start the Container Advertiser Automatically when the System Boots</span></a></li>
<li><a href="#span-further-example-configurations-span"><span>Further Example Configurations</span></a></li>
</ul></li>
</ul>
</nav>
    </div>
  

</aside>






  </main>
  <footer class="footer-top">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <div class="footer-content">
            <div class="mb-4">
                <img src="https://static.cumulusnetworks.com/static/images/shared/cumulus-networks-rt-white-trademarked.ff839f1b2570.svg">
                <p>© <script type="text/javascript">document.write(new Date().getFullYear());</script> Cumulus Networks.<br>
                Site by <a href="//unomena.com/" target="_blank">Unomena</a>.</p>
            </div>
            <ul class="mb-4">
              <li><h4>Products</h4></li>
              <li><a href="//cumulusnetworks.com/products/cumulus-linux/">Cumulus Linux</a></li>
              <li><a href="//cumulusnetworks.com/products/netq/">Cumulus NetQ</a></li>
              <li><a href="//cumulusnetworks.com/products/cumulus-express/">Cumulus Express</a></li>
            </ul>
            <ul class="mb-4">
              <li><h4>Learn</h4></li>
              <li><a href="//cumulusnetworks.com/learn/web-scale-networking-education/">Going web-scale</a></li>
              <li><a href="//cumulusnetworks.com/learn/events/">Events</a></li>
              <li><a href="//cumulusnetworks.com/blog/">Blog</a></li>
            </ul>
            <ul class="mb-4">
              <li><h4>About</h4></li>
              <li><a href="//cumulusnetworks.com/about/">Our story</a></li>
              <li><a href="//cumulusnetworks.com/about/careers/">Careers</a></li>
              <li><a href="//cumulusnetworks.com/about/media-coverage/">Media coverage</a></li>
              <li><a href="//docs.cumulusnetworks.com/" target="_blank">Tech docs</a></li>
              <li><a href="//cumulusnetworks.com/community/">Community</a></li>
            </ul>
            <ul>
              <li>
                <a href="//twitter.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M23 6.628l-2-.5 1-2-2.464.7A4.48 4.48 0 0 0 12 8.128v1c-3.539.73-6.634-1.2-9.5-4.5q-.75 4 1.5 6l-3-.5c.405 2.069 1.362 3.7 4 4l-2.5 1c1 2 2.566 2.31 5 2.5a10.748 10.748 0 0 1-6.5 2c12.755 5.669 20-2.664 20-10V8.3z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//www.facebook.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                      .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M17.768 7.5H13.5V5.6a.972.972 0 0 1 1.012-1.1c.418 0 2.988.01 2.988.01V.5h-4.329C9.244.5 8.5 3.474 8.5 5.355V7.5h-3v4h3v12h5v-12h3.851z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//linkedin.com/company/cumulus-networks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                      .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M6.5 22.5h-5v-13h5zm9-9a2 2 0 0 0-2 2v7h-5v-13h5v1.485a6.307 6.307 0 0 1 3.99-1.495c2.962 0 5.01 2.2 5.01 6.355V22.5h-5v-7a2 2 0 0 0-2-2zM6.5 5A2.5 2.5 0 1 1 4 2.5 2.5 2.5 0 0 1 6.5 5z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//vimeo.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M.5 7.393l.933 1.224S3.36 7.1 4 7.859s3.1 9.925 3.915 11.617c.714 1.483 2.684 3.444 4.845 2.042s9.34-7.529 10.626-14.769-8.642-5.723-9.693.583c2.627-1.577 4.03.642 2.686 3.154s-2.569 4.145-3.211 4.145-1.135-1.679-1.868-4.613c-.76-3.035-.755-8.5-3.911-7.882C4.412 2.721.5 7.393.5 7.393z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//www.github.com/cumulusnetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                        <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                        </style>
                    </defs>
                    <path class="a" d="M19.459 17c0-5.969-4.126-3.532-7.5-3.532s-7.5-2.375-7.5 3.532a3.5 3.5 0 0 0 3.5 3.5h8a3.5 3.5 0 0 0 3.5-3.5z"></path>
                    <path class="a" d="M21.489 10.214l.032.023s2.646-4.572-.6-7.237c-2 0-5.058 3.3-5.058 3.3l.022.016A14.152 14.152 0 0 0 8.1 6.3C8.083 6.285 5.037 3 3.042 3c-3.173 2.6-.729 7.012-.614 7.217a8.876 8.876 0 0 0-1.395 5.743c.241 3.126 2.847 6.54 5.982 6.54H16.9c3.135 0 5.742-3.414 5.982-6.54a8.857 8.857 0 0 0-1.393-5.746z"></path>
                    <ellipse class="a" cx="15.48" cy="17" rx="1" ry="1.5"></ellipse>
                    <ellipse class="a" cx="8.48" cy="17" rx="1" ry="1.5"></ellipse>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//slack.cumulusnetworks.com/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                        <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                        </style>
                    </defs>
                    <rect class="a" x=".5" y=".5" width="23" height="23" rx="6" ry="6"></rect>
                    <circle class="a" cx="12" cy="12" r="6"></circle>
                    <circle class="a" cx="19" cy="5" r="1.5"></circle>
                  </svg>
                </a>
              </li>
              <li>
                <p>Cumulus Networks<sup>®</sup> — Data center networking software for the open, modern data center.</p>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </footer>
  <div class="footer-bottom">
      <div class="container">
          <div class="row">
              <div class="col-12">
                  <ul>
                      <li><a href="//cumulusnetworks.com/legal/trademarks/">Trademarks</a></li>
                      <li><a href="//cumulusnetworks.com/legal/privacy/">Privacy</a></li>
                      <li><a href="//cumulusnetworks.com/legal/">Terms of service</a></li>
                  </ul>
              </div>
          </div>
      </div>
  </div>

  
  

</body>

</html>
