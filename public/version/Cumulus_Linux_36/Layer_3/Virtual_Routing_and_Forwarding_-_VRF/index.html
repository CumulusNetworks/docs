<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Virtual Routing and Forwarding - VRF | Cumulus Networks Documentation</title>

  
  <link href="https://fonts.googleapis.com/css?family=Oxygen|Oxygen+Mono:300,400,700" rel="stylesheet">

  
  
  
  <link rel="stylesheet" href="/book.min.a4ec20f62c4bbaad99f9db40524ec8653f6279bcde229add21ff46dfd05dfa96.css">

  
  <link rel="icon" href="/favicon.png" type="image/x-icon">

  
  <!--
  Made with Book Theme
  https://github.com/alex-shpak/hugo-book
  -->

</head>


<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  
  <header id="site-nav">
    <div class="header-wrapper flex">
      <a href="/">
        <img src="/header-logo.png" alt="Cumulus Networks">
        <img src="/cumulus-networks-rt-white.svg" alt="Cumulus Networks" class="header-mobile">
        <span>Docs</span>
      </a>
      <ul class="flex">
        <li><a href="//cumulusnetworks.com">HOME</a></li>
        <li><a href="//support.cumulusnetworks.com/">SUPPORT</a></li>
        <li><a href="//docs.cumulusnetworks.com/">DOCS</a></li>
        <li><a href="//education.cumulusnetworks.com">EDUCATION</a></li>
        <li><a href="//cumulusnetworks.com/blog/">BLOG</a></li>
        <li><a href="//forums.cumulusnetworks.com/">FORUMS</a></li>
      </ul>
      <div class="burger-menu">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </header>
  <div id="product-nav" class="flex">
    <ul>
      <li class="active"><a href="/Cumulus_Linux/">Cumulus Linux</a></li>
      <li><a href="/Cumulus_NetQ/">Cumulus NetQ</a></li>
      <li><a href="/Chassis/">Cumulus Express</a></li>
      <li><a href="">Cumulus VX</a></li>
    </ul>
    <div class="search-container">
      <div id="doc-search-box">
        <input type="text" class="doc-search-input" placeholder="Search" value="">
        <span><button type="submit"><img src="/icons/search_20x20.svg" alt=""></button></span>
      </div>
      <div id="dropdown" class="dropdown">
          <button class="btn" type="button" id="dropdownMenuButton">
            v3.76
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            <a class="dropdown-item" href="#">v3.5</a>
            <a class="dropdown-item" href="#">v2.1</a>
            <a class="dropdown-item" href="#">v1.43</a>
          </div>
      </div>
    </div>
  </div>
  <main class="flex container">
    <aside class="book-menu fixed">

      <nav role="navigation">
        <h2 class="book-brand">
          <a href="http://example.org/">Cumulus Networks Documentation</a>
        </h2>
        
        




  <ul class = "cn-book-section-container" id = "top">
    
        
          
      
          
            

  <li class="cn-book-section">
      

  <a href="/version/Cumulus_Linux_36/" >
    Cumulus Linux 3.6
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="/version/Cumulus_Linux_36/Cumulus_Linux_User_Guide/" >
    Cumulus Linux User Guide
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version/Cumulus_Linux_36/Quick_Start_Guide/" >
    Quick Start Guide
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version/Cumulus_Linux_36/Installation_Management/" >
    Installation Management
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Installation_Management/Managing_Cumulus_Linux_Disk_Images/" >
    Managing Cumulus Linux Disk Images
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Installation_Management/Installing_a_New_Cumulus_Linux_Image/" >
    Installing a New Cumulus Linux Image
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Installation_Management/Upgrading_Cumulus_Linux/" >
    Upgrading Cumulus Linux
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Installation_Management/Using_Snapshots/" >
    Using Snapshots
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Installation_Management/Adding_and_Updating_Packages/" >
    Adding and Updating Packages
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Installation_Management/Zero_Touch_Provisioning_-_ZTP/" >
    Zero Touch Provisioning - ZTP
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version/Cumulus_Linux_36/System_Configuration/" >
    System Configuration
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="/version/Cumulus_Linux_36/System_Configuration/Network_Command_Line_Utility_-_NCLU/" >
    Network Command Line Utility - NCLU
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/System_Configuration/Network_Command_Line_Utility_-_NCLU/Network_Command_Line_Utility/" >
    Network Command Line Utility
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version/Cumulus_Linux_36/System_Configuration/Authentication_Authorization_and_Accounting/" >
    Authentication, Authorization and Accounting
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/System_Configuration/Authentication_Authorization_and_Accounting/SSH_for_Remote_Access/" >
    SSH for Remote Access
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/System_Configuration/Authentication_Authorization_and_Accounting/User_Accounts/" >
    User Accounts
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/System_Configuration/Authentication_Authorization_and_Accounting/Using_sudo_to_Delegate_Privileges/" >
    Using sudo to Delegate Privileges
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/System_Configuration/Authentication_Authorization_and_Accounting/LDAP_Authentication_and_Authorization/" >
    LDAP Authentication and Authorization
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/System_Configuration/Authentication_Authorization_and_Accounting/TACACS_Plus/" >
    TACACS Plus
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/System_Configuration/Authentication_Authorization_and_Accounting/RADIUS_AAA/" >
    RADIUS AAA
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version/Cumulus_Linux_36/System_Configuration/Netfilter_-_ACLs/" >
    Netfilter - ACLs
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/System_Configuration/Netfilter_-_ACLs/Default_Cumulus_Linux_ACL_Configuration/" >
    Default Cumulus Linux ACL Configuration
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/System_Configuration/Netfilter_-_ACLs/Filtering_Learned_MAC_Addresses/" >
    Filtering Learned MAC Addresses
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/System_Configuration/Setting_Date_and_Time/" >
    Setting Date and Time
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/System_Configuration/Managing_Application_Daemons/" >
    Managing Application Daemons
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/System_Configuration/Configuring_switchd/" >
    Configuring switchd
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/System_Configuration/Power_over_Ethernet_-_PoE/" >
    Power over Ethernet - PoE
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/System_Configuration/Configuring_a_Global_Proxy/" >
    Configuring a Global Proxy
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/System_Configuration/HTTP_API/" >
    HTTP API
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version/Cumulus_Linux_36/Layer_1_and_Switch_Ports/" >
    Layer 1 and Switch Ports
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="/version/Cumulus_Linux_36/Layer_1_and_Switch_Ports/Interface_Configuration_and_Management/" >
    Interface Configuration and Management
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_1_and_Switch_Ports/Interface_Configuration_and_Management/Switch_Port_Attributes/" >
    Switch Port Attributes
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version/Cumulus_Linux_36/Layer_1_and_Switch_Ports/Buffer_and_Queue_Management/" >
    Buffer and Queue Management
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_1_and_Switch_Ports/Buffer_and_Queue_Management/Configuring_Hardware-enabled_DDOS_Protection/" >
    Configuring Hardware-enabled DDOS Protection
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_1_and_Switch_Ports/DHCP_Relays/" >
    DHCP Relays
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_1_and_Switch_Ports/DHCP_Servers/" >
    DHCP Servers
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_1_and_Switch_Ports/Facebook_Voyager_Optical_Interfaces/" >
    Facebook Voyager Optical Interfaces
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_1_and_Switch_Ports/802.1X_Interfaces/" >
    802.1X Interfaces
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_1_and_Switch_Ports/Prescriptive_Topology_Manager_-_PTM/" >
    Prescriptive Topology Manager - PTM
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version/Cumulus_Linux_36/Layer_2/" >
    Layer 2
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="/version/Cumulus_Linux_36/Layer_2/Link_Layer_Discovery_Protocol/" >
    Link Layer Discovery Protocol
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_2/Link_Layer_Discovery_Protocol/Voice_VLAN/" >
    Voice VLAN
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version/Cumulus_Linux_36/Layer_2/Ethernet_Bridging_-_VLANs/" >
    Ethernet Bridging - VLANs
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_2/Ethernet_Bridging_-_VLANs/VLAN-aware_Bridge_Mode/" >
    VLAN-aware Bridge Mode
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_2/Ethernet_Bridging_-_VLANs/Traditional_Bridge_Mode/" >
    Traditional Bridge Mode
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_2/Ethernet_Bridging_-_VLANs/VLAN_Tagging/" >
    VLAN Tagging
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_2/Ethernet_Bridging_-_VLANs/VLAN-aware_Bridge_Mode_for_Large-scale_Layer_2_Environments/" >
    VLAN-aware Bridge Mode for Large-scale Layer 2 Environments
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version/Cumulus_Linux_36/Layer_2/Virtual_Router_Redundancy_-_VRR/" >
    Virtual Router Redundancy - VRR
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_2/Virtual_Router_Redundancy_-_VRR/ifplugd/" >
    ifplugd
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_2/Spanning_Tree_and_Rapid_Spanning_Tree/" >
    Spanning Tree and Rapid Spanning Tree
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_2/Bonding_-_Link_Aggregation/" >
    Bonding - Link Aggregation
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_2/Multi-Chassis_Link_Aggregation_-_MLAG/" >
    Multi-Chassis Link Aggregation - MLAG
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_2/LACP_Bypass/" >
    LACP Bypass
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_2/IGMP_and_MLD_Snooping/" >
    IGMP and MLD Snooping
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version/Cumulus_Linux_36/Network_Virtualization/" >
    Network Virtualization
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="/version/Cumulus_Linux_36/Network_Virtualization/Static_VXLAN_Configurations/" >
    Static VXLAN Configurations
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Network_Virtualization/Static_VXLAN_Configurations/Static_VXLAN_Tunnels/" >
    Static VXLAN Tunnels
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Network_Virtualization/Static_VXLAN_Configurations/Static_MAC_Bindings_with_VXLAN/" >
    Static MAC Bindings with VXLAN
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version/Cumulus_Linux_36/Network_Virtualization/Lightweight_Network_Virtualization_Overview/" >
    Lightweight Network Virtualization Overview
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Network_Virtualization/Lightweight_Network_Virtualization_Overview/LNV_VXLAN_Active-Active_Mode/" >
    LNV VXLAN Active-Active Mode
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Network_Virtualization/Lightweight_Network_Virtualization_Overview/LNV_Full_Example/" >
    LNV Full Example
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version/Cumulus_Linux_36/Network_Virtualization/Virtualization_Integrations/" >
    Virtualization Integrations
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Network_Virtualization/Virtualization_Integrations/Integrating_Hardware_VTEPs_with_Midokura_MidoNet_and_OpenStack/" >
    Integrating Hardware VTEPs with Midokura MidoNet and OpenStack
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Network_Virtualization/Virtualization_Integrations/Integrating_Hardware_VTEPs_with_VMware_NSX-V/" >
    Integrating Hardware VTEPs with VMware NSX-V
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Network_Virtualization/Virtualization_Integrations/Integrating_Hardware_VTEPs_with_VMware_NSX/" >
    Integrating Hardware VTEPs with VMware NSX
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Network_Virtualization/Ethernet_Virtual_Private_Network_-_EVPN/" >
    Ethernet Virtual Private Network - EVPN
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Network_Virtualization/VXLAN_Routing/" >
    VXLAN Routing
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Network_Virtualization/VXLAN_Scale/" >
    VXLAN Scale
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Network_Virtualization/Hybrid_Cloud_Connectivity_with_QinQ_and_VXLANs/" >
    Hybrid Cloud Connectivity with QinQ and VXLANs
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version/Cumulus_Linux_36/Layer_3/" >
    Layer 3
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="/version/Cumulus_Linux_36/Layer_3/FRRouting_Overview/" >
    FRRouting Overview
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_3/FRRouting_Overview/Upgrading_from_Quagga_to_FRRouting/" >
    Upgrading from Quagga to FRRouting
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version/Cumulus_Linux_36/Layer_3/Configuring_FRRouting/" >
    Configuring FRRouting
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_3/Configuring_FRRouting/Comparing_NCLU_and_vtysh_Commands/" >
    Comparing NCLU and vtysh Commands
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_3/Routing/" >
    Routing
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_3/Introduction_to_Routing_Protocols/" >
    Introduction to Routing Protocols
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_3/Network_Topology/" >
    Network Topology
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_3/Address_Resolution_Protocol_-_ARP/" >
    Address Resolution Protocol - ARP
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_3/Open_Shortest_Path_First_-_OSPF_-_Protocol/" >
    Open Shortest Path First - OSPF - Protocol
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_3/Open_Shortest_Path_First_v3_-_OSPFv3_-_Protocol/" >
    Open Shortest Path First v3 - OSPFv3 - Protocol
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_3/Border_Gateway_Protocol_-_BGP/" >
    Border Gateway Protocol - BGP
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_3/Policy-based_Routing/" >
    Policy-based Routing
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_3/Bidirectional_Forwarding_Detection_-_BFD/" >
    Bidirectional Forwarding Detection - BFD
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_3/Equal_Cost_Multipath_Load_Sharing_-_Hardware_ECMP/" >
    Equal Cost Multipath Load Sharing - Hardware ECMP
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_3/Redistribute_Neighbor/" >
    Redistribute Neighbor
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_3/Virtual_Routing_and_Forwarding_-_VRF/"  class="active" >
    Virtual Routing and Forwarding - VRF
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_3/Management_VRF/" >
    Management VRF
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_3/GRE_Tunneling/" >
    GRE Tunneling
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_3/Protocol_Independent_Multicast_-_PIM/" >
    Protocol Independent Multicast - PIM
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Layer_3/Segment_Routing/" >
    Segment Routing
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version/Cumulus_Linux_36/Monitoring_and_Troubleshooting/" >
    Monitoring and Troubleshooting
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="/version/Cumulus_Linux_36/Monitoring_and_Troubleshooting/Monitoring_System_Hardware/" >
    Monitoring System Hardware
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Monitoring_and_Troubleshooting/Monitoring_System_Hardware/Network_Switch_Port_LED_and_Status_LED_Guidelines/" >
    Network Switch Port LED and Status LED Guidelines
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version/Cumulus_Linux_36/Monitoring_and_Troubleshooting/Understanding_the_cl-support_Output_File/" >
    Understanding the cl-support Output File
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Monitoring_and_Troubleshooting/Understanding_the_cl-support_Output_File/Troubleshooting_Log_Files/" >
    Troubleshooting Log Files
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Monitoring_and_Troubleshooting/Understanding_the_cl-support_Output_File/Troubleshooting_the_etc_Directory/" >
    Troubleshooting the etc Directory
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version/Cumulus_Linux_36/Monitoring_and_Troubleshooting/Troubleshooting_Network_Interfaces/" >
    Troubleshooting Network Interfaces
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Monitoring_and_Troubleshooting/Troubleshooting_Network_Interfaces/Monitoring_Interfaces_and_Transceivers_Using_ethtool/" >
    Monitoring Interfaces and Transceivers Using ethtool
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version/Cumulus_Linux_36/Monitoring_and_Troubleshooting/Network_Troubleshooting/" >
    Network Troubleshooting
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Monitoring_and_Troubleshooting/Network_Troubleshooting/Using_NCLU_to_Troubleshoot_Your_Network_Configuration/" >
    Using NCLU to Troubleshoot Your Network Configuration
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Monitoring_and_Troubleshooting/Network_Troubleshooting/Monitoring_System_Statistics_and_Network_Traffic_with_sFlow/" >
    Monitoring System Statistics and Network Traffic with sFlow
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version/Cumulus_Linux_36/Monitoring_and_Troubleshooting/Simple_Network_Management_Protocol_SNMP_Monitoring/" >
    Simple Network Management Protocol (SNMP) Monitoring
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Monitoring_and_Troubleshooting/Simple_Network_Management_Protocol_SNMP_Monitoring/Using_Nutanix_Prism_as_a_Monitoring_Tool/" >
    Using Nutanix Prism as a Monitoring Tool
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Monitoring_and_Troubleshooting/Single_User_Mode_-_Boot_Recovery/" >
    Single User Mode - Boot Recovery
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Monitoring_and_Troubleshooting/Resource_Diagnostics_Using_cl-resource-query/" >
    Resource Diagnostics Using cl-resource-query
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Monitoring_and_Troubleshooting/Monitoring_Virtual_Device_Counters/" >
    Monitoring Virtual Device Counters
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Monitoring_and_Troubleshooting/ASIC_Monitoring/" >
    ASIC Monitoring
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Monitoring_and_Troubleshooting/Monitoring_Best_Practices/" >
    Monitoring Best Practices
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Monitoring_and_Troubleshooting/switchd_Log_Message_Reference/" >
    switchd Log Message Reference
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Monitoring_and_Troubleshooting/FRRouting_Log_Message_Reference/" >
    FRRouting Log Message Reference
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version/Cumulus_Linux_36/Network_Solutions/" >
    Network Solutions
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Network_Solutions/Data_Center_Host_to_ToR_Architecture/" >
    Data Center Host to ToR Architecture
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Network_Solutions/Cumulus_Networks_Services_Demos/" >
    Cumulus Networks Services Demos
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Network_Solutions/Docker_on_Cumulus_Linux/" >
    Docker on Cumulus Linux
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Network_Solutions/OpenStack_Neutron_ML2_and_Cumulus_Linux/" >
    OpenStack Neutron ML2 and Cumulus Linux
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Network_Solutions/Anycast_Design_Guide/" >
    Anycast Design Guide
  </a>


    </li>
    
    <li >
      

  <a href="/version/Cumulus_Linux_36/Network_Solutions/RDMA_over_Converged_Ethernet_-_RoCE/" >
    RDMA over Converged Ethernet - RoCE
  </a>


    </li>
    
  </ul>


  </li>


    
    
  </ul>


  </li>


          
      
          
      
    
  </ul>









      </nav>

      
      
      
      

      <script src = "http://example.org/js/menuBundle.js"> </script>

    </aside>

    <div class="book-page">

      
      <header class="align-center justify-between book-header">
        <label for="menu-control">
          <img src="/svg/menu.svg" alt="Menu" />
        </label>
        <strong>Virtual Routing and Forwarding - VRF</strong>
      </header>

      
      
<article class="markdown">
<h1>Virtual Routing and Forwarding - VRF</h1>

<p>Cumulus Linux provides <em>virtual</em> <em>routing and forwarding</em> (VRF) to allow
for the presence of multiple independent routing tables working
simultaneously on the same router or switch. This permits multiple
network paths without the need for multiple switches. Think of this
feature as VLAN for layer 3, but unlike VLANs, there is no field in the
IP header carrying it. Other implementations call this feature
<em>VRF-Lite</em>.</p>

<p>The primary use cases for VRF in a data center are similar to VLANs at
layer 2: using common physical infrastructure to carry multiple isolated
traffic streams for multi-tenant environments, where these streams are
allowed to cross over only at configured boundary points, typically
firewalls or IDS. You can also use it to burst traffic from private
clouds to enterprise networks where the burst point is at layer 3. Or
you can use it in an OpenStack deployment.</p>

<p>VRF is fully supported in the Linux kernel, so it has the following
characteristics:</p>

<ul>
<li><p>The VRF is presented as a layer 3 master network device with its own
associated routing table.</p></li>

<li><p>The layer 3 interfaces (VLAN interfaces, bonds, switch virtual
interfaces/SVIs) associated with the VRF are enslaved to that VRF;
IP rules direct FIB (forwarding information base) lookups to the
routing table for the VRF device.</p></li>

<li><p>The VRF device can have its own IP address, known as a <em>VRF-local
loopback</em>.</p></li>

<li><p>Applications can use existing interfaces to operate in a VRF context
— by binding sockets to the VRF device or passing the <code>ifindex</code>
using <code>cmsg</code>. By default, applications on the switch run against the
default VRF. Services started by <code>systemd</code> run in the default VRF
unless the VRF instance is used. If <a href="/old/Cumulus_Linux_36/Management_VRF.html">management
VRF</a> is enabled, logins
to the switch default to the management VRF. This is a convenience
for users to not have to specify management VRF for each command.</p></li>

<li><p>Listen sockets used by services are VRF-global by default unless the
application is configured to use a more limited scope — for example,
read about <a href="/old/Cumulus_Linux_36/Management_VRF.html#src-8362410_ManagementVRF-services">services in the management
VRF</a>.
Connected sockets (like TCP) are then bound to the VRF domain in
which the connection originates. The kernel provides a sysctl that
allows a single instance to accept connections over all VRFs. For
TCP, connected sockets are bound to the VRF the first packet was
received. This sysctl is enabled for Cumulus Linux.</p></li>

<li><p>Connected and local routes are placed in appropriate VRF tables.</p></li>

<li><p>Neighbor entries continue to be per-interface, and you can view all
entries associated with the VRF device.</p></li>

<li><p>A VRF does not map to its own network namespace; however, you can
nest VRFs in a network namespace.</p></li>

<li><p>You can use existing Linux tools to interact with it, such as
<code>tcpdump</code>.</p></li>
</ul>

<p>Cumulus Linux supports up to 64 VRFs on a switch.</p>

<p>You configure VRF by associating each subset of interfaces to a VRF
routing table, and configuring an instance of the routing protocol — BGP
or OSPFv2 — for each routing table.</p>








<img class = "confluence-embedded-image confluence-thumbnail" src = "/images/download/thumbnails/8362412/mrf2.png" alt = "/images/download/thumbnails/8362412/mrf2.png"


width = 300

 />


<h2 id="configuring-vrf">Configuring VRF</h2>

<p>Each routing table is called a <em>VRF table</em>, and has its own table ID.
You configure VRF using
<a href="/old/Cumulus_Linux_36/Network_Command_Line_Utility_-_NCLU.html">NCLU</a>,
then place the layer 3 interface in the VRF. You can have a maximum of
64 VRFs on a switch.</p>

<p>When you configure a VRF, you follow a similar process to other network
interfaces. Keep in mind the following for a VRF table:</p>

<ul>
<li><p>It can have an IP address, a loopback interface for the VRF.</p></li>

<li><p>Associated rules are added automatically.</p></li>

<li><p>You can also add a default route to avoid skipping across tables
when the kernel forwards the packet.</p></li>

<li><p>Names for VRF tables can be up to 15 characters. However, you
<strong>cannot</strong> use the name <em>mgmt</em>, as this name can <strong>only</strong> be used
for <a href="/old/Cumulus_Linux_36/Management_VRF.html">management VRF</a>.</p></li>
</ul>

<p>To configure a VRF, run:</p>

<pre><code>                   
cumulus@switch:~$ net add vrf rocket vrf-table auto
cumulus@switch:~$ net add interface swp1 vrf rocket
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit
   
    
</code></pre>

<p>These commands result in the following VRF configuration in the
<code>/etc/network/interfaces</code> file:</p>

<pre><code>                   
auto rocket
iface rocket
    vrf-table auto
  
auto swp1 
iface swp1
    vrf rocket
   
    
</code></pre>

<h3 id="specifying-a-table-id">Specifying a Table ID</h3>

<p>Instead of having Cumulus Linux assign a table ID for the VRF table, you
can specify your own table ID in the configuration. The table ID to name
mapping is saved in <code>/etc/iproute2/rt_tables.d/</code> for name-based
references. So instead of using the <code>auto</code> option above, specify the
table ID like this:</p>

<pre><code>                   
cumulus@switch:~$ net add vrf rocket vrf-table 1016
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit
   
    
</code></pre>


<div class="notices note" > <p>If you do specify a table ID, it <strong>must</strong> be in the range of 1001 to
1255 which is reserved in Cumulus Linux for VRF table IDs.</p>
 </div>


<h3 id="bringing-a-vrf-up-after-downing-it-with-ifdown">Bringing a VRF Up after Downing It with ifdown</h3>

<p>If you take down a VRF using <code>ifdown</code>, to bring it back up you need to
do one of two things:</p>

<ul>
<li><p>Use <code>ifup --with-depends &lt;vrf&gt;</code></p></li>

<li><p>Use <code>ifreload -a</code></p></li>
</ul>

<p>For example:</p>

<pre><code>                   
cumulus@switch:~$ sudo ifdown rocket
cumulus@switch:~$ sudo ifup --with-depends rocket
   
    
</code></pre>

<h3 id="using-the-vrf-command">Using the vrf Command</h3>

<p>The <code>vrf</code> command returns information about VRF tables that is otherwise
not available in other Linux commands, such as <code>iproute</code>. You can also
use it to execute non-VRF-specific commands and perform other tasks
related to VRF tables.</p>

<p>To get a list of VRF tables, run:</p>

<pre><code>                   
cumulus@switch:~$ vrf list
  
VRF              Table
---------------- -----
rocket            1016
   
    
</code></pre>

<p>To return a list of processes and PIDs associated with a specific VRF
table, run <code>vrf task list &lt;vrf-name&gt;</code>. For example:</p>

<pre><code>                   
cumulus@switch:~$ vrf task list rocket
 
VRF: rocket            
-----------------------
dhclient           2508
sshd               2659
bash               2681
su                 2702
bash               2720
vrf                2829
   
    
</code></pre>

<p>To determine which VRF table is associated with a particular PID, run
<code>vrf task identify &lt;pid&gt;</code>. For example:</p>

<pre><code>                   
cumulus@switch:~$ vrf task identify 2829
 
rocket
   
    
</code></pre>

<h4 id="running-ipv4-and-ipv6-commands-in-a-vrf-context">Running IPv4 and IPv6 Commands in a VRF Context</h4>

<p>You can execute non-VRF-specific Linux commands and perform other tasks
against a given VRF table. This typically applies to single-use commands
started from a login shell, as they affect only AF_INET and AF_INET6
sockets opened by the command that gets executed; it has no impact on
netlink sockets, associated with the <code>ip</code> command.</p>

<p>To execute such a command against a VRF table, run <code>vrf task exec
&lt;vrf-name&gt; &lt;command&gt;</code>. For example, to SSH from the switch to a device
accessible through VRF <em>rocket</em>:</p>

<pre><code>                   
cumulus@switch:~$ sudo vrf task exec rocket ssh user@host
   
    
</code></pre>

<p>You should manage long-running services with <code>systemd</code> using the
<em>service@vrf</em> notation; for example, <code>systemctl start ntp@mgmt</code>.
<code>systemd</code>-based services are stopped when a VRF is deleted and started
when the VRF is created. For example, restarting networking or running
an <code>ifdown</code>/<code>ifup</code> sequence.</p>

<h3 id="services-in-vrfs">Services in VRFs</h3>

<p>For services that need to run against a specific VRF, Cumulus Linux uses
<code>systemd</code> instances, where the instance is the VRF. In general, you
start a service within a VRF like this:</p>

<pre><code>                   
cumulus@switch:~$ sudo systemctl start @
   
    
</code></pre>

<p>For example, you can run the NTP service in the turtle VRF using:</p>

<pre><code>                   
cumulus@switch:~$ sudo systemctl start ntp@turtle
   
    
</code></pre>

<p>In most cases, the instance running in the default VRF needs to be
stopped before a VRF instance can start. This is because the instance
running in the default VRF owns the port across all VRFs — that is, it
is VRF global. <code>systemd</code>-based services are stopped when the VRF is
deleted and started when the VRF is created. For example, when you
restart networking or run an <code>ifdown</code>/<code>ifup</code> sequence — as mentioned
above. The <a href="/old/Cumulus_Linux_36/Management_VRF.html#src-8362410_ManagementVRF-services">management VRF
chapter</a>
details how to do this.</p>

<p>In Cumulus Linux, the following services work with VRF instances:</p>

<ul>
<li><p>chef-client</p></li>

<li><p>collectd</p></li>

<li><p>dhcpd</p></li>

<li><p>dhcrelay</p></li>

<li><p>hsflowd</p></li>

<li><p>netq-agent</p></li>

<li><p>ntp</p></li>

<li><p>puppet</p></li>

<li><p>snmpd</p></li>

<li><p>snmptrapd</p></li>

<li><p>ssh</p></li>

<li><p>zabbix-agent</p></li>
</ul>


<div class="notices note" > <p>There are cases where <code>systemd</code> instances do not work; you must use a
service-specific configuration option instead. For example, you can
configure <code>rsyslogd</code> to send messages to remote systems over a VRF:</p>

<pre><code>                   
action(type=&quot;omfwd&quot; Target=&quot;hostname or ip here&quot; Device=&quot;mgmt&quot; Port=514
Protocol=&quot;udp&quot;)
   
    
</code></pre>
 </div>


<h2 id="vrf-route-leaking">VRF Route Leaking</h2>

<p>The most common use case for VRF is to use multiple independent routing
and forwarding tables; however, there are situations where destinations
in one VRF must be reachable (leaked) from another VRF. For example, to
make a service (such as a firewall) available to multiple VRFs or to
enable routing to external networks (or the Internet) for multiple VRFs,
where the external network itself is reachable through a specific VRF.</p>

<p>Cumulus Linux provides two options for route leaking across VRFs:
<em>static route leaking</em> and <em>dynamic route leaking</em>.</p>


<div class="notices note" > <ul>
<li><p>An interface is always assigned to only one VRF; any packets
received on that interface are routed using the associated VRF
routing table.</p></li>

<li><p>Route leaking is typically used for non-overlapping addresses.</p></li>

<li><p>Route leaking is supported for both IPv4 and IPv6 routes.</p></li>

<li><p>Route leaking is supported only on switches with Broadcom ASICs.</p></li>
</ul>
 </div>


<h3 id="enabling-vrf-route-leaking">Enabling VRF Route Leaking</h3>

<p>VRF route leaking is <em>not</em> enabled by default. To enable VRF route
leaking:</p>

<ol>
<li><p>Edit the <code>/etc/cumulus/switchd.conf</code> file. Change the
<code>vrf_route_leak_enable</code> option to <code>TRUE</code> and uncomment the line. For
example:</p>

<pre><code>                       
cumulus@switch:~$ sudo nano /etc/cumulus/switchd.conf
... 
#enable ptp time stamping
#ptp.timestamping = FALSE
vrf_route_leak_enable=TRUE
       
        
</code></pre></li>

<li><p>Restart <code>switchd</code> for the change to take effect:</p>

<pre><code>                       
cumulus@switch:~$ sudo systemctl restart switchd.service
       
        
</code></pre></li>
</ol>

<h3 id="configuring-static-route-leaking">Configuring Static Route Leaking</h3>

<p>For static route leaking, you configure routes manually in a VRF whose
next hops are reachable over an interface that is part of another VRF.
This is useful where one or more specific destinations in a different
VRF need to be reachable from another VRF. You can use static route
leaking to reach remote destinations (through a next hop router) or
directly connected destinations in another VRF.</p>

<p>Use the keyword <code>nexthop-vrf</code> when configuring a static route to specify
the VRF through which the next hop router is reachable.<br />
The example command below adds a static route (10.1.0.0/24) to a VRF
named <code>turtle</code>, which is reachable through a next-hop router
(192.168.200.1) over a different VRF, <code>rocket</code>.</p>

<pre><code>                   
cumulus@switch:~$ net add routing route 10.1.0.0/24 192.168.200.1 vrf turtle nexthop-vrf rocket
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit
   
    
</code></pre>

<h3 id="configuring-static-route-leaking-with-evpn">Configuring Static Route Leaking with EVPN</h3>

<p>You can configure static route leaking with EVPN symmetric routing. The
following commands provide examples.</p>


<div class="notices note" > <p>The static VRF route must be a supernet of routes to be leaked.</p>

<p>The supernet must not be the default route.</p>
 </div>


<p>To configure static route leaking between VRF1 and VRF2, where VRF1
contains subnets 10.50.1.0/24, 10.50.2.0/24, 10.50.3.0/24, and
10.50.4.0/24 and VRF2 contains subnets 10.60.1.0/24, 10.60.2.0/24,
10.60.3.0/24, and 10.60.4.0/24, run these commands:</p>

<pre><code>                   
cumulus@switch:~$ net add routing route 10.60.0.0/21 vrf2 vrf vrf1 nexthop-vrf vrf2
cumulus@switch:~$ net add routing route 10.50.0.0/21 vrf1 vrf vrf2 nexthop-vrf vrf1
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit
   
    
</code></pre>

<p>To configure static route leaking between the default VRF and VRF1,
where swp1s0 is the egress port for subnets under 10.10.0.0/16 in the
default VRF, run these commands:</p>

<pre><code>                   
cumulus@switch:~$ net add routing route 10.10.0.0/16 swp1s0 vrf vrf1 nexthop-vrf Default-IP-Routing-Table
cumulus@switch:~$ net add routing route 10.50.0.0/21 vrf1 nexthop-vrf vrf1
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit
   
    
</code></pre>

<p>Configuring Dynamic Route Leaking</p>

<p>For dynamic route leaking, a destination VRF is interested in the routes
of a source VRF. As routes come and go in the source VRF, they are
dynamically leaked to the destination VRF through BGP.<br />
If the routes in the source VRF are learned through BGP, no additional
configuration is necessary. If the routes in the source VRF are learned
through OSPF, or if they are statically configured or directly-connected
networks have to be reached, the routes need to be first <em>redistributed</em>
into BGP (in the source VRF) for them to be leaked.</p>

<p>You can also use dynamic route leaking to reach remote destinations as
well as directly connected destinations in another VRF. Multiple VRFs
can import routes from a single source VRF and a VRF can import routes
from multiple source VRFs. This is typically used when a single VRF
provides connectivity to external networks or a shared service for many
other VRFs.<br />
The routes that are leaked dynamically across VRFs can be controlled
using a route-map.<br />
Because dynamic route leaking happens through BGP, the underlying
mechanism relies on the BGP constructs of the Route Distinguisher (RD)
and Route Targets (RTs). However, you do not need to configure these
parameters; they are automatically derived when you enable route leaking
between a pair of VRFs.</p>


<div class="notices note" > <ul>
<li><p>You cannot reach the loopback address of a VRF (the address assigned
to the VRF device) from another VRF.</p></li>

<li><p>When using dynamic route leaking, you must use the <code>redistribute</code>
command in BGP to leak non-BGP routes (connected or static routes);
you cannot use the <code>network</code> command.</p></li>

<li><p>Routes in the management VRF with the next-hop as eth0 or the
management interface are not leaked.</p></li>

<li><p>VRF dynamic route leaking is not supported for EVPN environments.</p></li>

<li><p>Routes learned with iBGP or multi-hop eBGP in a VRF can be leaked
even if their next hops become unreachable. Therefore, route leaking
for BGP-learned routes is recommended only when they are learned
through single-hop eBGP.</p></li>

<li><p>Route leaking is supported only between two named VRFs. Route
leaking between the default VRF and other VRFs is not supported
currently.</p></li>
</ul>
 </div>


<p>To configure dynamic route leaking, use the <code>net add bgp vrf
&lt;TO_VRFNAME&gt; ipv4|ipv6 unicast import vrf &lt;FROM_VRFNAME&gt;</code> command.<br />
In the following example, routes in the BGP routing table of VRF
<code>rocket</code> are dynamically leaked into VRF <code>turtle</code>.</p>

<pre><code>                   
cumulus@switch:~$ net add bgp vrf turtle ipv4 unicast import vrf rocket
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit
   
    
</code></pre>

<h4 id="excluding-certain-prefixes">Excluding Certain Prefixes</h4>

<p>You can exclude certain prefixes from being imported. The prefixes must
be configured in a route map.</p>

<p>The following example configures a route map to match the source
protocol BGP and imports the routes from VRF turtle to VRF rocket. For
the imported routes, the community is set to 11:11 in VRF rocket.</p>

<pre><code>                   
cumulus@switch:~$ net add bgp vrf rocket ipv4 unicast import vrf turtle
cumulus@switch:~$ net add routing route-map turtle-to-rocket-IPV4 permit 10
cumulus@switch:~$ net add routing route-map turtle-to-rocket-IPV4 permit 10 match source-protocol bgp
cumulus@switch:~$ net add routing route-map turtle-to-rocket-IPV4 permit 10 set community 11:11
cumulus@switch:~$ net add bgp vrf rocket ipv4 unicast import vrf route-map turtle-to-rocket-IPV4 
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit
   
    
</code></pre>

<h3 id="verifying-dynamic-route-leaking-configuration">Verifying Dynamic Route Leaking Configuration</h3>

<p>Use the <code>net show bgp vrf &lt;VRFNAME&gt; ipv4|ipv6 unicast route-leak</code>
command to check the status of dynamic VRF route leaking. For example:</p>

<pre><code>                   
cumulus@switch:~$ net show bgp vrf turtle ipv4 unicast route-leak
This VRF is importing IPv4 Unicast routes from the following VRFs:
  green
Import RT(s): 0.0.0.0:3
This VRF is exporting IPv4 Unicast routes to the following VRFs:
  green
RD: 10.1.1.1:2
Export RT: 10.1.1.1:2
   
    
</code></pre>

<p>To view the BGP routing table, use the <code>net show bgp vrf &lt;VRFNAME&gt;
ipv4|ipv6 unicast</code> command. To view the FRR IP routing table, use the
<code>net show route vrf &lt;VRFNAME&gt;</code> command. These commands show all routes,
including routes leaked from other VRFs.</p>

<p>The following example command shows all routes in VRF <code>turtle</code>,
including routes leaked from VRF <code>green</code>:</p>

<pre><code>                   
cumulus@switch:~$ net show route vrf turtle
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, P - PIM, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel, D - SHARP,
       F - PBR,
       &gt; - selected route, * - FIB route
 
VRF turtle:
K * 0.0.0.0/0 [255/8192] unreachable (ICMP unreachable), 6d07h01m
C&gt;* 10.1.1.1/32 is directly connected, turtle, 6d07h01m
B&gt;* 10.0.100.1/32 [200/0] is directly connected, green(vrf green), 6d05h10m
B&gt;* 10.0.200.0/24 [20/0] via 10.10.2.2, swp1.11, 5d05h10m
B&gt;* 10.0.300.0/24 [200/0] via 10.20.2.2, swp1.21(vrf green), 5d05h10m
C&gt;* 10.10.2.0/30 is directly connected, swp1.11, 6d07h01m
C&gt;* 10.10.3.0/30 is directly connected, swp2.11, 6d07h01m
C&gt;* 10.10.4.0/30 is directly connected, swp3.11, 6d07h01m
B&gt;* 10.20.2.0/30 [200/0] is directly connected, swp1.21(vrf green), 6d05h10m
   
    
</code></pre>

<h4 id="deleting-dynamic-route-leaking-configuration">Deleting Dynamic Route Leaking Configuration</h4>

<p>Use the <code>net del bgp vrf &lt;TO_VRFNAME&gt; ipv4|ipv6 unicast import vrf
&lt;FROM_VRFNAME&gt;</code> command to remove dynamic route leaking. This ensures
that all leaked routes are removed and routes are no longer leaked from
the specified source VRF.</p>

<p>The following example command deletes leaked routes from VRF <code>rocket</code> to
VRF <code>turtle</code>:</p>

<pre><code>                   
cumulus@switch:~$ net del bgp vrf turtle ipv4 unicast import vrf rocket
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit
   
    
</code></pre>


<div class="notices note" > <p>Do not use the kernel commands; they are no lnger supported and might
cause issues when used with VRF route leaking in FRR.</p>
 </div>


<h2 id="frrouting-operation-in-a-vrf">FRRouting Operation in a VRF</h2>

<p>In Cumulus Linux 3.5 and later,
<a href="/old/Cumulus_Linux_36/Border_Gateway_Protocol_-_BGP.html">BGP</a>,
<a href="/old/Cumulus_Linux_36/Open_Shortest_Path_First_-_OSPF_-_Protocol.html">OSPFv2</a>
and <a href="/old/Cumulus_Linux_36/Routing.html">static routing</a> (IPv4 and IPv6)
are supported within a VRF context. Various FRRouting routing
constructs, such as routing tables, nexthops, router-id, and related
processing are also VRF-aware.</p>

<p><a href="/old/Cumulus_Linux_36/FRRouting_Overview.html">FRRouting</a> learns of
VRFs provisioned on the system as well as interface attachment to a VRF
through notifications from the kernel.</p>

<p>You can assign switch ports to each VRF table with an interface-level
configuration, and BGP instances can be assigned to the table with a BGP
router-level command.</p>

<p>Because BGP is VRF-aware, they support per-VRF neighbors, both iBGP and
eBGP as well as numbered and unnumbered interfaces. Non-interface-based
VRF neighbors are bound to the VRF, which is how you can have
overlapping address spaces in different VRFs. Each VRF can have its own
parameters, such as address families and redistribution. Incoming
connections rely on the Linux kernel for VRF-global sockets. BGP
neighbors can be tracked using
<a href="/old/Cumulus_Linux_36/Bidirectional_Forwarding_Detection_-_BFD.html">BFD</a>,
both for single and multiple hops. You can configure multiple BGP
instances, associating each with a VRF.</p>

<p>A VRF-aware OSPFv2 configuration also supports numbered and unnumbered
interfaces. Supported layer 3 interfaces include SVIs, sub-interfaces
and physical interfaces. The VRF supports types 1 through 5 (ABR/ASBR –
external LSAs) and types 9 through 11 (opaque LSAs) link state
advertisements, redistributing other routing protocols, connected and
static routes, and route maps. As with BGP, you can track OSPF neighbors
with
<a href="/old/Cumulus_Linux_36/Bidirectional_Forwarding_Detection_-_BFD.html">BFD</a>.</p>


<div class="notices note" > <p>Cumulus Linux does not support multiple VRFs in multi-instance OSPF.</p>
 </div>


<p>VRFs are provisioned using NCLU. VRFs can be pre-provisioned in
FRRouting too, but they become active only when configured with NCLU.</p>

<ul>
<li><p>You pre-provision a VRF in FRRouting by running the command <code>vrf
vrf-name</code>.</p></li>

<li><p>A BGP instance corresponding to a VRF can be pre-provisioned by
configuring <code>net add bgp vrf &lt;VRF&gt; autonomous-system &lt;ASN&gt;</code>. Under
this context, all existing BGP parameters can be configured:
neighbors, peer-groups, address-family configuration,
redistribution, and so forth.</p></li>

<li><p>An OSPFv2 instance can be configured using the <code>net add ospf vrf
&lt;VRF&gt;</code> command; as with BGP, all OSPFv2 parameters can be
configured.</p></li>

<li><p>Static routes (IPv4 and IPv6) can be provisioned in a VRF by
specifying the VRF along with the static route configuration. For
example, <code>ip route prefix dev vrf vrf-name</code>. The VRF has to exist
for this configuration to be accepted — either already defined
through <code>/etc/network/interfaces</code> or pre-provisioned in FRRouting.
If you want to leak a static route in a VRF, see the <a href="/old/Cumulus_Linux_36/#src-8362412_VirtualRoutingandForwarding-VRF-leakstatic">note
above</a>.</p></li>
</ul>

<h3 id="example-bgp-and-ospf-configurations">Example BGP and OSPF Configurations</h3>

<p>Here&rsquo;s an example VRF configuration in BGP:</p>

<pre><code>                   
cumulus@switch:~$ net add bgp vrf vrf1012 autonomous-system 64900
cumulus@switch:~$ net add bgp vrf vrf1012 router-id 6.0.2.7
cumulus@switch:~$ net add bgp vrf vrf1012 neighbor ISL peer-group
cumulus@switch:~$ net add bgp vrf vrf1012 neighbor ISLv6 peer-group
cumulus@switch:~$ net add bgp vrf vrf1012 neighbor swp1.2 interface v6only peer-group ISLv6
cumulus@switch:~$ net add bgp vrf vrf1012 neighbor swp1.2 remote-as external
cumulus@switch:~$ net add bgp vrf vrf1012 neighbor swp3.2 interface v6only peer-group ISLv6
cumulus@switch:~$ net add bgp vrf vrf1012 neighbor swp3.2 remote-as external
cumulus@switch:~$ net add bgp vrf vrf1012 neighbor 169.254.2.18 remote-as external
cumulus@switch:~$ net add bgp vrf vrf1012 neighbor 169.254.2.18 peer-group ISL
cumulus@switch:~$ net add bgp vrf vrf1012 ipv4 unicast network 20.7.2.0/24
cumulus@switch:~$ net add bgp vrf vrf1012 ipv4 unicast neighbor ISL activate
cumulus@switch:~$ net add bgp vrf vrf1012 neighbor ISL route-map ALLOW_BR2 out
cumulus@switch:~$ net add bgp vrf vrf1012 ipv6 unicast network 2003:7:2::/125
cumulus@switch:~$ net add bgp vrf vrf1012 ipv6 unicast neighbor ISLv6 activate
cumulus@switch:~$ net add bgp vrf vrf1012 neighbor ISLv6 route-map ALLOW_BR2_v6 out
   
    
</code></pre>

<p>These commands produce the following configuration in the
<code>/etc/frr/frr.conf</code> file:</p>

<pre><code>                   
router bgp 64900 vrf vrf1012
  bgp router-id 6.0.2.7
  no bgp default ipv4-unicast
  neighbor ISL peer-group
  neighbor ISLv6 peer-group
  neighbor swp1.2 interface v6only peer-group ISLv6
  neighbor swp1.2 remote-as external
  neighbor swp3.2 interface v6only peer-group ISLv6
  neighbor swp3.2 remote-as external
  neighbor 169.254.2.18 remote-as external
  neighbor 169.254.2.18 peer-group ISL
  !
  address-family ipv4 unicast
    network 20.7.2.0/24
    neighbor ISL activate
    neighbor ISL route-map ALLOW_BR2 out
  exit-address-family
  !
  address-family ipv6 unicast
    network 2003:7:2::/125
    neighbor ISLv6 activate
    neighbor ISLv6 route-map ALLOW_BR2_v6 out
  exit-address-family
!
   
    
</code></pre>

<p>Here is the FRRouting OSPF configuration:</p>

<pre><code>                   
cumulus@switch:~$ net add ospf vrf vrf1 
cumulus@switch:~$ net add ospf vrf vrf1 router-id 4.4.4.4
cumulus@switch:~$ net add ospf vrf vrf1 log-adjacency-changes detail
cumulus@switch:~$ net add ospf vrf vrf1 network 10.0.0.0/24 area 0.0.0.1
cumulus@switch:~$ net add ospf vrf vrf1 network 9.9.0.0/16 area 0.0.0.0
cumulus@switch:~$ net add ospf vrf vrf1 redistribute connected
cumulus@switch:~$ net add ospf vrf vrf1 redistribute bgp
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit
   
    
</code></pre>

<p>These commands create the following configuration in the
<code>/etc/frr/frr.conf</code> file:</p>

<pre><code>                   
router ospf vrf vrf1
 ospf router-id 4.4.4.4
 log-adjacency-changes detail
 redistribute connected
 redistribute bgp
 network 9.9.0.0/16 area 0.0.0.0
 network 10.0.0.0/24 area 0.0.0.1
!
   
    
</code></pre>

<h2 id="example-commands-to-show-vrf-data">Example Commands to Show VRF Data</h2>

<p>There are a number of ways to interact with VRFs, including NCLU,
<code>vtysh</code> (the FRRouting CLI) and <code>iproute2</code>.</p>

<h3 id="showing-vrf-data-using-nclu-commands">Showing VRF Data Using NCLU Commands</h3>

<p>To show the routes in the VRF:</p>

<pre><code>                   
cumulus@switch:~$ net show route vrf rocket
RIB entry for rocket
=================
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, T - Table,
       &gt; - selected route, * - FIB route
 
C&gt;* 169.254.2.8/30 is directly connected, swp1.2
C&gt;* 169.254.2.12/30 is directly connected, swp2.2
C&gt;* 169.254.2.16/30 is directly connected, swp3.2
   
    
</code></pre>

<p>To show the BGP summary for the VRF:</p>

<pre><code>                   
cumulus@switch:~$ net show bgp vrf rocket summary
BGP router identifier 6.0.2.7, local AS number 64900 vrf-id 14
BGP table version 0
RIB entries 1, using 120 bytes of memory
Peers 6, using 97 KiB of memory
Peer groups 2, using 112 bytes of memory
 
Neighbor        V    AS MsgRcvd MsgSent   TblVer  InQ OutQ Up/Down  State/PfxRcd
s3(169.254.2.18)
                4 65000  102039  102040        0    0    0 3d13h03m        0
s1(169.254.2.10)
                4 65000  102039  102040        0    0    0 3d13h03m        0
s2(169.254.2.14)
                4 65000  102039  102040        0    0    0 3d13h03m        0
 
Total number of neighbors 3
   
    
</code></pre>

<p>To show BGP (IPv4) routes in the VRF:</p>

<pre><code>                   
cumulus@switch:~$ net show bgp vrf vrf1012
BGP table version is 0, local router ID is 6.0.2.7
Status codes: s suppressed, d damped, h history, * valid, &gt; best, = multipath,
              i internal, r RIB-failure, S Stale, R Removed
Origin codes: i - IGP, e - EGP, ? - incomplete
 
   Network          Next Hop            Metric LocPrf Weight Path
   20.7.2.0/24      0.0.0.0                  0         32768 i
 
Total number of prefixes 1
   
    
</code></pre>

<p>However, to show BGP IPv6 routes in the VRF, you need to use <code>vtysh</code>,
the FRRouting CLI:</p>

<pre><code>                   
cumulus@switch:~$ sudo vtysh
switch# show bgp vrf vrf1012
BGP table version is 0, local router ID is 6.0.2.7
Status codes: s suppressed, d damped, h history, * valid, &gt; best, = multipath,
              i internal, r RIB-failure, S Stale, R Removed
Origin codes: i - IGP, e - EGP, ? - incomplete
 
   Network          Next Hop            Metric LocPrf Weight Path
   2003:7:2::/125   ::                       0         32768 i
 
Total number of prefixes 1
switch# exit
cumulus@switch:~$
   
    
</code></pre>

<p>To show the OSPF VRFs:</p>

<pre><code>                   
cumulus@switch:~$ net show ospf vrf all
Name                                  Id         RouterId  
Default-IP-Routing-Table              0          6.0.0.7           
vrf1012                               45         9.9.12.7          
vrf1013                               52         9.9.13.7          
vrf1014                               59         9.9.14.7          
vrf1015                               65535      0.0.0.0      &lt;- OSPF instance not active, pre-provisioned config.     
vrf1016                               65535      0.0.0.0           
 
Total number of OSPF VRFs: 6
   
    
</code></pre>

<p>To show all the OSPF routes in a VRF:</p>

<pre><code>                   
cumulus@switch:~$ net show ospf vrf vrf1012 route 
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, P - PIM, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel,
       &gt; - selected route, * - FIB route
 
VRF vrf1012:
O&gt;* 6.0.0.1/32 [110/210] via 200.254.2.10, swp2s0.2, 00:13:30
  *                      via 200.254.2.14, swp2s1.2, 00:13:30
  *                      via 200.254.2.18, swp2s2.2, 00:13:30
O&gt;* 6.0.0.2/32 [110/210] via 200.254.2.10, swp2s0.2, 00:13:30
  *                      via 200.254.2.14, swp2s1.2, 00:13:30
  *                      via 200.254.2.18, swp2s2.2, 00:13:30
O&gt;* 9.9.12.5/32 [110/20] via 200.254.2.10, swp2s0.2, 00:13:29
  *                      via 200.254.2.14, swp2s1.2, 00:13:29
  *                      via 200.254.2.18, swp2s2.2, 00:13:29
   
    
</code></pre>

<h3 id="showing-vrf-data-using-frrouting-commands">Showing VRF Data Using FRRouting Commands</h3>

<p>Show all VRFs learned by FRRouting from the kernel. The table ID shows
the corresponding routing table in the kernel either automatically
assigned or manually defined:</p>

<pre><code>                   
cumulus@switch:~$ sudo vtysh
switch# show vrf
vrf vrf1012 id 14 table 1012
vrf vrf1013 id 21 table 1013
vrf vrf1014 id 28 table 1014
switch# exit
cumulus@switch:~$ 
   
    
</code></pre>

<p>Show VRFs configured in BGP, including the default. A non-zero ID is a
VRF that has also been actually provisioned — that is, defined in
<code>/etc/network/interfaces</code>:</p>

<pre><code>                   
cumulus@switch:~$ sudo vtysh
switch# show bgp vrfs
Type  Id     RouterId          #PeersCfg  #PeersEstb  Name
DFLT  0      6.0.0.7                   0           0  Default
 VRF  14     6.0.2.7                   6           6  vrf1012
 VRF  21     6.0.3.7                   6           6  vrf1013
 VRF  28     6.0.4.7                   6           6  vrf1014
 
Total number of VRFs (including default): 4
switch# exit
cumulus@switch:~$ 
   
    
</code></pre>

<p>Display interfaces known to FRRouting and attached to this VRF:</p>

<pre><code>                   
cumulus@switch:~$ sudo vtysh
switch# show interface vrf vrf1012
Interface br2 is up, line protocol is down
  PTM status: disabled
  vrf: vrf1012
  index 13 metric 0 mtu 1500
  flags: 
  inet 20.7.2.1/24
 
  inet6 fe80::202:ff:fe00:a/64
  ND advertised reachable time is 0 milliseconds
  ND advertised retransmit interval is 0 milliseconds
  ND router advertisements are sent every 600 seconds
  ND router advertisements lifetime tracks ra-interval
  ND router advertisement default router preference is medium
  Hosts use stateless autoconfig for addresses.
switch# exit
cumulus@switch:~$
   
    
</code></pre>

<p>To show VRFs configured in OSPF:</p>

<pre><code>                   
cumulus@switch:~$ sudo vtysh
switch# show ip ospf vrfs
Name                            Id     RouterId 
Default-IP-Routing-Table        0      0.0.0.0          
rocket                          57     0.0.0.10         
turtle                          58     0.0.0.20    
Total number of OSPF VRFs (including default): 3
switch# exit
cumulus@switch:~$ 
   
    
</code></pre>

<p>To show all OSPF routes in a VRF:</p>

<pre><code>                   
cumulus@switch:~$ sudo vtysh
switch# show ip ospf vrf all route 
============ OSPF network routing table ============
N    7.0.0.0/24            [10] area: 0.0.0.0
                           directly attached to swp2
 
============ OSPF router routing table =============
 
============ OSPF external routing table ===========
 
============ OSPF network routing table ============
N    8.0.0.0/24            [10] area: 0.0.0.0       
                           directly attached to swp1
 
============ OSPF router routing table =============
 
============ OSPF external routing table ===========
 
switch# exit
cumulus@switch:~$ 
   
    
</code></pre>

<p>To see the routing table for each VRF, use the <code>show up route vrf all</code>
command. The OSPF route is denoted in the row that starts with O:</p>

<pre><code>                   
cumulus@switch:~$ sudo vtysh
switch# show ip route vrf all
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, P - PIM, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel,
       &gt; - selected route, * - FIB route
VRF turtle:
K&gt;* 0.0.0.0/0 [0/8192] unreachable (ICMP unreachable)
O   7.0.0.0/24 [110/10] is directly connected, swp2, 00:28:35
C&gt;* 7.0.0.0/24 is directly connected, swp2
C&gt;* 7.0.0.5/32 is directly connected, turtle
C&gt;* 7.0.0.100/32 is directly connected, turtle
C&gt;* 50.1.1.0/24 is directly connected, swp31s1
VRF rocket:
K&gt;* 0.0.0.0/0 [0/8192] unreachable (ICMP unreachable)
O 
8.0.0.0/24 [110/10] 
is directly connected, swp1, 00:23:26
C&gt;* 8.0.0.0/24 is directly connected, swp1
C&gt;* 8.0.0.5/32 is directly connected, rocket
C&gt;* 8.0.0.100/32 is directly connected, rocket
C&gt;* 50.0.1.0/24 is directly connected, swp31s0
switch# exit
cumulus@switch:~$ 
   
    
</code></pre>

<h3 id="showing-vrf-data-using-ip-commands">Showing VRF Data Using ip Commands</h3>

<p>To list all VRFs provisioned, showing the VRF ID (vrf1012, vrf1013 and
vrf1014 below) as well as the table ID:</p>

<pre><code>                   
cumulus@switch:~$ ip -d link show type vrf      
14: vrf1012:  mtu 1500 qdisc pfifo_fast state UNKNOWN mode DEFAULT group default qlen 1000
    link/ether 46:96:c7:64:4d:fa brd ff:ff:ff:ff:ff:ff promiscuity 0 
    vrf table 1012 addrgenmode eui64 
21: vrf1013:  mtu 1500 qdisc pfifo_fast state UNKNOWN mode DEFAULT group default qlen 1000
    link/ether 7a:8a:29:0f:5e:52 brd ff:ff:ff:ff:ff:ff promiscuity 0 
    vrf table 1013 addrgenmode eui64 
28: vrf1014:  mtu 1500 qdisc pfifo_fast state UNKNOWN mode DEFAULT group default qlen 1000
    link/ether e6:8c:4d:fc:eb:b1 brd ff:ff:ff:ff:ff:ff promiscuity 0 
    vrf table 1014 addrgenmode eui64 
   
    
</code></pre>

<p>To list the interfaces attached to a specific VRF:</p>

<pre><code>                   
cumulus@switch:~$ ip -d link show vrf vrf1012
8: swp1.2@swp1:  mtu 1500 qdisc noqueue master vrf1012 state UP mode DEFAULT group default 
    link/ether 00:02:00:00:00:07 brd ff:ff:ff:ff:ff:ff promiscuity 0 
    vlan protocol 802.1Q id 2  
    vrf_slave addrgenmode eui64 
9: swp2.2@swp2:  mtu 1500 qdisc noqueue master vrf1012 state UP mode DEFAULT group default 
    link/ether 00:02:00:00:00:08 brd ff:ff:ff:ff:ff:ff promiscuity 0 
    vlan protocol 802.1Q id 2  
    vrf_slave addrgenmode eui64 
10: swp3.2@swp3:  mtu 1500 qdisc noqueue master vrf1012 state UP mode DEFAULT group default 
    link/ether 00:02:00:00:00:09 brd ff:ff:ff:ff:ff:ff promiscuity 0 
    vlan protocol 802.1Q id 2  
    vrf_slave addrgenmode eui64 
11: swp4.2@swp4:  mtu 1500 qdisc noqueue master vrf1012 state UP mode DEFAULT group default 
    link/ether 00:02:00:00:00:0a brd ff:ff:ff:ff:ff:ff promiscuity 0 
    vlan protocol 802.1Q id 2  
    vrf_slave addrgenmode eui64 
12: swp5.2@swp5:  mtu 1500 qdisc noqueue master vrf1012 state UP mode DEFAULT group default 
    link/ether 00:02:00:00:00:0b brd ff:ff:ff:ff:ff:ff promiscuity 0 
    vlan protocol 802.1Q id 2  
    vrf_slave addrgenmode eui64 
13: br2:  mtu 1500 qdisc noqueue master vrf1012 state DOWN mode DEFAULT group default 
    link/ether 00:00:00:00:00:00 brd ff:ff:ff:ff:ff:ff promiscuity 0 
    bridge forward_delay 100 hello_time 200 max_age 2000 ageing_time 30000 stp_state 0 priority 32768 
    vlan_filtering 0 vlan_protocol 802.1Q bridge_id 8000.0:0:0:0:0:0 designated_root 8000.0:0:0:0:0:0 
    root_port 0 root_path_cost 0 topology_change 0 topology_change_detected 0 hello_timer    0.00 
    tcn_timer    0.00 topology_change_timer    0.00 gc_timer  202.23 vlan_default_pvid 1 group_fwd_mask 0 
    group_address 01:80:c2:00:00:00 mcast_snooping 1 mcast_router 1 mcast_query_use_ifaddr 0 mcast_querier 0 
    mcast_hash_elasticity 4096 mcast_hash_max 4096 mcast_last_member_count 2 mcast_startup_query_count 2 
    mcast_last_member_interval 100 mcast_membership_interval 26000 mcast_querier_interval 25500 
    mcast_query_interval 12500 mcast_query_response_interval 1000 mcast_startup_query_interval 3125 
    nf_call_iptables 0 nf_call_ip6tables 0 nf_call_arptables 0 
    vrf_slave addrgenmode eui64 
   
    
</code></pre>

<p>To show IPv4 routes in a VRF:</p>

<pre><code>                   
cumulus@switch:~$ ip route show table vrf1012
unreachable default  metric 240 
broadcast 20.7.2.0 dev br2  proto kernel  scope link  src 20.7.2.1 dead linkdown 
20.7.2.0/24 dev br2  proto kernel  scope link  src 20.7.2.1 dead linkdown 
local 20.7.2.1 dev br2  proto kernel  scope host  src 20.7.2.1 
broadcast 20.7.2.255 dev br2  proto kernel  scope link  src 20.7.2.1 dead linkdown 
broadcast 169.254.2.8 dev swp1.2  proto kernel  scope link  src 169.254.2.9 
169.254.2.8/30 dev swp1.2  proto kernel  scope link  src 169.254.2.9 
local 169.254.2.9 dev swp1.2  proto kernel  scope host  src 169.254.2.9 
broadcast 169.254.2.11 dev swp1.2  proto kernel  scope link  src 169.254.2.9 
broadcast 169.254.2.12 dev swp2.2  proto kernel  scope link  src 169.254.2.13 
169.254.2.12/30 dev swp2.2  proto kernel  scope link  src 169.254.2.13 
local 169.254.2.13 dev swp2.2  proto kernel  scope host  src 169.254.2.13 
broadcast 169.254.2.15 dev swp2.2  proto kernel  scope link  src 169.254.2.13 
broadcast 169.254.2.16 dev swp3.2  proto kernel  scope link  src 169.254.2.17 
169.254.2.16/30 dev swp3.2  proto kernel  scope link  src 169.254.2.17 
local 169.254.2.17 dev swp3.2  proto kernel  scope host  src 169.254.2.17 
broadcast 169.254.2.19 dev swp3.2  proto kernel  scope link  src 169.254.2.17 
   
    
</code></pre>

<p>To show IPv6 routes in a VRF:</p>

<pre><code>                   
cumulus@switch:~$ ip -6 route show table vrf1012
local fe80:: dev lo  proto none  metric 0  pref medium
local fe80:: dev lo  proto none  metric 0  pref medium
local fe80:: dev lo  proto none  metric 0  pref medium
local fe80:: dev lo  proto none  metric 0  pref medium
local fe80::202:ff:fe00:7 dev lo  proto none  metric 0  pref medium
local fe80::202:ff:fe00:8 dev lo  proto none  metric 0  pref medium
local fe80::202:ff:fe00:9 dev lo  proto none  metric 0  pref medium
local fe80::202:ff:fe00:a dev lo  proto none  metric 0  pref medium
fe80::/64 dev br2  proto kernel  metric 256 dead linkdown  pref medium
fe80::/64 dev swp1.2  proto kernel  metric 256  pref medium
fe80::/64 dev swp2.2  proto kernel  metric 256  pref medium
fe80::/64 dev swp3.2  proto kernel  metric 256  pref medium
ff00::/8 dev br2  metric 256 dead linkdown  pref medium
ff00::/8 dev swp1.2  metric 256  pref medium
ff00::/8 dev swp2.2  metric 256  pref medium
ff00::/8 dev swp3.2  metric 256  pref medium
unreachable default dev lo  metric 240  error -101 pref medium  
   
    
</code></pre>

<p>To see a list of links associated with a particular VRF table, <code>run ip
link list &lt;vrf-name&gt;</code>. For example:</p>

<pre><code>                   
cumulus@switch:~$ ip link list rocket
  
VRF: rocket           
--------------------
swp1.10@swp1     UP             6c:64:1a:00:5a:0c  
swp2.10@swp2     UP             6c:64:1a:00:5a:0d 
   
    
</code></pre>

<p>To see a list of routes associated with a particular VRF table, run <code>ip
route list &lt;vrf-name&gt;</code>. For example:</p>

<pre><code>                   
cumulus@switch:~$ ip route list rocket
 
VRF: rocket           
--------------------
unreachable default  metric 8192 
10.1.1.0/24 via 10.10.1.2 dev swp2.10 
10.1.2.0/24 via 10.99.1.2 dev swp1.10 
broadcast 10.10.1.0 dev swp2.10  proto kernel  scope link  src 10.10.1.1 
10.10.1.0/28 dev swp2.10  proto kernel  scope link  src 10.10.1.1 
local 10.10.1.1 dev swp2.10  proto kernel  scope host  src 10.10.1.1 
broadcast 10.10.1.15 dev swp2.10  proto kernel  scope link  src 10.10.1.1 
broadcast 10.99.1.0 dev swp1.10  proto kernel  scope link  src 10.99.1.1 
10.99.1.0/30 dev swp1.10  proto kernel  scope link  src 10.99.1.1 
local 10.99.1.1 dev swp1.10  proto kernel  scope host  src 10.99.1.1 
broadcast 10.99.1.3 dev swp1.10  proto kernel  scope link  src 10.99.1.1 
 
local fe80:: dev lo  proto none  metric 0  pref medium
local fe80:: dev lo  proto none  metric 0  pref medium
local fe80::6e64:1aff:fe00:5a0c dev lo  proto none  metric 0  pref medium
local fe80::6e64:1aff:fe00:5a0d dev lo  proto none  metric 0  pref medium
fe80::/64 dev swp1.10  proto kernel  metric 256  pref medium
fe80::/64 dev swp2.10  proto kernel  metric 256  pref medium
ff00::/8 dev swp1.10  metric 256  pref medium
ff00::/8 dev swp2.10  metric 256  pref medium
unreachable default dev lo  metric 8192  error -101 pref medium
   
    
</code></pre>


<div class="notices tip" > <p>You can also show routes in a VRF using <code>ip [-6] route show vrf &lt;name&gt;</code>.
This command omits local and broadcast routes, which can clutter the
output.</p>
 </div>


<h2 id="using-bgp-unnumbered-interfaces-with-vrf">Using BGP Unnumbered Interfaces with VRF</h2>

<p><a href="/old/Cumulus_Linux_36/Border_Gateway_Protocol_-_BGP.html">BGP unnumbered interface
configurations</a>
are supported with VRF. In BGP unnumbered, there are no addresses on any
interface. However, debugging tools like <code>traceroute</code> need at least a
single IP address per node as the node&rsquo;s source IP address. Typically,
this address was assigned to the loopback device. With VRF, you need a
loopback device for each VRF table since VRF is based on interfaces, not
IP addresses. While Linux does not support multiple loopback devices, it
does support the concept of a dummy interface, which is used to achieve
the same goal.</p>

<p>An IP address can be associated with the VRF device, which will then act
as the dummy (loopback-like) interface for that VRF.</p>

<ol>
<li><p>Configure the BGP unnumbered configuration. The BGP unnumbered
configuration is the same for a non-VRF, applied under the VRF
context (<code>router bgp asn vrf &lt;vrf-name&gt;</code>).</p>

<pre><code>                       
cumulus@switch:~$ net add vrf vrf1 vrf-table auto
cumulus@switch:~$ net add vrf vrf1 ip address 6.1.0.6/32
cumulus@switch:~$ net add vrf vrf1 ipv6 address 2001:6:1::6/128
cumulus@switch:~$ net add interface swp1 link speed 10000 
cumulus@switch:~$ net add interface swp1 link autoneg off
cumulus@switch:~$ net add interface swp1 vrf vrf1
cumulus@switch:~$ net add vlan 101 ip address 20.1.6.1/24
cumulus@switch:~$ net add vlan 101 ipv6 address 2001:20:1:6::1/80
cumulus@switch:~$ net add bridge bridge ports vlan101
       
        
</code></pre>

<p>These commands create the following configuration in the
<code>/etc/network/interfaces</code> file:</p>

<pre><code>                       
auto swp1
iface swp1
    link-autoneg on
    link-speed 10000
    vrf vrf1
 
auto bridge
iface bridge
    bridge-ports vlan101
    bridge-vids 101
    bridge-vlan-aware yes
 
auto vlan101
iface vlan101
    address 20.1.6.1/24
    address 2001:20:1:6::1/80
    vlan-id 101
    vlan-raw-device bridge
 
auto vrf1
iface vrf1
    address 6.1.0.6/32
    address 2001:6:1::6/128
    vrf-table auto
       
        
</code></pre></li>
</ol>

<p>Here is the FRRouting BGP configuration:</p>

<pre><code>                   
cumulus@switch:~$ net add bgp vrf vrf1 autonomous-system 65001
cumulus@switch:~$ net add bgp vrf vrf1 bestpath as-path multipath-relax
cumulus@switch:~$ net add bgp vrf vrf1 bestpath compare-routerid
cumulus@switch:~$ net add bgp vrf vrf1 neighbor LEAF peer-group
cumulus@switch:~$ net add bgp vrf vrf1 neighbor LEAF remote-as external
cumulus@switch:~$ net add bgp vrf vrf1 neighbor LEAF capability extended-nexthop
cumulus@switch:~$ net add bgp vrf vrf1 neighbor swp1.101 interface peer-group LEAF
cumulus@switch:~$ net add bgp vrf vrf1 neighbor swp2.101 interface peer-group LEAF
cumulus@switch:~$ net add bgp vrf vrf1 ipv4 unicast redistribute connected
cumulus@switch:~$ net add bgp vrf vrf1 ipv4 unicast neighbor LEAF activate
cumulus@switch:~$ net add bgp vrf vrf1 ipv6 unicast redistribute connected
cumulus@switch:~$ net add bgp vrf vrf1 ipv6 unicast neighbor LEAF activate
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit
   
    
</code></pre>

<p>These commands create the following configuration in the
<code>/etc/frr/frr.conf</code> file:</p>

<pre><code>                   
!
router bgp 65001 vrf vrf1
 no bgp default ipv4-unicast
 bgp bestpath as-path multipath-relax
 bgp bestpath compare-routerid
 neighbor LEAF peer-group
 neighbor LEAF remote-as external
 neighbor LEAF capability extended-nexthop
 neighbor swp1.101 interface peer-group LEAF
 neighbor swp2.101 interface peer-group LEAF
 !
 address-family ipv4 unicast
  redistribute connected
  neighbor LEAF activate
 exit-address-family
 !
 address-family ipv6 unicast
  redistribute connected
  neighbor LEAF activate
 exit-address-family
!
   
    
</code></pre>

<h2 id="using-dhcp-with-vrf">Using DHCP with VRF</h2>

<p>Since you can use VRF to bind IPv4 and IPv6 sockets to non-default VRF
tables, you have the ability to start DHCP servers and relays in any
non-default VRF table using the <code>dhcpd</code> and <code>dhcrelay</code> services,
respectively. These services must be managed by <code>systemd</code> in order to
run in a VRF context; in addition, the services must be listed in
<code>/etc/vrf/systemd.conf</code>. By default, this file already lists these two
services, as well as others like <code>ntp</code> and <code>snmpd</code>. You can add more
services as needed, such as <code>dhcpd6</code> and <code>dhcrelay6</code> for IPv6.</p>

<p>If you edit <code>/etc/vrf/systemd.conf</code>, run <code>sudo systemctl daemon-reload</code>
to generate the <code>systemd</code> instance files for the newly added service(s).
Then you can start the service in the VRF using <code>systemctl start
&lt;service&gt;@&lt;vrf-name&gt;.service</code>, where <code>&lt;service&gt;</code> is the name of the
service — such as <code>dhcpd</code> or <code>dhcrelay</code> — and <code>&lt;vrf-name&gt;</code> is the name
of the VRF.</p>

<p>For example, to start the <code>dhcrelay</code> service after you configured a VRF
named <em>turtle</em>, run:</p>

<pre><code>                   
cumulus@switch:~$ sudo systemctl start dhcrelay@turtle.service
   
    
</code></pre>

<p>To enable the service at boot time you should also run <code>systemctl enable
&lt;service&gt;@&lt;vrf-name&gt;</code>. To continue with the previous example:</p>

<pre><code>                   
cumulus@switch:~$ sudo systemctl enable dhcrelay@turtle.service
   
    
</code></pre>

<p>In addition, you need to create a separate default file in
<code>/etc/default</code> for every instance of a DHCP server and/or relay in a
non-default VRF; this is where you set the server and relay options. To
run multiple instances of any of these services, you need a separate
file for each instance. The files must be named as follows:</p>

<ul>
<li><p>isc-dhcp-server-&lt;vrf-name&gt;</p></li>

<li><p>isc-dhcp-server6-&lt;vrf-name&gt;</p></li>

<li><p>isc-dhcp-relay-&lt;vrf-name&gt;</p></li>

<li><p>isc-dhcp-relay6-&lt;vrf-name&gt;</p></li>
</ul>

<p>See the example configuration below for more details.</p>

<h3 id="caveats-for-dhcp-with-vrf">Caveats for DHCP with VRF</h3>

<ul>
<li><p>Cumulus Linux does <strong>not</strong> support DHCP server and relay across
VRFs, so the server and host cannot be in different VRF tables. In
addition, the server and relay cannot be in different VRF tables.</p></li>

<li><p>Typically a service running in the default VRF owns a port across
all VRFs. If the VRF local instance is preferred, the global one may
need to be disabled and stopped first.</p></li>

<li><p>VRF is a layer 3 routing feature. It only makes sense to run
programs that use AF_INET and AF_INET6 sockets in a VRF. VRF
context does not affect any other aspects of the operation of a
program.</p></li>

<li><p>This method only works with <code>systemd</code>-based services.</p></li>
</ul>

<h3 id="example-configuration">Example Configuration</h3>

<p>In the following example, there is one IPv4 network with a VRF named
<em>rocket</em> and one IPv6 network with a VRF named <em>turtle</em>.</p>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p>The IPv4 DHCP server/relay network looks like this:</p>







<img class = "confluence-embedded-image image-center" src = "/images/download/attachments/8362412/vrf_dhcpIPv4.png" alt = "/images/download/attachments/8362412/vrf_dhcpIPv4.png"

height = 250


 />
</td>
<td><p>The IPv6 DHCP server/relay network looks like this:</p>







<img class = "confluence-embedded-image image-center" src = "/images/download/attachments/8362412/vrf_dhcpIPv6.png" alt = "/images/download/attachments/8362412/vrf_dhcpIPv6.png"

height = 250


 />
</td>
</tr>
</tbody>
</table>

<p>Configure each DHCP server and relay as follows:</p>

<table>
<tbody>
<tr class="odd">
<td><p><strong>Sample DHCP Server Configuration</strong></p>
<ol>
<li><p>Create the file <code>isc-dhcp-server-rocket</code> in <code>/etc/default/</code>. Here is sample content:</p>
<pre><code>                   
# Defaults for isc-dhcp-server initscript
# sourced by /etc/init.d/isc-dhcp-server
# installed at /etc/default/isc-dhcp-server by the maintainer scripts
#
# This is a POSIX shell fragment
#
# Path to dhcpd&#39;s config file (default: /etc/dhcp/dhcpd.conf).
DHCPD_CONF=&quot;-cf /etc/dhcp/dhcpd-rocket.conf&quot;
# Path to dhcpd&#39;s PID file (default: /var/run/dhcpd.pid).
DHCPD_PID=&quot;-pf /var/run/dhcpd-rocket.pid&quot;
# Additional options to start dhcpd with.
# Don&#39;t use options -cf or -pf here; use DHCPD_CONF/ DHCPD_PID instead
#OPTIONS=&quot;&quot;
# On what interfaces should the DHCP server (dhcpd) serve DHCP requests?
# Separate multiple interfaces with spaces, e.g. &quot;eth0 eth1&quot;.
INTERFACES=&quot;swp2&quot;
   
    </code></pre></li>
<li><p>Enable the DHCP server:<br />
<code>cumulus@switch:~$ sudo systemctl enable dhcpd@rocket.service</code></p></li>
<li><p>Start the DHCP server:<br />
<code>cumulus@switch:~$ sudo systemctl start dhcpd@rocket.service</code><br />
or<br />
<code>cumulus@switch:~$ sudo systemctl restart dhcpd@rocket.service</code></p></li>
<li><p>Check status:<br />
<code>cumulus@switch:~$ sudo systemctl status dhcpd@rocket.service</code></p></li>
</ol>

<div class="notices tip" > <p></p>
<p>You can create this configuration using the <code>vrf</code> command (<a href="/old/Cumulus_Linux_36/#src-8362412_VirtualRoutingandForwarding-VRF-exec">see above</a> for more details):</p>
<pre><code><br />
cumulus@switch:~$ sudo vrf task exec rocket /usr/sbin/dhcpd -f -q -cf /
    /etc/dhcp/dhcpd-rocket.conf -pf /var/run/dhcpd-rocket.pid swp2</p>

<pre><code>&lt;/code&gt;&lt;/pre&gt;
</code></pre>

<p><p></p>
 </div>
</td>
<td><p><strong>Sample DHCP6 Server Configuration</strong></p>
<ol>
<li><p>Create the file <code>isc-dhcp-server6-turtle</code> in <code>/etc/default/</code>. Here is sample content:</p>
<pre><code>                   
# Defaults for isc-dhcp-server initscript
# sourced by /etc/init.d/isc-dhcp-server
# installed at /etc/default/isc-dhcp-server by the maintainer scripts
#
# This is a POSIX shell fragment
#
# Path to dhcpd&#39;s config file (default: /etc/dhcp/dhcpd.conf).
DHCPD_CONF=&quot;-cf /etc/dhcp/dhcpd6-turtle.conf&quot;
# Path to dhcpd&#39;s PID file (default: /var/run/dhcpd.pid).
DHCPD_PID=&quot;-pf /var/run/dhcpd6-turtle.pid&quot;
# Additional options to start dhcpd with.
# Don&#39;t use options -cf or -pf here; use DHCPD_CONF/ DHCPD_PID instead
#OPTIONS=&quot;&quot;
# On what interfaces should the DHCP server (dhcpd) serve DHCP requests?
# Separate multiple interfaces with spaces, e.g. &quot;eth0 eth1&quot;.
INTERFACES=&quot;swp3&quot;
   
    </code></pre></li>
<li><p>Enable the DHCP server:<br />
<code>cumulus@switch:~$ sudo systemctl enable dhcpd6@turtle.service</code></p></li>
<li><p>Start the DHCP server:<br />
<code>cumulus@switch:~$ sudo systemctl start dhcpd6@turtle.service</code><br />
or<br />
<code>cumulus@switch:~$ sudo systemctl restart dhcpd6@turtle.service</code></p></li>
<li><p>Check status:<br />
<code>cumulus@switch:~$ sudo systemctl status dhcpd6@turtle.service</code></p></li>
</ol>

<div class="notices tip" > <p></p>
<p>You can create this configuration using the <code>vrf</code> command (<a href="/old/Cumulus_Linux_36/#src-8362412_VirtualRoutingandForwarding-VRF-exe">see above</a> for more details):</p>
<pre><code><br />
cumulus@switch:~$ sudo vrf task exec turtle dhcpd -6 -q -cf /
    /etc/dhcp/dhcpd6-turtle.conf -pf /var/run/dhcpd6-turtle.pid swp3</p>

<pre><code>&lt;/code&gt;&lt;/pre&gt;
</code></pre>

<p><p></p>
 </div>
</td>
</tr>
<tr class="even">
<td><p><strong>Sample DHCP Relay Configuration</strong></p>
<ol>
<li><p>Create the file <code>isc-dhcp-relay-rocket</code> in <code>/etc/default/</code>. Here is sample content:</p>
<pre><code>                   
# Defaults for isc-dhcp-relay initscript
# sourced by /etc/init.d/isc-dhcp-relay
# installed at /etc/default/isc-dhcp-relay by the maintainer scripts
#
# This is a POSIX shell fragment
#
# What servers should the DHCP relay forward requests to?
SERVERS=&quot;102.0.0.2&quot;
# On what interfaces should the DHCP relay (dhrelay) serve DHCP requests?
# Always include the interface towards the DHCP server.
# This variable requires a -i for each interface configured above.
# This will be used in the actual dhcrelay command
# For example, &quot;-i eth0 -i eth1&quot;
INTF_CMD=&quot;-i swp2s2 -i swp2s3&quot;
# Additional options that are passed to the DHCP relay daemon?
OPTIONS=&quot;&quot;
   
    </code></pre></li>
<li><p>Enable the DHCP relay:<br />
<code>cumulus@switch:~$ sudo systemctl enable dhcrelay@rocket.service</code></p></li>
<li><p>Start the DHCP relay:<br />
<code>cumulus@switch:~$ sudo systemctl start dhcrelay@rocket.service</code><br />
or<br />
<code>cumulus@switch:~$ sudo systemctl restart dhcrelay@rocket.service</code></p></li>
<li><p>Check status:<br />
<code>cumulus@switch:~$ sudo systemctl status dhcrelay@rocket.service</code></p></li>
</ol>

<div class="notices tip" > <p></p>
<p>You can create this configuration using the <code>vrf</code> command (<a href="/old/Cumulus_Linux_36/#src-8362412_VirtualRoutingandForwarding-VRF-exec">see above</a> for more details):</p>
<pre><code><br />
cumulus@switch:~$ sudo vrf task exec rocket /usr/sbin/dhcrelay -d -q -i /
    swp2s2 -i swp2s3 102.0.0.2</p>

<pre><code>&lt;/code&gt;&lt;/pre&gt;
</code></pre>

<p><p></p>
 </div>
</td>
<td><p><strong>Sample DHCP6 Relay Configuration</strong></p>
<ol>
<li><p>Create the file <code>isc-dhcp-relay6-turtle</code> in <code>/etc/default/</code>. Here is sample content:</p>
<pre><code>                   
# Defaults for isc-dhcp-relay initscript
# sourced by /etc/init.d/isc-dhcp-relay
# installed at /etc/default/isc-dhcp-relay by the maintainer scripts
#
# This is a POSIX shell fragment
#
# What servers should the DHCP relay forward requests to?
#SERVERS=&quot;103.0.0.2&quot;
# On what interfaces should the DHCP relay (dhrelay) serve DHCP requests?
# Always include the interface towards the DHCP server.
# This variable requires a -i for each interface configured above.
# This will be used in the actual dhcrelay command
# For example, &quot;-i eth0 -i eth1&quot;
INTF_CMD=&quot;-l swp18s0 -u swp18s1&quot;
# Additional options that are passed to the DHCP relay daemon?
OPTIONS=&quot;-pf /var/run/dhcrelay6@turtle.pid&quot;
   
    </code></pre></li>
<li><p>Enable the DHCP relay:<br />
<code>cumulus@switch:~$ sudo systemctl enable dhcrelay6@turtle.service</code></p></li>
<li><p>Start the DHCP relay:<br />
<code>cumulus@switch:~$ sudo systemctl start dhcrelay6@turtle.service</code><br />
or<br />
<code>cumulus@switch:~$ sudo systemctl restart dhcrelay6@turtle.service</code></p></li>
<li><p>Check status:<br />
<code>cumulus@switch:~$ sudo systemctl status dhcrelay6@turtle.service</code></p></li>
</ol>

<div class="notices tip" > <p></p>
<p>You can create this configuration using the <code>vrf</code> command (<a href="/old/Cumulus_Linux_36/#src-8362412_VirtualRoutingandForwarding-VRF-ex">see above</a> for more details):</p>
<pre><code><br />
cumulus@switch:~$ sudo vrf task exec turtle /usr/sbin/dhcrelay -d -q -6 -l /
    swp18s0 -u swp18s1 -pf /var/run/dhcrelay6@turtle.pid</p>

<pre><code>&lt;/code&gt;&lt;/pre&gt;
</code></pre>

<p><p></p>
 </div>
</td>
</tr>
</tbody>
</table>

<h2 id="using-ping-or-traceroute">Using ping or traceroute</h2>

<p>If you wish to use <code>ping</code> or <code>traceroute</code> on a VRF, use the <code>-I &lt;vrf&gt;</code>
flag for ping and <code>-i &lt;vrf&gt;</code> for <code>traceroute</code>.</p>

<pre><code>                   
cumulus@switch:~$ ping -I turtle
   
    
</code></pre>

<p>Or:</p>

<pre><code>                   
cumulus@switch:~$ sudo traceroute -i turtle
   
    
</code></pre>

<h2 id="caveats-and-errata">Caveats and Errata</h2>

<ul>
<li><p>Switches using the Hurricane2 ASIC (such as the Penguin Computing
Arctica 4804IP) do not support VRFs.</p></li>

<li><p>Table selection based on the incoming interface only; currently,
packet attributes or output-interface-based selection are not
available.</p></li>

<li><p>Setting the router ID outside of BGP via the <code>router-id</code> option
causes all BGP instances to get the same router ID. If you want each
BGP instance to have its own router ID, specify the <code>router-id</code>
under the BGP instance using <code>bgp router-id</code>. If both are specified,
the one under the BGP instance overrides the one provided outside
BGP.</p></li>

<li><p>You cannot configure <a href="/old/Cumulus_Linux_36/Ethernet_Virtual_Private_Network_-_EVPN.html">EVPN address
families</a>
within a VRF.</p></li>
</ul>
</article>



    </div>
    

      


  

    <aside class="book-toc fixed">

  

  <button> </button>

      <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#configuring-vrf">Configuring VRF</a>
<ul>
<li><a href="#specifying-a-table-id">Specifying a Table ID</a></li>
<li><a href="#bringing-a-vrf-up-after-downing-it-with-ifdown">Bringing a VRF Up after Downing It with ifdown</a></li>
<li><a href="#using-the-vrf-command">Using the vrf Command</a>
<ul>
<li><a href="#running-ipv4-and-ipv6-commands-in-a-vrf-context">Running IPv4 and IPv6 Commands in a VRF Context</a></li>
</ul></li>
<li><a href="#services-in-vrfs">Services in VRFs</a></li>
</ul></li>
<li><a href="#vrf-route-leaking">VRF Route Leaking</a>
<ul>
<li><a href="#enabling-vrf-route-leaking">Enabling VRF Route Leaking</a></li>
<li><a href="#configuring-static-route-leaking">Configuring Static Route Leaking</a></li>
<li><a href="#configuring-static-route-leaking-with-evpn">Configuring Static Route Leaking with EVPN</a>
<ul>
<li><a href="#excluding-certain-prefixes">Excluding Certain Prefixes</a></li>
</ul></li>
<li><a href="#verifying-dynamic-route-leaking-configuration">Verifying Dynamic Route Leaking Configuration</a>
<ul>
<li><a href="#deleting-dynamic-route-leaking-configuration">Deleting Dynamic Route Leaking Configuration</a></li>
</ul></li>
</ul></li>
<li><a href="#frrouting-operation-in-a-vrf">FRRouting Operation in a VRF</a>
<ul>
<li><a href="#example-bgp-and-ospf-configurations">Example BGP and OSPF Configurations</a></li>
</ul></li>
<li><a href="#example-commands-to-show-vrf-data">Example Commands to Show VRF Data</a>
<ul>
<li><a href="#showing-vrf-data-using-nclu-commands">Showing VRF Data Using NCLU Commands</a></li>
<li><a href="#showing-vrf-data-using-frrouting-commands">Showing VRF Data Using FRRouting Commands</a></li>
<li><a href="#showing-vrf-data-using-ip-commands">Showing VRF Data Using ip Commands</a></li>
</ul></li>
<li><a href="#using-bgp-unnumbered-interfaces-with-vrf">Using BGP Unnumbered Interfaces with VRF</a></li>
<li><a href="#using-dhcp-with-vrf">Using DHCP with VRF</a>
<ul>
<li><a href="#caveats-for-dhcp-with-vrf">Caveats for DHCP with VRF</a></li>
<li><a href="#example-configuration">Example Configuration</a></li>
</ul></li>
<li><a href="#using-ping-or-traceroute">Using ping or traceroute</a></li>
<li><a href="#caveats-and-errata">Caveats and Errata</a></li>
</ul></li>
</ul>
</nav>

      
      <button>
      <a href="https://github.com/cawleyflower/testDocs/edit/dev/content/version/Cumulus_Linux_36/Layer_3/Virtual_Routing_and_Forwarding_-_VRF.md" target="_blank" rel="noopener">
        <img src="/svg/pencil-circle.svg" alt="Edit" /> Edit this page
      </a>
    </button>
    


    

</aside>





  </main>
  <footer class="footer-top">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <div class="footer-content">
            <div class="mb-4">
                <img src="https://static.cumulusnetworks.com/static/images/shared/cumulus-networks-rt-white-trademarked.ff839f1b2570.svg">
                <p>© <script type="text/javascript">document.write(new Date().getFullYear());</script> Cumulus Networks.<br>
                Site by <a href="//unomena.com/" target="_blank">Unomena</a>.</p>
            </div>
            <ul class="mb-4">
              <li><h4>Products</h4></li>
              <li><a href="//cumulusnetworks.com/products/cumulus-linux/">Cumulus Linux</a></li>
              <li><a href="//cumulusnetworks.com/products/netq/">Cumulus NetQ</a></li>
              <li><a href="//cumulusnetworks.com/products/cumulus-express/">Cumulus Express</a></li>
            </ul>
            <ul class="mb-4">
              <li><h4>Learn</h4></li>
              <li><a href="//cumulusnetworks.com/learn/web-scale-networking-education/">Going web-scale</a></li>
              <li><a href="//cumulusnetworks.com/learn/events/">Events</a></li>
              <li><a href="//cumulusnetworks.com/blog/">Blog</a></li>
            </ul>
            <ul class="mb-4">
              <li><h4>About</h4></li>
              <li><a href="//cumulusnetworks.com/about/">Our story</a></li>
              <li><a href="//cumulusnetworks.com/about/careers/">Careers</a></li>
              <li><a href="//cumulusnetworks.com/about/media-coverage/">Media coverage</a></li>
              <li><a href="//docs.cumulusnetworks.com/" target="_blank">Tech docs</a></li>
              <li><a href="//cumulusnetworks.com/community/">Community</a></li>
            </ul>
            <ul>
              <li>
                <a href="//twitter.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M23 6.628l-2-.5 1-2-2.464.7A4.48 4.48 0 0 0 12 8.128v1c-3.539.73-6.634-1.2-9.5-4.5q-.75 4 1.5 6l-3-.5c.405 2.069 1.362 3.7 4 4l-2.5 1c1 2 2.566 2.31 5 2.5a10.748 10.748 0 0 1-6.5 2c12.755 5.669 20-2.664 20-10V8.3z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//www.facebook.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                      .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M17.768 7.5H13.5V5.6a.972.972 0 0 1 1.012-1.1c.418 0 2.988.01 2.988.01V.5h-4.329C9.244.5 8.5 3.474 8.5 5.355V7.5h-3v4h3v12h5v-12h3.851z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//linkedin.com/company/cumulus-networks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                      .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M6.5 22.5h-5v-13h5zm9-9a2 2 0 0 0-2 2v7h-5v-13h5v1.485a6.307 6.307 0 0 1 3.99-1.495c2.962 0 5.01 2.2 5.01 6.355V22.5h-5v-7a2 2 0 0 0-2-2zM6.5 5A2.5 2.5 0 1 1 4 2.5 2.5 2.5 0 0 1 6.5 5z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//vimeo.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M.5 7.393l.933 1.224S3.36 7.1 4 7.859s3.1 9.925 3.915 11.617c.714 1.483 2.684 3.444 4.845 2.042s9.34-7.529 10.626-14.769-8.642-5.723-9.693.583c2.627-1.577 4.03.642 2.686 3.154s-2.569 4.145-3.211 4.145-1.135-1.679-1.868-4.613c-.76-3.035-.755-8.5-3.911-7.882C4.412 2.721.5 7.393.5 7.393z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//www.github.com/cumulusnetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                        <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                        </style>
                    </defs>
                    <path class="a" d="M19.459 17c0-5.969-4.126-3.532-7.5-3.532s-7.5-2.375-7.5 3.532a3.5 3.5 0 0 0 3.5 3.5h8a3.5 3.5 0 0 0 3.5-3.5z"></path>
                    <path class="a" d="M21.489 10.214l.032.023s2.646-4.572-.6-7.237c-2 0-5.058 3.3-5.058 3.3l.022.016A14.152 14.152 0 0 0 8.1 6.3C8.083 6.285 5.037 3 3.042 3c-3.173 2.6-.729 7.012-.614 7.217a8.876 8.876 0 0 0-1.395 5.743c.241 3.126 2.847 6.54 5.982 6.54H16.9c3.135 0 5.742-3.414 5.982-6.54a8.857 8.857 0 0 0-1.393-5.746z"></path>
                    <ellipse class="a" cx="15.48" cy="17" rx="1" ry="1.5"></ellipse>
                    <ellipse class="a" cx="8.48" cy="17" rx="1" ry="1.5"></ellipse>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//slack.cumulusnetworks.com/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                        <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                        </style>
                    </defs>
                    <rect class="a" x=".5" y=".5" width="23" height="23" rx="6" ry="6"></rect>
                    <circle class="a" cx="12" cy="12" r="6"></circle>
                    <circle class="a" cx="19" cy="5" r="1.5"></circle>
                  </svg>
                </a>
              </li>
              <li>
                <p>Cumulus Networks<sup>®</sup> — Data center networking software for the open, modern data center.</p>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </footer>
  <div class="footer-bottom">
      <div class="container">
          <div class="row">
              <div class="col-12">
                  <ul>
                      <li><a href="//cumulusnetworks.com/legal/trademarks/">Trademarks</a></li>
                      <li><a href="//cumulusnetworks.com/legal/privacy/">Privacy</a></li>
                      <li><a href="//cumulusnetworks.com/legal/">Terms of service</a></li>
                  </ul>
              </div>
          </div>
      </div>
  </div>

  
  

</body>

</html>
