<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Border Gateway Protocol - BGP | Cumulus Networks Documentation</title>

  
  <link href="https://fonts.googleapis.com/css?family=Oxygen|Oxygen+Mono:300,400,700" rel="stylesheet">

  
  
  
  <link rel="stylesheet" href="/docs.cumulusnetworks.com/book.min.a378d8a2da6f5357a83a43dff33d6f77fb70401e0399d5ba78faf81d7a1ae1a8.css">

  
  <link rel="icon" href="/docs.cumulusnetworks.com/icons/favicon.png" type="image/x-icon">

  
  <!--
  Made with Book Theme
  https://github.com/alex-shpak/hugo-book
  -->

  
  
  <script src = "/docs.cumulusnetworks.com/js/codecopy.js"> </script>

</head>


<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  
  <header id="site-nav">
    <div class="header-wrapper flex">
      <a href="/">
        <img src="/header-logo.png" alt="Cumulus Networks">
        <img src="/cumulus-networks-rt-white.svg" alt="Cumulus Networks" class="header-mobile">
        <span>Docs</span>
      </a>
      <ul class="flex">
        <li><a href="//cumulusnetworks.com">HOME</a></li>
        <li><a href="//support.cumulusnetworks.com/">SUPPORT</a></li>
        <li><a href="//docs.cumulusnetworks.com/">DOCS</a></li>
        <li><a href="//education.cumulusnetworks.com">EDUCATION</a></li>
        <li><a href="//cumulusnetworks.com/blog/">BLOG</a></li>
        <li><a href="//forums.cumulusnetworks.com/">FORUMS</a></li>
      </ul>
      <div class="burger-menu">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </header>
  <div id="product-nav" class="flex">
      
    
    <ul>
    
      <li class = "active" ><a href = docs.cumulusnetworks.com/cumulus-linux/ >
        Cumulus Linux </a> </li>
    
      <li><a href = docs.cumulusnetworks.com/cumulus-netq/ >
        Cumulus NetQ </a> </li>
    
      <li><a href = docs.cumulusnetworks.com/cumulus-vx/ >
        Cumulus VX </a> </li>
    
      <li>
        <div id="products-dropdown" class="dropdown">
            <button class="btn" type="button" id="dropdownMenuButton">
              Products
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <a class="dropdown-item" href="">Cumulus RMP</a>
              <a class="dropdown-item" href="">Cumulus Chassis</a>
              <a class="dropdown-item" href="">Cumulus Host Pack</a>
            </div>
        </div>
      </li>
    </ul>
    <div class="search-container">
      <div id="doc-search-box">
        <input type="text" class="doc-search-input" placeholder="Search" value="">
        <span><button type="submit"><img src="/icons/search_20x20.svg" alt=""></button></span>
      </div>
      <div id="dropdown" class="dropdown">
          <button class="btn" type="button" id="dropdownMenuButton">
            v3.1.2
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/cumulus-linux/"> v3.7.7</a>
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-linux-25esr/"> v2.5.12</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-linux-30/"> v3.0.1</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-linux-31/"> v3.1.2</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-linux-321/"> v3.2.1</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-linux-330/"> v3.3.0</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-linux-332/"> v3.3.2</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-linux-343/"> v3.4.3</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-linux-35/"> v3.5</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-linux-36/"> v3.6</a>
            
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
          </div>
      </div>
    </div>
  </div>
  <main class="flex container">
    <aside class="book-menu fixed">

      <nav role="navigation">
        <h2 class="book-brand">
          <a href="docs.cumulusnetworks.com">Cumulus Networks Documentation</a>
        </h2>
        
        




  <ul class = "cn-book-section-container" id = "top">
    
        
          
      
          
      
          
            

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/" >
    Cumulus Linux User Guide
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Installation-Upgrading-and-Package-Management/" >
    Installation, Upgrading and Package Management
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Installation-Upgrading-and-Package-Management/Managing-Cumulus-Linux-Disk-Images/" >
    Managing Cumulus Linux Disk Images
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Installation-Upgrading-and-Package-Management/Managing-Cumulus-Linux-Disk-Images/Installing-a-New-Cumulus-Linux-Image/" >
    Installing a New Cumulus Linux Image
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Installation-Upgrading-and-Package-Management/Managing-Cumulus-Linux-Disk-Images/Upgrading-Cumulus-Linux/" >
    Upgrading Cumulus Linux
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Installation-Upgrading-and-Package-Management/Adding-and-Updating-Packages/" >
    Adding and Updating Packages
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Installation-Upgrading-and-Package-Management/Zero-Touch-Provisioning-ZTP/" >
    Zero Touch Provisioning - ZTP
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/System-Management/" >
    System Management
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/System-Management/Authentication-Authorization-and-Accounting/" >
    Authentication, Authorization, and Accounting
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/System-Management/Authentication-Authorization-and-Accounting/SSH-for-Remote-Access/" >
    SSH for Remote Access
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/System-Management/Authentication-Authorization-and-Accounting/User-Accounts/" >
    User Accounts
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/System-Management/Authentication-Authorization-and-Accounting/Using-sudo-to-Delegate-Privileges/" >
    Using sudo to Delegate Privileges
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/System-Management/Authentication-Authorization-and-Accounting/LDAP-Authentication-and-Authorization/" >
    LDAP Authentication and Authorization
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/System-Management/Authentication-Authorization-and-Accounting/TACACS&#43;/" >
    TACACS&#43;
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/System-Management/Netfilter-ACLs/" >
    Netfilter - ACLs
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/System-Management/Netfilter-ACLs/Default-Cumulus-Linux-ACL-Configuration/" >
    Default Cumulus Linux ACL Configuration
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/System-Management/Setting-Date-and-Time/" >
    Setting Date and Time
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/System-Management/Managing-Application-Daemons/" >
    Managing Application Daemons
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/System-Management/Configuring-switchd/" >
    Configuring switchd
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/System-Management/Power-over-Ethernet-PoE/" >
    Power over Ethernet - PoE
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/System-Management/Configuring-a-Global-Proxy/" >
    Configuring a Global Proxy
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Configuring-and-Managing-Network-Interfaces/" >
    Configuring and Managing Network Interfaces
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Configuring-and-Managing-Network-Interfaces/Buffer-and-Queue-Management/" >
    Buffer and Queue Management
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Configuring-and-Managing-Network-Interfaces/Buffer-and-Queue-Management/Configuring-Hardware-enabled-DDOS-Protection/" >
    Configuring Hardware-enabled DDOS Protection
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Configuring-and-Managing-Network-Interfaces/Layer-1-and-Switch-Port-Attributes/" >
    Layer 1 and Switch Port Attributes
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Configuring-and-Managing-Network-Interfaces/Configuring-DHCP-Relays-and-Servers/" >
    Configuring DHCP Relays and Servers
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Configuring-and-Managing-Network-Interfaces/Network-Command-Line-Utility/" >
    Network Command Line Utility
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-1-and-Layer-2-Features/" >
    Layer 1 and Layer 2 Features
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-1-and-Layer-2-Features/Ethernet-Bridging-VLANs/" >
    Ethernet Bridging - VLANs
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-1-and-Layer-2-Features/Ethernet-Bridging-VLANs/VLAN-Tagging/" >
    VLAN Tagging
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-1-and-Layer-2-Features/Ethernet-Bridging-VLANs/VLAN-aware-Bridge-Mode-for-Large-scale-Layer-2-Environments/" >
    VLAN-aware Bridge Mode for Large-scale Layer 2 Environments
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-1-and-Layer-2-Features/Network-Virtualization/" >
    Network Virtualization
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-1-and-Layer-2-Features/Network-Virtualization/Lightweight-Network-Virtualization-LNV/" >
    Lightweight Network Virtualization - LNV
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-1-and-Layer-2-Features/Network-Virtualization/Lightweight-Network-Virtualization-LNV/LNV-VXLAN-Active-Active-Mode/" >
    LNV VXLAN Active-Active Mode
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-1-and-Layer-2-Features/Network-Virtualization/Lightweight-Network-Virtualization-LNV/LNV-Full-Example/" >
    LNV Full Example
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-1-and-Layer-2-Features/Network-Virtualization/Integrating-with-VMware-NSX/" >
    Integrating with VMware NSX
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-1-and-Layer-2-Features/Network-Virtualization/Integrating-Hardware-VTEPs-with-Midokura-MidoNet-and-OpenStack/" >
    Integrating Hardware VTEPs with Midokura MidoNet and OpenStack
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-1-and-Layer-2-Features/Network-Virtualization/Static-MAC-Bindings-with-VXLAN/" >
    Static MAC Bindings with VXLAN
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-1-and-Layer-2-Features/Network-Virtualization/Ethernet-Virtual-Private-Network-EVPN/" >
    Ethernet Virtual Private Network - EVPN
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-1-and-Layer-2-Features/Spanning-Tree-and-Rapid-Spanning-Tree/" >
    Spanning Tree and Rapid Spanning Tree
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-1-and-Layer-2-Features/Link-Layer-Discovery-Protocol/" >
    Link Layer Discovery Protocol
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-1-and-Layer-2-Features/Prescriptive-Topology-Manager-PTM/" >
    Prescriptive Topology Manager - PTM
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-1-and-Layer-2-Features/Bonding-Link-Aggregation/" >
    Bonding - Link Aggregation
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-1-and-Layer-2-Features/Multi-Chassis-Link-Aggregation-MLAG/" >
    Multi-Chassis Link Aggregation - MLAG
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-1-and-Layer-2-Features/LACP-Bypass/" >
    LACP Bypass
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-1-and-Layer-2-Features/Virtual-Router-Redundancy-VRR/" >
    Virtual Router Redundancy - VRR
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-1-and-Layer-2-Features/IGMP-and-MLD-Snooping/" >
    IGMP and MLD Snooping
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-3-Features/" >
    Layer 3 Features
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-3-Features/Configuring-Quagga/" >
    Configuring Quagga
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-3-Features/Configuring-Quagga/Cumulus-Linux-Quagga-Commands/" >
    Cumulus Linux Quagga Commands
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-3-Features/Routing/" >
    Routing
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-3-Features/Introduction-to-Routing-Protocols/" >
    Introduction to Routing Protocols
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-3-Features/Network-Topology/" >
    Network Topology
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-3-Features/Quagga-Overview/" >
    Quagga Overview
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-3-Features/Open-Shortest-Path-First-OSPF-Protocol/" >
    Open Shortest Path First - OSPF - Protocol
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-3-Features/Open-Shortest-Path-First-v3-OSPFv3-Protocol/" >
    Open Shortest Path First v3 - OSPFv3 - Protocol
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-3-Features/Border-Gateway-Protocol-BGP/"  class="active" >
    Border Gateway Protocol - BGP
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-3-Features/Bidirectional-Forwarding-Detection-BFD/" >
    Bidirectional Forwarding Detection - BFD
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-3-Features/Equal-Cost-Multipath-Load-Sharing-Hardware-ECMP/" >
    Equal Cost Multipath Load Sharing - Hardware ECMP
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-3-Features/Redistribute-Neighbor/" >
    Redistribute Neighbor
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-3-Features/Virtual-Routing-and-Forwarding-VRF/" >
    Virtual Routing and Forwarding - VRF
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-3-Features/Management-VRF/" >
    Management VRF
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Layer-3-Features/Protocol-Independent-Multicast-PIM/" >
    Protocol Independent Multicast - PIM
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Monitoring-and-Troubleshooting/" >
    Monitoring and Troubleshooting
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Monitoring-and-Troubleshooting/Understanding-and-Decoding-the-cl-support-Output-File/" >
    Understanding and Decoding the cl-support Output File
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Monitoring-and-Troubleshooting/Understanding-and-Decoding-the-cl-support-Output-File/Troubleshooting-Log-Files/" >
    Troubleshooting Log Files
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Monitoring-and-Troubleshooting/Understanding-and-Decoding-the-cl-support-Output-File/Troubleshooting-the-etc-Directory/" >
    Troubleshooting the etc Directory
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Monitoring-and-Troubleshooting/Understanding-and-Decoding-the-cl-support-Output-File/Troubleshooting-the-support-Directory/" >
    Troubleshooting the support Directory
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Monitoring-and-Troubleshooting/Troubleshooting-Network-Interfaces/" >
    Troubleshooting Network Interfaces
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Monitoring-and-Troubleshooting/Troubleshooting-Network-Interfaces/Monitoring-Interfaces-and-Transceivers-Using-ethtool/" >
    Monitoring Interfaces and Transceivers Using ethtool
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Monitoring-and-Troubleshooting/Network-Troubleshooting/" >
    Network Troubleshooting
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Monitoring-and-Troubleshooting/Network-Troubleshooting/Using-netshow-to-Troubleshoot-Your-Network-Configuration/" >
    Using netshow to Troubleshoot Your Network Configuration
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Monitoring-and-Troubleshooting/Network-Troubleshooting/Monitoring-System-Statistics-and-Network-Traffic-with-sFlow/" >
    Monitoring System Statistics and Network Traffic with sFlow
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Monitoring-and-Troubleshooting/Network-Troubleshooting/Using-netq-to-Troubleshoot-the-Network/" >
    Using netq to Troubleshoot the Network
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Monitoring-and-Troubleshooting/SNMP-Monitoring/" >
    SNMP Monitoring
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Monitoring-and-Troubleshooting/SNMP-Monitoring/Using-Nutanix-Prism-as-a-Monitoring-Tool/" >
    Using Nutanix Prism as a Monitoring Tool
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Monitoring-and-Troubleshooting/Single-User-Mode-Boot-Recovery/" >
    Single User Mode - Boot Recovery
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Monitoring-and-Troubleshooting/Resource-Diagnostics-Using-cl-resource-query/" >
    Resource Diagnostics Using cl-resource-query
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Monitoring-and-Troubleshooting/Monitoring-System-Hardware/" >
    Monitoring System Hardware
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Monitoring-and-Troubleshooting/Monitoring-Virtual-Device-Counters/" >
    Monitoring Virtual Device Counters
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Monitoring-and-Troubleshooting/Monitoring-Best-Practices/" >
    Monitoring Best Practices
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Network-Solutions/" >
    Network Solutions
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Network-Solutions/Data-Center-Host-to-ToR-Architecture/" >
    Data Center Host to ToR Architecture
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Network-Solutions/Cumulus-Networks-Services-Demos/" >
    Cumulus Networks Services Demos
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Network-Solutions/Docker-on-Cumulus-Linux/" >
    Docker on Cumulus Linux
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Network-Solutions/OpenStack-Neutron-ML2-and-Cumulus-Linux/" >
    OpenStack Neutron ML2 and Cumulus Linux
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Whats-New-in-Cumulus-Linux-3.1/" >
    What&#39;s New in Cumulus Linux 3.1
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Quick-Start-Guide/" >
    Quick Start Guide
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-linux-31/Cumulus-Linux-Index/" >
    Cumulus Linux Index
  </a>


    </li>
    
  </ul>


  </li>


          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  </ul>









      </nav>

      
      
      
      

      <script src = "/docs.cumulusnetworks.com/js/menuBundle.js"> </script>


    </aside>

    <div class="book-page">

      
      <header class="align-center justify-between book-header">
        <label for="menu-control">
          <img src="/docs.cumulusnetworks.com/svg/menu.svg" alt="Menu" />
        </label>
        <strong>Border Gateway Protocol - BGP</strong>
      </header>

      
      
<div class= "notices info" id = "info" >
    This documentation is for an older version of the software. If you are using the current version of Cumulus Linux, this content may not be up to date. The current version of the documentation is available [here](https://docs.cumulusnetworks.com/).
  </div>
<article class="markdown">
<h1>Border Gateway Protocol - BGP</h1>

<p><details></p>

<p>BGP is the routing protocol that runs the Internet. It is an
increasingly popular protocol for use in the data center as it lends
itself well to the rich interconnections in a Clos topology.
Specifically:</p>

<ul>
<li><p>It does not require routing state to be periodically refreshed
unlike OSPF.</p></li>

<li><p>It is less chatty than its link-state siblings. For example, a link
or node transition can result in a bestpath change, causing BGP to
send updates.</p></li>

<li><p>It is multi-protocol and extensible.</p></li>

<li><p>There are many robust vendor implementations.</p></li>

<li><p>The protocol is very mature and comes with many years of operational
experience.</p></li>
</ul>

<p><a href="http://tools.ietf.org/html/draft-lapukhov-bgp-routing-large-dc-04" target="_blank">This IETF
draft</a>
provides further details of the use of BGP within the data center.</p>

<h2 id="span-commands-span"><span>Commands</span></h2>

<p>Cumulus Linux:</p>

<ul>
<li><p>bgp</p></li>

<li><p>systemctl</p></li>

<li><p>vtysh</p></li>
</ul>

<p>Quagga:</p>

<ul>
<li><p>bgp</p></li>

<li><p>neighbor</p></li>

<li><p>router</p></li>

<li><p>show</p></li>
</ul>

<h2 id="span-autonomous-system-number-asn-span"><span>Autonomous System Number (ASN)</span></h2>

<p>One of the key concepts in BGP is an <em>autonomous</em> <em>system number</em> or
ASN. An <a href="https://en.wikipedia.org/wiki/Autonomous_System_%28Internet%29" target="_blank">autonomous
system</a>
is defined as a set of routers under a common administration. Since BGP
was originally designed to peer between independently managed
enterprises and/or service providers, each such enterprise is treated as
an autonomous system, responsible for a set of network addresses. Each
such autonomous system is given a unique number called its ASN. ASNs are
handed out by a central authority (ICANN). However, ASNs between 64512
and 65535 are reserved for private use. Using BGP within the data center
relies on either using this number space or else using the single ASN
you own.</p>

<p>The ASN is central to how BGP builds a forwarding topology. A BGP route
advertisement carries with it not only the originator’s ASN, but also
the list of ASNs that this route advertisement has passed through. When
forwarding a route advertisement, a BGP speaker adds itself to this
list. This list of ASNs is called the <em>AS path</em>. BGP uses the AS path to
detect and avoid loops.</p>

<p>ASNs were originally 16-bit numbers, but were later modified to be
32-bit. Quagga supports both 16-bit and 32-bit ASNs, but most
implementations still run with 16-bit ASNs.</p>

<h2 id="span-ebgp-and-ibgp-span"><span>eBGP and iBGP</span></h2>

<p>When BGP is used to peer between autonomous systems, the peering is
referred to as <em>external BGP</em> or eBGP. When BGP is used within an
autonomous system, the peering used is referred to as <em>internal BGP</em> or
iBGP. eBGP peers have different ASNs while iBGP peers have the same ASN.</p>

<p>While the heart of the protocol is the same when used as eBGP or iBGP,
there is a key difference in the protocol behavior between use as eBGP
and iBGP: an iBGP node does not forward routing information learned from
one iBGP peer to another iBGP peer. It expects the originating iBGP peer
to send this information to all iBGP peers.</p>

<p>This implies that iBGP peers are all connected to each other. In a large
network, this requirement can quickly become unscalable. The most
popular method to avoid this problem is to introduce a <em>route
reflector</em>.</p>

<h2 id="span-route-reflectors-span"><span>Route Reflectors</span></h2>

<p>Route reflectors are quite easy to understand in a Clos topology. In a
two-tier Clos network, the leaf (or tier 1) switches are the only ones
connected to end stations. Subsequently, this means that the spines
themselves do not have any routes to announce. They’re merely
<strong>reflecting</strong> the routes announced by one leaf to the other leaves.
Thus, the spine switches function as route reflectors while the leaf
switches serve as route reflector clients.</p>

<p>In a three-tier network, the tier 2 nodes (or mid-tier spines) act as
both route reflector servers and route reflector clients. They act as
route reflectors because they announce the routes learned from the tier
1 nodes to other tier 1 nodes and to tier 3 nodes. They also act as
route reflector clients to the tier 3 nodes, receiving routes learned
from other tier 2 nodes. Tier 3 nodes act only as route reflectors.</p>

<p>In the following illustration, tier 2 node 2.1 is acting as a route
reflector server, announcing the routes between tier 1 nodes 1.1 and 1.2
to tier 1 node 1.3. It is also a route reflector client, learning the
routes between tier 2 nodes 2.2 and 2.3 from the tier 3 node, 3.1.</p>








<img class = "confluence-embedded-image confluence-thumbnail" src = "/images/download/thumbnails/5122130/bgp_route_reflectors.png" alt = "/images/download/thumbnails/5122130/bgp_route_reflectors.png"


width = 300

 />


<h2 id="span-id-src-5122130-bordergatewayprotocol-bgp-ecmp-class-confluence-anchor-link-span-span-ecmp-with-bgp-span"><span id="src-5122130_BorderGatewayProtocol-BGP-ecmp" class="confluence-anchor-link"></span><span>ECMP with BGP</span></h2>

<p>If a BGP node hears a prefix <strong>p</strong> from multiple peers, it has all the
information necessary to program the routing table to forward traffic
for that prefix <strong>p</strong> through all of these peers. Thus, BGP supports
equal-cost multipathing (ECMP).</p>

<p>In order to perform ECMP in BGP, you may need to configure <em>multipath
relax</em> (if you&rsquo;re using eBGP).</p>

<h3 id="span-maximum-paths-span"><span>Maximum Paths</span></h3>

<p>In Cumulus Linux, the BGP <code>maximum-paths</code> setting is enabled by default,
so multiple routes are already installed. The default setting is 64
paths.</p>

<h3 id="span-bgp-for-both-ipv4-and-ipv6-span"><span>BGP for Both IPv4 and IPv6</span></h3>

<p>Unlike OSPF, which has separate versions of the protocol to announce
IPv4 and IPv6 routes, BGP is a multi-protocol routing engine, capable of
announcing both IPv4 and IPv6 prefixes. It supports announcing IPv4
prefixes over an IPv4 session and IPv6 prefixes over an IPv6 session. It
also supports announcing prefixes of both these address families over a
single IPv4 session or over a single IPv6 session.</p>

<h2 id="span-id-src-5122130-bordergatewayprotocol-bgp-config-bgp-class-confluence-anchor-link-span-span-configuring-bgp-span"><span id="src-5122130_BorderGatewayProtocol-BGP-config_bgp" class="confluence-anchor-link"></span><span>Configuring BGP</span></h2>

<ol>
<li><p>Enable the BGP and Zebra daemons:</p>

<ul>
<li><p>Enable the <code>zebra</code> and <code>bgpd</code> daemons, as described in
<a href="/version/cumulus-linux-31/Layer-3-Features/Configuring-Quagga/">Configuring
Quagga</a>,
then start Quagga:</p>

<pre><code>cumulus@switch:~$ sudo systemctl enable quagga.service
cumulus@switch:~$ sudo systemctl start quagga.service
</code></pre></li>

<li><p>Touch an empty <code>bgpd</code> configuration file:</p>

<pre><code>cumulus@switch:~$ sudo touch /etc/quagga/bgpd.conf
</code></pre>

<p>A slightly more useful configuration file would contain the
following lines:</p>

<pre><code>hostname R7
log timestamp precision 6
log file /var/log/quagga/bgpd.log
</code></pre>

<p>The most important information here is the specification of the
location of the log file, where the BGP process can log
debugging and other useful information. A common convention is
to store the log files under <code>/var/log/quagga</code>.</p>

<p>You must restart the <code>bgpd</code> daemon when you update the BGP
configuration:</p>

<pre><code>cumulus@switch:~$ sudo /usr/lib/quagga/quagga restart bgpd
</code></pre></li>
</ul></li>

<li><p>Identify the BGP node by assigning an ASN and <code>router-id</code>:</p>

<pre><code>cumulus@switch:~$ sudo vtysh
 
Hello, this is Quagga (version 0.99.23.1+cl3u2).
Copyright 1996-2005 Kunihiro Ishiguro, et al.
 
R7# configure  terminal
R7(config)# router bgp 65000
R7(config-router)# bgp router-id 0.0.0.1
</code></pre></li>

<li><p>Specify to whom it must disseminate routing information:</p>

<pre><code>R7(config-router)# neighbor 10.0.0.2 external
</code></pre>

<p>If it is an iBGP session, the <code>remote-as</code> is the same as the local
AS:</p>

<pre><code>R7(config-router)# neighbor 10.0.0.2 remote-as internal
</code></pre>

<p>Specifying the peer’s IP address allows BGP to set up a TCP socket
with this peer, but it doesn’t distribute any prefixes to it, unless
it is explicitly told that it must via the <code>activate</code> command:</p>

<pre><code>R7(config-router)# address-family ipv4 unicast
R7(config-router-af)# neighbor 10.0.0.2 activate
R7(config-router-af)# exit
R7(config-router)# address-family ipv6
R7(config-router-af)# neighbor 2001:db8:0002::0a00:0002 activate
R7(config-router-af)# exit
</code></pre>

<p>As you can see, <code>activate</code> has to be specified for each address
family that is being announced by the BGP session.</p></li>

<li><p>Specify some properties of the BGP session:</p>

<pre><code>R7(config-router)# neighbor 10.0.0.2 next-hop-self
R7(config-router)# address-family ipv4 unicast
</code></pre>

<p>If this is a route-reflector client, it can be specified as follows:</p>

<pre><code>R3(config-router-af)# neighbor 10.0.0.1 route-reflector-client
</code></pre>


<div class="notices note" > <pre><code>It is node R3, the route reflector, on which the peer is specified
as a client.
</code></pre>
 </div>
</li>

<li><p>Specify what prefixes to originate:</p>

<pre><code>R7(config-router)# address-family ipv4 unicast
R7(config-router-af)# network 192.0.2.0/24
R7(config-router-af)# network 203.0.113.1/24
</code></pre></li>
</ol>

<h2 id="span-id-src-5122130-bordergatewayprotocol-bgp-unnumbered-class-confluence-anchor-link-span-span-using-bgp-unnumbered-interfaces-span"><span id="src-5122130_BorderGatewayProtocol-BGP-unnumbered" class="confluence-anchor-link"></span><span>Using BGP Unnumbered Interfaces</span></h2>

<p>Unnumbered interfaces are interfaces without unique IP addresses. In
BGP, you configure unnumbered interfaces using <em>extended next-hop
encoding</em> (ENHE), which is defined by
<a href="https://tools.ietf.org/html/rfc5549" target="_blank">RFC 5549</a>. BGP unnumbered
interfaces provide a means of advertising an IPv4 route with an IPv6
next-hop. Prior to RFC 5549, an IPv4 route could be advertised only with
an IPv4 next-hop.</p>

<p>BGP unnumbered interfaces are particularly useful in deployments where
IPv4 prefixes are advertised through BGP over a section without any IPv4
address configuration on links. As a result, the routing entries are
also IPv4 for destination lookup and have IPv6 next-hops for forwarding
purposes.</p>

<h3 id="span-bgp-and-extended-next-hop-encoding-span"><span>BGP and Extended Next-hop Encoding</span></h3>

<p>Once enabled and active, BGP makes use of the available IPv6 next-hops
for advertising any IPv4 prefixes. BGP learns the prefixes, calculates
the routes and installs them in IPv4 AFI to IPv6 AFI format. However,
ENHE in Cumulus Linux does not install routes into the kernel in IPv4
prefix to IPv6 next-hop format. For link-local peerings enabled by
dynamically learning the other end&rsquo;s link-local address using IPv6
neighbor discovery router advertisements, an IPv6 next-hop is converted
into an IPv4 link-local address and a static neighbor entry is installed
for this IPv4 link-local address with the MAC address derived from the
link-local address of the other end.</p>


<div class="notices note" > <p>It is assumed that the IPv6 implementation on the peering device will
use the MAC address as the interface ID when assigning the IPv6
link-local address, as suggested by RFC 4291.</p>
 </div>


<h3 id="span-configuring-bgp-unnumbered-interfaces-span"><span>Configuring BGP Unnumbered Interfaces</span></h3>

<p>Configuring a BGP unnumbered interface requires enabling IPv6 neighbor
discovery router advertisements. The <code>interval</code> you specify is measured
in seconds, and defaults to 600 seconds. Extended next-hop encoding is
sent only for the link-local address peerings:</p>

<pre><code>router bgp 65020
 bgp router-id 10.0.0.21
 bgp bestpath as-path multipath-relax
 bgp bestpath compare-routerid
 neighbor fabric peer-group
 neighbor fabric remote-as external
 neighbor fabric description Internal Fabric Network
 neighbor fabric capability extended-nexthop
 neighbor swp1 interface peer-group fabric
 neighbor swp2 interface peer-group fabric
 neighbor swp3 interface peer-group fabric
 neighbor swp4 interface peer-group fabric
 neighbor swp29 interface peer-group fabric
 neighbor swp30 interface peer-group fabric
!
</code></pre>

<p>For an unnumbered configuration, you can use a single command to
configure a neighbor and attach it to a <a href="#src-5122130_BorderGatewayProtocol-BGP-peergroups">peer
group</a>:</p>

<pre><code># neighbor &lt;swpX&gt; interface peer-group &lt;group name&gt;
</code></pre>

<h3 id="span-managing-unnumbered-interfaces-span"><span>Managing Unnumbered Interfaces</span></h3>

<p>All the relevant BGP commands are now capable of showing IPv6 next-hops
and/or the interface name for any IPv4 prefix:</p>

<pre><code>#  show ip bgp
BGP table version is 15, local router ID is 10.0.0.21
Status codes: s suppressed, d damped, h history, * valid, &gt; best, = multipath,
              i internal, r RIB-failure, S Stale, R Removed
Origin codes: i - IGP, e - EGP, ? - incomplete
   Network          Next Hop            Metric LocPrf Weight Path
*= 0.0.0.0          swp30                         0 65051 i
*&gt;                  swp29                         0 65051 i
*&gt; 10.0.0.1/32      swp29                         0 65051 65001 i
*=                  swp30                         0 65051 65001 i
*&gt; 10.0.0.11/32     swp1            0             0 65011 i
*&gt; 10.0.0.12/32     swp2            0             0 65012 i
*&gt; 10.0.0.13/32     swp3            0             0 65013 i
*&gt; 10.0.0.14/32     swp4            0             0 65014 i
*&gt; 10.0.0.21/32     0.0.0.0                  0         32768 i
*= 10.0.0.51/32     swp30           0             0 65051 i
*&gt;                  swp29           0             0 65051 i
*&gt; 172.16.1.0/24    swp1            0             0 65011 i
*=                  swp2            0             0 65012 i
*&gt; 172.16.3.0/24    swp3            0             0 65013 i
*=                  swp4            0             0 65014 i
Total number of prefixes 10
</code></pre>

<p>Quagga RIB commands are also modified:</p>

<pre><code># show ip route
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, T - Table,
       &gt; - selected route, * - FIB route
B&gt;* 0.0.0.0/0 [20/0] via fe80::4638:39ff:fe00:c, swp29, 00:11:41
  *                  via fe80::4638:39ff:fe00:52, swp30, 00:11:41
B&gt;* 10.0.0.1/32 [20/0] via fe80::4638:39ff:fe00:c, swp29, 00:11:41
  *                    via fe80::4638:39ff:fe00:52, swp30, 00:11:41
B&gt;* 10.0.0.11/32 [20/0] via fe80::4638:39ff:fe00:5b, swp1, 00:11:41
B&gt;* 10.0.0.12/32 [20/0] via fe80::4638:39ff:fe00:2e, swp2, 00:11:42
B&gt;* 10.0.0.13/32 [20/0] via fe80::4638:39ff:fe00:57, swp3, 00:11:42
B&gt;* 10.0.0.14/32 [20/0] via fe80::4638:39ff:fe00:43, swp4, 00:11:42
C&gt;* 10.0.0.21/32 is directly connected, lo
B&gt;* 10.0.0.51/32 [20/0] via fe80::4638:39ff:fe00:c, swp29, 00:11:41
  *                     via fe80::4638:39ff:fe00:52, swp30, 00:11:41
B&gt;* 172.16.1.0/24 [20/0] via fe80::4638:39ff:fe00:5b, swp1, 00:11:41
  *                      via fe80::4638:39ff:fe00:2e, swp2, 00:11:41
B&gt;* 172.16.3.0/24 [20/0] via fe80::4638:39ff:fe00:57, swp3, 00:11:42
  *                      via fe80::4638:39ff:fe00:43, swp4, 00:11:42
</code></pre>

<p>The following commands show how the IPv4 link-local address
<em>169.254.0.1</em> is used to install the route and static neighbor entry to
facilitate proper forwarding without having to install an IPv4 prefix
with IPv6 next-hop in the kernel:</p>

<pre><code>cumulus@switch:~$ ip route show 10.0.0.1
10.0.0.1  proto zebra  metric 20 
    nexthop via 169.254.0.1  dev swp29 weight 1 onlink
    nexthop via 169.254.0.1  dev swp30 weight 1 onlink

cumulus@switch:~$ ip neighbor
169.254.0.1 dev swp29 lladdr 44:38:39:00:00:0c PERMANENT
169.254.0.1 dev swp3 lladdr 44:38:39:00:00:57 PERMANENT
169.254.0.1 dev swp30 lladdr 44:38:39:00:00:52 PERMANENT
169.254.0.1 dev swp2 lladdr 44:38:39:00:00:2e PERMANENT
192.168.0.254 dev eth0 lladdr 44:38:39:00:00:5f REACHABLE
169.254.0.1 dev swp4 lladdr 44:38:39:00:00:43 PERMANENT
169.254.0.1 dev swp1 lladdr 44:38:39:00:00:5b PERMANENT
fe80::4638:39ff:fe00:52 dev swp30 lladdr 44:38:39:00:00:52 router REACHABLE
fe80::4638:39ff:fe00:c dev swp29 lladdr 44:38:39:00:00:0c router REACHABLE
fe80::4638:39ff:fe00:2e dev swp2 lladdr 44:38:39:00:00:2e router REACHABLE
fe80::4638:39ff:fe00:43 dev swp4 lladdr 44:38:39:00:00:43 router REACHABLE
fe80::4638:39ff:fe00:57 dev swp3 lladdr 44:38:39:00:00:57 router REACHABLE
fe80::4638:39ff:fe00:5b dev swp1 lladdr 44:38:39:00:00:5b router REACHABLE
</code></pre>

<h3 id="span-how-traceroute-interacts-with-bgp-unnumbered-interfaces-span"><span>How traceroute Interacts with BGP Unnumbered Interfaces</span></h3>

<p>Every router or end host must have an IPv4 address in order to complete
a <code>traceroute</code> of IPv4 addresses. In this case, the IPv4 address used is
that of the loopback device.</p>

<p>Even if ENHE is not used in the data center, link addresses are not
typically advertised. This is because:</p>

<ul>
<li><p>Link addresses take up valuable FIB resources. In a large Clos
environment, the number of such addresses can be quite large.</p></li>

<li><p>Link addresses expose an additional attack vector for intruders to
use to either break in or engage in DDOS attacks.</p></li>
</ul>

<p>Therefore, assigning an IP address to the loopback device is essential.</p>

<h3 id="span-advanced-understanding-how-next-hop-fields-are-set-span"><span>Advanced: Understanding How Next-hop Fields Are Set</span></h3>

<p>This section describes how the IPv6 next-hops are set in the
MP_REACH_NLRI (<a href="https://www.ietf.org/rfc/rfc2858.txt" target="_blank">multiprotocol reachable
NLRI</a>) initiated by the system,
which applies whether IPv6 prefixes or IPv4 prefixes are exchanged with
ENHE. There are two main aspects to determine — how many IPv6 next-hops
are included in the MP_REACH_NLRI (since the RFC allows either one or
two next-hops) and the values of the next-hop(s). This section also
describes how a received MP_REACH_NLRI is handled as far as processing
IPv6 next-hops.</p>

<ul>
<li><p>Whether peering to a global IPv6 address or link-local IPv6 address,
the determination whether to send one or two next-hops is as
follows:</p>

<ol>
<li><p>If reflecting the route, two next-hops are sent only if the peer
has <code>nexthop-local unchanged</code> configured and the attribute of
the received route has an IPv6 link-local next-hop; otherwise,
only one next-hop is sent.</p></li>

<li><p>Otherwise (if it&rsquo;s not reflecting the route), two next-hops are
sent if explicitly configured (<code>nexthop-local unchanged</code>) or the
peer is directly connected (that is, either peering is on
link-local address or the global IPv4 or IPv6 address is
<em>directly connected</em>) and the route is either a
local/self-originated route or the peer is an eBGP peer.</p></li>

<li><p>In all other cases, only one next-hop gets sent, unless an
outbound route map adds another next-hop.</p></li>
</ol></li>

<li><p><code>route-map</code> can impose two next-hops in scenarios where Cumulus
Linux would only send one next-hop — by specifying <code>set ipv6 nexthop
link-local</code>.</p></li>

<li><p>For all routes to eBGP peers and self-originated routes to iBGP
peers, the global next-hop (first value) is the peering address of
the local system. If the peering is on the link-local address, this
is the global IPv6 address on the peering interface, if present;
otherwise, it is the link-local IPv6 address on the peering
interface.</p></li>

<li><p>For other routes to iBGP peers (eBGP to iBGP or reflected), the
global next-hop will be the global next-hop in the received
attribute.</p>


<div class="notices note" > <pre><code>If this address were a link-local IPv6 address, it would get reset
so that the link-local IPv6 address of the eBGP peer is not passed
along to an iBGP peer, which most likely may be on a different link.
</code></pre>
 </div>
</li>

<li><p><code>route-map</code> and/or the peer configuration can change the above
behavior. For example, <code>route-map</code> can set the global IPv6 next-hop
or the peer configuration can set it to <em>self</em> — which is relevant
for <em>iBGP</em> peers. The route map or peer configuration can also set
the next-hop to unchanged, which ensures the source IPv6 global
next-hop is passed around — which is relevant for <em>eBGP</em> peers.</p></li>

<li><p>Whenever two next-hops are being sent, the link-local next-hop (the
second value of the two) is the link-local IPv6 address on the
peering interface unless it is due to <code>nh-local-unchanged</code> or
<code>route-map</code> has set the link-local next-hop.</p></li>

<li><p>Network administrators cannot set <a href="http://en.wikipedia.org/wiki/Martian_packet" target="_blank">martian
values</a> for IPv6
next-hops in <code>route-map</code>. Also, global and link-local next-hops are
validated to ensure they match the respective address types.</p></li>

<li><p>In a received update, a martian check is imposed for the IPv6 global
next-hop. If the check fails, it gets treated as an implicit
withdraw.</p></li>

<li><p>If two next-hops are received in an update and the second next-hop
is not a link-local address, it gets ignored and the update is
treated as if only one next-hop was received.</p></li>

<li><p>Whenever two next-hops are received in an update, the second
next-hop is used to install the route into <code>zebra</code>. As per the
previous point, it is already assured that this is a link-local IPv6
address. Currently, this is assumed to be reachable and is not
registered with NHT.</p></li>

<li><p>When <code>route-map</code> specifies the next-hop as <code>peer-address</code>, the
global IPv6 next-hop as well as the link-local IPv6 next-hop (if
it&rsquo;s being sent) is set to the <em>peering address</em>. If the peering is
on a link-local address, the former could be the link-local address
on the peering interface, unless there is a global IPv6 address
present on this interface.</p></li>
</ul>

<p>The above rules imply that there are scenarios where a generated update
has two IPv6 next-hops, and both of them are the IPv6 link-local address
of the peering interface on the local system. If you are peering with a
switch or router that is not running Cumulus Linux and expects the first
next-hop to be a global IPv6 address, a route map can be used on the
sender to specify a global IPv6 address. This conforms with the
recommendations in the Internet draft
<a href="https://tools.ietf.org/html/draft-kato-bgp-ipv6-link-local-00" target="_blank">draft-kato-bgp-ipv6-link-local-00.txt</a>,
&ldquo;BGP4+ Peering Using IPv6 Link-local Address&rdquo;.</p>

<h3 id="span-limitations-span"><span>Limitations</span></h3>

<ul>
<li><p>Interface-based peering with separate IPv4 and IPv6 sessions is not
supported.</p></li>

<li><p>ENHE is sent for IPv6 link-local peerings only.</p></li>

<li><p>If an IPv4 /30 or /31 IP address is assigned to the interface IPv4
peering will be used over IPv6 link-local peering.</p></li>

<li><p>If the default router lifetime in the generated IPv6 route
advertisements (RA) is set to <em>0</em>, the receiving Quagga instance
will drop the RA if it is on a Cumulus Linux <strong>2.5.z</strong> switch. To
work around this issue, either:</p>

<ul>
<li><p>Explicitly configure the switch to advertise a router lifetime
of 0, unless a value is specifically set by the operator — with
the assumption that the host is running Cumulus Linux 3.y.z
version of Quagga. When hosts see an IPv6 RA with a router
lifetime of 0, they won&rsquo;t make that router a default router.</p></li>

<li><p>Use the <code>sysctl</code> on the host —
<code>net.ipv6.conf.all.accept_ra_defrtr</code>. However, this requires
applying this setting on all hosts, which may mean many hosts,
especially if Quagga is run on the hosts.</p></li>
</ul></li>
</ul>

<h2 id="span-id-src-5122130-bordergatewayprotocol-bgp-add-path-class-confluence-anchor-link-span-span-bgp-add-path-span"><span id="src-5122130_BorderGatewayProtocol-BGP-add-path" class="confluence-anchor-link"></span><span>BGP add-path</span></h2>

<p>In Cumulus Linux 3.0 and later, BGP and static routing (IPv4 and IPv6)
are supported within a VRF context. For more information, refer to
<a href="/version/cumulus-linux-31/Layer-3-Features/Virtual-Routing-and-Forwarding---VRF">Virtual Routing and Forwarding -
VRF</a>.</p>

<h3 id="span-bgp-add-path-rx-span"><span>BGP add-path RX</span></h3>

<p><em>BGP add-path RX</em> allows BGP to receive multiple paths for the same
prefix. A path identifier is used so that additional paths do not
override previously advertised paths. No additional configuration is
required for BGP add-path RX.</p>


<div class="notices note" > <p>BGP advertises the add-path RX capability by default. Add-Path TX
requires an administrator to enable it. Enabling TX will reset the
session.</p>
 </div>


<p>To view the existing capabilities, run <code>show ip bgp neighbors</code>. They can
be seen listed in the subsection <em>Add Path:</em>, below <em>Neighbor
capabilities:</em>.</p>

<pre><code>r7# show ip bgp neighbors

BGP neighbor on swp1: fe80::4638:39ff:fe00:5b, remote AS 65011, local AS 65020, external link
Hostname: leaf01
 Member of peer-group fabric for session parameters
  BGP version 4, remote router ID 10.0.0.11
  BGP state = Established, up for 00:59:17
  Last read 00:00:02, Last write 00:59:16
  Hold time is 9, keepalive interval is 3 seconds
  Neighbor capabilities:
    4 Byte AS: advertised and received
    AddPath:
      IPv4 Unicast: RX advertised IPv4 Unicast and received
    Extended nexthop: advertised and received
      Address families by peer:
                   IPv4 Unicast
    Route refresh: advertised and received(old &amp; new)
    Address family IPv4 Unicast: advertised and received
    Hostname Capability: advertised and received
    Graceful Restart Capabilty: advertised and received
      Remote Restart timer is 120 seconds
      Address families by peer:
        none
 
...
</code></pre>

<p>The example output above shows that additional BGP paths can be sent and
received (TX and RX are advertised). It also shows that the BGP
neighbor, fe80::4638:39ff:fe00:5b, supports both.</p>

<p>To view the current additional paths, run <code>show ip bgp &lt;network&gt;</code>. The
example output shows five additional paths that have been added by the
TX node for receiving. All the paths have a unique AddPath ID.</p>

<pre><code>r7# show ip bgp 1.1.1.1/32
BGP routing table entry for 1.1.1.1/32
Paths: (6 available, best #6, table Default-IP-Routing-Table)
  500
    10.7.6.2 from r6(10.7.6.2) (10.0.0.6)
      Origin IGP, metric 0, localpref 100, valid, external
      Community: 6:6
      AddPath ID: RX 0, TX 7
      Last update: Thu Jun  2 00:57:16 2016
 
  500
    10.7.5.2 from r5(10.7.5.2) (10.0.0.5)
      Origin IGP, metric 0, localpref 100, valid, external, bestpath-from-AS 500
      Community: 5:5
      AddPath ID: RX 0, TX 6
      Advertised to: r8(10.7.8.2)
      Last update: Thu Jun  2 00:57:16 2016
 
  300
    10.7.4.2 from r4(10.7.4.2) (10.0.0.4)
      Origin IGP, metric 0, localpref 100, valid, external
      Community: 4:4
      AddPath ID: RX 0, TX 5
      Last update: Thu Jun  2 00:57:16 2016
 
  300
    10.7.3.2 from r3(10.7.3.2) (10.0.0.3)
      Origin IGP, metric 0, localpref 100, valid, external, bestpath-from-AS 300
      Community: 3:3
      AddPath ID: RX 0, TX 4
      Advertised to: r8(10.7.8.2)
      Last update: Thu Jun  2 00:57:16 2016
 
  100
    10.7.2.2 from r2(10.7.2.2) (10.0.0.2)
      Origin IGP, metric 0, localpref 100, valid, external, multipath
      Community: 2:2
      AddPath ID: RX 0, TX 3
      Last update: Thu Jun  2 00:57:16 2016
 
  100
    10.7.1.2 from r1(10.7.1.2) (10.0.0.1)
      Origin IGP, metric 0, localpref 100, valid, external, multipath, bestpath-from-AS 100, best
      Community: 1:1
      AddPath ID: RX 0, TX 2
      Advertised to: r1(10.7.1.2) r2(10.7.2.2) r3(10.7.3.2) r4(10.7.4.2) r5(10.7.5.2) r6(10.7.6.2) r8(10.7.8.2)
      Last update: Thu Jun  2 00:57:16 2016
</code></pre>

<h3 id="span-bgp-add-path-tx-span"><span>BGP add-path TX</span></h3>

<p>AddPath TX allows BGP to advertise more than just the bestpath for a
prefix. Consider the following topology:</p>

<pre><code>          r8
          |
          |
  r1 ----    ---- r6
  r2 ---- r7 ---- r5
          ||
          ||
        r3 r4
</code></pre>

<p>In this topology:</p>

<ul>
<li><p>r1 and r2 are in AS 100</p></li>

<li><p>r3 and r4 are in AS 300</p></li>

<li><p>r5 and r6 are in AS 500</p></li>

<li><p>r7 is in AS 700</p></li>

<li><p>r8 is in AS 800</p></li>

<li><p>r7 learns 1.1.1.<sup>1</sup>&frasl;<sub>32</sub> from r1, r2, r3, r4, r5, and r6. Among these r7
picks the path from r1 as the bestpath for 1.1.1.<sup>1</sup>&frasl;<sub>32</sub></p></li>
</ul>

<p>The example below configures the r7 session to advertise the bestpath
learned from each AS. In this case, this means a path from AS 100, a
path from AS 300, and a path from AS 500. The <code>show ip bgp 1.1.1.1/32</code>
from r7 has &ldquo;bestpath-from-AS 100&rdquo; so the user can see what the bestpath
is from each AS:</p>

<pre><code>r7# conf t
r7(config)# router bgp 700
r7(config-router)# neighbor 192.0.2.2 addpath-tx-bestpath-per-AS
r7(config-router)# 
</code></pre>

<p>The output below shows the result on r8:</p>

<pre><code>r8# show ip bgp 1.1.1.1/32
BGP routing table entry for 1.1.1.1/32
Paths: (3 available, best #3, table Default-IP-Routing-Table)
  Advertised to non peer-group peers:
  r7(10.7.8.1)
  700 100
    10.7.8.1 from r7(10.7.8.1) (10.0.0.7)
      Origin IGP, localpref 100, valid, external
      Community: 1:1
      AddPath ID: RX 2, TX 4
      Last update: Thu Jun  2 00:57:14 2016
 
  700 300
    10.7.8.1 from r7(10.7.8.1) (10.0.0.7)
      Origin IGP, localpref 100, valid, external
      Community: 3:3
      AddPath ID: RX 4, TX 3
      Last update: Thu Jun  2 00:57:14 2016
 
  700 500
    10.7.8.1 from r7(10.7.8.1) (10.0.0.7)
      Origin IGP, localpref 100, valid, external, bestpath-from-AS 700, best
      Community: 5:5
      AddPath ID: RX 6, TX 2
      Last update: Thu Jun  2 00:57:14 2016
 
r8#
</code></pre>

<p>The example below shows the results if r7 is configured to advertise all
paths to r8:</p>

<pre><code>r7# conf t
r7(config)# router bgp 700
r7(config-router)# neighbor 192.0.2.2 addpath-tx-all-paths       
r7(config-router)#
</code></pre>

<p>The output below shows the result on r8:</p>

<pre><code>r8# show ip bgp 1.1.1.1/32
BGP routing table entry for 1.1.1.1/32
Paths: (3 available, best #3, table Default-IP-Routing-Table)
  Advertised to non peer-group peers:
  r7(10.7.8.1)
  700 100
    10.7.8.1 from r7(10.7.8.1) (10.0.0.7)
      Origin IGP, localpref 100, valid, external
      Community: 1:1
      AddPath ID: RX 2, TX 4
      Last update: Thu Jun  2 00:57:14 2016
 
  700 300
    10.7.8.1 from r7(10.7.8.1) (10.0.0.7)
      Origin IGP, localpref 100, valid, external
      Community: 3:3
      AddPath ID: RX 4, TX 3
      Last update: Thu Jun  2 00:57:14 2016
 
  700 500
    10.7.8.1 from r7(10.7.8.1) (10.0.0.7)
      Origin IGP, localpref 100, valid, external, bestpath-from-AS 700, best
      Community: 5:5
      AddPath ID: RX 6, TX 2
      Last update: Thu Jun  2 00:57:14 2016
 
 
r8#
</code></pre>

<h2 id="span-fast-convergence-design-considerations-span"><span>Fast Convergence Design Considerations</span></h2>

<p>Without getting into the why (see the IETF draft cited in Useful Links
below that talks about BGP use within the data center), we strongly
recommend the following use of addresses in the design of a BGP-based
data center network:</p>

<ul>
<li><p>Use of interface addresses: Set up BGP sessions only using
interface-scoped addresses. This allows BGP to react quickly to link
failures.</p></li>

<li><p>Use of next-hop-self: Every BGP node says that it knows how to
forward traffic to the prefixes it is announcing. This reduces the
requirement to announce interface-specific addresses and thereby
reduces the size of the forwarding table.</p></li>
</ul>

<h3 id="span-specifying-the-interface-name-in-the-neighbor-command-span"><span>Specifying the Interface Name in the neighbor Command</span></h3>

<p>When you are configuring BGP for the neighbors of a given interface, you
can specify the interface name instead of its IP address. All the other
<code>neighbor</code> command options remain the same.</p>

<p>This is equivalent to BGP peering to the link-local IPv6 address of the
neighbor on the given interface. The link-local address is learned via
IPv6 neighbor discovery router advertisements.</p>

<p>Consider the following example configuration:</p>

<pre><code>router bgp 65000
  bgp router-id 0.0.0.1
  neighbor swp1 interface
  neighbor swp1 remote-as internal
  neighbor swp1 next-hop-self
!
  address-family ipv6
  neighbor swp1 activate
  exit-address-family
</code></pre>


<div class="notices note" > <p>By default, Cumulus Linux sends IPv6 neighbor discovery router
advertisements. Cumulus Networks recommends you adjust the router
advertisement&rsquo;s interval to a shorter value (<code>ipv6 nd ra-interval
&lt;interval&gt;</code>) to address scenarios when nodes come up and miss router
advertisement processing to relay the neighbor’s link-local address to
BGP. The <code>interval</code> is measured in seconds and defaults to 600 seconds.</p>
 </div>


<h2 id="span-id-src-5122130-bordergatewayprotocol-bgp-peergroups-class-confluence-anchor-link-span-span-using-peer-groups-to-simplify-configuration-span"><span id="src-5122130_BorderGatewayProtocol-BGP-peergroups" class="confluence-anchor-link"></span><span>Using Peer Groups to Simplify Configuration</span></h2>

<p>When there are many peers to connect to, the amount of redundant
configuration becomes overwhelming. For example, repeating the
<code>activate</code> and <code>next-hop-self</code> commands for even 60 neighbors makes for
a very long configuration file. Using <code>peer-group</code> addresses this
problem.</p>

<p>Instead of specifying properties of each individual peer, Quagga allows
for defining one or more peer groups and associating all the attributes
common to that peer session to a peer group. A peer needs to be attached
to a peer group only once, when it then inherits all address families
activated for that peer group.</p>

<p>After doing this, the only task is to associate an IP address with a
peer group. Here is an example of defining and using peer groups:</p>

<pre><code>R7(config-router)# neighbor tier-2 peer-group
R7(config-router)# address-family ipv4 unicast
R7(config-router-af)# neighbor tier-2 activate
R7(config-router-af)# neighbor tier-2 next-hop-self
R7(config-router-af)# exit
R7(config-router)# neighbor 10.0.0.2 peer-group tier-2
R7(config-router)# neighbor 192.0.2.2 peer-group tier-2
</code></pre>


<div class="notices note" > <p>BGP peer-group restrictions have been replaced with update-groups, which
dynamically examine all peers, and group them if they have the same
outbound policy.</p>
 </div>


<h2 id="span-configuring-bgp-dynamic-neighbors-span"><span>Configuring BGP Dynamic Neighbors</span></h2>

<p>The <em>BGP dynamic neighbor</em> feature provides BGP peering to a group of
remote neighbors within a specified range of IPv4 or IPv6 addresses for
a BGP peer group. You can configure each range as a subnet IP address.</p>

<p>You configure dynamic neighbors using the <code>bgp listen range &lt;IP address&gt;
peer-group &lt;GROUP&gt;</code> command. Once they are configured, a BGP speaker can
listen for and form peer relationships with any neighbor in the IP
address range and mapped to a peer group.</p>

<pre><code>leaf01# configure terminal
leaf01(config)# router bgp 65001
leaf01(config-router)# bgp listen range 10.1.1.0/24 peer-group SPINE
</code></pre>

<p>You can limit the number of dynamic peers by specifying that limit in
the <code>bgp listen limit</code> command:</p>

<pre><code>leaf01(config-router)# bgp listen limit 5
</code></pre>

<p>A sample configuration for IPv4 would look like this:</p>

<pre><code>router bgp 65001
 neighbor SPINE peer-group
 neighbor SPINE remote-as 65000
  bgp listen limit 5
  bgp listen range 10.1.1.0/24 peer-group SPINE
</code></pre>

<h2 id="span-configuring-bgp-peering-relationships-across-switches-span"><span>Configuring BGP Peering Relationships across Switches</span></h2>

<p>A BGP peering relationship is typically initiated with the <code>neighbor
x.x.x.x remote-as [internal|external]</code> command.</p>

<p>Specifying <em>internal</em> signifies an iBGP peering; that is, the neighbor
will only create or accept a connection with the specified neighbor if
the remote peer AS number matches this BGP&rsquo;s AS number.</p>

<p>Specifying <em>external</em> signifies an eBGP peering; that is, the neighbor
will only create a connection with the neighbor if the remote peer AS
number does <strong>not</strong> match this BGP AS number.</p>

<p>You can make this distinction using the <code>neighbor</code> command or the
<code>peer-group</code> command.</p>

<p>In general, use the following syntax with the <code>neighbor</code> command:</p>

<pre><code>neighbor (ipv4 addr|ipv6 addr|WORD) remote-as [internal|external]
</code></pre>

<p>Some example configurations follow.</p>

<p>To connect to <strong>the same AS</strong> using the <code>neighbor</code> command, modify your
configuration similar to the following:</p>

<pre><code>router bgp 500
neighbor 192.168.1.2 remote-as internal
</code></pre>

<p>To connect to a <strong>different AS</strong> using the <code>neighbor</code> command, modify
your configuration similar to the following:</p>

<pre><code>router bgp 500
neighbor 192.168.1.2 remote-as external
</code></pre>

<p>To connect to <strong>the same AS</strong> using the <code>peer-group</code> command, modify
your configuration similar to the following:</p>

<pre><code>router bgp 500
neighbor swp1 interface
neighbor IBGP peer-group
neighbor IBGP remote-as internal
neighbor swp1 peer-group IBGP
neighbor 192.0.2.3 peer-group IBGP
neighbor 192.0.2.4 peer-group IBGP
</code></pre>

<p>To connect to a <strong>different AS</strong> using the <code>peer-group</code> command, modify
your configuration similar to the following:</p>

<pre><code>router bgp 500
neighbor swp2 interface
neighbor EBGP peer-group
neighbor EBGP remote-as external
neighbor 192.0.2.2 peer-group EBGP
neighbor swp2 peer-group EBGP
neighbor 192.0.2.4 peer-group EBGP
</code></pre>

<h2 id="span-configure-md5-enabled-bgp-neighbors-span"><span>Configure MD5-enabled BGP Neighbors</span></h2>

<p>The following sections outline how to configure an MD5-enabled bgp
neighbor, either using the Quagga CLI vtysh, or by manually editing the
configuration files. Each process assumes that Quagga is used as the
routing platform, and consists of two switches (<code>AS 65000</code> and
<code>AS 65001</code>), connected by the link <code>192.0.2.100/30</code>, with the following
configurations:</p>

<pre><code>quagga# show ip bgp sum
BGP router identifier 192.0.2.5, local AS number 65000
RIB entries 0, using 0 bytes of memory
Peers 1, using 6652 bytes of memory
Neighbor V AS MsgRcvd MsgSent TblVer InQ OutQ Up/Down State/PfxRcd
192.0.2.101 4 65001 2 3 0 0 0 00:00:04 0
Total number of neighbors 1

quagga# show ip bgp sum
BGP router identifier 192.0.2.2, local AS number 65001
RIB entries 0, using 0 bytes of memory
Peers 1, using 6652 bytes of memory
Neighbor V AS MsgRcvd MsgSent TblVer InQ OutQ Up/Down State/PfxRcd
192.0.2.102 4 65000 2 3 0 0 0 00:00:04 0
Total number of neighbors 1
</code></pre>

<h3 id="span-manually-configure-an-md5-enabled-bgp-neighbor-span"><span>Manually configure an MD5-enabled BGP Neighbor</span></h3>

<ol>
<li><p>SSH into <code>switch1</code>.</p></li>

<li><p>Open <code>Quagga.conf</code> in a text editor.</p></li>

<li><p>Add the line <code>neighbor 192.0.2.102 password mypassword</code>below the
BGP configuration lines, and save the file:</p>

<pre><code>router bgp 65001
bgp router-id 192.0.2.5
neighbor 192.0.2.102 remote-as 65000
192.0.2.102 password mypassword
</code></pre></li>

<li><p>Restart Quagga:</p>

<pre><code>cumulus@switch1:~$ systemctl restart quagga
</code></pre>


<div class="notices warning" > <pre><code>This will bring down any other layer 3 sessions and affect network
traffic.
</code></pre>
 </div>
</li>

<li><p>Confirm the configuration has been implemented with the <code>cl-bgp
summary</code> command:</p>

<pre><code>cumulus@switch1:~$ sudo cl-bgp summary 
BGP router identifier 192.0.2.5, local AS number 65000
RIB entries 0, using 0 bytes of memory
Peers 1, using 6652 bytes of memory
 
Neighbor        V    AS MsgRcvd MsgSent   TblVer  InQ OutQ Up/Down  State/PfxRcd
192.0.2.101     4 65001     200     227        0    0    0 00:00:03        0
 
Total number of neighbors 1
</code></pre></li>

<li><p>SSH into <code>switch2</code>.</p></li>

<li><p>Open <code>Quagga.conf</code> in a text editor.</p></li>

<li><p>Add the line <code>neighbor 192.0.2.101 password mypassword</code>below the
BGP configuration lines, and save the file:</p>

<pre><code>router bgp 65000
bgp router-id 192.0.2.2
neighbor 192.0.2.101 remote-as 65001
neighbor 192.0.2.101 password mypassword 
</code></pre></li>

<li><p>Restart Quagga:</p>

<pre><code>cumulus@switch1:~$ systemctl restart quagga
</code></pre>


<div class="notices warning" > <pre><code>This will bring down any other layer 3 sessions and affect network
traffic.
</code></pre>
 </div>
</li>

<li><p>Confirm the configuration has been implemented with the <code>cl-bgp
summary</code> command:</p>

<pre><code>BGP router identifier 192.0.2.2, local AS number 65001
RIB entries 0, using 0 bytes of memory
Peers 1, using 6652 bytes of memory
 
Neighbor        V    AS MsgRcvd MsgSent   TblVer  InQ OutQ Up/Down  State/PfxRcd
192.0.2.102     4 65000     255     282        0    0    0 00:06:29        0
 
Total number of neighbors 1
</code></pre></li>
</ol>

<h3 id="span-configure-an-md5-enabled-bgp-neighbor-using-vtysh-span"><span>Configure an MD5-enabled BGP Neighbor using vtysh</span></h3>

<ol>
<li><p>SSH into <code>switch1</code>.</p></li>

<li><p>Start the <code>vtysh</code> CLI:</p>

<pre><code>cumulus@switch1:~$ sudo vtysh
</code></pre></li>

<li><p>Run the following commands in the Quagga CLI, replacing <code>mypassword</code>
as appropriate:</p>

<pre><code>quagga# configure terminal
quagga(config)# router bgp 65001
quagga(config-router)# neighbor 192.0.2.102 password mypassword
</code></pre></li>

<li><p>SSH into <code>switch2</code>.</p></li>

<li><p>Start the <code>vtysh</code> CLI:</p>

<pre><code>cumulus@switch2:~$ sudo vtysh
</code></pre></li>

<li><p>Run the following commands in the Quagga CLI, replacing <code>mypassword</code>
as appropriate:</p>

<pre><code>quagga# configure terminal
quagga(config)# router bgp 65000
quagga(config-router)# neighbor 192.0.2.101 password mypassword
</code></pre></li>

<li><p>When both sides are configured properly, BGP should reestablish
automatically. Confirm that this is the case using the <code>show ip bgp
summary</code> command. The output below is from <code>switch1</code>:</p>

<pre><code>quagga# show ip bgp summary  
BGP router identifier 192.0.2.5, local AS number 65000
RIB entries 0, using 0 bytes of memory
Peers 1, using 6652 bytes of memory
 
Neighbor        V    AS MsgRcvd MsgSent   TblVer  InQ OutQ Up/Down  State/PfxRcd
192.0.2.101     4 65001     257     284        0    0    0 00:08:11        0
 
Total number of neighbors 1
</code></pre></li>

<li><p>Once Quagga is configured correctly, run the <code>write memory</code> command
on each switch to persist the changes after Quagga is next
restarted.</p></li>
</ol>

<h2 id="span-configure-bgp-ttl-security-span"><span>Configure BGP TTL Security</span></h2>

<p>The steps below cover how to configure BGP ttl security on Cumulus
Linux, using a leaf (<code>leaf01</code>), and spine (<code>spine01</code>) for the example
output:</p>

<ol>
<li><p>SSH into <code>leaf01</code>.</p></li>

<li><p>Run the Quagga CLI <code>vtysh</code>:</p>

<pre><code>cumulus@leaf01:~$ sudo vtysh
</code></pre></li>

<li><p>Configure <code>leaf01</code> for ttl security:</p>

<pre><code>leaf01# configure terminal
leaf01(config)# router bgp 65000
leaf01(config-router)# neighbor [spine01-IP] ttl-security hops [value]
</code></pre></li>

<li><p>SSH into <code>spine01</code>.</p></li>

<li><p>Run the Quagga CLI <code>vtysh</code>:</p>

<pre><code>cumulus@spine01:~$ sudo vtysh
</code></pre></li>

<li><p>Configure <code>spine01</code>:</p>

<pre><code>spine01# configure terminal
spine01(config)# router bgp 65001
spine01(config-router)# neighbor [leaf01-IP] ttl-security hops [value]
</code></pre></li>
</ol>

<p>BGP ttl security is now configured. To review the resulting
configuration, run the <code>show ip bgp neighbor</code> command.</p>

<p><summary>Example show ip bgp neighbor output </summary></p>

<pre><code>spine01#show ip bgp neighbor
BGP neighbor is 10.1.2.1, remote AS 65001, local AS 65002, external link
Hostname: leaf02
BGP version 4, remote router ID 1.1.1.2
BGP state = Established, up for 00:01:23
Last read 00:00:02, Last write 00:01:23
Hold time is 9, keepalive interval is 3 seconds
Neighbor capabilities:
4 Byte AS: advertised and received
AddPath:
IPv4 Unicast: RX advertised IPv4 Unicast and received
Route refresh: advertised and received(old &amp; new)
Address family IPv4 Unicast: advertised and received
Hostname Capability: advertised and received
Graceful Restart Capabilty: advertised and received
Remote Restart timer is 120 seconds
Address families by peer:
none
Graceful restart informations:
End-of-RIB send: IPv4 Unicast
End-of-RIB received: IPv4 Unicast
Message statistics:
Inq depth is 0
Outq depth is 0
Sent Rcvd
Opens: 32 2
Notifications: 31 0
Updates: 2 2
Keepalives: 51 49
Route Refresh: 0 0
Capability: 0 0
Total: 116 53
Minimum time between advertisement runs is 0 seconds
For address family: IPv4 Unicast
Update group 2, subgroup 2
Packet Queue length 0
Community attribute sent to this neighbor(both)
0 accepted prefixes
Connections established 2; dropped 1
Last reset 00:06:35, due to NOTIFICATION sent (Hold Timer Expired)
External BGP neighbor may be up to 1 hops away.
Local host: 10.1.2.2, Local port: 53059
Foreign host: 10.1.2.1, Foreign port: 179
Nexthop: 10.1.2.2
Nexthop global: fe80::4638:39ff:fe00:2f
Nexthop local: fe80::4638:39ff:fe00:2f
BGP connection: shared network
BGP Connect Retry Timer in Seconds: 10
Read thread: on Write thread: off
</code></pre>

<h2 id="span-configuration-tips-span"><span>Configuration Tips</span></h2>

<h3 id="span-bgp-advertisement-best-practices-span"><span>BGP Advertisement Best Practices</span></h3>

<p>Limiting the exchange of routing information at various parts in the
network is a best practice you should follow. The following image
illustrates one way you can do so in a typical Clos architecture:</p>








<img class = "confluence-embedded-image" src = "/images/download/attachments/5122130/BGP-Advertisement-Best-Practices.png" alt = "/images/download/attachments/5122130/BGP-Advertisement-Best-Practices.png"

height = 400


 />


<h3 id="span-utilizing-multiple-routing-tables-and-forwarding-span"><span>Utilizing Multiple Routing Tables and Forwarding</span></h3>

<p>You can run multiple routing tables (one for in-band/data plane traffic
and one for out-of-band/management plane traffic) on the same switch
using <a href="/version/cumulus-linux-31/Layer-3-Features/Management-VRF">management
VRF</a>
(multiple routing tables and forwarding).</p>

<h3 id="span-additional-default-settings-span"><span>Additional Default Settings</span></h3>

<p>Other default settings not discussed in detail in this chapter include
the following; they&rsquo;re all enabled by default:</p>

<ul>
<li><p><code>bgp deterministic-med</code>, which ensures path ordering no longer
impacts bestpath selection.</p></li>

<li><p><code>bgp show-hostname</code>, which displays the hostname in show command
output.</p></li>

<li><p><code>bgp network import-check</code>, which enables the advertising of the BGP
network in IGP.</p></li>
</ul>

<h3 id="span-configuring-bgp-neighbor-maximum-prefixes-span"><span>Configuring BGP Neighbor maximum-prefixes</span></h3>

<p>The maximum number of route announcements, or prefixes, allowed by a BGP
neighbor can be configured uding the <code>maximum-prefixes</code> command in the
CLI. Replace the <code>PEER</code> input with the relevant peer, and replace
<code>NUMBER</code> with the maximum number of prefixes desired:</p>

<pre><code>quagga(config)# neighbor PEER maximum-prefix NUMBER
</code></pre>

<h2 id="span-troubleshooting-bgp-span"><span>Troubleshooting BGP</span></h2>

<p>The most common starting point for troubleshooting BGP is to view the
summary of neighbors connected to and some information about these
connections. A sample output of this command is as follows:</p>

<pre><code>R7# show ip bgp summary
BGP router identifier 10.0.0.21, local AS number 65020 vrf-id 0
BGP table version 15
RIB entries 17, using 2040 bytes of memory
Peers 6, using 97 KiB of memory
Peer groups 1, using 56 bytes of memory
 
Neighbor        V    AS MsgRcvd MsgSent   TblVer  InQ OutQ Up/Down  State/PfxRcd
leaf01(swp1)    4 65011    2684    2693        0    0    0 02:14:04        2
leaf02(swp2)    4 65012    2684    2694        0    0    0 02:14:05        2
leaf03(swp3)    4 65013    2684    2693        0    0    0 02:14:04        2
leaf04(swp4)    4 65014    2684    2694        0    0    0 02:14:05        2
edge01(swp29)   4 65051    8058    8054        0    0    0 02:14:06        3
edge01(swp30)   4 65051    8055    8052        0    0    0 02:14:04        3
 
Total number of neighbors 6
</code></pre>


<div class="notices tip" > <p>You can determine whether the sessions above are iBGP or eBGP sessions
by looking at the ASNs.</p>
 </div>


<p>It is also useful to view the routing table as defined by BGP:</p>

<pre><code>R7# show ip bgp
BGP table version is 15, local router ID is 10.0.0.21
Status codes: s suppressed, d damped, h history, * valid, &gt; best, = multipath,
              i internal, r RIB-failure, S Stale, R Removed
Origin codes: i - IGP, e - EGP, ? - incomplete
 
   Network          Next Hop            Metric LocPrf Weight Path
*= 0.0.0.0          swp30                         0 65051 i
*&gt;                  swp29                         0 65051 i
*&gt; 10.0.0.1/32      swp29                         0 65051 65001 i
*=                  swp30                         0 65051 65001 i
*&gt; 10.0.0.11/32     swp1            0             0 65011 i
*&gt; 10.0.0.12/32     swp2            0             0 65012 i
*&gt; 10.0.0.13/32     swp3            0             0 65013 i
*&gt; 10.0.0.14/32     swp4            0             0 65014 i
*&gt; 10.0.0.21/32     0.0.0.0                  0         32768 i
*= 10.0.0.51/32     swp30           0             0 65051 i
*&gt;                  swp29           0             0 65051 i
*&gt; 172.16.1.0/24    swp1            0             0 65011 i
*=                  swp2            0             0 65012 i
*&gt; 172.16.3.0/24    swp3            0             0 65013 i
*=                  swp4            0             0 65014 i
 
Total number of prefixes 10
</code></pre>

<p>A more detailed breakdown of a specific neighbor can be obtained using
<code>show ip bgp neighbor &lt;neighbor ip address&gt;</code>:</p>

<pre><code>R7# show ip bgp  neighbor 10.0.0.2
BGP neighbor is 10.0.0.2, remote AS 65000, local AS 65000, internal link
BGP version 4, remote router ID 0.0.0.5
BGP state = Established, up for 00:14:03
Last read 14:52:31, hold time is 18, keepalive interval is 6 seconds
Neighbor capabilities:
  4 Byte AS: advertised and received
  Route refresh: advertised and received(old &amp; new)
  Address family IPv4 Unicast: advertised and received
Message statistics:
  Inq depth is 0
  Outq depth is 0
                       Sent       Rcvd
  Opens:                  1          1
  Notifications:          0          0
  Updates:                1          3
  Keepalives:            16         15
  Route Refresh:          0          0
  Capability:             0          0
  Total:                 18         19
Minimum time between advertisement runs is 5 seconds
 
For address family: IPv4 Unicast
  NEXT_HOP is always this router
  Community attribute sent to this neighbor(both)
  3 accepted prefixes
 
  Connections established 1; dropped 0
  Last reset never
Local host: 10.0.0.1, Local port: 35258
Foreign host: 10.0.0.2, Foreign port: 179
Nexthop: 10.0.0.1
Nexthop global: fe80::202:ff:fe00:19
Nexthop local: ::
BGP connection: non shared network
Read thread: on  Write thread: off
</code></pre>

<p>To see the details of a specific route such as from whom it was
received, to whom it was sent, and so forth, use the <code>show ip bgp &lt;ip
address/prefix&gt;</code> command:</p>

<pre><code>R7# show ip bgp 192.0.2.0
BGP routing table entry for 192.0.2.0/24
Paths: (2 available, best #1, table Default-IP-Routing-Table)
  Not advertised to any peer
  Local
    10.0.0.2 (metric 1) from 10.0.0.2 (0.0.0.10)
      Origin IGP, metric 0, localpref 100, valid, internal, best
      Originator: 0.0.0.10, Cluster list: 0.0.0.5
      Last update: Mon Jul  8 10:12:17 2013
  Local
    192.0.2.2 (metric 1) from 192.0.2.2 (0.0.0.10)
      Origin IGP, metric 0, localpref 100, valid, internal
      Originator: 0.0.0.10, Cluster list: 0.0.0.6
      Last update: Mon Jul  8 10:12:17 2013
</code></pre>

<p>This shows that the routing table prefix seen by BGP is 192.0.2.0/24,
that this route was not advertised to any neighbor, and that it was
heard by two neighbors, <em>10.0.0.2</em> and <em>192.0.2.2</em>.</p>

<p>Here is another output of the same command, on a different node in the
network:</p>

<pre><code>cumulus@switch:~$ sudo vtysh -c 'sh ip bgp 192.0.2.0'
BGP routing table entry for 192.0.2.0/24
Paths: (1 available, best #1, table Default-IP-Routing-Table)
  Advertised to non peer-group peers:
  10.0.0.1 192.0.2.21 192.0.2.22
  Local, (Received from a RR-client)
    203.0.113.1 (metric 1) from 203.0.113.1 (0.0.0.10)
      Origin IGP, metric 0, localpref 100, valid, internal, best
      Last update: Mon Jul  8 09:07:41 2013
</code></pre>

<h3 id="span-debugging-tip-logging-neighbor-state-changes-span"><span>Debugging Tip: Logging Neighbor State Changes</span></h3>

<p>It is very useful to log the changes that a neighbor goes through to
troubleshoot any issues associated with that neighbor. This is done
using the <code>log-neighbor-changes</code> command, which is enabled by default:</p>

<pre><code>R7(config-router)# bgp log-neighbor-changes
</code></pre>

<p>The output is sent to the specified log file, usually
<code>/var/log/quagga/bgpd.log</code>, and looks like this:</p>

<pre><code>2016/07/08 10:12:06.572827 BGP: %NOTIFICATION: sent to neighbor 10.0.0.2 6/3 (Cease/Peer Unconfigured) 0 bytes
2016/07/08 10:12:06.572954 BGP: Notification sent to neighbor 10.0.0.2: type 6/3
2016/07/08 10:12:16.682071 BGP: %ADJCHANGE: neighbor 192.0.2.2 Up
2016/07/08 10:12:16.682660 BGP: %ADJCHANGE: neighbor 10.0.0.2 Up
</code></pre>

<h3 id="span-troubleshooting-link-local-addresses-span"><span>Troubleshooting Link-local Addresses</span></h3>

<p>To verify that <code>quagga</code> learned the neighboring link-local IPv6 address
via the IPv6 neighbor discovery router advertisements on a given
interface, use the <code>show interface &lt;if-name&gt;</code> command. If <code>ipv6 nd
suppress-ra</code> isn&rsquo;t enabled on both ends of the interface, then <code>Neighbor
address(s):</code> should have the other end&rsquo;s link-local address. That is the
address that BGP would use when BGP is enabled on that interface.</p>


<div class="notices note" > <p>IPv6 route advertisements (RAs) are automatically enabled on an
interface with IPv6 addresses, so the step <code>no ipv6 nd suppress-ra</code> is
no longer needed for BGP unnumbered. The timer interval for RAs remains
600s, which may need to be adjusted to bring up peers quickly.</p>
 </div>


<p>Use <code>vtysh</code> to verify the configuration:</p>

<pre><code>cumulus@switch:~$ sudo vtysh
 
Hello, this is Quagga (version 0.99.23.1+cl3u2).
Copyright 1996-2005 Kunihiro Ishiguro, et al.
 
R7# show interface swp1
Interface swp1 is up, line protocol is up
  Link ups:       0    last: (never)
  Link downs:     0    last: (never)
  PTM status: disabled
  vrf: Default-IP-Routing-Table
  index 4 metric 0 mtu 1500 
  flags: &lt;UP,BROADCAST,RUNNING,MULTICAST&gt;
  HWaddr: 44:38:39:00:00:5c
  inet6 fe80::4638:39ff:fe00:5c/64
  ND advertised reachable time is 0 milliseconds
  ND advertised retransmit interval is 0 milliseconds
  ND router advertisements are sent every 10 seconds
  ND router advertisements lifetime tracks ra-interval
  ND router advertisement default router preference is medium
  Hosts use stateless autoconfig for addresses.
  Neighbor address(s):
  inet6 fe80::4638:39ff:fe00:5b/128
</code></pre>

<p>Instead of the IPv6 address, the peering interface name is displayed in
the <code>show ip bgp summary</code> command and wherever else applicable:</p>

<pre><code>R7# show ip bgp summary
BGP router identifier 10.0.0.21, local AS number 65020 vrf-id 0
BGP table version 15
RIB entries 17, using 2040 bytes of memory
Peers 6, using 97 KiB of memory
Peer groups 1, using 56 bytes of memory
 
Neighbor        V    AS MsgRcvd MsgSent   TblVer  InQ OutQ Up/Down  State/PfxRcd
leaf01(swp1)    4 65011    2834    2843        0    0    0 02:21:35        2
leaf02(swp2)    4 65012    2834    2844        0    0    0 02:21:36        2
leaf03(swp3)    4 65013    2834    2843        0    0    0 02:21:35        2
leaf04(swp4)    4 65014    2834    2844        0    0    0 02:21:36        2
edge01(swp29)   4 65051    8509    8505        0    0    0 02:21:37        3
edge01(swp30)   4 65051    8506    8503        0    0    0 02:21:35        3
 
Total number of neighbors 6
</code></pre>

<p>Most of the show commands can take the interface name instead of the IP
address, if that level of specificity is needed:</p>

<pre><code>R7# show ip bgp neighbors ?
  &lt;cr&gt;      
  A.B.C.D   Neighbor to display information about
  WORD      Neighbor on bgp configured interface
  X:X::X:X  Neighbor to display information about
  json      JavaScript Object Notation

R7# show ip bgp neighbors swp1
BGP neighbor on swp1: fe80::4638:39ff:fe00:5b, remote AS 65011, local AS 65020, external link
Hostname: leaf01
 Member of peer-group fabric for session parameters
  BGP version 4, remote router ID 10.0.0.11
  BGP state = Established, up for 02:23:10
  Last read 00:00:01, Last write 02:23:09
  Hold time is 9, keepalive interval is 3 seconds
  Neighbor capabilities:
    4 Byte AS: advertised and received
    AddPath:
      IPv4 Unicast: RX advertised IPv4 Unicast and received
    Extended nexthop: advertised and received
      Address families by peer:
                   IPv4 Unicast
    Route refresh: advertised and received(old &amp; new)
    Address family IPv4 Unicast: advertised and received
    Hostname Capability: advertised and received
    Graceful Restart Capabilty: advertised and received
      Remote Restart timer is 120 seconds
      Address families by peer:
        none
  Graceful restart informations:
    End-of-RIB send: IPv4 Unicast
    End-of-RIB received: IPv4 Unicast
  Message statistics:
    Inq depth is 0
    Outq depth is 0
                         Sent       Rcvd
    Opens:                  1          1
    Notifications:          0          0
    Updates:               10          2
    Keepalives:          2864       2863
    Route Refresh:          0          0
    Capability:             0          0
    Total:               2875       2866
  Minimum time between advertisement runs is 0 seconds
 For address family: IPv4 Unicast
  fabric peer-group member
  Update group 1, subgroup 1
  Packet Queue length 0
  Community attribute sent to this neighbor(both)
  Inbound path policy configured
  Outbound path policy configured
  Incoming update prefix filter list is *dc-spine
  Outgoing update prefix filter list is *dc-spine
  2 accepted prefixes
  Connections established 1; dropped 0
  Last reset never
Local host: fe80::4638:39ff:fe00:5c, Local port: 43327
Foreign host: fe80::4638:39ff:fe00:5b, Foreign port: 179
Nexthop: 10.0.0.21
Nexthop global: fe80::4638:39ff:fe00:5c
Nexthop local: fe80::4638:39ff:fe00:5c
BGP connection: shared network
Read thread: on  Write thread: off
</code></pre>

<h2 id="span-enabling-read-only-mode-span"><span>Enabling Read-only Mode</span></h2>

<p>You can enable read-only mode for when the BGP process restarts or when
the BGP process is cleared using <code>clear ip bgp *</code>. When enabled,
read-only mode begins as soon as the first peer reaches its
<em>established</em> state and a timer for <code>&lt;max-delay&gt;</code> seconds is started.</p>

<p>While in read-only mode, BGP doesn&rsquo;t run best-path or generate any
updates to its peers. This mode continues until:</p>

<ul>
<li><p>All the configured peers, except the shutdown peers, have sent an
explicit EOR (End-Of-RIB) or an implicit EOR. The first keep-alive
after BGP has reached the established state is considered an
implicit EOR. If the <code>&lt;establish-wait&gt;</code> option is specified, then
BGP will wait for peers to reach the established state from the
start of the <code>update-delay</code> until the <code>&lt;establish-wait&gt;</code> period is
over; that is, the minimum set of established peers for which EOR is
expected would be peers established during the <code>establish-wait</code>
window, not necessarily all the configured neighbors.</p></li>

<li><p>The <code>max-delay</code> period is over.</p></li>
</ul>

<p>Upon reaching either of these two conditions, BGP resumes the decision
process and generates updates to its peers.</p>

<p>To enable read-only mode:</p>

<pre><code>cumulus@switch:$ sudo bgp update-delay &lt;max-delay in seconds&gt; [&lt;establish-wait in seconds&gt;]
</code></pre>

<p>The default <code>&lt;max-delay&gt;</code> is 0 — the feature is off by default.</p>

<p>Use output from <code>show ip bgp summary</code> for information about the state of
the update delay.</p>

<p>This feature can be useful in reducing CPU/network usage as BGP
restarts/clears. It&rsquo;s particularly useful in topologies where BGP learns
a prefix from many peers. Intermediate best paths are possible for the
same prefix as peers get established and start receiving updates at
different times. This feature is also valuable if the network has a high
number of such prefixes.</p>

<h2 id="span-applying-a-route-map-for-route-updates-span"><span>Applying a Route Map for Route Updates</span></h2>

<p>You can apply a route map on route updates from BGP to Zebra. All the
applicable match operations are allowed, such as match on prefix,
next-hop, communities, and so forth. Set operations for this
attach-point are limited to metric and next-hop only. Any operation of
this feature does not affect BGPs internal RIB.</p>

<p>Both IPv4 and IPv6 address families are supported. Route maps work on
multi-paths as well. However, the metric setting is based on the best
path only.</p>

<p>To apply a route map for route updates:</p>

<pre><code>cumulus@switch:$ sudo cl-bgp table-map &lt;route-map-name&gt;
</code></pre>

<h2 id="span-protocol-tuning-span"><span>Protocol Tuning</span></h2>

<h3 id="span-converging-quickly-on-link-failures-span"><span>Converging Quickly On Link Failures</span></h3>

<p>In the Clos topology, we recommend that you only use interface addresses
to set up peering sessions. This means that when the link fails, the BGP
session is torn down immediately, triggering route updates to propagate
through the network quickly. This requires the following commands be
enabled for all links: <code>link-detect</code> and <code>ttl-security hops &lt;hops&gt;</code>.
<code>ttl-security hops</code> specifies how many hops away the neighbor is. For
example, in a Clos topology, every peer is at most 1 hop away.</p>


<div class="notices note" > <p>See Caveats and Errata below for information regarding <code>ttl-security
hops</code>.</p>
 </div>


<p>Here is an example:</p>

<pre><code>cumulus@switch:~$ sudo vtysh
 
Hello, this is Quagga (version 0.99.23.1+cl3u2).
Copyright 1996-2005 Kunihiro Ishiguro, et al.
 
R7# configure terminal
R7(config)# interface swp1
R7(config-if)# link-detect
R7(config-if)# exit
R7(config)# router bgp 65000
R7(config-router)# neighbor 10.0.0.2 ttl-security hops 1
</code></pre>

<h3 id="span-converging-quickly-on-soft-failures-span"><span>Converging Quickly On Soft Failures</span></h3>

<p>It is possible that the link is up, but the neighboring BGP process is
hung or has crashed. If a BGP process crashes, Quagga’s <code>watchquagga</code>
daemon, which monitors the various <code>quagga</code> daemons, will attempt to
restart it. If the process is also hung, <code>watchquagga</code> will attempt to
restart the process. BGP itself has a keepalive timer that is exchanged
between neighbors. By default, this keepalive timer is set to 3 seconds.
This time can be increased to a higher number, which decreases CPU load,
especially in the presence of a lot of neighbors. <code>keepalive-time</code> is
the periodicity with which the keepalive message is sent. <code>hold-time</code>
specifies how many keepalive messages can be lost before the connection
is considered invalid. It is usually set to 3 times the keepalive time,
so it defaults to 9 seconds. Here is an example of changing these
timers:</p>

<pre><code>R7(config-router)# neighbor 10.0.0.2 timers 10 30
</code></pre>

<p>You can make these the default for all BGP neighbors using a different
command:</p>

<pre><code>R7(config-router)# timers bgp 10 30
</code></pre>

<p>The following display snippet shows that the default values have been
modified for this neighbor:</p>

<pre><code>R7(config-router)# do show ip bgp neighbor 10.0.0.2
BGP neighbor is 10.0.0.2, remote AS 65000, local AS 65000, internal link
  BGP version 4, remote router ID 0.0.0.5
  BGP state = Established, up for 05:53:59
  Last read 14:53:25, hold time is 18, keepalive interval is 3 seconds
  Configured hold time is 9, keepalive interval is 3 seconds
  ....
</code></pre>


<div class="notices tip" > <p>When you&rsquo;re in a configuration mode, such as when you&rsquo;re configuring BGP
parameters, you can run any show command by adding <code>do</code> to the original
command. For example, <code>do show ip bgp neighbor</code> was shown above. Under a
non-configuration mode, you&rsquo;d simply run:</p>

<pre><code>R7# show ip bgp neighbor 10.0.0.2
</code></pre>
 </div>


<h3 id="span-reconnecting-quickly-span"><span>Reconnecting Quickly</span></h3>

<p>A BGP process attempts to connect to a peer after a failure (or on
startup) every <code>connect-time</code> seconds. By default, this is 10 seconds.
To modify this value, use:</p>

<pre><code>R7(config-router)# neighbor 10.0.0.2 timers connect 30
</code></pre>

<p>This command has to be specified per each neighbor, peer-group doesn’t
support this option in <code>quagga</code>.</p>

<h3 id="span-advertisement-interval-span"><span>Advertisement Interval</span></h3>

<p>BGP by default chooses stability over fast convergence. This is very
useful when routing for the Internet. For example, unlike link-state
protocols, BGP typically waits for a duration of
<code>advertisement-interval</code> seconds between sending consecutive updates to
a neighbor. This ensures that an unstable neighbor flapping routes won’t
be propagated throughout the network. By default, this is set to 0
seconds for both eBGP and iBGP sessions, which allows for very fast
convergence. You can modify this as follows:</p>

<pre><code>R7(config-router)# neighbor 10.0.0.2 advertisement-interval 5
</code></pre>

<p>The following output shows the modified value:</p>

<pre><code>R7(config-router)# do show ip bgp neighbor 10.0.0.2
BGP neighbor is 10.0.0.2, remote AS 65000, local AS 65000, internal link
  BGP version 4, remote router ID 0.0.0.5
  BGP state = Established, up for 06:01:49
  Last read 14:53:15, hold time is 18, keepalive interval is 6 seconds
  Configured hold time is 9, keepalive interval is 3 seconds
Neighbor capabilities:
  4 Byte AS: advertised and received
  Route refresh: advertised and received(old &amp; new)
  Address family IPv4 Unicast: advertised and received
Message statistics:
  Inq depth is 0
  Outq depth is 0
                       Sent       Rcvd
  Opens:                  1          1
  Notifications:          0          0
  Updates:                1          3
  Keepalives:           363        362
  Route Refresh:          0          0
  Capability:             0          0
  Total:                365        366
Minimum time between advertisement runs is 5 seconds
....
</code></pre>


<div class="notices note" > <p>This command is not supported with peer-groups.</p>
 </div>


<p>See this <a href="http://tools.ietf.org/html/draft-jakma-mrai-02" target="_blank">IETF draft</a>
for more details on the use of this value.</p>

<h2 id="span-configuration-files-span"><span>Configuration Files</span></h2>

<ul>
<li>/etc/quagga/bgpd.conf</li>
</ul>

<h2 id="span-useful-links-span"><span>Useful Links</span></h2>

<ul>
<li><p><a href="/version/cumulus-linux-31/Layer-3-Features/Bidirectional-Forwarding-Detection---BFD">Bidirectional forwarding
detection</a>
(BFD) and BGP</p></li>

<li><p><a href="http://en.wikipedia.org/wiki/Border_Gateway_Protocol" target="_blank">Wikipedia entry for
BGP</a> (includes
list of useful RFCs)</p></li>

<li><p><a href="http://www.nongnu.org/quagga/docs/docs-info.html#BGP" target="_blank">Quagga online documentation for
BGP</a> (may not
be up to date)</p></li>

<li><p><a href="http://tools.ietf.org/html/draft-lapukhov-bgp-routing-large-dc-04" target="_blank">IETF draft discussing BGP use within data
centers</a></p></li>
</ul>

<h2 id="span-caveats-and-errata-span"><span>Caveats and Errata</span></h2>

<h3 id="span-ttl-security-issue-span"><span>ttl-security Issue</span></h3>

<p>Enabling <code>ttl-security</code> does not cause the hardware to be programmed
with the relevant information. This means that frames will come up to
the CPU and be dropped there. It is recommended that you use the
<code>cl-acltool</code> command to explicitly add the relevant entry to hardware.</p>

<p>For example, you can configure a file, like
<code>/etc/cumulus/acl/policy.d/01control_plane_bgp.rules</code>, with a rule like
this for TTL:</p>

<pre><code>INGRESS_INTF = swp1 
    INGRESS_CHAIN = INPUT, FORWARD 
 
    [iptables]
    -A $INGRESS_CHAIN --in-interface $INGRESS_INTF -p tcp --dport bgp -m ttl --ttl 255 POLICE --set-mode pkt --set-rate 2000 --set-burst 1000 
-A $INGRESS_CHAIN --in-interface $INGRESS_INTF -p tcp --dport bgp DROP
</code></pre>


<div class="notices note" > <p>For more information about ACLs and <code>cl-acltool</code>, see <a href="/version/cumulus-linux-31/System-Management/Netfilter---ACLs/">Netfilter
(ACLs)</a>.</p>
 </div>


<article id="html-search-results" class="ht-content" style="display: none;">

</article>

<footer id="ht-footer">

</footer>

<p></details></p>
</article>

      <script src="https://utteranc.es/client.js"
        repo="CumulusNetworks/docs-internal"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
      </script>

    </div>
    

      


  

    <aside class="book-toc fixed">

  
    <div class="toc">
    
      <button>
      <a href="https://github.com/CumulusNetworks/docs/edit/master/content/version/cumulus-linux-31/Layer-3-Features/Border-Gateway-Protocol---BGP.md" target="_blank" rel="noopener"><img src="/docs.cumulusnetworks.com/svg/pencil-circle.svg" alt="Edit" /> Edit this page</a>
      </button>
    
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#span-commands-span"><span>Commands</span></a></li>
<li><a href="#span-autonomous-system-number-asn-span"><span>Autonomous System Number (ASN)</span></a></li>
<li><a href="#span-ebgp-and-ibgp-span"><span>eBGP and iBGP</span></a></li>
<li><a href="#span-route-reflectors-span"><span>Route Reflectors</span></a></li>
<li><a href="#span-id-src-5122130-bordergatewayprotocol-bgp-ecmp-class-confluence-anchor-link-span-span-ecmp-with-bgp-span"><span id="src-5122130_BorderGatewayProtocol-BGP-ecmp" class="confluence-anchor-link"></span><span>ECMP with BGP</span></a>
<ul>
<li><a href="#span-maximum-paths-span"><span>Maximum Paths</span></a></li>
<li><a href="#span-bgp-for-both-ipv4-and-ipv6-span"><span>BGP for Both IPv4 and IPv6</span></a></li>
</ul></li>
<li><a href="#span-id-src-5122130-bordergatewayprotocol-bgp-config-bgp-class-confluence-anchor-link-span-span-configuring-bgp-span"><span id="src-5122130_BorderGatewayProtocol-BGP-config_bgp" class="confluence-anchor-link"></span><span>Configuring BGP</span></a></li>
<li><a href="#span-id-src-5122130-bordergatewayprotocol-bgp-unnumbered-class-confluence-anchor-link-span-span-using-bgp-unnumbered-interfaces-span"><span id="src-5122130_BorderGatewayProtocol-BGP-unnumbered" class="confluence-anchor-link"></span><span>Using BGP Unnumbered Interfaces</span></a>
<ul>
<li><a href="#span-bgp-and-extended-next-hop-encoding-span"><span>BGP and Extended Next-hop Encoding</span></a></li>
<li><a href="#span-configuring-bgp-unnumbered-interfaces-span"><span>Configuring BGP Unnumbered Interfaces</span></a></li>
<li><a href="#span-managing-unnumbered-interfaces-span"><span>Managing Unnumbered Interfaces</span></a></li>
<li><a href="#span-how-traceroute-interacts-with-bgp-unnumbered-interfaces-span"><span>How traceroute Interacts with BGP Unnumbered Interfaces</span></a></li>
<li><a href="#span-advanced-understanding-how-next-hop-fields-are-set-span"><span>Advanced: Understanding How Next-hop Fields Are Set</span></a></li>
<li><a href="#span-limitations-span"><span>Limitations</span></a></li>
</ul></li>
<li><a href="#span-id-src-5122130-bordergatewayprotocol-bgp-add-path-class-confluence-anchor-link-span-span-bgp-add-path-span"><span id="src-5122130_BorderGatewayProtocol-BGP-add-path" class="confluence-anchor-link"></span><span>BGP add-path</span></a>
<ul>
<li><a href="#span-bgp-add-path-rx-span"><span>BGP add-path RX</span></a></li>
<li><a href="#span-bgp-add-path-tx-span"><span>BGP add-path TX</span></a></li>
</ul></li>
<li><a href="#span-fast-convergence-design-considerations-span"><span>Fast Convergence Design Considerations</span></a>
<ul>
<li><a href="#span-specifying-the-interface-name-in-the-neighbor-command-span"><span>Specifying the Interface Name in the neighbor Command</span></a></li>
</ul></li>
<li><a href="#span-id-src-5122130-bordergatewayprotocol-bgp-peergroups-class-confluence-anchor-link-span-span-using-peer-groups-to-simplify-configuration-span"><span id="src-5122130_BorderGatewayProtocol-BGP-peergroups" class="confluence-anchor-link"></span><span>Using Peer Groups to Simplify Configuration</span></a></li>
<li><a href="#span-configuring-bgp-dynamic-neighbors-span"><span>Configuring BGP Dynamic Neighbors</span></a></li>
<li><a href="#span-configuring-bgp-peering-relationships-across-switches-span"><span>Configuring BGP Peering Relationships across Switches</span></a></li>
<li><a href="#span-configure-md5-enabled-bgp-neighbors-span"><span>Configure MD5-enabled BGP Neighbors</span></a>
<ul>
<li><a href="#span-manually-configure-an-md5-enabled-bgp-neighbor-span"><span>Manually configure an MD5-enabled BGP Neighbor</span></a></li>
<li><a href="#span-configure-an-md5-enabled-bgp-neighbor-using-vtysh-span"><span>Configure an MD5-enabled BGP Neighbor using vtysh</span></a></li>
</ul></li>
<li><a href="#span-configure-bgp-ttl-security-span"><span>Configure BGP TTL Security</span></a></li>
<li><a href="#span-configuration-tips-span"><span>Configuration Tips</span></a>
<ul>
<li><a href="#span-bgp-advertisement-best-practices-span"><span>BGP Advertisement Best Practices</span></a></li>
<li><a href="#span-utilizing-multiple-routing-tables-and-forwarding-span"><span>Utilizing Multiple Routing Tables and Forwarding</span></a></li>
<li><a href="#span-additional-default-settings-span"><span>Additional Default Settings</span></a></li>
<li><a href="#span-configuring-bgp-neighbor-maximum-prefixes-span"><span>Configuring BGP Neighbor maximum-prefixes</span></a></li>
</ul></li>
<li><a href="#span-troubleshooting-bgp-span"><span>Troubleshooting BGP</span></a>
<ul>
<li><a href="#span-debugging-tip-logging-neighbor-state-changes-span"><span>Debugging Tip: Logging Neighbor State Changes</span></a></li>
<li><a href="#span-troubleshooting-link-local-addresses-span"><span>Troubleshooting Link-local Addresses</span></a></li>
</ul></li>
<li><a href="#span-enabling-read-only-mode-span"><span>Enabling Read-only Mode</span></a></li>
<li><a href="#span-applying-a-route-map-for-route-updates-span"><span>Applying a Route Map for Route Updates</span></a></li>
<li><a href="#span-protocol-tuning-span"><span>Protocol Tuning</span></a>
<ul>
<li><a href="#span-converging-quickly-on-link-failures-span"><span>Converging Quickly On Link Failures</span></a></li>
<li><a href="#span-converging-quickly-on-soft-failures-span"><span>Converging Quickly On Soft Failures</span></a></li>
<li><a href="#span-reconnecting-quickly-span"><span>Reconnecting Quickly</span></a></li>
<li><a href="#span-advertisement-interval-span"><span>Advertisement Interval</span></a></li>
</ul></li>
<li><a href="#span-configuration-files-span"><span>Configuration Files</span></a></li>
<li><a href="#span-useful-links-span"><span>Useful Links</span></a></li>
<li><a href="#span-caveats-and-errata-span"><span>Caveats and Errata</span></a>
<ul>
<li><a href="#span-ttl-security-issue-span"><span>ttl-security Issue</span></a></li>
</ul></li>
</ul></li>
</ul>
</nav>
    </div>
  

</aside>






  </main>
  <footer class="footer-top">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <div class="footer-content">
            <div class="mb-4">
                <img src="https://static.cumulusnetworks.com/static/images/shared/cumulus-networks-rt-white-trademarked.ff839f1b2570.svg">
                <p>© <script type="text/javascript">document.write(new Date().getFullYear());</script> Cumulus Networks.<br>
                Site by <a href="//unomena.com/" target="_blank">Unomena</a>.</p>
            </div>
            <ul class="mb-4">
              <li><h4>Products</h4></li>
              <li><a href="//cumulusnetworks.com/products/cumulus-linux/">Cumulus Linux</a></li>
              <li><a href="//cumulusnetworks.com/products/netq/">Cumulus NetQ</a></li>
              <li><a href="//cumulusnetworks.com/products/cumulus-express/">Cumulus Express</a></li>
            </ul>
            <ul class="mb-4">
              <li><h4>Learn</h4></li>
              <li><a href="//cumulusnetworks.com/learn/web-scale-networking-education/">Going web-scale</a></li>
              <li><a href="//cumulusnetworks.com/learn/events/">Events</a></li>
              <li><a href="//cumulusnetworks.com/blog/">Blog</a></li>
            </ul>
            <ul class="mb-4">
              <li><h4>About</h4></li>
              <li><a href="//cumulusnetworks.com/about/">Our story</a></li>
              <li><a href="//cumulusnetworks.com/about/careers/">Careers</a></li>
              <li><a href="//cumulusnetworks.com/about/media-coverage/">Media coverage</a></li>
              <li><a href="//docs.cumulusnetworks.com/" target="_blank">Tech docs</a></li>
              <li><a href="//cumulusnetworks.com/community/">Community</a></li>
            </ul>
            <ul>
              <li>
                <a href="//twitter.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M23 6.628l-2-.5 1-2-2.464.7A4.48 4.48 0 0 0 12 8.128v1c-3.539.73-6.634-1.2-9.5-4.5q-.75 4 1.5 6l-3-.5c.405 2.069 1.362 3.7 4 4l-2.5 1c1 2 2.566 2.31 5 2.5a10.748 10.748 0 0 1-6.5 2c12.755 5.669 20-2.664 20-10V8.3z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//www.facebook.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                      .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M17.768 7.5H13.5V5.6a.972.972 0 0 1 1.012-1.1c.418 0 2.988.01 2.988.01V.5h-4.329C9.244.5 8.5 3.474 8.5 5.355V7.5h-3v4h3v12h5v-12h3.851z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//linkedin.com/company/cumulus-networks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                      .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M6.5 22.5h-5v-13h5zm9-9a2 2 0 0 0-2 2v7h-5v-13h5v1.485a6.307 6.307 0 0 1 3.99-1.495c2.962 0 5.01 2.2 5.01 6.355V22.5h-5v-7a2 2 0 0 0-2-2zM6.5 5A2.5 2.5 0 1 1 4 2.5 2.5 2.5 0 0 1 6.5 5z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//vimeo.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M.5 7.393l.933 1.224S3.36 7.1 4 7.859s3.1 9.925 3.915 11.617c.714 1.483 2.684 3.444 4.845 2.042s9.34-7.529 10.626-14.769-8.642-5.723-9.693.583c2.627-1.577 4.03.642 2.686 3.154s-2.569 4.145-3.211 4.145-1.135-1.679-1.868-4.613c-.76-3.035-.755-8.5-3.911-7.882C4.412 2.721.5 7.393.5 7.393z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//www.github.com/cumulusnetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                        <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                        </style>
                    </defs>
                    <path class="a" d="M19.459 17c0-5.969-4.126-3.532-7.5-3.532s-7.5-2.375-7.5 3.532a3.5 3.5 0 0 0 3.5 3.5h8a3.5 3.5 0 0 0 3.5-3.5z"></path>
                    <path class="a" d="M21.489 10.214l.032.023s2.646-4.572-.6-7.237c-2 0-5.058 3.3-5.058 3.3l.022.016A14.152 14.152 0 0 0 8.1 6.3C8.083 6.285 5.037 3 3.042 3c-3.173 2.6-.729 7.012-.614 7.217a8.876 8.876 0 0 0-1.395 5.743c.241 3.126 2.847 6.54 5.982 6.54H16.9c3.135 0 5.742-3.414 5.982-6.54a8.857 8.857 0 0 0-1.393-5.746z"></path>
                    <ellipse class="a" cx="15.48" cy="17" rx="1" ry="1.5"></ellipse>
                    <ellipse class="a" cx="8.48" cy="17" rx="1" ry="1.5"></ellipse>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//slack.cumulusnetworks.com/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                        <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                        </style>
                    </defs>
                    <rect class="a" x=".5" y=".5" width="23" height="23" rx="6" ry="6"></rect>
                    <circle class="a" cx="12" cy="12" r="6"></circle>
                    <circle class="a" cx="19" cy="5" r="1.5"></circle>
                  </svg>
                </a>
              </li>
              <li>
                <p>Cumulus Networks<sup>®</sup> — Data center networking software for the open, modern data center.</p>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </footer>
  <div class="footer-bottom">
      <div class="container">
          <div class="row">
              <div class="col-12">
                  <ul>
                      <li><a href="//cumulusnetworks.com/legal/trademarks/">Trademarks</a></li>
                      <li><a href="//cumulusnetworks.com/legal/privacy/">Privacy</a></li>
                      <li><a href="//cumulusnetworks.com/legal/">Terms of service</a></li>
                  </ul>
              </div>
          </div>
      </div>
  </div>

  
  

</body>

</html>
