<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Extending NetQ with Custom Commands | Cumulus Networks Documentation</title>

  
  <link href="https://fonts.googleapis.com/css?family=Oxygen|Oxygen+Mono:300,400,700" rel="stylesheet">

  
  
  
  <link rel="stylesheet" href="/docs.cumulusnetworks.com/book.min.a378d8a2da6f5357a83a43dff33d6f77fb70401e0399d5ba78faf81d7a1ae1a8.css">

  
  <link rel="icon" href="/docs.cumulusnetworks.com/icons/favicon.png" type="image/x-icon">

  
  <!--
  Made with Book Theme
  https://github.com/alex-shpak/hugo-book
  -->

  
  
  <script src = "/docs.cumulusnetworks.com/js/codecopy.js"> </script>

</head>


<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  
  <header id="site-nav">
    <div class="header-wrapper flex">
      <a href="/">
        <img src="/header-logo.png" alt="Cumulus Networks">
        <img src="/cumulus-networks-rt-white.svg" alt="Cumulus Networks" class="header-mobile">
        <span>Docs</span>
      </a>
      <ul class="flex">
        <li><a href="//cumulusnetworks.com">HOME</a></li>
        <li><a href="//support.cumulusnetworks.com/">SUPPORT</a></li>
        <li><a href="//docs.cumulusnetworks.com/">DOCS</a></li>
        <li><a href="//education.cumulusnetworks.com">EDUCATION</a></li>
        <li><a href="//cumulusnetworks.com/blog/">BLOG</a></li>
        <li><a href="//forums.cumulusnetworks.com/">FORUMS</a></li>
      </ul>
      <div class="burger-menu">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </header>
  <div id="product-nav" class="flex">
      
    
    <ul>
    
      <li><a href = docs.cumulusnetworks.com/cumulus-linux/ >
        Cumulus Linux </a> </li>
    
      <li class = "active" ><a href = docs.cumulusnetworks.com/cumulus-netq/ >
        Cumulus NetQ </a> </li>
    
      <li><a href = docs.cumulusnetworks.com/cumulus-vx/ >
        Cumulus VX </a> </li>
    
      <li>
        <div id="products-dropdown" class="dropdown">
            <button class="btn" type="button" id="dropdownMenuButton">
              Products
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <a class="dropdown-item" href="">Cumulus RMP</a>
              <a class="dropdown-item" href="">Cumulus Chassis</a>
              <a class="dropdown-item" href="">Cumulus Host Pack</a>
            </div>
        </div>
      </li>
    </ul>
    <div class="search-container">
      <div id="doc-search-box">
        <input type="text" class="doc-search-input" placeholder="Search" value="">
        <span><button type="submit"><img src="/icons/search_20x20.svg" alt=""></button></span>
      </div>
      <div id="dropdown" class="dropdown">
          <button class="btn" type="button" id="dropdownMenuButton">
            v1.2.1
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/cumulus-netq/"> v2.2.0</a>
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-netq-10/"> v1.0.0</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-netq-110/"> v1.1.0</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-netq-121/"> v1.2.1</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-netq-141/"> v1.4.1</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-netq-21/"> v2.1</a>
            
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
          </div>
      </div>
    </div>
  </div>
  <main class="flex container">
    <aside class="book-menu fixed">

      <nav role="navigation">
        <h2 class="book-brand">
          <a href="docs.cumulusnetworks.com">Cumulus Networks Documentation</a>
        </h2>
        
        




  <ul class = "cn-book-section-container" id = "top">
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
            

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/" >
    Cumulus NetQ
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Getting-Started-with-NetQ/" >
    Getting Started with NetQ
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Getting-Started-with-NetQ/Configuring-High-Availability-Mode/" >
    Configuring High Availability Mode
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Getting-Started-with-NetQ/Upgrading-NetQ/" >
    Upgrading NetQ
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Proactively-Monitoring-the-Network-Fabric/" >
    Proactively Monitoring the Network Fabric
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Proactively-Monitoring-the-Network-Fabric/MLAG-Troubleshooting-with-NetQ/" >
    MLAG Troubleshooting with NetQ
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Early-Access-Features/" >
    Early Access Features
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Early-Access-Features/Chassis-Integration/" >
    Chassis Integration
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Early-Access-Features/Extending-NetQ-with-Custom-Commands/"  class="active" >
    Extending NetQ with Custom Commands
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Early-Access-Features/Querying-the-NetQ-Database/" >
    Querying the NetQ Database
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Early-Access-Features/Collecting-Interface-Statistics/" >
    Collecting Interface Statistics
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Getting-to-Know-NetQ/" >
    Getting to Know NetQ
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/NetQ-Service-Console/" >
    NetQ Service Console
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Taking-Preventative-Steps-with-Your-Network/" >
    Taking Preventative Steps with Your Network
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Performing-Network-Diagnostics/" >
    Performing Network Diagnostics
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Monitoring-the-Physical-Layer/" >
    Monitoring the Physical Layer
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Monitoring-Linux-Hosts-with-NetQ/" >
    Monitoring Linux Hosts with NetQ
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Monitoring-Container-Environments-with-NetQ/" >
    Monitoring Container Environments with NetQ
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Using-NetQ-Virtual-Environments/" >
    Using NetQ Virtual Environments
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Restoring-from-Backups-with-NetQ/" >
    Restoring from Backups with NetQ
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Troubleshooting-NetQ/" >
    Troubleshooting NetQ
  </a>


    </li>
    
  </ul>


  </li>


          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  </ul>









      </nav>

      
      
      
      

      <script src = "/docs.cumulusnetworks.com/js/menuBundle.js"> </script>


    </aside>

    <div class="book-page">

      
      <header class="align-center justify-between book-header">
        <label for="menu-control">
          <img src="/docs.cumulusnetworks.com/svg/menu.svg" alt="Menu" />
        </label>
        <strong>Extending NetQ with Custom Commands</strong>
      </header>

      
      
<div class= "notices info" id = "info" >
    This documentation is for an older version of the software. If you are using the current version of Cumulus Linux, this content may not be up to date. The current version of the documentation is available [here](https://docs.cumulusnetworks.com/).
  </div>
<article class="markdown">
<h1>Extending NetQ with Custom Commands</h1>

<p>NetQ provides the ability to codify playbooks and extend NetQ with
custom commands for use cases specific to your network.</p>

<p>The summary of steps required to do this is a follows:</p>

<ul>
<li><p>The extensions must be written in <a href="https://www.python.org" target="_blank">Python</a>
or <a href="http://cython.org" target="_blank">Cython</a>.</p></li>

<li><p>The commands need to be added must use <code>network doctopt</code>.</p></li>

<li><p>The .py file (or the compiled .so if using Cython) is now copied to
/usr/lib/python2.7/dist-packages/netq_apps/modules/addons.</p></li>

<li><p>Enable the add-ons with the <code>netq config add addons</code> command</p></li>

<li><p>Check that your command works by typing <code>netq &lt;TAB&gt;</code></p></li>
</ul>

<h2 id="span-sample-file-with-custom-command-span"><span>Sample File with Custom Command</span></h2>

<p>To help you get started, here is the Hello World of NetQ command
extension:</p>

<pre><code>'''
hello: A netq app hello world module
Usage:
   netq hello [json]
Options:
   hello                          : Hello world experimental
'''
import json
from netq_apps.modules import NetqModule, RC_SUCCESS, RC_FAIL
app = NetqModule()

@app.route('hello')
def cli_hello_world(cli, netq):
    '''My very own hello'''
    jsonify = cli.get('json')
    if jsonify:
       print json.dumps({'greeting': 'Hello World'})
    else:
       print 'Hello World'
    return RC_SUCCESS
</code></pre>

<p>Let&rsquo;s break down each part of the code.</p>

<h3 id="span-command-specification-with-help-span"><span>Command Specification With Help</span></h3>

<p>The lines at the start of the file within the triple quotes (&ldquo;&lsquo;)
constitute what is called the <em>docstring</em> of the file or module.
<code>network-docopt</code>, the Python library that builds the command parser for
NetQ, uses the information provided in the <em>docstring</em>. Specifically,
everything between <strong>Usage</strong> and <strong>Options</strong> is considered a command
specification. In this case, <code>netq hello</code> is the only command specified
in the file. The command MUST start with the word <code>netq</code>. Every <code>netq</code>
command follows the following structure:</p>

<pre><code>netq [&lt;hostname&gt;] &lt;verb&gt; &lt;object&gt; &lt;filters&gt;
</code></pre>

<p>For example, here is the sample for <code>show vlan</code>:</p>

<pre><code>netq [&lt;hostname&gt;] show vlan [&lt;1-4096&gt;] [around &lt;text-time&gt;] [json] 
</code></pre>

<p>The <em>&lt;hostname&gt;</em> option is used to filter results to just the
specified host; hostname can also be a regular expression. The
<em>&lt;verb&gt;</em> is <em>show</em>, the <em>&lt;object&gt;</em> is <em>vlan</em> and the remaining
parameters are filters to viewing the data.</p>

<p>For example, if you wanted to extend hello world by passing an optional
greeting, modify the usage to be:</p>

<pre><code>netq hello &lt;text-greeting&gt;
</code></pre>

<p><code>network-docopt</code> understands a few parameter types and validates them
before passing them to your code. Some common ones are:</p>

<ul>
<li><p><strong>&lt;hostname&gt;</strong>: A host known to NetQ</p></li>

<li><p><strong>&lt;remote-interface&gt;</strong>: An interface on the specified host known
to NetQ</p></li>

<li><p><strong>&lt;text&gt;</strong>: Any free text, but has to be a single word or
delimited within quotes</p></li>

<li><p><strong>&lt;ip&gt;</strong>, <strong>&lt;ip/prefixlen&gt;</strong>: IPv4 or IPv6 address, with prefix
length in the second case</p></li>

<li><p><strong>&lt;ipv4&gt;</strong>, <strong>&lt;ipv4/prefixlen&gt;</strong>: IPv4 address, with prefix
length in the second case</p></li>

<li><p><strong>&lt;ipv6&gt;</strong>, <strong>&lt;ipv6/prefixlen&gt;</strong>: IPv6 address, with prefix
length in the second case</p></li>

<li><p><strong>&lt;wildcard&gt;</strong>: All the remaining text</p></li>

<li><p>Valid number range: Such as <strong>&lt;1-4096&gt;</strong> to limit the allowed
range</p></li>
</ul>

<p>So in the VLAN example above, specifying a VLAN value outside the 1-4096
range results in an error, with command unknown and a help message
indicating that you need to specify a value between 1 and 4096. For
hosts and interfaces used with <em>&lt;hostname&gt;</em> and
<em>&lt;remote-interface&gt;</em>, NetQ automatically provides tab completion.</p>

<p>To display meaningful help associated with a keyword, add the help for
the command via the <strong>Options</strong> section. In the example code above, the
object <em>hello</em> has the help text &ldquo;Hello world experimental&rdquo;. This text
is displayed when the user types <code>netq &lt;TAB&gt;</code>, as shown in the following
example:</p>

<pre><code>cumulus@switch:~$ netq 
&lt;hostname&gt; : Type first char of netq host for dynamic completion
check : Perform fabric-wide checks
config : Configuration
example : Show examples of usage and workflow
hello : Hello world experimental
help : Show usage info
resolve : Annotate input with names and interesting info
show : Show fabric-wide info about specified object
trace : Control Path Trace
cumulus@torc-11:mgmt-vrf:~$ netq
</code></pre>


<div class="notices note" > <p>Any help you provide here overrides the help provided for the keyword by
a module loaded previously.</p>
 </div>


<h3 id="span-associating-the-command-with-the-function-span"><span>Associating the Command with the Function</span></h3>

<p>After configuring the command, you need to associate or <em>bind</em> that
command with the function to be called when a user runs the command.
This is done by using decorators to functions similar to how other CLI
builders or web servers work.</p>

<p>First, create an instance of the class <code>NetqModule()</code> called <em>app</em>. Then
associate the function to the appropriate command via the decorator
<code>@app.route</code>. As shown in the example above, the function
<code>cli_hello_world()</code> is decorated to indicate that it is the function to
call for the command <code>hello</code>. The function takes two parameters: <em>cli</em>
and <em>netq</em>. Usage of these parameters is discussed in the next section.</p>

<p>Keep in mind the following when matching the command to the function:</p>

<ul>
<li><p>If a prior binding has already been assigned to a command, the newer
binding will fail. By default, modules in the core NetQ code take
precedence over early access modules, which take precedence over the
modules defined in addons directory.</p></li>

<li><p>The command string can be as small as possible. For example, the
commands <code>netq hello json</code> and <code>netq hello</code> can be handled by
different functions or by the same function. The NetQ command parser
does a longest match first to determine which of the competing
functions is assigned to execute a command. The command parser
supports up to three string matches. In other words, <code>show ip
address</code> is supported, but <code>show ip address json</code> is not. Such
longer command strings bound to a function either silently fail or a
shorter string version is matched.</p></li>
</ul>

<h3 id="span-using-the-cli-and-netq-parameters-span"><span>Using the cli and netq Parameters</span></h3>

<p>The function that is called to execute a command expects to received two
parameters, <em>cli</em> and <em>netq</em>, in the order shown in the example above.</p>

<p><em>cli</em> is a dictionary containing the parameters provided by the user on
the command line. <em>netq</em> contains the timestamps provided by the user,
if any. Any other object within NetQ can be ignored. The timestamps are
provided to query NetQ objects around a specific time or in a time
window.</p>

<p>The example shows how to extract the value provided by the user at the
command line from <em>cli</em>. Since <em>json</em> is a keyword, getting the key
<em>json</em> from <em>cli</em> lets you to determine if the user specified <em>json</em> at
the command line or not. If the user did not specify <em>json</em> at the
command line, <code>cli.get('json')</code> returns <em>None</em>, whereas if the user did
specify <em>json</em>, then <code>cli.get('json')</code> returns the string &ldquo;json&rdquo;. Thus,
if the user wants to specify a parameter along with a keyword, for
example, as shown in <code>netq show macs [vlan &lt;1-4096&gt;]</code>, then the value of
the VLAN to search for a MAC address can be found using
<code>cli.get('&lt;1-4096&gt;')</code>, not via <code>cli.get('vlan')</code>.</p>

<h3 id="span-return-values-span"><span>Return Values</span></h3>

<p>The function returns either <em>RC_SUCCESS</em> if successful or <em>RC_FAIL</em> if
not. The code snippet shows how to import these values from the standard
NetQ libraries.</p>

<h2 id="span-querying-the-netq-database-span"><span>Querying the NetQ Database</span></h2>

<p>While the code snippet above was sufficient to illustrate the general
skeleton, if you want to extend the commands, you typically will want to
add meaningful functionality such as querying the database and
displaying some more meaningful information. For example, consider a new
command called <code>show ip-routes</code>, which displays the route information
available in the database, but with a different set of fields than shown
via <code>show ip routes</code>. The code to do so is shown below.</p>

<pre><code>&quot;&quot;&quot;
routes.py: NetQ app module for processing IPv4/v6 routes
Usage:
   netq &lt;hostname&gt; show myroutes [vrf &lt;vrf&gt;] [json]
Options:
   myroutes                               : IPv4/v6 routes
&quot;&quot;&quot;
from __future__ import absolute_import
from collections import OrderedDict

from netq_apps.modules import NetqModule, RC_SUCCESS
from netq_apps.cmd.netq import netq_show

from netq_lib.orm.redisdb.models import Route

app = NetqModule()

@app.route('show myroutes')
@netq_show
def cli_show_myroutes(cli, netq, context):
    '''MY very own show routes'''
    hostname = cli.get('&lt;hostname&gt;') or '*'
    vrf = cli.get('&lt;vrf&gt;') or '*'
    context.col_sizes = [16, 8, 32, 26, 16]
    entries = Route.query.filter(timestamp=netq.start_time,
                                 endtimestamp=netq.end_time,
                                 hostname=hostname, vrf=vrf)
    for entry in entries:
        out = OrderedDict()
        if isinstance(entry, tuple):
            route = entry[0]
        else:
            route = entry
        if not route.nexthops:
            route.nexthops = [['None', 'Local']]
        nexthops = ', '.join(
            '%s: %s' % (nh[0], nh[1]) if nh[0] != 'None' else '%s' % nh[1]
            for nh in sorted(route.nexthops)
        )

        out['Hostname'] = route.hostname
        out['Protocol'] = route.protocol
        out['Prefix'] = route.prefix
        out['Nexthops'] = nexthops
        out['Last Changed'] = route.timestamp
        yield out
</code></pre>

<p>Much of this code is similar to the hello world example, but the new
items are discussed below.</p>

<h3 id="span-the-imports-span"><span>The Imports</span></h3>

<p>There are two additional imports, one for <em>netq_show</em> and the other for
<em>Route</em>.</p>

<h4 id="span-netq-show-span"><span>netq_show</span></h4>

<p><em>netq_show</em> is the decorator that takes care of wrapping the output in
a format native to NetQ. For example, it generates the JSON for you
automatically, so that you don&rsquo;t have to write a JSON output generator
just to support JSON and you don&rsquo;t have to worry about supporting the
tabular format, displaying rotten nodes in a different color and so on.
All you have to do is generate output in the form of an <code>OrderedDict</code>
and <code>yield</code> for every entry. The <code>OrderedDict</code> ensures that the columns
are displayed in the order provided in the code. The column headers are
generated from the dictionary key, as are the JSON keys.</p>

<p>By wrapping the code with the <em>netq_show</em>, all these display
complexities are covered for you.</p>

<h4 id="span-route-span"><span>Route</span></h4>

<p><em>Route</em> is the database object that holds all the pertinent information
about a route. Its contents are defined in the
<code>/usr/lib/python2.7/dist-packages/netq_lib/orm/redisdb/models.py</code> file.
There are other database objects defined in the file, but this example
only involves the <em>Route</em> object.</p>

<h3 id="span-the-function-handler-span"><span>The Function Handler</span></h3>

<p>The function that satisfies the command <code>show myroutes</code> is
<em>cli_show_myroutes</em>, and because of the decorator, takes an additional
input parameter, <em>context</em>. It&rsquo;s mainly used to pass things between the
main NetQ command module and the specific modules, such as this one.
This particular case uses the <em>context</em> to update the column sizes to be
used in the display.</p>

<h3 id="span-the-query-functions-span"><span>The Query Functions</span></h3>

<p>The meat of the code is the query. Objects are queried using the model
of *&lt;object&gt;.query.&lt;query function&gt;. T*his particular example uses
<em>filter</em> as the query function, as shown by the <code>Route.query.filter()</code>
call. The filter function produces output filtered by the parameters
specified in the keyword arguments passed. For example, the <em>hostname</em>
keyword argument restricts the results returned by the query function to
only those on the specified host. The list of keys that can be specified
for an object are listed under the object&rsquo;s definition in the
aforementioned <code>models.py</code> file under the function <code>key_fmt()</code>. A look
at that function for the <em>Route</em> object shows that the key fields are:
hostname, prefix, route type, routing table id, ipv4/v6 route and, If
the entry is originated on this node, the protocol that added this route
and the VRF name qualifier. The values returned include all the key
fields plus the fields shown in the <code>val_fmt()</code> function for the object.</p>

<p>The other useful query functions are:</p>

<ul>
<li><p><code>query.get()</code>: which returns just the first element matching the
parameters specified.</p></li>

<li><p><code>query.latest()</code>: which returns the latest element matching the
parameters specified, and does not take any time parameters.</p></li>

<li><p><code>query.count()</code>: which returns a count of the matching elements
instead of the elements themselves.</p></li>
</ul>

<p>The filter query functions return an iterator and thus is lazy about
retrieving data from the back end. You can stop whenever you want in the
iteration. <code>query.get()</code> and <code>query.latest()</code> both return a single
object of the type the query is on while <code>query.count()</code> returns an
integer.</p>

<h2 id="span-debugging-span"><span>Debugging</span></h2>

<p>Inevitably when writing code, coding errors need to be debugged and the
fixes tried again. When a module doesn&rsquo;t load or returns an error, it is
reported in the <code>netqd.log</code>, usually kept under <code>/var/log</code> (unless you
modified the location). Deploying the module on one node doesn&rsquo;t mean it
is automatically available on all nodes. You must copy it to all the
required nodes.</p>

<p>To reload the modules after making fixes, run the command <code>netq config
reload parser</code>.</p>

<h2 id="span-caveats-span"><span>Caveats</span></h2>

<p>This feature is an early access feature, and must be treated as such.
There may be obscure failures which will require Cumulus Networks
engineering intervention to investigate. Finally, please save the
modules you write. If you reinstall the <code>netq-apps</code> package, your
modules may get overwritten when you install the new package. One of the
next releases of NetQ should provide the ability to store these modules
under <code>/usr/local/lib</code>, to keep them from being affected by package
management.</p>

<article id="html-search-results" class="ht-content" style="display: none;">

</article>

<footer id="ht-footer">

</footer>
</article>

      <script src="https://utteranc.es/client.js"
        repo="CumulusNetworks/docs-internal"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
      </script>

    </div>
    

      


  

    <aside class="book-toc fixed">

  
    <div class="toc">
    
      <button>
      <a href="https://github.com/CumulusNetworks/docs/edit/master/content/version/cumulus-netq-121/Early-Access-Features/Extending-NetQ-with-Custom-Commands.md" target="_blank" rel="noopener"><img src="/docs.cumulusnetworks.com/svg/pencil-circle.svg" alt="Edit" /> Edit this page</a>
      </button>
    
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#span-sample-file-with-custom-command-span"><span>Sample File with Custom Command</span></a>
<ul>
<li><a href="#span-command-specification-with-help-span"><span>Command Specification With Help</span></a></li>
<li><a href="#span-associating-the-command-with-the-function-span"><span>Associating the Command with the Function</span></a></li>
<li><a href="#span-using-the-cli-and-netq-parameters-span"><span>Using the cli and netq Parameters</span></a></li>
<li><a href="#span-return-values-span"><span>Return Values</span></a></li>
</ul></li>
<li><a href="#span-querying-the-netq-database-span"><span>Querying the NetQ Database</span></a>
<ul>
<li><a href="#span-the-imports-span"><span>The Imports</span></a>
<ul>
<li><a href="#span-netq-show-span"><span>netq_show</span></a></li>
<li><a href="#span-route-span"><span>Route</span></a></li>
</ul></li>
<li><a href="#span-the-function-handler-span"><span>The Function Handler</span></a></li>
<li><a href="#span-the-query-functions-span"><span>The Query Functions</span></a></li>
</ul></li>
<li><a href="#span-debugging-span"><span>Debugging</span></a></li>
<li><a href="#span-caveats-span"><span>Caveats</span></a></li>
</ul></li>
</ul>
</nav>
    </div>
  

</aside>






  </main>
  <footer class="footer-top">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <div class="footer-content">
            <div class="mb-4">
                <img src="https://static.cumulusnetworks.com/static/images/shared/cumulus-networks-rt-white-trademarked.ff839f1b2570.svg">
                <p> <script type="text/javascript">document.write(new Date().getFullYear());</script> Cumulus Networks.<br>
                Site by <a href="//unomena.com/" target="_blank">Unomena</a>.</p>
            </div>
            <ul class="mb-4">
              <li><h4>Products</h4></li>
              <li><a href="//cumulusnetworks.com/products/cumulus-linux/">Cumulus Linux</a></li>
              <li><a href="//cumulusnetworks.com/products/netq/">Cumulus NetQ</a></li>
              <li><a href="//cumulusnetworks.com/products/cumulus-express/">Cumulus Express</a></li>
            </ul>
            <ul class="mb-4">
              <li><h4>Learn</h4></li>
              <li><a href="//cumulusnetworks.com/learn/web-scale-networking-education/">Going web-scale</a></li>
              <li><a href="//cumulusnetworks.com/learn/events/">Events</a></li>
              <li><a href="//cumulusnetworks.com/blog/">Blog</a></li>
            </ul>
            <ul class="mb-4">
              <li><h4>About</h4></li>
              <li><a href="//cumulusnetworks.com/about/">Our story</a></li>
              <li><a href="//cumulusnetworks.com/about/careers/">Careers</a></li>
              <li><a href="//cumulusnetworks.com/about/media-coverage/">Media coverage</a></li>
              <li><a href="//docs.cumulusnetworks.com/" target="_blank">Tech docs</a></li>
              <li><a href="//cumulusnetworks.com/community/">Community</a></li>
            </ul>
            <ul>
              <li>
                <a href="//twitter.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M23 6.628l-2-.5 1-2-2.464.7A4.48 4.48 0 0 0 12 8.128v1c-3.539.73-6.634-1.2-9.5-4.5q-.75 4 1.5 6l-3-.5c.405 2.069 1.362 3.7 4 4l-2.5 1c1 2 2.566 2.31 5 2.5a10.748 10.748 0 0 1-6.5 2c12.755 5.669 20-2.664 20-10V8.3z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//www.facebook.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                      .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M17.768 7.5H13.5V5.6a.972.972 0 0 1 1.012-1.1c.418 0 2.988.01 2.988.01V.5h-4.329C9.244.5 8.5 3.474 8.5 5.355V7.5h-3v4h3v12h5v-12h3.851z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//linkedin.com/company/cumulus-networks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                      .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M6.5 22.5h-5v-13h5zm9-9a2 2 0 0 0-2 2v7h-5v-13h5v1.485a6.307 6.307 0 0 1 3.99-1.495c2.962 0 5.01 2.2 5.01 6.355V22.5h-5v-7a2 2 0 0 0-2-2zM6.5 5A2.5 2.5 0 1 1 4 2.5 2.5 2.5 0 0 1 6.5 5z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//vimeo.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M.5 7.393l.933 1.224S3.36 7.1 4 7.859s3.1 9.925 3.915 11.617c.714 1.483 2.684 3.444 4.845 2.042s9.34-7.529 10.626-14.769-8.642-5.723-9.693.583c2.627-1.577 4.03.642 2.686 3.154s-2.569 4.145-3.211 4.145-1.135-1.679-1.868-4.613c-.76-3.035-.755-8.5-3.911-7.882C4.412 2.721.5 7.393.5 7.393z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//www.github.com/cumulusnetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                        <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                        </style>
                    </defs>
                    <path class="a" d="M19.459 17c0-5.969-4.126-3.532-7.5-3.532s-7.5-2.375-7.5 3.532a3.5 3.5 0 0 0 3.5 3.5h8a3.5 3.5 0 0 0 3.5-3.5z"></path>
                    <path class="a" d="M21.489 10.214l.032.023s2.646-4.572-.6-7.237c-2 0-5.058 3.3-5.058 3.3l.022.016A14.152 14.152 0 0 0 8.1 6.3C8.083 6.285 5.037 3 3.042 3c-3.173 2.6-.729 7.012-.614 7.217a8.876 8.876 0 0 0-1.395 5.743c.241 3.126 2.847 6.54 5.982 6.54H16.9c3.135 0 5.742-3.414 5.982-6.54a8.857 8.857 0 0 0-1.393-5.746z"></path>
                    <ellipse class="a" cx="15.48" cy="17" rx="1" ry="1.5"></ellipse>
                    <ellipse class="a" cx="8.48" cy="17" rx="1" ry="1.5"></ellipse>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//slack.cumulusnetworks.com/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                        <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                        </style>
                    </defs>
                    <rect class="a" x=".5" y=".5" width="23" height="23" rx="6" ry="6"></rect>
                    <circle class="a" cx="12" cy="12" r="6"></circle>
                    <circle class="a" cx="19" cy="5" r="1.5"></circle>
                  </svg>
                </a>
              </li>
              <li>
                <p>Cumulus Networks<sup></sup>  Data center networking software for the open, modern data center.</p>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </footer>
  <div class="footer-bottom">
      <div class="container">
          <div class="row">
              <div class="col-12">
                  <ul>
                      <li><a href="//cumulusnetworks.com/legal/trademarks/">Trademarks</a></li>
                      <li><a href="//cumulusnetworks.com/legal/privacy/">Privacy</a></li>
                      <li><a href="//cumulusnetworks.com/legal/">Terms of service</a></li>
                  </ul>
              </div>
          </div>
      </div>
  </div>

  
  

</body>

</html>
