<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Configuring High Availability Mode | Cumulus Networks Documentation</title>

  
  <link href="https://fonts.googleapis.com/css?family=Oxygen|Oxygen+Mono:300,400,700" rel="stylesheet">

  
  
  
  <link rel="stylesheet" href="/docs.cumulusnetworks.com/book.min.a378d8a2da6f5357a83a43dff33d6f77fb70401e0399d5ba78faf81d7a1ae1a8.css">

  
  <link rel="icon" href="/docs.cumulusnetworks.com/icons/favicon.png" type="image/x-icon">

  
  <!--
  Made with Book Theme
  https://github.com/alex-shpak/hugo-book
  -->

  
  
  <script src = "/docs.cumulusnetworks.com/js/codecopy.js"> </script>

</head>


<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  
  <header id="site-nav">
    <div class="header-wrapper flex">
      <a href="/">
        <img src="/header-logo.png" alt="Cumulus Networks">
        <img src="/cumulus-networks-rt-white.svg" alt="Cumulus Networks" class="header-mobile">
        <span>Docs</span>
      </a>
      <ul class="flex">
        <li><a href="//cumulusnetworks.com">HOME</a></li>
        <li><a href="//support.cumulusnetworks.com/">SUPPORT</a></li>
        <li><a href="//docs.cumulusnetworks.com/">DOCS</a></li>
        <li><a href="//education.cumulusnetworks.com">EDUCATION</a></li>
        <li><a href="//cumulusnetworks.com/blog/">BLOG</a></li>
        <li><a href="//forums.cumulusnetworks.com/">FORUMS</a></li>
      </ul>
      <div class="burger-menu">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </header>
  <div id="product-nav" class="flex">
      
    
    <ul>
    
      <li><a href = docs.cumulusnetworks.com/cumulus-linux/ >
        Cumulus Linux </a> </li>
    
      <li class = "active" ><a href = docs.cumulusnetworks.com/cumulus-netq/ >
        Cumulus NetQ </a> </li>
    
      <li><a href = docs.cumulusnetworks.com/cumulus-vx/ >
        Cumulus VX </a> </li>
    
      <li>
        <div id="products-dropdown" class="dropdown">
            <button class="btn" type="button" id="dropdownMenuButton">
              Products
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <a class="dropdown-item" href="">Cumulus RMP</a>
              <a class="dropdown-item" href="">Cumulus Chassis</a>
              <a class="dropdown-item" href="">Cumulus Host Pack</a>
            </div>
        </div>
      </li>
    </ul>
    <div class="search-container">
      <div id="doc-search-box">
        <input type="text" class="doc-search-input" placeholder="Search" value="">
        <span><button type="submit"><img src="/icons/search_20x20.svg" alt=""></button></span>
      </div>
      <div id="dropdown" class="dropdown">
          <button class="btn" type="button" id="dropdownMenuButton">
            v1.2.1
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/cumulus-netq/"> v2.2.0</a>
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-netq-10/"> v1.0.0</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-netq-110/"> v1.1.0</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-netq-121/"> v1.2.1</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-netq-141/"> v1.4.1</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-netq-21/"> v2.1</a>
            
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
          </div>
      </div>
    </div>
  </div>
  <main class="flex container">
    <aside class="book-menu fixed">

      <nav role="navigation">
        <h2 class="book-brand">
          <a href="docs.cumulusnetworks.com">Cumulus Networks Documentation</a>
        </h2>
        
        




  <ul class = "cn-book-section-container" id = "top">
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
            

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/" >
    Cumulus NetQ
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Getting-Started-with-NetQ/" >
    Getting Started with NetQ
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Getting-Started-with-NetQ/Configuring-High-Availability-Mode/"  class="active" >
    Configuring High Availability Mode
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Getting-Started-with-NetQ/Upgrading-NetQ/" >
    Upgrading NetQ
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Proactively-Monitoring-the-Network-Fabric/" >
    Proactively Monitoring the Network Fabric
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Proactively-Monitoring-the-Network-Fabric/MLAG-Troubleshooting-with-NetQ/" >
    MLAG Troubleshooting with NetQ
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Early-Access-Features/" >
    Early Access Features
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Early-Access-Features/Chassis-Integration/" >
    Chassis Integration
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Early-Access-Features/Extending-NetQ-with-Custom-Commands/" >
    Extending NetQ with Custom Commands
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Early-Access-Features/Querying-the-NetQ-Database/" >
    Querying the NetQ Database
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Early-Access-Features/Collecting-Interface-Statistics/" >
    Collecting Interface Statistics
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Getting-to-Know-NetQ/" >
    Getting to Know NetQ
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/NetQ-Service-Console/" >
    NetQ Service Console
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Taking-Preventative-Steps-with-Your-Network/" >
    Taking Preventative Steps with Your Network
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Performing-Network-Diagnostics/" >
    Performing Network Diagnostics
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Monitoring-the-Physical-Layer/" >
    Monitoring the Physical Layer
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Monitoring-Linux-Hosts-with-NetQ/" >
    Monitoring Linux Hosts with NetQ
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Monitoring-Container-Environments-with-NetQ/" >
    Monitoring Container Environments with NetQ
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Using-NetQ-Virtual-Environments/" >
    Using NetQ Virtual Environments
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Restoring-from-Backups-with-NetQ/" >
    Restoring from Backups with NetQ
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Troubleshooting-NetQ/" >
    Troubleshooting NetQ
  </a>


    </li>
    
  </ul>


  </li>


          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  </ul>









      </nav>

      
      
      
      

      <script src = "/docs.cumulusnetworks.com/js/menuBundle.js"> </script>


    </aside>

    <div class="book-page">

      
      <header class="align-center justify-between book-header">
        <label for="menu-control">
          <img src="/docs.cumulusnetworks.com/svg/menu.svg" alt="Menu" />
        </label>
        <strong>Configuring High Availability Mode</strong>
      </header>

      
      
<div class= "notices info" id = "info" >
    This documentation is for an older version of the software. If you are using the current version of Cumulus Linux, this content may not be up to date. The current version of the documentation is available [here](https://docs.cumulusnetworks.com/).
  </div>
<article class="markdown">
<h1>Configuring High Availability Mode</h1>

<p>NetQ supports high availability — that is, the ability to continue
functioning even in the absence of a single failure of the telemetry
server node. To make the NetQ Telemetry Server highly available (<em>HA
mode</em>), you need to run three instances of the telemetry server.
Currently, exactly three instances are supported in HA mode. Of the
three instances, one is considered the <em>master</em> and is writeable while
the other two are read-only <em>replicas</em>. Each server instance is mapped
to port 6379 on the host. A Redis
<em><a href="https://redis.io/topics/sentinel" target="_blank">sentinel</a></em> on each telemetry server
host monitors the health of the database cluster and decides which
database is the current master. If the master becomes unavailable, the
sentinel promotes one of the replicas to become the new master. Each
sentinel runs on port 26379.</p>

<p>HA mode is optional.</p>

<p>To begin using HA mode, install the telemetry server image on three
separate physical hosts to form a database cluster. Note the IP address
of each instance.</p>

<h2 id="span-enabling-ha-mode-span"><span>Enabling HA Mode</span></h2>

<p>To configure the HA cluster, perform the following steps. These steps
assume there are three telemetry servers, ts01 (the original one which
was <a href="/version/cumulus-netq-121/Getting-Started-with-NetQ/">already
configured</a> as the
telemetry server), ts02 and ts03, which are assigned IP addresses
10.0.0.5, 10.0.0.6 and 10.0.0.7, respectively. The servers are all
assumed to be up and reachable and can communicate with each other.</p>


<div class="notices note" > <p>When configuring HA mode, you can only specify the IP addresses for the
telemetry servers. You cannot use the DNS names here.</p>
 </div>


<ol>
<li><p>On each telemetry server, specify the IP address of the master, then
both replicas. Wait at least 30 seconds between each instance of the
command.</p>

<pre><code>cumulus@ts01:~$ netq config ts add server 10.0.0.5 10.0.0.6 10.0.0.7

cumulus@ts02:~$ netq config ts add server 10.0.0.5 10.0.0.6 10.0.0.7

cumulus@ts03:~$ netq config ts add server 10.0.0.5 10.0.0.6 10.0.0.7
</code></pre></li>

<li><p>Replicate NetQ Notifier on the replica telemetry servers, then
restart the netq-notifier service on the replicas:</p>

<pre><code>cumulus@ts02:~$ sudo systemctl restart netq-notifier.service

cumulus@ts03:~$ sudo systemctl restart netq-notifier.service
</code></pre></li>

<li><p>Verify that HA mode is configured on the three telemetry servers.
Each server should indicate that ts01 (using IP address 10.0.0.5) is
the master.</p>

<pre><code>cumulus@ts01:~$ netq config ts show server
Server    Role     Master    Replicas            Status    Last Changed
--------  -------  --------  ------------------  --------  --------------
10.0.0.5  master   10.0.0.5  10.0.0.7, 10.0.0.6  ok        55s
10.0.0.6  replica  10.0.0.5  -                   ok        55s
10.0.0.7  replica  10.0.0.5  -                   ok        55s

cumulus@ts02:~$ netq config ts show server
Server    Role     Master    Replicas            Status    Last Changed
--------  -------  --------  ------------------  --------  --------------
10.0.0.5  master   10.0.0.5  10.0.0.7, 10.0.0.6  ok        55s
10.0.0.6  replica  10.0.0.5  -                   ok        55s
10.0.0.7  replica  10.0.0.5  -                   ok        55s

cumulus@ts03:~$ netq config ts show server
Server    Role     Master    Replicas            Status    Last Changed
--------  -------  --------  ------------------  --------  --------------
10.0.0.5  master   10.0.0.5  10.0.0.7, 10.0.0.6  ok        55s
10.0.0.6  replica  10.0.0.5  -                   ok        55s
10.0.0.7  replica  10.0.0.5  -                   ok        55s
</code></pre></li>

<li><p>Update the agent on each switch and server node to point to the HA
cluster, and restart the NetQ Agent on each node:</p>

<pre><code>cumulus@switch:~$ netq config add server 10.0.0.5 10.0.0.6 10.0.0.7
Restarting netqd... Success!
cumulus@switch:~$ netq config restart agent
Restarting netq-agent... Success!
</code></pre></li>
</ol>

<h2 id="span-checking-ha-mode-status-span"><span>Checking HA Mode Status</span></h2>

<p>To check the status of the database cluster, run the following command
from a telemetry server:</p>

<pre><code>cumulus@ts01:~$ netq config ts show server
</code></pre>

<p>You can also get the detailed output of a specific server in the cluster
by specifying that server&rsquo;s IP address:</p>

<pre><code>cumulus@ts01:~$ netq config ts show server 10.0.0.7
</code></pre>

<h2 id="span-restarting-ha-mode-services-span"><span>Restarting HA Mode Services</span></h2>

<p>You can restart the <code>netq-appliance</code> and <code>netq-gui</code> services using:</p>

<pre><code>cumulus@ts01:~$ sudo systemctl restart netq-gui.service
cumulus@ts01:~$ sudo systemctl restart netq-appliance.service
</code></pre>

<h2 id="span-changing-the-master-telemetry-server-span"><span>Changing the Master Telemetry Server</span></h2>

<p>You can change which telemetry server you want to be the master simply
by changing the order in which you specify them with the <code>netq config ts
add server</code> command. You need to run the following command on each
telemetry server, waiting at least 30 seconds in between updating the
configuration on each server.</p>

<p>For example, notice that the telemetry server <em>ts01</em> is the master in
the following configuration:</p>

<pre><code>cumulus@ts01:~$ netq config ts show server
Server    Role     Master    Replicas            Status    Last Changed
--------  -------  --------  ------------------  --------  --------------
10.0.0.5  master   10.0.0.5  10.0.0.6, 10.0.0.7  ok        50s
10.0.0.6  replica  10.0.0.5  -                   ok        50s
10.0.0.7  replica  10.0.0.5  -                   ok        50s
</code></pre>

<p>To make the first replica the new master, run the following command on
each telemetry server (you don&rsquo;t need to change anything on the switch
and server nodes):</p>

<pre><code>cumulus@ts01:~$ netq config ts add server 10.0.0.6 10.0.0.5 10.0.0.7

cumulus@ts02:~$ netq config ts add server 10.0.0.6 10.0.0.5 10.0.0.7

cumulus@ts03:~$ netq config ts add server 10.0.0.6 10.0.0.5 10.0.0.7
</code></pre>

<p>Verify that <em>ts02</em> is the new master:</p>

<pre><code>cumulus@ts01:~$ netq config ts show server
Server    Role     Master    Replicas            Status    Last Changed
--------  -------  --------  ------------------  --------  --------------
10.0.0.5  replica  10.0.0.6  -                   ok        28s
10.0.0.6  master   10.0.0.6  10.0.0.7, 10.0.0.5  ok        28s
10.0.0.7  replica  10.0.0.6  -                   ok        28s
</code></pre>

<h2 id="span-replacing-a-replica-with-a-new-server-span"><span>Replacing a Replica with a New Server</span></h2>

<p>If you need to replace a telemetry server with a different physical
system, do the following steps.</p>


<div class="notices note" > <p>Do not try and replace the master server. You can only replace a
replica. If you need to replace the master, make it a replica first, as
described above.</p>
 </div>


<p>Consider the following cluster of telemetry servers:</p>

<pre><code>cumulus@ts01:~$ netq config ts show server
Server    Role     Master    Replicas            Status    Last Changed
--------  -------  --------  ------------------  --------  --------------
10.0.0.5  master   10.0.0.5  10.0.0.6, 10.0.0.7  ok        14m:10s
10.0.0.6  replica  10.0.0.5  -                   ok        14m:10s
10.0.0.7  replica  10.0.0.5  -                   ok        14m:10s
</code></pre>

<p>10.0.0.5 (ts01) is the master, while 10.0.0.6 (ts02) and 10.0.0.7 (ts03)
are the replicas. You want to replace ts03 with ts04 (10.0.0.8):</p>

<ol>
<li><p>Bring up the new telemetry server (ts04) and make sure the
connectivity is okay.</p></li>

<li><p>Bring down the telemetry server you are replacing (ts03):</p>

<pre><code>cumulus@ts03:~$ sudo shutdown
</code></pre></li>

<li><p>Execute the following NetQ command on every telemetry server to
create a cluster with the new telemetry server. Wait at least 30
seconds between each instance of the command.</p>

<pre><code>cumulus@ts01:~$ netq config ts add server 10.0.0.5 10.0.0.6 10.0.0.8

cumulus@ts02:~$ netq config ts add server 10.0.0.5 10.0.0.6 10.0.0.8

cumulus@ts04:~$ netq config ts add server 10.0.0.5 10.0.0.6 10.0.0.8
</code></pre></li>

<li><p>Verify the HA status on one of the telemetry servers. The status
should be the same on all the three telemetry servers indicating
that ts01 (10.0.0.5) is the master:</p>

<pre><code>cumulus@ts01:~$ netq config ts show server
Server    Role     Master    Replicas            Status    Last Changed
--------  -------  --------  ------------------  --------  --------------
10.0.0.5  master   10.0.0.5  10.0.0.6, 10.0.0.8  ok        5m:10s
10.0.0.6  replica  10.0.0.5  -                   ok        5m:10s
10.0.0.8  replica  10.0.0.5  -                   ok        5m:10s 
</code></pre></li>

<li><p>Update the agent on each switch and server node to point to the new
HA cluster, and restart the NetQ Agent on each node:</p>

<pre><code>cumulus@switch:~$ netq config add server 10.0.0.5 10.0.0.6 10.0.0.8
Restarting netqd... Success!
cumulus@switch:~$ netq config restart agent
Restarting netq-agent... Success!
</code></pre></li>
</ol>

<h2 id="span-resetting-the-database-cluster-span"><span>Resetting the Database Cluster</span></h2>

<p>You can force a reset of the Redis HA cluster using:</p>

<pre><code>cumulus@netq-ts:~$ netq config ts reset-cluster
</code></pre>

<h2 id="span-troubleshooting-ha-mode-span"><span>Troubleshooting HA Mode</span></h2>

<h3 id="span-relevant-services-and-configuration-files-span"><span>Relevant Services and Configuration Files</span></h3>

<p>The following <code>systemd</code> services are involved in HA mode:</p>

<ul>
<li><p>cts-auth.service: The telemetry server-side service that manages the
configuration.</p></li>

<li><p>cts-auth.socket: The telemetry server-side authorization shim socket
for the service console.</p></li>

<li><p>cts-backup.service: Runs a cron job to back up the Redis database.</p></li>

<li><p>cts-backup.timer: The timer for the backup service, with a minimum
interval of 5 minutes.</p></li>

<li><p>netqd.service: The service for the telemetry server CLI for use
locally on the server.</p></li>

<li><p>netq-appliance.service: Starts and stops all telemetry server
services <strong>except</strong> for the <code>ts-gui</code> service.</p></li>

<li><p>netq-gui.service: Starts and stops telemetry server <code>ts-gui</code>
service.</p></li>

<li><p>netq-influxdb.service: The service that manages the HA mode
InfluxDB.</p></li>

<li><p>netq-notifier.service: Starts and stops the NetQ Notifier service.</p></li>
</ul>

<p>The following configuration files are in the <code>/etc/cts/run/redis</code>
directory:</p>

<ul>
<li><p>redis_6379.conf: Contains the runtime Redis database configuration
and state.</p></li>

<li><p>snt1.conf: Contains the runtime Redis sentinel configuration and
state.</p></li>
</ul>

<p>The following log file is in the <code>/var/log</code> directory:</p>

<ul>
<li>netqd.log: The logs associated with running the NetQ CLI locally on
the machine.</li>
</ul>

<p>The NetQ Notifier log is:</p>

<ul>
<li>/var/log/netq-###.log</li>
</ul>

<p>Logging configurations are in:</p>

<ul>
<li><p>/etc/rsyslog.d</p></li>

<li><p>/etc/logrotate.d</p></li>
</ul>

<p>The following log files are in the <code>/var/log/cts</code> directory:</p>

<ul>
<li><p>cts-backup.log</p></li>

<li><p>cts-docker-compose.log</p></li>

<li><p>cts-dockerd.log</p></li>

<li><p>cts-redis.log</p></li>

<li><p>cts-sentinel.log</p></li>
</ul>

<p>For more information about the log files, see the <a href="/version/cumulus-netq-121/Troubleshooting-NetQ">Troubleshooting
NetQ</a> chapter.</p>

<h3 id="span-one-replica-must-be-available-always-span"><span>One Replica Must Be Available Always</span></h3>

<p>While HA mode is enabled, if both the replica servers go down, the
master database stops accepting writes. This causes the NetQ agents to
go into a rotten state.</p>

<p>This serves to avoid having multiple masters in a split-brain condition.
Please refer to the section &ldquo;Example 2: basic setup with three boxes&rdquo; on
the <a href="https://redis.io/topics/sentinel" target="_blank">Redis Sentinel page</a> for more
details.</p>

<article id="html-search-results" class="ht-content" style="display: none;">

</article>

<footer id="ht-footer">

</footer>
</article>

      <script src="https://utteranc.es/client.js"
        repo="CumulusNetworks/docs-internal"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
      </script>

    </div>
    

      


  

    <aside class="book-toc fixed">

  
    <div class="toc">
    
      <button>
      <a href="https://github.com/CumulusNetworks/docs/edit/master/content/version/cumulus-netq-121/Getting-Started-with-NetQ/Configuring-High-Availability-Mode.md" target="_blank" rel="noopener"><img src="/docs.cumulusnetworks.com/svg/pencil-circle.svg" alt="Edit" /> Edit this page</a>
      </button>
    
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#span-enabling-ha-mode-span"><span>Enabling HA Mode</span></a></li>
<li><a href="#span-checking-ha-mode-status-span"><span>Checking HA Mode Status</span></a></li>
<li><a href="#span-restarting-ha-mode-services-span"><span>Restarting HA Mode Services</span></a></li>
<li><a href="#span-changing-the-master-telemetry-server-span"><span>Changing the Master Telemetry Server</span></a></li>
<li><a href="#span-replacing-a-replica-with-a-new-server-span"><span>Replacing a Replica with a New Server</span></a></li>
<li><a href="#span-resetting-the-database-cluster-span"><span>Resetting the Database Cluster</span></a></li>
<li><a href="#span-troubleshooting-ha-mode-span"><span>Troubleshooting HA Mode</span></a>
<ul>
<li><a href="#span-relevant-services-and-configuration-files-span"><span>Relevant Services and Configuration Files</span></a></li>
<li><a href="#span-one-replica-must-be-available-always-span"><span>One Replica Must Be Available Always</span></a></li>
</ul></li>
</ul></li>
</ul>
</nav>
    </div>
  

</aside>






  </main>
  <footer class="footer-top">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <div class="footer-content">
            <div class="mb-4">
                <img src="https://static.cumulusnetworks.com/static/images/shared/cumulus-networks-rt-white-trademarked.ff839f1b2570.svg">
                <p>© <script type="text/javascript">document.write(new Date().getFullYear());</script> Cumulus Networks.<br>
                Site by <a href="//unomena.com/" target="_blank">Unomena</a>.</p>
            </div>
            <ul class="mb-4">
              <li><h4>Products</h4></li>
              <li><a href="//cumulusnetworks.com/products/cumulus-linux/">Cumulus Linux</a></li>
              <li><a href="//cumulusnetworks.com/products/netq/">Cumulus NetQ</a></li>
              <li><a href="//cumulusnetworks.com/products/cumulus-express/">Cumulus Express</a></li>
            </ul>
            <ul class="mb-4">
              <li><h4>Learn</h4></li>
              <li><a href="//cumulusnetworks.com/learn/web-scale-networking-education/">Going web-scale</a></li>
              <li><a href="//cumulusnetworks.com/learn/events/">Events</a></li>
              <li><a href="//cumulusnetworks.com/blog/">Blog</a></li>
            </ul>
            <ul class="mb-4">
              <li><h4>About</h4></li>
              <li><a href="//cumulusnetworks.com/about/">Our story</a></li>
              <li><a href="//cumulusnetworks.com/about/careers/">Careers</a></li>
              <li><a href="//cumulusnetworks.com/about/media-coverage/">Media coverage</a></li>
              <li><a href="//docs.cumulusnetworks.com/" target="_blank">Tech docs</a></li>
              <li><a href="//cumulusnetworks.com/community/">Community</a></li>
            </ul>
            <ul>
              <li>
                <a href="//twitter.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M23 6.628l-2-.5 1-2-2.464.7A4.48 4.48 0 0 0 12 8.128v1c-3.539.73-6.634-1.2-9.5-4.5q-.75 4 1.5 6l-3-.5c.405 2.069 1.362 3.7 4 4l-2.5 1c1 2 2.566 2.31 5 2.5a10.748 10.748 0 0 1-6.5 2c12.755 5.669 20-2.664 20-10V8.3z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//www.facebook.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                      .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M17.768 7.5H13.5V5.6a.972.972 0 0 1 1.012-1.1c.418 0 2.988.01 2.988.01V.5h-4.329C9.244.5 8.5 3.474 8.5 5.355V7.5h-3v4h3v12h5v-12h3.851z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//linkedin.com/company/cumulus-networks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                      .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M6.5 22.5h-5v-13h5zm9-9a2 2 0 0 0-2 2v7h-5v-13h5v1.485a6.307 6.307 0 0 1 3.99-1.495c2.962 0 5.01 2.2 5.01 6.355V22.5h-5v-7a2 2 0 0 0-2-2zM6.5 5A2.5 2.5 0 1 1 4 2.5 2.5 2.5 0 0 1 6.5 5z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//vimeo.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M.5 7.393l.933 1.224S3.36 7.1 4 7.859s3.1 9.925 3.915 11.617c.714 1.483 2.684 3.444 4.845 2.042s9.34-7.529 10.626-14.769-8.642-5.723-9.693.583c2.627-1.577 4.03.642 2.686 3.154s-2.569 4.145-3.211 4.145-1.135-1.679-1.868-4.613c-.76-3.035-.755-8.5-3.911-7.882C4.412 2.721.5 7.393.5 7.393z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//www.github.com/cumulusnetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                        <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                        </style>
                    </defs>
                    <path class="a" d="M19.459 17c0-5.969-4.126-3.532-7.5-3.532s-7.5-2.375-7.5 3.532a3.5 3.5 0 0 0 3.5 3.5h8a3.5 3.5 0 0 0 3.5-3.5z"></path>
                    <path class="a" d="M21.489 10.214l.032.023s2.646-4.572-.6-7.237c-2 0-5.058 3.3-5.058 3.3l.022.016A14.152 14.152 0 0 0 8.1 6.3C8.083 6.285 5.037 3 3.042 3c-3.173 2.6-.729 7.012-.614 7.217a8.876 8.876 0 0 0-1.395 5.743c.241 3.126 2.847 6.54 5.982 6.54H16.9c3.135 0 5.742-3.414 5.982-6.54a8.857 8.857 0 0 0-1.393-5.746z"></path>
                    <ellipse class="a" cx="15.48" cy="17" rx="1" ry="1.5"></ellipse>
                    <ellipse class="a" cx="8.48" cy="17" rx="1" ry="1.5"></ellipse>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//slack.cumulusnetworks.com/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                        <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                        </style>
                    </defs>
                    <rect class="a" x=".5" y=".5" width="23" height="23" rx="6" ry="6"></rect>
                    <circle class="a" cx="12" cy="12" r="6"></circle>
                    <circle class="a" cx="19" cy="5" r="1.5"></circle>
                  </svg>
                </a>
              </li>
              <li>
                <p>Cumulus Networks<sup>®</sup> — Data center networking software for the open, modern data center.</p>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </footer>
  <div class="footer-bottom">
      <div class="container">
          <div class="row">
              <div class="col-12">
                  <ul>
                      <li><a href="//cumulusnetworks.com/legal/trademarks/">Trademarks</a></li>
                      <li><a href="//cumulusnetworks.com/legal/privacy/">Privacy</a></li>
                      <li><a href="//cumulusnetworks.com/legal/">Terms of service</a></li>
                  </ul>
              </div>
          </div>
      </div>
  </div>

  
  

</body>

</html>
