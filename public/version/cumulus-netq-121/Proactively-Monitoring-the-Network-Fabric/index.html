<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Proactively Monitoring the Network Fabric | Cumulus Networks Documentation</title>

  
  <link href="https://fonts.googleapis.com/css?family=Oxygen|Oxygen+Mono:300,400,700" rel="stylesheet">

  
  
  
  <link rel="stylesheet" href="/docs.cumulusnetworks.com/book.min.a378d8a2da6f5357a83a43dff33d6f77fb70401e0399d5ba78faf81d7a1ae1a8.css">

  
  <link rel="icon" href="/docs.cumulusnetworks.com/icons/favicon.png" type="image/x-icon">

  
  <link rel="alternate" type="application/rss+xml" href="docs.cumulusnetworks.com/version/cumulus-netq-121/Proactively-Monitoring-the-Network-Fabric/index.xml" title="Cumulus Networks Documentation" />
  <!--
  Made with Book Theme
  https://github.com/alex-shpak/hugo-book
  -->

  
  
  <script src = "/docs.cumulusnetworks.com/js/codecopy.js"> </script>

</head>


<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  
  <header id="site-nav">
    <div class="header-wrapper flex">
      <a href="/">
        <img src="/header-logo.png" alt="Cumulus Networks">
        <img src="/cumulus-networks-rt-white.svg" alt="Cumulus Networks" class="header-mobile">
        <span>Docs</span>
      </a>
      <ul class="flex">
        <li><a href="//cumulusnetworks.com">HOME</a></li>
        <li><a href="//support.cumulusnetworks.com/">SUPPORT</a></li>
        <li><a href="//docs.cumulusnetworks.com/">DOCS</a></li>
        <li><a href="//education.cumulusnetworks.com">EDUCATION</a></li>
        <li><a href="//cumulusnetworks.com/blog/">BLOG</a></li>
        <li><a href="//forums.cumulusnetworks.com/">FORUMS</a></li>
      </ul>
      <div class="burger-menu">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </header>
  <div id="product-nav" class="flex">
      
    
    <ul>
    
      <li><a href = docs.cumulusnetworks.com/cumulus-linux/ >
        Cumulus Linux </a> </li>
    
      <li class = "active" ><a href = docs.cumulusnetworks.com/cumulus-netq/ >
        Cumulus NetQ </a> </li>
    
      <li><a href = docs.cumulusnetworks.com/cumulus-vx/ >
        Cumulus VX </a> </li>
    
      <li>
        <div id="products-dropdown" class="dropdown">
            <button class="btn" type="button" id="dropdownMenuButton">
              Products
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <a class="dropdown-item" href="">Cumulus RMP</a>
              <a class="dropdown-item" href="">Cumulus Chassis</a>
              <a class="dropdown-item" href="">Cumulus Host Pack</a>
            </div>
        </div>
      </li>
    </ul>
    <div class="search-container">
      <div id="doc-search-box">
        <input type="text" class="doc-search-input" placeholder="Search" value="">
        <span><button type="submit"><img src="/icons/search_20x20.svg" alt=""></button></span>
      </div>
      <div id="dropdown" class="dropdown">
          <button class="btn" type="button" id="dropdownMenuButton">
            v1.2.1
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/cumulus-netq/"> v2.2.0</a>
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-netq-10/"> v1.0.0</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-netq-110/"> v1.1.0</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-netq-121/"> v1.2.1</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-netq-141/"> v1.4.1</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-netq-21/"> v2.1</a>
            
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
          </div>
      </div>
    </div>
  </div>
  <main class="flex container">
    <aside class="book-menu fixed">

      <nav role="navigation">
        <h2 class="book-brand">
          <a href="docs.cumulusnetworks.com">Cumulus Networks Documentation</a>
        </h2>
        
        




  <ul class = "cn-book-section-container" id = "top">
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
            

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/" >
    Cumulus NetQ
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Getting-Started-with-NetQ/" >
    Getting Started with NetQ
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Getting-Started-with-NetQ/Configuring-High-Availability-Mode/" >
    Configuring High Availability Mode
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Getting-Started-with-NetQ/Upgrading-NetQ/" >
    Upgrading NetQ
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Proactively-Monitoring-the-Network-Fabric/"  class="active" >
    Proactively Monitoring the Network Fabric
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Proactively-Monitoring-the-Network-Fabric/MLAG-Troubleshooting-with-NetQ/" >
    MLAG Troubleshooting with NetQ
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Early-Access-Features/" >
    Early Access Features
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Early-Access-Features/Chassis-Integration/" >
    Chassis Integration
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Early-Access-Features/Extending-NetQ-with-Custom-Commands/" >
    Extending NetQ with Custom Commands
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Early-Access-Features/Querying-the-NetQ-Database/" >
    Querying the NetQ Database
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Early-Access-Features/Collecting-Interface-Statistics/" >
    Collecting Interface Statistics
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Getting-to-Know-NetQ/" >
    Getting to Know NetQ
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/NetQ-Service-Console/" >
    NetQ Service Console
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Taking-Preventative-Steps-with-Your-Network/" >
    Taking Preventative Steps with Your Network
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Performing-Network-Diagnostics/" >
    Performing Network Diagnostics
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Monitoring-the-Physical-Layer/" >
    Monitoring the Physical Layer
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Monitoring-Linux-Hosts-with-NetQ/" >
    Monitoring Linux Hosts with NetQ
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Monitoring-Container-Environments-with-NetQ/" >
    Monitoring Container Environments with NetQ
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Using-NetQ-Virtual-Environments/" >
    Using NetQ Virtual Environments
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Restoring-from-Backups-with-NetQ/" >
    Restoring from Backups with NetQ
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-121/Troubleshooting-NetQ/" >
    Troubleshooting NetQ
  </a>


    </li>
    
  </ul>


  </li>


          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  </ul>









      </nav>

      
      
      
      

      <script src = "/docs.cumulusnetworks.com/js/menuBundle.js"> </script>


    </aside>

    <div class="book-page">

      
      <header class="align-center justify-between book-header">
        <label for="menu-control">
          <img src="/docs.cumulusnetworks.com/svg/menu.svg" alt="Menu" />
        </label>
        <strong>Proactively Monitoring the Network Fabric</strong>
      </header>

      
      
<div class= "notices info" id = "info" >
  This documentation is for an older version of the software. If you are using the current version of Cumulus Linux, this content may not be up to date. The current version of the documentation is available [here](https://docs.cumulusnetworks.com/).
  </div>
<article class="markdown">
<h1>Proactively Monitoring the Network Fabric</h1>

<p><details></p>

<p>NetQ continually and algorithmically checks for various network events
(see below) and sends real-time alerts via <em>NetQ Notifier</em> to notify
users that a network event occurs. When alerted, you can determine
precisely where the fault occurred so you can remediate quickly.</p>

<p>You can create filters for how to handle notifications and you can also
ignore notifications.</p>

<h2 id="span-netq-notifier-span"><span>NetQ Notifier</span></h2>

<p>The NetQ Notifier&rsquo;s role within the NetQ suite of applications is to
deliver alerts to users through mediums such as Slack and syslog,
informing users of network events.</p>








<img class = "confluence-embedded-image" src = "/images/download/attachments/8356545/netq-notifier-and-redis.png" alt = "/images/download/attachments/8356545/netq-notifier-and-redis.png"


 />


<p>Notifications can be generated for the following network events:</p>

<ul>
<li><p>Agent node state</p></li>

<li><p>Backend connections</p></li>

<li><p>Fan</p></li>

<li><p>License</p></li>

<li><p>NTP</p></li>

<li><p>OS</p></li>

<li><p>Port</p></li>

<li><p>PSU</p></li>

<li><p>Services</p></li>

<li><p>Temperature</p></li>
</ul>

<p>When a notification arrives, what should you do next? Typically, you
could run <code>netq check</code> commands; see <a href="/version/cumulus-netq-121/Performing-Network-Diagnostics">Performing Network
Diagnostics</a>
for more information. For a thorough example, read about troubleshooting
<a href="/version/cumulus-netq-121/Proactively-Monitoring-the-Network-Fabric/MLAG-Troubleshooting-with-NetQ">MLAG node
failures</a>.</p>

<h3 id="span-log-message-format-span"><span>Log Message Format</span></h3>

<p>Messages have the following structure:</p>

<pre><code>&lt;timestamp&gt; &lt;node&gt; &lt;service&gt;[PID]: &lt;level&gt; &lt;type&gt;: &lt;message&gt;
</code></pre>

<p>For example:</p>

<pre><code>2017-08-28T22:43:32.794669+00:00 spine01 netq-notifier[13232]: INFO: filter#default: BGP: leaf01 peerlink-1.4094: session state changed from failed to established
</code></pre>

<h3 id="span-supported-integrations-span"><span>Supported Integrations</span></h3>

<p>NetQ supports the ability to send notifications to the following
applications:</p>

<ul>
<li><p><strong>PagerDuty</strong>: NetQ Notifier sends notifications to PagerDuty as
PagerDuty events.</p>








<img class = "confluence-embedded-image" src = "/images/download/attachments/8356545/NetQ-PagerDuty.png" alt = "/images/download/attachments/8356545/NetQ-PagerDuty.png"

height = 250


 />



<div class="notices note" > <pre><code>If NetQ generates multiple notifications, on the order of 50/second
(which could happen when a node reboots or when one peer in an MLAG
pair disconnects), PagerDuty does not see all these notifications.
You may see warnings in the `netq-notifier.log` file like this:

    2017-09-20T20:39:48.222458+00:00 rdsq1 netq-notifier[1]: WARNING: Notifier: notifier-pagerduty: Request failed with exception: Code: 429, msg: {&quot;status&quot;:&quot;throttle exceeded&quot;,&quot;message&quot;:&quot;Requests for this service are arriving too quickly.  Please retry later.&quot;}

This is a known limitation in PagerDuty at this time.
</code></pre>
 </div>
</li>

<li><p><strong>Slack</strong>: NetQ Notifier sends notifications to Slack as incoming
webhooks for a Slack channel you configure. For example:</p>








<img class = "confluence-embedded-image" src = "/images/download/attachments/8356545/NetQ-Slack-channel.png" alt = "/images/download/attachments/8356545/NetQ-Slack-channel.png"

height = 250


 />
</li>

<li><p><strong>rsyslog:</strong> Using <code>rsyslog</code>, NetQ Notifier sends alerts and events
to the <code>/var/log/netq-notifier.log</code> file by default, but
notifications can also be sent to ELK/Logstash or Splunk.</p>








<img class = "confluence-embedded-image" src = "/images/download/attachments/8356545/netq-notifier.log.png" alt = "/images/download/attachments/8356545/netq-notifier.log.png"

height = 150


 />
</li>

<li><p><strong>Splunk</strong>: NetQ integrates with Splunk using <code>rsyslog</code>, a standard
mechanism to capture log files in Linux. Splunk provides plugins to
handle <code>rsyslog</code> inputs.</p>








<img class = "confluence-embedded-image" src = "/images/download/attachments/8356545/NetQ-1.1-splunk.png" alt = "/images/download/attachments/8356545/NetQ-1.1-splunk.png"

height = 150


 />
</li>

<li><p><strong>ELK/Logstash</strong>: NetQ integrates with ELK/Logstash using <code>rsyslog</code>.
ELK also provides plugins to handle <code>rsyslog</code> inputs.</p>








<img class = "confluence-embedded-image" src = "/images/download/attachments/8356545/NetQ-1.1-logstash.png" alt = "/images/download/attachments/8356545/NetQ-1.1-logstash.png"

height = 150


 />
</li>
</ul>

<h3 id="span-configuring-an-integration-span"><span>Configuring an Integration</span></h3>

<p>You need to define to which applications NetQ sends notifications. By
default, NetQ sends notifications only to <code>syslog</code>.</p>

<p>To configure PagerDuty or Slack, you need to edit the
<code>/etc/netq/netq.yml</code> configuration file.</p>

<pre><code>cumulus@switch:~$ sudo nano /etc/netq/netq.yml

...

## a) Filter notifications to integrations (Slack or PD) based on Severity,
## i.e., WARNING to PD, INFO to Slack
# notifier-integrations:
# - name: notifier-slack-channel-1
#   type: slack
#   webhook: &quot;https://&lt;slack-webhook1&quot;
#   severity: INFO  &lt;==== Set the severity type here
#   tag: &quot;&lt;@slack-tag1&gt;&quot;
# - name: notifier-pagerduty
#   type: pagerduty
#   severity: WARNING &lt;==== Set the severity type here
#   api_access_key: &quot;&lt;API Key&gt;&quot;
#   api_integration_key: &quot;&lt;API Integration Key&gt;&quot;
#

...
</code></pre>


<div class="notices tip" > <p>For Slack notifications, the contents of <em>tag</em> is added to the
notification message to be sent, which is useful for setting alerts for
notifications within Slack.</p>

<p>In order to tag users, enclose the username and &ldquo;@&rdquo; sign in angled
brackets, like this: <em>&lt;@cumulus&gt;</em>.</p>
 </div>


<p>You need to do some extra steps to be able to export NetQ data to
<a href="#src-8356545_ProactivelyMonitoringtheNetworkFabric-elk">ELK</a> or
<a href="#src-8356545_ProactivelyMonitoringtheNetworkFabric-splunk">Splunk</a> (see
below).</p>

<p>After you modify the NetQ configuration, you must restart the
<code>netq-notifier</code> service on the telemetry server:</p>

<pre><code>cumulus@switch:~$ sudo systemctl restart netq-notifier.service
</code></pre>

<h3 id="span-filtering-notifications-span"><span>Filtering Notifications</span></h3>

<p>By default, NetQ sends all notifications in response to network events.
You can filter this according to your needs.</p>

<p>A filter has three components, a <em>rule</em>, an <em>action</em> and <em>output</em>:</p>

<ul>
<li><p><strong>Rule</strong>: A set of conditions against which an incoming event is
matched. If an incoming event matches the rule, the event
information is passed to the action. The rule is a dictionary of
key-value pairs, where the &ldquo;key&rdquo; is an item associated with the
event and &ldquo;value&rdquo; is the value of that item. For example:<br />
rule:<br />
hostname: leaf01<br />
ifname: swp1</p>

<p>If the default rule is not specified or if it is empty, a match
always results. You can make NetQ Notifier continue matching filters
even if a match is found, by adding <em>terminate_on_match: False</em> to
the filter. Values specified in the rule are matched with those
received in a event using <a href="https://docs.python.org/2/library/re.html" target="_blank">Python regular
expressions</a>. NetQ also
matches for message severity and sends a notification only if the
event is above the given severity. Message severity levels are:
INFO, WARNING, ERROR and CRITICAL in ascending order.</p></li>

<li><p><strong>Action</strong>: The action to perform if the rule matches. The action
takes the event provided by the rule stage and generates a message
dictionary with a message and its severity. Multiple actions can be
prescribed in the action list. An action is typically a Python
function that is provided with NetQ or you can write a custom one
yourself. If no action is provided, NetQ defaults to a generic
handler that looks at the event, and based on that event runs the
relevant notification function.</p></li>

<li><p><strong>Output</strong>: The integrations that will receive the notification. The
output contains the message and severity. If the output is <em>None</em>
the notification is not sent to any integration, including <code>syslog</code>.
If the output is empty, the message is sent only to <code>syslog</code>.
Otherwise, the notification is sent to the list of integrations
specified in the output list as well as to <code>syslog</code>. If ALL is
specified, the notification is sent to all integrations.</p></li>
</ul>

<p>For example, to send BGP session state notifications to particular Slack
channel, in this case, <em>slack-channel-BGP</em>, do the following:</p>

<pre><code>cumulus@switch:~$ sudo nano /etc/netq/netq.yml

...

## e) Send BGP Session state notifications to particular slack channel
## (slack-channel-BGP), rest to another one (slack-channel-catchall)
# notifier-filters:
# - name: BGP slack channel
# rule:
# type: BgpSession
# output:
# - slack-channel-BGP


...
</code></pre>

<p>To drop notifications, set the output to None for the given rule in the
<code>/etc/netq/netq.yml</code> file. For example, you can drop all notifications
from leaf01 by configuring the following:</p>

<pre><code>cumulus@switch:~$ sudo nano /etc/netq/netq.yml

...

## b) Drop all notifications coming from a switch/host say, leaf01
# notifier-filters:
# - name: leaf01 drop
#   rule:
#     hostname: leaf01
#   output:
#     - None
# - name: default
#   rule:
#   output:
#     - ALL

...
</code></pre>

<h3 id="span-example-netq-yml-file-span"><span>Example netq.yml File</span></h3>

<p><summary>/etc/netq/netq.yml file contents </summary></p>

<pre><code>cumulus@switch:~$ cat /etc/netq/netq.yml
## Netq configuration File.
## Configuration is also read from files in /etc/netq/config.d/ and have
## precedence over config in /etc/netq/netq.yml.
## ----- Common configurations -----
## Backend Configuration for all netq agents and apps on this host.
##
backend:
  server: 10.0.0.165
#  port: 6379
## ----- netq-agent configurations -----
## Netq Agent Configuration
##
## log_level: Could be debug, info, warning or error. Default is info.
##
#netq-agent:
#  log_level: info
## Docker Agent Configuration
##
## docker_enable: Enable Docker monitoring. Default is True.
## docker_poll_period: Docker poll period in secs. Default is 15 secs.
##
#docker:
#  enable: true
#  poll_period: 15
## ----- netq configurations -----
## Netq configuration
##
## log_level: Could be debug, info, warning or error. Default is info.
##
#netqd:
#  log_level: info
## ----- netq-notifier configurations -----
## Netq Notifier Configuration
##
## log_level: Could be debug, info, warning or error. Default is info.
##
# netq-notifier:
#  log_level: debug
## NetQ Notifier Filter Configuration
##
## NetQ Notifier sends notifications to integrations(syslog, slack or pagerduty)
## based on the events that are happening across the network.
## Notifications are generated based on the filters that have been specified in
## &quot;notifier-filters&quot;.  NetQ Agents generate an event when something interesting
## happens on the host (switch or server) its running on. The Notifier is always
## listening for these events and once it receives an event, it makes it go
## through a set of filters.
##
## A filter has 3 stages:
## a) Rule: Defines a set of conditions against which an incoming event is
## matched. Input to this stage is an incoming event and the event is sent to
## the next stage if there is a match. If there is a match, the event
## information is passed to the action stage. The rule is a dictionary of
## key-value pairs, where the &quot;key&quot; is an item associated with the event and
## &quot;value&quot; is the value of that item,
## e.g. type: Link
##      hostname: leaf-01
##      ifname: swp1
## The Default rule, if none is specified or if it is empty, is to always assume
## a match.
## Notifier-filter rules are matched sequentially and we stop only when a match
## is found. You can make the notifier continue matching filters even if a match
## is found, by adding &quot;terminate_on_match: False&quot; to the filter.Values
## specified in the rule are matched with those received in a event using python
## regular expressions  https://docs.python.org/2/library/re.html
## We can also match for message severity and print messages only if it is above
## the given severity. Message severity levels are: INFO, WARNING, ERROR and
## CRITICAL in ascending order.
##
## b) Action: action to perform if the &quot;rule&quot; is matched.  The action stage
## take the event provided by the &quot;rule&quot; stage and generates a message
## dictionary with a message and its severity. Multiple actions can be
## prescribed in the &quot;action&quot; list. &quot;action&quot; is typically a python function that
## is provided with the tool or a custom one written by the user. If no action
## is provided, we default to a generic handler which looks at the event and
## based on the event runs the relevant notification function.
##
## c) output: This stage takes the message dictionary provided by the action
## stage and sends the message and severity to the right integration to display
## the message. If the output is None the message is not sent to any integration
## or syslog. If output is empty, the message is sent only to syslog. Else the
## message is sent to the list of integrations specified in the output list and
## syslog. If ALL is specified, the message is sent to all integrations.
## Integrations are defined in notifier-integrations.
##
## The config file comes with the following default filter:
##
## notifier-filters:
## - name: default
##   rule:
##   output:
##     - ALL
##
## which is an empty rule, empty action and output to all. This defaults to
## match all rules and then perform the default action which is to run the
## generic handler mentioned in the action stage above.
##
## NetQ Integration Configuration
##
## The integrations refer to the external tool where you would like to receive
## the notification. An integration is added as a list element to
## &quot;notifier-integrations&quot;. Each integration must have a &quot;name&quot; and &quot;type&quot;.
## Severity is optional and lets you send messages above that level to the
## integration. Allowed values are: INFO, WARNING, ERROR, CRITICAL in increasing
## order. Currently allowed &quot;type&quot; are &quot;slack&quot; and &quot;pagerduty&quot;. You can define
## multiple slack or PD integrations.
##
##For Slack integration, along with a name and &quot;type: slack&quot;, you also need to
## also provide the Incoming Webhook of the channel. The webhook URL for your
## channel can be found or created in Slack at:
##   Apps -&gt; Custom Integrations -&gt; Incoming Webhooks.
## Tags are optional and are strings that are attached to the end of th
## notification message.
## E.g.
# notifier-integrations:
# - name: notifier-slack-channel-1
#   type: slack
#   webhook: &quot;https://&lt;slack-webhook1&gt;&quot;
#   severity: INFO,
#   tag: &quot;@slack-tag1&quot;
##
## For pagerDuty, along with name and &quot;type: pagerduty&quot;, you also need to
## provide the &quot;api_access_key&quot; and &quot;api_integration_key&quot; from Pagerduty.
## A unique API Access Key which can be created on your PagerDuty website at:
## Configuration -&gt; API Access -&gt; Create New API Key
## An 'Integration Key' can be created/found on your PagerDuty website at:
## Configuration -&gt; Services -&gt; Add New Service -&gt; New Integration -&gt;
##   Select Integration Type as 'Use our API directly: Events API v2'.
## E.g. pagerduty integration along with slack
# notifier-integrations:
# - name: notifier-slack-channel-1
#   type: slack
#   webhook: &quot;https://&lt;slack-webhook1&gt;&quot;
#   severity: INFO
#   tag: &quot;@slack-tag1&quot;
# - name: notifier-pagerduty
#   type: pagerduty
#   severity: WARNING
#   api_access_key: &lt;API Key&gt;
#   api_integration_key: &lt;API Integration Key&gt;
##
## Customizing Notifications
## Here are some examples on how to customize your notifications:
##
## a) Filter notifications to integrations (Slack or PD) based on Severity,
## i.e., WARNING to PD, INFO to Slack
# notifier-integrations:
# - name: notifier-slack-channel-1
#   type: slack
#   webhook: &quot;https://&lt;slack-webhook1&quot;
#   severity: INFO  &lt;==== Set the severity type here
#   tag: &quot;@slack-tag1&quot;
# - name: notifier-pagerduty
#   type: pagerduty
#   severity: WARNING &lt;==== Set the severity type here
#   api_access_key: &quot;&lt;API Key&gt;&quot;
#   api_integration_key: &quot;&lt;API Integration Key&gt;&quot;
#
##
## b) Drop all notifications coming from a switch/host say, leaf-01
# notifier-filters:
# - name: leaf-01 drop
#   rule:
#     hostname: leaf-01
#   output:
#     - None
# - name: default
#   rule:
#   output:
#     - ALL
##
## c) Drop all notifications coming from switches whose name starts with leaf
# notifier-filters:
# - name: leaf drop
#   rule:
#     hostname: &quot;leaf-.*&quot;
#   output:
#     - None
# - name: default
#   rule:
#   output:
#     - ALL
##
## d) Drop all notifications coming from a particular link, e.g. leaf-01 swp1
# notifier-filters:
# - name: leaf-01 swp1 drop
#   rule:
#     type: Link
#     hostname: leaf-01
#     ifname: swp1
#   output:
#     - None
# - name: default
#   rule:
#   output:
#    - ALL
##
## e) Send BGP Session state notifications to particular slack channel
## (slack-channel-BGP), rest to another one (slack-channel-catchall)
# notifier-filters:
# - name: BGP slack channel
#   rule:
#     type: BgpSession
#   output:
#     - slack-channel-BGP
# - name: default
#   rule:
#   output:
#     - slack-channel-catchall
##
## f) Send BgpSession notifications based on severity to different slack channels
# notifier-filters:
# - name: BGP severity slack channel
#   rule:
#     type: BgpSession
#     severity: WARNING
#   output:
#     - slack-channel-BGP-info
# - name: default
#   rule:
#   output:
#     - slack-channel-catchall
##
## g) Drop all temperature related alerts
# notifier-filters:
# - name: temp drop
#   rule:
#     type: Temp
#   output:
#     - None
# - name: default
#   rule:
#   output:
#     - ALL
notifier-filters:
  - name: default
    rule:
    output:
      - ALL
</code></pre>

<h3 id="span-id-src-8356545-proactivelymonitoringthenetworkfabric-elk-class-confluence-anchor-link-span-span-exporting-to-elk-span"><span id="src-8356545_ProactivelyMonitoringtheNetworkFabric-elk" class="confluence-anchor-link"></span><span>Exporting to ELK</span></h3>

<p>To export NetQ Notifier data to ELK via Logstash, on the host running
the NetQ Telemetry Server and NetQ Notifier, configure the notifier to
send the logs to a Logstash instance. In the following example, Logstash
is on a host with the IP address 192.168.50.30, using port 51414:</p>

<pre><code># rsyslog - logstash configuration 
sed -i '/$netq_notifier_log/a if $programname == &quot;netq-notifier&quot; then @@192.168.50.30:51414' /etc/rsyslog.d\
/50-netq-notifier.conf
</code></pre>

<p>Then restart <code>rsyslog</code>:</p>

<pre><code>root@ts_host:~# systemctl restart rsyslog
</code></pre>

<p>On the server running Logstash, create a file in <code>/etc/logstash/conf.d/</code>
called <code>notifier_logstash.conf</code>, and paste in the following text, using
the IP address and port you specified earlier:</p>

<pre><code>root@ts_host:~#vi /etc/logstash/conf.d/notifier_logstash.conf

input {
    syslog {
        type =&gt; syslog
        port =&gt; 51414                                                                
    }
}
output {
    file {
        path =&gt; &quot;/tmp/logstash_notifier.log&quot;                                                                                  
    }
}
</code></pre>

<p>Then restart Logstash:</p>

<pre><code>root@logstash_host:~# systemctl restart logstash
</code></pre>

<p>NetQ Notifier logs now appear in <code>/tmp/logstash_notifier.log</code> on the
Logstash host.</p>

<h3 id="span-id-src-8356545-proactivelymonitoringthenetworkfabric-splunk-class-confluence-anchor-link-span-span-exporting-to-splunk-span"><span id="src-8356545_ProactivelyMonitoringtheNetworkFabric-splunk" class="confluence-anchor-link"></span><span>Exporting to Splunk</span></h3>

<p>To export NetQ Notifier data to Splunk, on the host running the NetQ
Telemetry Server and NetQ Notifier, configure the notifier to send the
logs to Splunk. In the following example, Splunk is on a host with the
IP address 192.168.50.30, using port 51414:</p>

<pre><code># rsyslog - splunk configuration 
sed -i /$netq_notifier_log/a if $programname == netq-notifier then @@192.168.50.30:51415 /etc/rsyslog.d\
/50-netq-notifier.conf
</code></pre>

<p>Then restart <code>rsyslog</code>:</p>

<pre><code>root@ts_host:~# systemctl restart rsyslog
</code></pre>

<p>To configure Splunk, do the following:</p>

<ol>
<li><p>In Splunk in a browser, choose <strong>Add Data</strong> &gt; <strong>monitor</strong> &gt;
<strong>TCP</strong> &gt; <strong>Port</strong>, and set it to <em>51415</em>.</p></li>

<li><p>Click <strong>Next</strong>, then choose <strong>Source Type (syslog)</strong> &gt; <strong>Review</strong>
&gt; <strong>Done</strong>.</p></li>
</ol>

<p>NetQ Notifier messages now appear in Splunk.</p>

<h3 id="span-precisely-locating-an-issue-on-the-network-span"><span>Precisely Locating an Issue on the Network</span></h3>

<p>NetQ helps you locate exactly where you have an issue on your network.
Use <code>netq check</code> or <code>netq trace</code> to locate a fault, then run <code>netq show
changes</code> to see what could have caused it.</p>

<p>For example, checking the state of the VLANs on your network, you can
see where some nodes have mismatched VLANs with their peers:</p>

<table>
<colgroup>
<col style="width: 100%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p><code>cumulus@leaf01:~$ netq check vlan </code><br />
<code>Checked Nodes: 25, Checked Links: 775, Failed Nodes: 3, Failed Links: 6 Vlan and/or PVID mismatch found on following links </code><br />
<code>Hostname Interface Vlans Peer Peer Interface Peer Vlans Error</code><br />
<code>-------- ----------- ----------------- ------- ---------------- ----------------- -----------------</code><br />
<code>server01 torbond1 103-106,1000-1005 leaf02 hostbond2 101-106,1000-1005 VLAN set Mismatch</code><br />
<code>server01 torbond1 103-106,1000-1005 leaf01 hostbond2 101-106,1000-1005 VLAN set Mismatch</code><br />
<code>server02 torbond1 102-106,1000-1005 leaf02 hostbond3 101-106,1000-1005 VLAN set Mismatch</code><br />
<code>server02 torbond1 102-106,1000-1005 leaf01 hostbond3 101-106,1000-1005 VLAN set Mismatch</code><br />
<code>server03 torbond1 102-106,1000-1005 leaf04 hostbond2 101-106,1000-1005 VLAN set Mismatch</code><br />
<code>server03 torbond1 102-106,1000-1005 leaf03 hostbond2 101-106,1000-1005 VLAN set Mismatch</code></p></td>
</tr>
</tbody>
</table>

<h3 id="span-id-src-8356545-proactivelymonitoringthenetworkfabric-ntp-class-confluence-anchor-link-span-span-detecting-out-of-sync-nodes-span"><span id="src-8356545_ProactivelyMonitoringtheNetworkFabric-ntp" class="confluence-anchor-link"></span><span>Detecting Out of Sync Nodes</span></h3>

<p>NetQ includes commands to assist in determining if any nodes are out of
sync. Use <code>netq check ntp</code> to determine if any nodes are out of sync,
and <code>netq show services ntp</code> and <code>netq show ntp</code> to review the records:</p>

<pre><code>cumulus@switch:~$ netq check ntp
Total Nodes: 18, Checked Nodes: 18, Rotten Nodes: 7, Unknown Nodes: 0, failed NTP Nodes: 8
Hostname        NTP Sync    Connect Time
--------------  ----------  -------------------
act-5712-12     Rotten      2017-09-01 09:15:30
act-6712-06     Rotten      2017-09-01 09:16:02
act-7712-04     Rotten      2017-09-01 09:16:05
cel-smallxp-13  no          2017-08-26 01:15:00
dell-s4000-10   Rotten      2017-09-01 09:14:53
dell-s6000-22   Rotten      2017-09-01 09:15:29
mlx-2410-02     Rotten      2017-09-01 09:16:23
qct-ly8-04      Rotten      2017-09-01 09:14:56

cumulus@switch:~$ netq show services ntp
Matching services records are:
Node             Service      PID  VRF      Enabled    Active    Monitored    Status    Up Time    Last Changed
---------------  ---------  -----  -------  ---------  --------  -----------  --------  ---------  --------------
leaf01           ntp          913  default  yes        yes       no           ok        2h ago     2h ago
leaf02           ntp          911  default  yes        yes       no           ok        2h ago     2h ago
leaf03           ntp          909  default  yes        yes       no           ok        2h ago     2h ago
leaf04           ntp          910  default  yes        yes       no           ok        2h ago     2h ago
oob-mgmt-server  ntp          729  default  yes        yes       no           ok        2h ago     2h ago
spine01          ntp          909  default  yes        yes       no           ok        2h ago     2h ago
spine02          ntp          909  default  yes        yes       no           ok        2h ago     2h ago

cumulus@switch:~$ netq show ntp
Hostname        NTP Sync    Current Server    Stratum
--------------  ----------  ----------------  ---------
act-5712-12     -           -                 -
act-6712-06     -           -                 -
act-7712-04     -           -                 -
cel-bs01-fc1    yes         chimera.buffero   2
cel-bs01-fc2    yes         104.156.99.226    2
cel-bs01-fc4    yes         104.156.99.226    2
cel-bs01-lc101  yes         chimera.buffero   2
cel-bs01-lc102  yes         secure.visionne   2
cel-bs01-lc201  yes         chimera.buffero   2
cel-bs01-lc202  yes         secure.visionne   2
cel-bs01-lc301  yes         chimera.buffero   2
cel-bs01-lc401  yes         104.156.99.226    2
cel-bs01-lc402  yes         chimera.buffero   2
cel-smallxp-13  no          -                 16
dell-s4000-10   -           -                 -
dell-s6000-22   -           -                 -
mlx-2410-02     -           -                 -
qct-ly8-04      -           -                 -
{code}
</code></pre>


<div class="notices warning" > <p>These commands require <code>systemd</code> in order to run correctly.</p>
 </div>


<h2 id="span-extending-netq-with-custom-services-using-curl-span"><span>Extending NetQ with Custom Services Using curl</span></h2>

<p>You can extend NetQ to monitor parameters beyond what it monitors by
default. For example, you can create a service that runs a series of
pings to a known host or between two known hosts to ensure that
connectivity is valid. Or you can create a service that curls a URL and
sends the output to <code>/dev/null</code>. This method works with the <a href="Performing-Network-Diagnostics.html#src-8356555_PerformingNetworkDiagnostics-time_machine" target="_blank">NetQ time
machine</a>
capability regarding <code>netq show services</code>.</p>

<ol>
<li><p>As the sudo user on a node running the NetQ agent, edit the
<code>/etc/netq/config.d/netq-agent-commands.yml</code> file.</p></li>

<li><p>Create the custom service. In the example below, the new service is
called <em>web</em>. You need to specify:</p>

<ul>
<li><p>The <em>period</em> in seconds.</p></li>

<li><p>The <em>key</em> that identifies the name of the service.</p></li>

<li><p>The command will <em>run</em> always. If you do not specify <em>always</em>
here, you must enable the service manually using <code>systemctl</code>.</p></li>

<li><p>The <em>command</em> to run. In this case we are using <code>curl</code> to ping a
web server.</p></li>
</ul>

<!-- end list -->

<pre><code>cumulus@leaf01:~$ sudo vi /etc/netq/config.d/netq-agent-commands.yml 

user-commands:
  - service: 'misc'
    commands:
      - period: &quot;60&quot;
        key: &quot;config-interfaces&quot;
        command: &quot;/bin/cat /etc/network/interfaces&quot;
      - period: &quot;60&quot;
        key: &quot;config-ntp&quot;
        command: &quot;/bin/cat /etc/ntp.conf&quot;
  - service: &quot;zebra&quot;
    commands:
      - period: &quot;60&quot;
        key: &quot;config-quagga&quot;
        command: [&quot;/usr/bin/vtysh&quot;, &quot;-c&quot;, &quot;show running-config&quot;]

  - service: &quot;web&quot;
    commands:
      - period: &quot;60&quot;
        key: &quot;webping&quot;
        run: &quot;always&quot;
        command: ['/usr/bin/curl https://cumulusnetworks.com/ -o /dev/null']
</code></pre></li>

<li><p>After you save and close the file, restart the NetQ agent:</p>

<pre><code>cumulus@leaf01:~$ netq config agent restart
</code></pre></li>

<li><p>You can verify the command is running by checking the
<code>/var/run/netq-agent-running.json</code> file:</p>

<pre><code>cumulus@leaf01:~$ cat /var/run/netq-agent-running.json
{&quot;commands&quot;: [{&quot;service&quot;: &quot;smond&quot;, &quot;always&quot;: false, &quot;period&quot;: 30, &quot;callback&quot;: {}, &quot;command&quot;: &quot;/usr/sbin/smonctl -j&quot;, &quot;key&quot;: &quot;smonctl-json&quot;}, {&quot;service&quot;: &quot;misc&quot;, &quot;always&quot;: false, &quot;period&quot;: 30, &quot;callback&quot;: {}, &quot;command&quot;: &quot;/usr/sbin/switchd -lic&quot;, &quot;key&quot;: &quot;cl-license&quot;}, {&quot;service&quot;: &quot;misc&quot;, &quot;always&quot;: false, &quot;period&quot;: 30, &quot;callback&quot;: {}, &quot;command&quot;: null, &quot;key&quot;: &quot;ports&quot;}, {&quot;service&quot;: &quot;misc&quot;, &quot;always&quot;: false, &quot;period&quot;: 60, &quot;callback&quot;: null, &quot;command&quot;: &quot;/bin/cat /etc/network/interfaces&quot;, &quot;key&quot;: &quot;config-interfaces&quot;}, {&quot;service&quot;: &quot;misc&quot;, &quot;always&quot;: false, &quot;period&quot;: 60, &quot;callback&quot;: null, &quot;command&quot;: &quot;/bin/cat /etc/ntp.conf&quot;, &quot;key&quot;: &quot;config-ntp&quot;}, {&quot;service&quot;: &quot;lldpd&quot;, &quot;always&quot;: false, &quot;period&quot;: 30, &quot;callback&quot;: {}, &quot;command&quot;: &quot;/usr/sbin/lldpctl -f json&quot;, &quot;key&quot;: &quot;lldp-neighbor-json&quot;}, {&quot;service&quot;: &quot;mstpd&quot;, &quot;always&quot;: false, &quot;period&quot;: 15, &quot;callback&quot;: {}, &quot;command&quot;: &quot;/sbin/mstpctl showall json&quot;, &quot;key&quot;: &quot;mstpctl-bridge-json&quot;}], &quot;backend&quot;: {&quot;server&quot;: &quot;10.0.0.165&quot;}}
</code></pre></li>

<li><p>And you can see the service is running on the host when you run
<code>netq show services</code>:</p>

<pre><code>cumulus@leaf01:~$ netq show services web
</code></pre></li>
</ol>

<h2 id="span-exporting-netq-data-span"><span>Exporting NetQ Data</span></h2>

<p>Data from the NetQ Telemetry Server can be exported in a number of ways.
First, you can use the <code>json</code> option to output check and show commands
to JSON format for parsing in other applications.</p>

<p>For example, you can check the state of BGP on your network with <code>netq
check bgp</code>:</p>

<pre><code>cumulus@leaf01:~$ netq check bgp 
Total Nodes: 25, Failed Nodes: 2, Total Sessions: 228 , Failed Sessions: 2,
Node       Peer Name  Peer Hostname Reason       Time 
---------- ---------- ------------- ------------ ------- 
exit01     swp6.2     spine01       Rotten Agent 15h ago 
spine01    swp3.2     exit01        Idle         15h ago
</code></pre>

<p>When you show the output in JSON format, this same command looks like
this:</p>

<pre><code>cumulus@leaf01:~$ netq check bgp json 
{
    &quot;failedNodes&quot;: [
        {
            &quot;node&quot;: &quot;exit-1&quot;, 
            &quot;reason&quot;: &quot;Idle&quot;, 
            &quot;peerId&quot;: &quot;firewall-1&quot;, 
            &quot;neighbor&quot;: &quot;swp6.2&quot;, 
            &quot;time&quot;: &quot;15h ago&quot;
        }, 
        {
            &quot;node&quot;: &quot;firewall-1&quot;, 
            &quot;reason&quot;: &quot;Idle&quot;, 
            &quot;peerId&quot;: &quot;exit-1&quot;, 
            &quot;neighbor&quot;: &quot;swp3.2&quot;, 
            &quot;time&quot;: &quot;15h ago&quot;
        }
    ], 
    &quot;summary&quot;: {
        &quot;checkedNodeCount&quot;: 25, 
        &quot;failedSessionCount&quot;: 2, 
        &quot;failedNodeCount&quot;: 2, 
        &quot;totalSessionCount&quot;: 228
    }
}
</code></pre>

<article id="html-search-results" class="ht-content" style="display: none;">

</article>

<footer id="ht-footer">

</footer>

<p></details></p>
</article>

      <script src="https://utteranc.es/client.js"
        repo="CumulusNetworks/docs-internal"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
      </script>

    </div>
    

      


  

    <aside class="book-toc fixed">

  
    <div class="toc">
    
      <button>
      <a href="https://github.com/CumulusNetworks/docs/edit/master/content/version/cumulus-netq-121/Proactively-Monitoring-the-Network-Fabric/_index.md" target="_blank" rel="noopener"><img src="/docs.cumulusnetworks.com/svg/pencil-circle.svg" alt="Edit" /> Edit this page</a>
      </button>
    
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#span-netq-notifier-span"><span>NetQ Notifier</span></a>
<ul>
<li><a href="#span-log-message-format-span"><span>Log Message Format</span></a></li>
<li><a href="#span-supported-integrations-span"><span>Supported Integrations</span></a></li>
<li><a href="#span-configuring-an-integration-span"><span>Configuring an Integration</span></a></li>
<li><a href="#span-filtering-notifications-span"><span>Filtering Notifications</span></a></li>
<li><a href="#span-example-netq-yml-file-span"><span>Example netq.yml File</span></a></li>
<li><a href="#span-id-src-8356545-proactivelymonitoringthenetworkfabric-elk-class-confluence-anchor-link-span-span-exporting-to-elk-span"><span id="src-8356545_ProactivelyMonitoringtheNetworkFabric-elk" class="confluence-anchor-link"></span><span>Exporting to ELK</span></a></li>
<li><a href="#span-id-src-8356545-proactivelymonitoringthenetworkfabric-splunk-class-confluence-anchor-link-span-span-exporting-to-splunk-span"><span id="src-8356545_ProactivelyMonitoringtheNetworkFabric-splunk" class="confluence-anchor-link"></span><span>Exporting to Splunk</span></a></li>
<li><a href="#span-precisely-locating-an-issue-on-the-network-span"><span>Precisely Locating an Issue on the Network</span></a></li>
<li><a href="#span-id-src-8356545-proactivelymonitoringthenetworkfabric-ntp-class-confluence-anchor-link-span-span-detecting-out-of-sync-nodes-span"><span id="src-8356545_ProactivelyMonitoringtheNetworkFabric-ntp" class="confluence-anchor-link"></span><span>Detecting Out of Sync Nodes</span></a></li>
</ul></li>
<li><a href="#span-extending-netq-with-custom-services-using-curl-span"><span>Extending NetQ with Custom Services Using curl</span></a></li>
<li><a href="#span-exporting-netq-data-span"><span>Exporting NetQ Data</span></a></li>
</ul></li>
</ul>
</nav>
    </div>
  

</aside>






  </main>
  <footer class="footer-top">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <div class="footer-content">
            <div class="mb-4">
                <img src="https://static.cumulusnetworks.com/static/images/shared/cumulus-networks-rt-white-trademarked.ff839f1b2570.svg">
                <p> <script type="text/javascript">document.write(new Date().getFullYear());</script> Cumulus Networks.<br>
                Site by <a href="//unomena.com/" target="_blank">Unomena</a>.</p>
            </div>
            <ul class="mb-4">
              <li><h4>Products</h4></li>
              <li><a href="//cumulusnetworks.com/products/cumulus-linux/">Cumulus Linux</a></li>
              <li><a href="//cumulusnetworks.com/products/netq/">Cumulus NetQ</a></li>
              <li><a href="//cumulusnetworks.com/products/cumulus-express/">Cumulus Express</a></li>
            </ul>
            <ul class="mb-4">
              <li><h4>Learn</h4></li>
              <li><a href="//cumulusnetworks.com/learn/web-scale-networking-education/">Going web-scale</a></li>
              <li><a href="//cumulusnetworks.com/learn/events/">Events</a></li>
              <li><a href="//cumulusnetworks.com/blog/">Blog</a></li>
            </ul>
            <ul class="mb-4">
              <li><h4>About</h4></li>
              <li><a href="//cumulusnetworks.com/about/">Our story</a></li>
              <li><a href="//cumulusnetworks.com/about/careers/">Careers</a></li>
              <li><a href="//cumulusnetworks.com/about/media-coverage/">Media coverage</a></li>
              <li><a href="//docs.cumulusnetworks.com/" target="_blank">Tech docs</a></li>
              <li><a href="//cumulusnetworks.com/community/">Community</a></li>
            </ul>
            <ul>
              <li>
                <a href="//twitter.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M23 6.628l-2-.5 1-2-2.464.7A4.48 4.48 0 0 0 12 8.128v1c-3.539.73-6.634-1.2-9.5-4.5q-.75 4 1.5 6l-3-.5c.405 2.069 1.362 3.7 4 4l-2.5 1c1 2 2.566 2.31 5 2.5a10.748 10.748 0 0 1-6.5 2c12.755 5.669 20-2.664 20-10V8.3z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//www.facebook.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                      .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M17.768 7.5H13.5V5.6a.972.972 0 0 1 1.012-1.1c.418 0 2.988.01 2.988.01V.5h-4.329C9.244.5 8.5 3.474 8.5 5.355V7.5h-3v4h3v12h5v-12h3.851z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//linkedin.com/company/cumulus-networks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                      .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M6.5 22.5h-5v-13h5zm9-9a2 2 0 0 0-2 2v7h-5v-13h5v1.485a6.307 6.307 0 0 1 3.99-1.495c2.962 0 5.01 2.2 5.01 6.355V22.5h-5v-7a2 2 0 0 0-2-2zM6.5 5A2.5 2.5 0 1 1 4 2.5 2.5 2.5 0 0 1 6.5 5z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//vimeo.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M.5 7.393l.933 1.224S3.36 7.1 4 7.859s3.1 9.925 3.915 11.617c.714 1.483 2.684 3.444 4.845 2.042s9.34-7.529 10.626-14.769-8.642-5.723-9.693.583c2.627-1.577 4.03.642 2.686 3.154s-2.569 4.145-3.211 4.145-1.135-1.679-1.868-4.613c-.76-3.035-.755-8.5-3.911-7.882C4.412 2.721.5 7.393.5 7.393z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//www.github.com/cumulusnetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                        <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                        </style>
                    </defs>
                    <path class="a" d="M19.459 17c0-5.969-4.126-3.532-7.5-3.532s-7.5-2.375-7.5 3.532a3.5 3.5 0 0 0 3.5 3.5h8a3.5 3.5 0 0 0 3.5-3.5z"></path>
                    <path class="a" d="M21.489 10.214l.032.023s2.646-4.572-.6-7.237c-2 0-5.058 3.3-5.058 3.3l.022.016A14.152 14.152 0 0 0 8.1 6.3C8.083 6.285 5.037 3 3.042 3c-3.173 2.6-.729 7.012-.614 7.217a8.876 8.876 0 0 0-1.395 5.743c.241 3.126 2.847 6.54 5.982 6.54H16.9c3.135 0 5.742-3.414 5.982-6.54a8.857 8.857 0 0 0-1.393-5.746z"></path>
                    <ellipse class="a" cx="15.48" cy="17" rx="1" ry="1.5"></ellipse>
                    <ellipse class="a" cx="8.48" cy="17" rx="1" ry="1.5"></ellipse>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//slack.cumulusnetworks.com/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                        <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                        </style>
                    </defs>
                    <rect class="a" x=".5" y=".5" width="23" height="23" rx="6" ry="6"></rect>
                    <circle class="a" cx="12" cy="12" r="6"></circle>
                    <circle class="a" cx="19" cy="5" r="1.5"></circle>
                  </svg>
                </a>
              </li>
              <li>
                <p>Cumulus Networks<sup></sup>  Data center networking software for the open, modern data center.</p>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </footer>
  <div class="footer-bottom">
      <div class="container">
          <div class="row">
              <div class="col-12">
                  <ul>
                      <li><a href="//cumulusnetworks.com/legal/trademarks/">Trademarks</a></li>
                      <li><a href="//cumulusnetworks.com/legal/privacy/">Privacy</a></li>
                      <li><a href="//cumulusnetworks.com/legal/">Terms of service</a></li>
                  </ul>
              </div>
          </div>
      </div>
  </div>

  
  

</body>

</html>
