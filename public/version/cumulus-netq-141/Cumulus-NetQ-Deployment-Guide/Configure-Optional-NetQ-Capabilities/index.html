<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Configure Optional NetQ Capabilities | Cumulus Networks Documentation</title>

  
  <link href="https://fonts.googleapis.com/css?family=Oxygen|Oxygen+Mono:300,400,700" rel="stylesheet">

  
  
  
  <link rel="stylesheet" href="/docs.cumulusnetworks.com/book.min.a378d8a2da6f5357a83a43dff33d6f77fb70401e0399d5ba78faf81d7a1ae1a8.css">

  
  <link rel="icon" href="/docs.cumulusnetworks.com/icons/favicon.png" type="image/x-icon">

  
  <!--
  Made with Book Theme
  https://github.com/alex-shpak/hugo-book
  -->

  
  
  <script src = "/docs.cumulusnetworks.com/js/codecopy.js"> </script>

</head>


<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  
  <header id="site-nav">
    <div class="header-wrapper flex">
      <a href="/">
        <img src="/header-logo.png" alt="Cumulus Networks">
        <img src="/cumulus-networks-rt-white.svg" alt="Cumulus Networks" class="header-mobile">
        <span>Docs</span>
      </a>
      <ul class="flex">
        <li><a href="//cumulusnetworks.com">HOME</a></li>
        <li><a href="//support.cumulusnetworks.com/">SUPPORT</a></li>
        <li><a href="//docs.cumulusnetworks.com/">DOCS</a></li>
        <li><a href="//education.cumulusnetworks.com">EDUCATION</a></li>
        <li><a href="//cumulusnetworks.com/blog/">BLOG</a></li>
        <li><a href="//forums.cumulusnetworks.com/">FORUMS</a></li>
      </ul>
      <div class="burger-menu">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </header>
  <div id="product-nav" class="flex">
      
    
    <ul>
    
      <li><a href = docs.cumulusnetworks.com/cumulus-linux/ >
        Cumulus Linux </a> </li>
    
      <li class = "active" ><a href = docs.cumulusnetworks.com/cumulus-netq/ >
        Cumulus NetQ </a> </li>
    
      <li><a href = docs.cumulusnetworks.com/cumulus-vx/ >
        Cumulus VX </a> </li>
    
      <li>
        <div id="products-dropdown" class="dropdown">
            <button class="btn" type="button" id="dropdownMenuButton">
              Products
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <a class="dropdown-item" href="">Cumulus RMP</a>
              <a class="dropdown-item" href="">Cumulus Chassis</a>
              <a class="dropdown-item" href="">Cumulus Host Pack</a>
            </div>
        </div>
      </li>
    </ul>
    <div class="search-container">
      <div id="doc-search-box">
        <input type="text" class="doc-search-input" placeholder="Search" value="">
        <span><button type="submit"><img src="/icons/search_20x20.svg" alt=""></button></span>
      </div>
      <div id="dropdown" class="dropdown">
          <button class="btn" type="button" id="dropdownMenuButton">
            v1.4.1
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/cumulus-netq/"> v2.2.0</a>
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-netq-10/"> v1.0.0</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-netq-110/"> v1.1.0</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-netq-121/"> v1.2.1</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-netq-141/"> v1.4.1</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-netq-21/"> v2.1</a>
            
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
          </div>
      </div>
    </div>
  </div>
  <main class="flex container">
    <aside class="book-menu fixed">

      <nav role="navigation">
        <h2 class="book-brand">
          <a href="docs.cumulusnetworks.com">Cumulus Networks Documentation</a>
        </h2>
        
        




  <ul class = "cn-book-section-container" id = "top">
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
            

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/" >
    Cumulus NetQ
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/Cumulus-NetQ-Image-and-Provisioning-Management-User-Guide/" >
    Cumulus NetQ Image and Provisioning Management User Guide
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/Cumulus-NetQ-Image-and-Provisioning-Management-User-Guide/IPM-Preface/" >
    IPM Preface
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/Cumulus-NetQ-Image-and-Provisioning-Management-User-Guide/IPM-Command-Line-Overview/" >
    IPM Command Line Overview
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/Cumulus-NetQ-Image-and-Provisioning-Management-User-Guide/Activate-and-Initialize-IPM/" >
    Activate and Initialize IPM
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/Cumulus-NetQ-Image-and-Provisioning-Management-User-Guide/Configure-and-Manage-DHCP-Options/" >
    Configure and Manage DHCP Options
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/Cumulus-NetQ-Image-and-Provisioning-Management-User-Guide/Manage-Network-Operating-System-Images/" >
    Manage Network Operating System Images
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/Cumulus-NetQ-Image-and-Provisioning-Management-User-Guide/Manage-Zero-Touch-Provisioning-Scripts/" >
    Manage Zero-Touch Provisioning Scripts
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/Cumulus-NetQ-Telemetry-User-Guide/" >
    Cumulus NetQ Telemetry User Guide
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/Cumulus-NetQ-Telemetry-User-Guide/Early-Access-Features/" >
    Early Access Features
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/Cumulus-NetQ-Telemetry-User-Guide/Early-Access-Features/Extend-NetQ-with-Custom-Commands/" >
    Extend NetQ with Custom Commands
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/Cumulus-NetQ-Telemetry-User-Guide/Early-Access-Features/Query-the-NetQ-Database/" >
    Query the NetQ Database
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/Cumulus-NetQ-Telemetry-User-Guide/Early-Access-Features/Collect-Interface-Statistics/" >
    Collect Interface Statistics
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/Cumulus-NetQ-Telemetry-User-Guide/Resolve-Issues/" >
    Resolve Issues
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/Cumulus-NetQ-Telemetry-User-Guide/Resolve-Issues/Event-Message-Reference/" >
    Event Message Reference
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/Cumulus-NetQ-Telemetry-User-Guide/Resolve-Issues/Methods-for-Diagnosing-Network-Issues/" >
    Methods for Diagnosing Network Issues
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/Cumulus-NetQ-Telemetry-User-Guide/Resolve-Issues/Resolve-MLAG-Issues/" >
    Resolve MLAG Issues
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/Cumulus-NetQ-Telemetry-User-Guide/Resolve-Issues/Investigate-NetQ-Issues/" >
    Investigate NetQ Issues
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/Cumulus-NetQ-Telemetry-User-Guide/Telemetry-Preface/" >
    Telemetry Preface
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/Cumulus-NetQ-Telemetry-User-Guide/NetQ-Command-Line-Overview/" >
    NetQ Command Line Overview
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/Cumulus-NetQ-Telemetry-User-Guide/NetQ-Service-Console/" >
    NetQ Service Console
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/Cumulus-NetQ-Telemetry-User-Guide/Monitor-Overall-Network-Health/" >
    Monitor Overall Network Health
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/Cumulus-NetQ-Telemetry-User-Guide/Monitor-Switch-Hardware-and-Software/" >
    Monitor Switch Hardware and Software
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/Cumulus-NetQ-Telemetry-User-Guide/Monitor-Physical-Layer-Components/" >
    Monitor Physical Layer Components
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/Cumulus-NetQ-Telemetry-User-Guide/Monitor-Data-Link-Layer-Devices-and-Protocols/" >
    Monitor Data Link Layer Devices and Protocols
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/Cumulus-NetQ-Telemetry-User-Guide/Monitor-Network-Layer-Protocols/" >
    Monitor Network Layer Protocols
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/Cumulus-NetQ-Telemetry-User-Guide/Monitor-Virtual-Network-Overlays/" >
    Monitor Virtual Network Overlays
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/Cumulus-NetQ-Telemetry-User-Guide/Monitor-Linux-Hosts/" >
    Monitor Linux Hosts
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/Cumulus-NetQ-Telemetry-User-Guide/Monitor-Container-Environments/" >
    Monitor Container Environments
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/Cumulus-NetQ-Telemetry-User-Guide/Automate-Common-and-Repetitive-Tasks/" >
    Automate Common and Repetitive Tasks
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/Cumulus-NetQ-Deployment-Guide/" >
    Cumulus NetQ Deployment Guide
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/Cumulus-NetQ-Deployment-Guide/Deployment-Preface/" >
    Deployment Preface
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/Cumulus-NetQ-Deployment-Guide/Install-NetQ/" >
    Install NetQ
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/Cumulus-NetQ-Deployment-Guide/Configure-Optional-NetQ-Capabilities/"  class="active" >
    Configure Optional NetQ Capabilities
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/Cumulus-NetQ-Deployment-Guide/Maintain-NetQ/" >
    Maintain NetQ
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-netq-141/Cumulus-NetQ-Deployment-Guide/Deployment-Appendices/" >
    Deployment Appendices
  </a>


    </li>
    
  </ul>


  </li>


    
    
  </ul>


  </li>


          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  </ul>









      </nav>

      
      
      
      

      <script src = "/docs.cumulusnetworks.com/js/menuBundle.js"> </script>


    </aside>

    <div class="book-page">

      
      <header class="align-center justify-between book-header">
        <label for="menu-control">
          <img src="/docs.cumulusnetworks.com/svg/menu.svg" alt="Menu" />
        </label>
        <strong>Configure Optional NetQ Capabilities</strong>
      </header>

      
      
<div class= "notices info" id = "info" >
    This documentation is for an older version of the software. If you are using the current version of Cumulus Linux, this content may not be up to date. The current version of the documentation is available [here](https://docs.cumulusnetworks.com/).
  </div>
<article class="markdown">
<h1>Configure Optional NetQ Capabilities</h1>

<p>After you have installed the Telemetry Server and the NetQ Agents, you
may want to configure some of the additional capabilities that NetQ
offers. This topic describes how to install, setup, and configure these
capabilities.</p>

<h2 id="span-activate-early-access-features-span"><span>Activate Early Access Features</span></h2>

<p>NetQ contains <a href="https://support.cumulusnetworks.com/hc/en-us/articles/202933878-Early-Access-Features-Defined" target="_blank">early
access</a>
features that provide advanced access to new functionality before it
becomes generally available. The telemetry-based early access features
are bundled into the <code>netq-apps</code> package (installed automatically with
NetQ) ; there is no specific EA package like there typically is with
Cumulus Linux.</p>

<p>You enable early access features by running the <code>netq config add
</code>command. You disable the early access features by running the <code>netq
config del</code> command.</p>

<p>For example, to activate a feature:</p>

<ol>
<li><p>Log on to any switch or server running NetQ.</p></li>

<li><p>Activate the early access feature set.</p>

<pre><code>cumulus@switch:~$ netq config add experimental
</code></pre></li>

<li><p>Try out the features and provide feedback to your sales
representative.<br />
Usage information is contained in the <a href="/version/cumulus-netq-141/Cumulus-NetQ-Telemetry-User-Guide/">Cumulus NetQ Telemetry User
Guide</a>.</p></li>
</ol>

<p>The NetQ Image and Provisioning Management (IPM) application are
installed automatically, but not enabled.</p>

<p>To enable the IPM application:</p>

<ol>
<li><p>Log on to the NetQ Telemetry Server.</p>

<pre><code>&lt;machine-name&gt;:~&lt;username&gt;$ ssh cumulus@&lt;telemetry-server-name-or-ip-address&gt;
cumulus@ts:~$
</code></pre></li>

<li><p>Open required ports.</p></li>

<li><p>Enable and start the IPM application (named <em>tips-appliance</em>).</p>

<pre><code>cumulus@ts:~$ sudo systemctl enable tips-appliance  
Created symlink from /etc/systemd/system/multi-user.target.wants/tips-appliance.service to /lib/systemd/system/tips-appliance.service.

cumulus@ts:~$ sudo systemctl start tips-appliance
</code></pre>

<p>Once the IPM application is running, the IPM Command Line Interface,
<em>TIPCTL</em>, is available. TIPCTL is the user interface used to
activate, configure, and monitor the IPM application and services.</p></li>

<li><p>Try out the application and provide feedback to your sales
representative.<br />
Usage information is contained in the <a href="/version/cumulus-netq-141/Cumulus-NetQ-Image-and-Provisioning-Management-User-Guide/">Cumulus NetQ Image and
Provisioning Management User
Guide</a>.</p></li>
</ol>

<h2 id="span-id-src-10453429-configureoptionalnetqcapabilities-integratenotification-class-confluence-anchor-link-span-span-integrate-netq-with-an-event-notification-application-span"><span id="src-10453429_ConfigureOptionalNetQCapabilities-IntegrateNotification" class="confluence-anchor-link"></span><span>Integrate NetQ with an Event Notification Application</span></h2>

<p>By default, alert messages are sent to <code>rsyslog</code>; however, other
third-party tools may be configured to receive the alert messages . Once
you have observed the events received in <code>rsyslog</code> for some period of
time, you can more easily determine which events you want to direct to a
given notification application and how you might assign the events to
various event channels. You can integrate NetQ with a number of
third-party notification applications, including PagerDuty, Slack,
Elastic Logstash, and Splunk. You may integrate with one or more of
these applications with or without filtering the events sent. To set up
the integrations, you must configure the NetQ Notifier component on the
Telemetry Server.</p>

<h3 id="span-netq-notifier-span"><span>NetQ Notifier</span></h3>

<p>NetQ Notifier is responsible for delivering alerts to users through
mediums such as Slack and syslog, informing users of network events.
NetQ Notifier <span style="color: #ff0000;"> listens for events on the
public subscription channel and writes them to
<code>/var/log/netq-notifier.log</code> </span> . As events occur, NetQ Notifier
sends alert messages to <code>rsyslog</code>. NetQ Agents communicate directly with
NetQ Notifier. Note that if you are running the TS in <a href="#src-10453429_ConfigureOptionalNetQCapabilities-HAConfig">HA
mode</a>, then
NetQ Notifier only runs on the master instance of the TS and is
responsible for accepting messages for publication from all of the TS
instances (master and slaves).</p>








<img class = "confluence-embedded-image" src = "/images/download/attachments/10453429/image2018-7-19-12_5_49.png" alt = "/images/download/attachments/10453429/image2018-7-19-12_5_49.png"


width = 600

 />


<p>Notifications can be generated for the following types of events:</p>

<ul>
<li><p>BGP session state</p></li>

<li><p>Fan</p></li>

<li><p>License</p></li>

<li><p>Link</p></li>

<li><p>LNV session state</p></li>

<li><p>MLAG session state</p></li>

<li><p>NTP</p></li>

<li><p>OS</p></li>

<li><p>Port</p></li>

<li><p>PSU (power supply unit)</p></li>

<li><p>Services</p></li>

<li><p>Temperature</p></li>
</ul>

<p>The NetQ Notifier is preconfigured to monitor for <em>all</em> events and
publish <em>all</em> alert messages. No additional configuration is required;
however, you can modify this default behavior to:</p>

<ul>
<li><p>Limit the events that are logged: NetQ Notifier sends out alerts
based on the configured logging level. If you want to change the
default logging level of <em>info</em> to increase or decrease the set of
events that are logged, refer to <a href="#src-10453429_ConfigureOptionalNetQCapabilities-NotifierLog">Configure NetQ Notifier
Logging</a>.</p></li>

<li><p>Limit the events that are published: If you do not want to receive
alerts for all events, you can limit the messages to publish by
creating a NetQ Notifier filter. Refer to <a href="#src-10453429_ConfigureOptionalNetQCapabilities-NotifierFilters">Create NetQ Notifier
Filters</a>
for details.</p></li>

<li><p>Use an alternate tool to view alerts: You can integrate NetQ
Notifier with third-party event notification applications.
Integration consists of setting a few parameters in the NetQ
configuration file to identify the output, and then creating a
filter to publish messages on that channel (<a href="#src-10453429_ConfigureOptionalNetQCapabilities-NotifierFilters">Create NetQ Notifier
Filters</a>).</p></li>
</ul>

<p>NetQ Notifier was installed as part of the TS virtual machine
installation process and resides in the TS VM. You control the operation
of NetQ Notifier using <code>systemd</code> commands (such as <code>systemctl stop|start
netq-notifier</code>). You configure NetQ Notifier using the NetQ Notifier
CLI, or by manually editing the <code>/etc/netq/netq.yml</code>configuration
file.</p>

<h4 id="span-log-message-format-span"><span>Log Message Format</span></h4>

<p>Messages have the following structure:</p>

<p><code>&lt;timestamp&gt; &lt;node&gt; &lt;service&gt;[PID]: &lt;level&gt;: filter#&lt;name&gt;: &lt;type&gt;:
&lt;message&gt;</code></p>

<table>
<thead>
<tr>
<th>Element</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>timestamp</td>
<td>Date and time event occurred in UTC format</td>
</tr>

<tr>
<td>node</td>
<td>Hostname of network node where event occurred</td>
</tr>

<tr>
<td>service [PID]</td>
<td>Service and Process IDentifier that generated the event</td>
</tr>

<tr>
<td>level</td>
<td>Logging level in which the given event is classified; <em>debug</em>, <em>error</em>, <em>info</em>, or <em>warning</em></td>
</tr>

<tr>
<td>filter#&lt;name&gt;</td>
<td>Name of filter that captured the event; a name of <em>none</em> indicates no notification is sent (even if logged); a name of <em>default</em> indicates no filter is applied (all messages are sent)</td>
</tr>

<tr>
<td>type</td>
<td>Category of event; <em>BgpSession</em>, <em>Fan</em>, <em>License</em>, <em>Link</em>, <em>LnvSession</em>, <em>ClagSession</em>, <em>NTP</em>, <em>OS</em>, <em>Port</em>, <em>PSU</em>, <em>Services</em>, or <em>Temp</em></td>
</tr>

<tr>
<td>message</td>
<td>Text description of event, including the node where the event occurred</td>
</tr>
</tbody>
</table>

<p>For example:</p>








<img class = "confluence-embedded-image" src = "/images/download/attachments/10453429/image2018-8-7-16_21_25.png" alt = "/images/download/attachments/10453429/image2018-8-7-16_21_25.png"


width = 1200

 />


<h4 id="span-default-output-span"><span>Default Output</span></h4>

<p>Using <code>rsyslog</code>, a standard mechanism to capture log files in Linux,
NetQ Notifier sends alerts and events to the
<code>/var/log/netq-notifier.log</code>.</p>

<h3 id="span-netq-notifier-cli-overview-span"><span>NetQ Notifier CLI Overview</span></h3>

<p>The NetQ Notifier Command Line Interface (CLI) is used to filter and
send notifications to third-party tools based on severity, service,
event-type, and device. The CLI enables you to configure these items
without editing the configuration file, reducing the risk of errors. The
commands must be run from the Telemetry Server. All commands begin with
<code>netq config ts</code>. You can use TAB completion or the help keyword to
assist when needed.</p>

<table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>add</td>
<td>Adds or modifies Notifier configuration, including filters, or sets master data node for DB cluster</td>
</tr>

<tr>
<td>del</td>
<td>Removes existing Notifier configuration</td>
</tr>

<tr>
<td>reset-cluster</td>
<td>Resets DB cluster to force into known state</td>
</tr>

<tr>
<td>restart</td>
<td>Restarts the Notifier daemon</td>
</tr>

<tr>
<td>show</td>
<td>Displays current DB server configuration or Notifier integrations</td>
</tr>

<tr>
<td>start</td>
<td>Starts the Notifier daemon</td>
</tr>

<tr>
<td>status</td>
<td>Display Notifier status</td>
</tr>

<tr>
<td>stop</td>
<td>Stop Notifier daemon</td>
</tr>
</tbody>
</table>

<p>The command syntax is:</p>

<pre><code>##Integrations
netq config ts add notifier integration slack &lt;text-integration-name&gt; webhook &lt;text-webhook-url&gt; [severity &lt;debug|info|warning|error&gt;] [tag @&lt;text-slack-tag&gt;]
netq config ts add notifier integration pagerduty &lt;text-integration-name&gt; api-access-key &lt;text-api-access-key&gt; api-integration-key &lt;text-api-integration-key&gt; [severity &lt;debug|info|warning|error&gt;]

##Filters
netq config ts add notifier filter &lt;text-filter-name&gt; [before &lt;text-filter-name-anchor&gt;] [after &lt;text-filter-name-anchor&gt;] [rule &lt;text-rule-key&gt; &lt;text-rule-value&gt;] [output &lt;text-integration-name-anchor&gt;]

##Logging
netq config ts add notifier loglevel [debug|error|info|warning] [json]

##Management
netq config ts del notifier (slack|pagerduty) &lt;text-integration-name-anchor&gt;
netq config ts del notifier filter &lt;text-filter-name-anchor&gt;
netq config ts del notifier loglevel

netq config ts (start|stop|restart|status) notifier
netq config ts show notifier [&lt;ip-server&gt;|&lt;text-server-name&gt;|config] [json]
netq config ts reset-cluster
</code></pre>

<p>The options are described in the following sections where they are used.</p>

<h3 id="span-id-src-10453429-configureoptionalnetqcapabilities-notifierlog-class-confluence-anchor-link-span-span-configure-netq-notifier-logging-span"><span id="src-10453429_ConfigureOptionalNetQCapabilities-NotifierLog" class="confluence-anchor-link"></span><span>Configure NetQ Notifier Logging</span></h3>

<p>The logging level used by the NetQ Notifier determines what types of
messages are published and what messages are suppressed. Five levels of
logging are available, as shown in this table.</p>

<table>
<thead>
<tr>
<th>Logging Level</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>debug</td>
<td><span style="color: #ff0000;"> Sends notifications for all debugging-related, informational, warning, error, <span style="color: #000000;"> and critical </span> messages. </span></td>
</tr>

<tr>
<td>info</td>
<td><span style="color: #ff0000;"> Sends notifications for critical, informational, warning, and error messages (default). </span></td>
</tr>

<tr>
<td>warning</td>
<td><span style="color: #ff0000;"> Sends notifications for critical, warning, and error messages. </span></td>
</tr>

<tr>
<td>error</td>
<td><span style="color: #ff0000;"> Sends notifications for critical and errors messages. </span></td>
</tr>

<tr>
<td>critical</td>
<td>Sends notifications for critical messages.</td>
</tr>
</tbody>
</table>

<p>You can view the messages in the NetQ Notifier log, as shown here, or
use the notification applications for easier viewing.</p>

<pre><code>...
2018-10-01T18:46:00.337079+00:00 cumulus netq-notifier[5617]: INFO: filter#default: Link: mlx-2700-03 swp3s1: state changed from down to up
2018-10-01T18:46:01.455979+00:00 cumulus netq-notifier[5617]: INFO: filter#default: Link: mlx-2700-03 hostbond3 (Local Node/s tor-1 and Ports swp3s0 &lt;==&gt; Remote Node/s hosts-11 and Ports swp1) (master: VlanA-1): state changed from down to up
2018-10-01T18:46:02.590245+00:00 cumulus netq-notifier[5617]: INFO: filter#default: Link: mlx-2700-03 hostbond5 (Local Node/s tor-1 and Ports swp3s2 &lt;==&gt; Remote Node/s hosts-13 and Ports swp1) (master: VlanA-1): state changed from down to up
2018-10-01T18:46:29.585642+00:00 cumulus netq-notifier[5617]: INFO: filter#default: Port: mlx-2700-03 swp3s2: port is now plugged
2018-10-01T18:46:30.782686+00:00 cumulus netq-notifier[5617]: INFO: filter#default: Port: mlx-2700-03 swp3s3: port is now plugged
2018-10-01T18:25:45.527880+00:00 cumulus netq-notifier[5617]: INFO: netq-notifier: Notifier processing messages because local REDIS is a master.
2018-10-01T18:34:15.278120+00:00 cumulus netq-notifier[5617]: WARNING: filter#default: Port: mlx-2700-03 swp17: port is now empty
2018-10-01T18:35:47.043010+00:00 cumulus netq-notifier[5617]: INFO: filter#default: Port: mlx-2700-03 swp17: port is now plugged
2018-10-01T18:43:23.802855+00:00 cumulus netq-notifier[5617]: WARNING: filter#default: Link: mlx-2700-03 swp3s3: state changed from up to down
2018-10-01T18:43:25.195741+00:00 cumulus netq-notifier[5617]: WARNING: filter#default: Link: mlx-2700-03 swp3s0: state changed from up to down
2018-10-01T18:43:26.583027+00:00 cumulus netq-notifier[5617]: WARNING: filter#default: Link: mlx-2700-03 swp3s2: state changed from up to down
netq-notifier.log:2018-09-26T23:45:19.622756+00:00 cumulus netq-notifier[2201]: CRITICAL: filter#default: Temp: act-omp03-lc101 temp95: state is absent
netq-notifier.log:2018-09-26T23:45:19.623445+00:00 cumulus netq-notifier[2201]: CRITICAL: filter#default: Temp: act-omp03-lc101 temp96: state is absent
netq-notifier.log:2018-09-26T23:45:19.624140+00:00 cumulus netq-notifier[2201]: CRITICAL: filter#default: Temp: act-omp03-lc101 temp97: state is absent
netq-notifier.log:2018-09-26T23:45:19.624806+00:00 cumulus netq-notifier[2201]: CRITICAL: filter#default: Temp: act-omp03-lc101 temp98: state is absent
netq-notifier.log:2018-09-26T23:45:19.625486+00:00 cumulus netq-notifier[2201]: CRITICAL: filter#default: Temp: act-omp03-lc101 temp99: state is absent
netq-notifier.log.1:2018-09-27T22:37:28.380181+00:00 cumulus netq-notifier[844]: CRITICAL: filter#default: PSU: act-461054p-03 psu1: state is bad
...
</code></pre>

<p><strong>Example: Configure debug-level logging</strong></p>

<ol>
<li><p>Set the logging level to <em>debug.</em></p>

<pre><code>cumulus@ts:~$ netq config ts add notifier loglevel debug
</code></pre></li>

<li><p>Restart the NetQ Agent.</p>

<pre><code>cumulus@ts:~$ netq config ts restart notifier
Restarting netq-notifier... Success!
</code></pre></li>

<li><p>Verify connection to Telemetry Server.</p>

<pre><code>cumulus@ts:~$ netq config ts show server
Server      Role    Master               Replicas              Status      Last Changed
----------------- ---------- ---------------------------------- ---------------------------------- ---------------- ----------------
192.168.1.254   master   192.168.1.254           -                 ok        -
</code></pre></li>
</ol>

<p><span style="color: #222222;"> <strong>Example: Configure warning-level
logging</strong> </span></p>

<pre><code>cumulus@switch:~$ netq config ts add notifier loglevel warning 
cumulus@switch:~$ netq config ts restart notifier 
cumulus@switch:~$ netq config ts show server
</code></pre>

<p><strong>Example: Disable NetQ Notifier Logging</strong></p>

<p><span style="color: #222222;"> If you have set the logging level to
<em>debug</em> for troubleshooting, it is recommended that you either change
the logging level to a less heavy mode or completely disable agent
logging altogether when you are finished troubleshooting. </span></p>

<p><span style="color: #222222;"> To change the logging level, run the
following command and restart the agent service: </span></p>

<pre><code>cumulus@switch:~$netq config ts add notifier loglevel &lt;LOG_LEVEL&gt;
cumulus@switch:~$ netq config ts restart notifier
</code></pre>

<p>To disable all logging:</p>

<pre><code>cumulus@switch:~$netq config ts del notifier loglevel
cumulus@switch:~$ netq config ts restart notifier
</code></pre>

<h3 id="span-id-src-10453429-configureoptionalnetqcapabilities-pdcli-class-confluence-anchor-link-span-span-configure-pagerduty-using-netq-notifier-cli-span"><span id="src-10453429_ConfigureOptionalNetQCapabilities-PDcli" class="confluence-anchor-link"></span><span>Configure PagerDuty Using NetQ Notifier CLI</span></h3>

<p>NetQ Notifier sends notifications to PagerDuty as PagerDuty events.</p>

<p>For example:</p>








<img class = "confluence-embedded-image" src = "/images/download/attachments/10453429/NetQ-PagerDuty.png" alt = "/images/download/attachments/10453429/NetQ-PagerDuty.png"

height = 250


 />



<div class="notices note" > <p>If NetQ generates multiple notifications, on the order of 50/second
(which can happen when a node reboots or when one peer in an MLAG pair
disconnects), PagerDuty does not see all these notifications. You may
see warnings in the netq-notifier.log file similar to this:</p>

<p><code>2017-09-20T20:39:48.222458+00:00 rdsq1 netq-notifier[1]: WARNING:
Notifier: notifier-pagerduty: Request failed with exception: Code: 429,
msg: {&quot;status&quot;:&quot;throttle exceeded&quot;,&quot;message&quot;:&quot;Requests for this service
are arriving too quickly. Please retry later.&quot;}</code></p>

<p>This is a known limitation in PagerDuty at this time.</p>
 </div>


<p>To configure NetQ Notifier to send notifications to PagerDuty:</p>

<ol>
<li><p>Configure the following options using the <code>netq</code><code>config ts add
notifier integration</code> command:</p>

<table>
<thead>
<tr>
<th>Option</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>INTEGRATION_TYPE</td>
<td>The third-party notification system; use <em>pagerduty</em> in this case and provide a name for the integration.</td>
</tr>

<tr>
<td>api-access-key</td>
<td>The required API access key is also called the <a href="https://v2.developer.pagerduty.com/docs/authentication" target="_blank">authorization token</a>.</td>
</tr>

<tr>
<td>api-integration-key</td>
<td>The <a href="https://v2.developer.pagerduty.com/docs/events-api-v2" target="_blank">integration</a> key is also called the service_key or routing_key. The default is an empty string (&ldquo;&rdquo;).</td>
</tr>

<tr>
<td>severity</td>
<td>The log level to set, which can be one of <em>info</em>, <em>warning</em>, <em>error</em>, <em>critical</em> or <em>debug</em>. The severity defaults to <em>info</em>.</td>
</tr>
</tbody>
</table></li>

<li><p>Restart the NetQ Notifier service<br />
For example:</p>

<pre><code>cumulus@ts:~$ netq config ts add notifier integration pagerduty pager-duty-test api-access-key 1234567890 api-integration-key 9876543210
cumulus@ts:~$ netq config ts restart notifier
</code></pre>

<p>These commands create a new notifier-integration configuration in
the <code>/etc/netq/netq.yml</code> file.</p>

<pre><code>cumulus@ts:~$ cat /etc/netq/netq.yml 
backend:
  port: 6379
  role: master
  server: 127.0.0.1
notifier-filters:
- name: default
  output:
  - ALL
  rule:
notifier-integrations:
- api_access_key: 1234567890
  api_integration_key: 9876543210
  name: pager-duty-test
  severity: info
  type: pagerduty
</code></pre></li>
</ol>

<h3 id="span-configure-slack-using-netq-notifier-cli-span"><span>Configure Slack Using NetQ Notifier CLI</span></h3>

<p>NetQ Notifier sends notifications to Slack as incoming webhooks for a
Slack channel you configure.</p>

<p>For example:</p>








<img class = "confluence-embedded-image" src = "/images/download/attachments/10453429/NetQ-Slack-channel.png" alt = "/images/download/attachments/10453429/NetQ-Slack-channel.png"

height = 250


 />


<p>To configure NetQ Notifier to send notifications to Slack:</p>

<ol>
<li><p>If needed, create one or more Slack channels on which to receive the
notifications.</p>

<ol>
<li><p>Click + next to <strong>Channels</strong>.</p></li>

<li><p>Enter a name for the channel, and click <strong>Create Channel</strong>.</p></li>
</ol></li>

<li><p>Create an incoming WebHook.</p>

<ol>
<li><p>Select <strong>Customize Slack</strong> from the Slack dropdown menu.</p></li>

<li><p>Click <strong>Workspaces</strong> in the top right corner, and select the
workspace where the channel is located.</p></li>

<li><p>Click <strong>Add Applications</strong>, and select <strong>Incoming WebHooks</strong>.</p></li>

<li><p>Click <strong>Add Configuration</strong> and enter the name of the channel
you created (where you want to post notifications).</p></li>

<li><p>Click <strong>Add Incoming WebHooks integration</strong>.</p></li>

<li><p>Save WebHook URL in a text file for use in next step.</p></li>
</ol></li>

<li><p>Configure the following options in the <code>netq</code><code>config ts add
notifier integration</code> command:</p>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th><p>Option</p></th>
<th><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>INTEGRATION_TYPE<br />
INTEGRATION_NAME</p></td>
<td><p>The third-party notification system; use <em>slack</em> in this case and provide a name for the integration.</p></td>
</tr>
<tr class="even">
<td><p>WEBHOOK</p></td>
<td><p>Copy the WebHook URL from the text file OR in the desired channel, locate the initial message indicating the addition of the webhook, click <strong>incoming-webhook</strong> link, click <strong>Settings</strong>.</p>
<p>Example URL: <code>https://hooks.slack.com/services/text/moretext/evenmoretext</code></p></td>
</tr>
<tr class="odd">
<td><p>severity</p></td>
<td><p>The log level to set, which can be one of <em>error, warning, info,</em> or <em>debug</em>. The severity defaults to <em>info</em>.</p></td>
</tr>
<tr class="even">
<td><p>tag</p></td>
<td><p>Optional tag appended to the Slack notification to highlight particular channels or people. The tag value must be preceded by the @ sign. For example, <em>@ts-info</em>.</p></td>
</tr>
</tbody>
</table></li>

<li><p>Restart the NetQ Notifier service.<br />
For example:</p>

<pre><code>cumulus@ts:~$ netq config ts add notifier integration slack slack-test webhook https://hooks.slack.com/services/text/moretext/evenmoretext severity warning tag @ts-warning
cumulus@ts:~$ netq config ts restart notifier
</code></pre>

<p>These commands create a new notifier-integration configuration in
the <code>/etc/netq/netq.yml</code> file.</p>

<pre><code>cumulus@redis-1:~$ cat /etc/netq/netq.yml 
backend:
  port: 6379
  role: master
  server: 127.0.0.1
notifier-filters:
- name: default
  output:
  - ALL
  rule:
notifier-integrations:
- name: slack-test
  severity: warning
  tag: '@ts-warning'
  type: slack
  webhook: https://hooks.slack.com/services/text/moretext/evenmoretext
</code></pre></li>
</ol>

<h3 id="span-id-src-10453429-configureoptionalnetqcapabilities-pdman-class-confluence-anchor-link-span-span-configure-pagerduty-manually-span"><span id="src-10453429_ConfigureOptionalNetQCapabilities-PDman" class="confluence-anchor-link"></span><span>Configure PagerDuty Manually</span></h3>

<p>If you prefer to edit the <code>netq.yml</code> file directly, rather than use the
NetQ Notifier CLI, you can do so.</p>

<p>To configure alerts and PagerDuty integrations on the NetQ Telemetry
Server:</p>

<ol>
<li><p>As a sudo user, open <code>/etc/netq/netq.yml</code> in a text editor.</p></li>

<li><p>Optionally, change the logging level, if you want a more restrictive
level than <em>info</em> by adding the following two lines to the file:</p>

<pre><code>...
netq-notifier: 
  log_level: warning
...
</code></pre></li>

<li><p>Configure PagerDuty: Input the information for this integration into
the notifier-integrations stanza, using the syntax shown in the
example:</p>

<ol>
<li><p>Add the notifier-integrations stanza.</p></li>

<li><p>Add a name, such as <em>notifier-pagerduty or netq-notifier</em>. Note:
no spaces are allowed in the name. Use a dash instead if you
want to separate words as shown here.</p></li>

<li><p>Add the type of <em>pagerduty</em>.</p></li>

<li><p>Add the message severity level, <em>debug</em>, <em>info</em>, <em>warning</em>,
<em>error</em>, or <em>critical</em>.</p></li>

<li><p>Add the API access key (also called the <a href="https://v2.developer.pagerduty.com/docs/authentication" target="_blank">authorization
token</a>)
and the
<a href="https://v2.developer.pagerduty.com/docs/events-api-v2" target="_blank">integration</a>
key (also called the service_key or routing_key).</p>

<pre><code>notifier-integrations: 
  - name: notifier-pagerduty 
    type: pagerduty 
    severity: WARNING (does this need to be in all caps?)
    api_access_key: &lt;API Key&gt; 
    api_integration_key: &lt;API Integration Key&gt;
</code></pre></li>
</ol></li>

<li><p>When you are finished editing the file, save and close it.</p></li>

<li><p>Stop then start the NetQ Notifier daemon to apply the new
configuration.</p>

<pre><code>cumulus@ts:~$ sudo systemctl restart netq-notifier
</code></pre></li>
</ol>

<h3 id="span-configure-slack-manually-span"><span>Configure Slack Manually</span></h3>

<p>If you prefer to edit the <code>netq.yml</code> file directly, rather than using
the NetQ Notifier CLI, you can do so.</p>

<p>To configure alerts and Slack integrations on the NetQ Telemetry Server:</p>

<ol>
<li><p>As a sudo user, open <code>/etc/netq/netq.yml</code> in a text editor.</p></li>

<li><p>Optionally, change the logging level, if you want a more restrictive
level than <em>info</em> by adding the following two lines to the file.</p>

<pre><code>...
netq-notifier: 
  log_level: warning
...
</code></pre></li>

<li><p>Configure Slack: Input the information for this integration into the
notifier-integrations stanza, using the syntax shown in the example.</p>

<ol>
<li><p>Add the the notifier-integrations stanza.</p></li>

<li><p>Add a name, such as <em>notifier-slack-channel-1</em> or
<em>netq-notifier</em>. Note: no spaces are allowed in the name. Use a
dash instead if you want to separate words as shown here.</p></li>

<li><p>Add the type of <em>slack</em>.</p></li>

<li><p>Add the webhook URL. To obtain this:</p>

<ol>
<li><p>In the desired Slack channel, locate the initial message
indicating the addition of the integration, click
<strong>incoming-webhook</strong> link, click <strong>Settings</strong>.</p>








<img class = "confluence-embedded-image confluence-content-image-border" src = "/images/download/attachments/10453429/image2018-8-10-14_19_40.png" alt = "/images/download/attachments/10453429/image2018-8-10-14_19_40.png"

height = 96


width = 350

 />
</li>

<li><p>The URL produced by Slack looks similar to the one shown
here:</p>








<img class = "confluence-embedded-image" src = "/images/download/attachments/10453429/netq-slack-webhook.png" alt = "/images/download/attachments/10453429/netq-slack-webhook.png"


width = 750

 />
</li>
</ol></li>

<li><p>Add the message severity level, <em>debug</em>, <em>info</em>, <em>warning</em>, or
<em>error</em>.</p></li>

<li><p>Optionally add a tag, such as <em>@netqts-sys</em> or <em>@ts-info</em>.</p>

<pre><code>notifier-integrations:
  - name: notifier-slack-channel-1
    type: slack
    webhook: &quot;https://hooks.slack.com/services/sometext/moretext/evenmoretext&quot;
    severity: INFO
    tag: &quot;@netqts-sys&quot;
</code></pre></li>
</ol></li>

<li><p>When you are finished editing the file, save and close it.</p></li>

<li><p>Stop then start the NetQ Notifier daemon to apply the new
configuration.</p>

<pre><code>cumulus@netq-appliance:~$ sudo systemctl restart netq-notifier
</code></pre>


<div class="notices tip" > <pre><code>If your webhook does not immediately send a message to your channel,
look for errors in syntax. Check the log file located at
`/var/log/netq-notifier.log`.
</code></pre>
 </div>
</li>
</ol>

<h3 id="span-view-integrations-span"><span>View Integrations</span></h3>

<p>You can view configured integrations using the <code>netq config ts show
notifier</code> command. Include the <code>json</code> option to display JSON-formatted
output.</p>

<p>For example:</p>

<pre><code>cumulus@ts:~$ netq config ts show notifier integration
Integration Name    Attribute    Value
------------------  -----------  -----------------------------------------------------------
slack-test          type         slack
                    tag          @ts-info
                    webhook      https://hooks.slack.com/services/text/moretext/evenmoretext
                    severity     info
pager-duty-test     api_integration_key  9876543210
                    type                 pagerduty
                    severity             info
                    api_access_key       1234567890

Filter Name    Attribute    Value
-------------  -----------  -------
default        output       ALL
               rule
</code></pre>

<h3 id="span-id-src-10453429-configureoptionalnetqcapabilities-elk-class-confluence-anchor-link-span-span-export-notifications-to-elk-span"><span id="src-10453429_ConfigureOptionalNetQCapabilities-elk" class="confluence-anchor-link"></span><span>Export Notifications to ELK</span></h3>

<p>NetQ Notifier integrates with ELK/Logstash using plugins to handle
<code>rsyslog</code> inputs.</p>

<p>For example:</p>








<img class = "confluence-embedded-image" src = "/images/download/attachments/10453429/NetQ-1.1-logstash.png" alt = "/images/download/attachments/10453429/NetQ-1.1-logstash.png"


width = 1200

 />


<p>To configure NetQ Notifier to send data to ELK through Logstash:</p>

<ol>
<li><p>On the host running the Telemetry Server and NetQ Notifier,
configure the notifier to send the logs to a Logstash instance by
adding the following to the logstash configuration file.<br />
In this example, the Logstash instance is on a host with the IP
address 192.168.50.30, using port 51414.</p>

<pre><code># rsyslog - logstash configuration 
sed -i '/$netq_notifier_log/a if $programname == &quot;netq-notifier&quot; then @@192.168.50.30:51414' /etc/rsyslog.d\
/50-netq-notifier.conf
</code></pre></li>

<li><p>Restart <code>rsyslog</code>.</p>

<pre><code>root@ts:~# systemctl restart rsyslog
</code></pre></li>

<li><p>On the server running the Logstash instance at the address specified
earlier, create a file in <code>/etc/logstash/conf.d/</code> called
<code>notifier_logstash.conf</code>. Then add the following definition, using
the <span style="color: #ff0000;"> </span> port you specified
earlier.</p>

<pre><code>root@ts:~#vi /etc/logstash/conf.d/notifier_logstash.conf

input {
    syslog {
        type =&gt; syslog
        port =&gt; 51414                                                                
    }
}
output {
    file {
        path =&gt; &quot;/tmp/logstash_notifier.log&quot;                                                                                  
    }
}
</code></pre></li>

<li><p>Restart Logstash.</p>

<pre><code>root@logstash_host:~# systemctl restart logstash
</code></pre></li>
</ol>

<p>NetQ Notifier logs now appear in <code>/tmp/logstash_notifier.log</code> on the
Logstash host.</p>

<h3 id="span-id-src-10453429-configureoptionalnetqcapabilities-splunk-class-confluence-anchor-link-span-span-export-notifications-to-splunk-span"><span id="src-10453429_ConfigureOptionalNetQCapabilities-splunk" class="confluence-anchor-link"></span><span>Export Notifications to Splunk</span></h3>

<p>NetQ integrates with Splunk using plugins to handle <code>rsyslog</code> inputs.</p>

<p>For example:</p>








<img class = "confluence-embedded-image" src = "/images/download/attachments/10453429/NetQ-1.1-splunk.png" alt = "/images/download/attachments/10453429/NetQ-1.1-splunk.png"


width = 800

 />


<p>To configure NetQ Notifier to send data to Splunk for display:</p>

<ol>
<li><p>On the host running the Telemetry Server and NetQ Notifier,
configure the notifier to send the logs to a Splunk by adding the
following to the Splunk configuration file.<br />
In this example, Splunk is installed on a host with the IP address
192.168.50.30, using port 51414.</p>

<pre><code># rsyslog - splunk configuration 
sed -i /$netq_notifier_log/a if $programname == netq-notifier then @@192.168.50.30:51415 /etc/rsyslog.d\
/50-netq-notifier.conf
</code></pre></li>

<li><p>Restart <code>rsyslog</code>.</p>

<pre><code>root@ts:~# systemctl restart rsyslog
</code></pre></li>

<li><p>Open Splunk in a browser, choose <strong>Add Data</strong> &gt; <strong>monitor</strong> &gt;
<strong>TCP</strong> &gt; <strong>Port</strong>, and set it to <em>51415</em>.</p></li>

<li><p>Click <strong>Next</strong>, then choose <strong>Source Type (syslog)</strong> &gt; <strong>Review</strong>
&gt; <strong>Done</strong>.</p></li>
</ol>

<p>NetQ Notifier messages now appear in Splunk.</p>

<h2 id="span-id-src-10453429-configureoptionalnetqcapabilities-notifierfilters-class-confluence-anchor-link-span-span-create-netq-notifier-filters-span"><span id="src-10453429_ConfigureOptionalNetQCapabilities-NotifierFilters" class="confluence-anchor-link"></span><span>Create NetQ Notifier Filters</span></h2>

<p>You can limit or direct log messages sent by NetQ Notifier using
filters. Filters are created based on rules you define. Each filter
contains one or more rules. Each rule contains a single key-value pair.
When a message matches the rule, it is sent to the indicated
destination. The default rule is matches all messages. You can specify
rules using entities such as hostnames or interface names in the regular
expression, enabling you to filter messages specific to those hosts or
interfaces. Additionally, you can send log messages to PagerDuty or a
given Slack channel using the <em>output</em> keyword; you need to have already
defined the PagerDuty or Slack configurations (as described earlier).</p>

<p>By default, filters are processed in the order they appear in the
<code>netq.yml</code> configuration file (from top to bottom) until a match is
found. This means that each event message is first evaluated by the
first filter listed, and if it matches then it is processed, ignoring
all other filters, and the system moves on to the next event message
received. If the event does not match the first filter, it is tested
against the second filter, and if it matches then it is processed and
the system moves on to the next event received. And so forth. Events
that do not match any filter are ignored. This diagram shows an example
with four defined filters with sample output results.</p>








<img class = "confluence-embedded-image" src = "/images/download/attachments/10453429/image2018-8-9-14_59_13.png" alt = "/images/download/attachments/10453429/image2018-8-9-14_59_13.png"


width = 250

 />


<p>When you create a new filter, it is automatically added to the top of
the list, before all others, so you may need to rearrange them to ensure
you capture the events you want and drop the events you do not want.
Optionally, you can use a <em>before</em> or <em>after</em> keyword to ensure one rule
is processed before or after another.</p>


<div class="notices info" > <p>Filter names may contain spaces, but must be enclosed with single quotes
in commands. It is easier to use dashes in place of spaces or mixed case
for better readability. For example, use bgpSessionChanges or
BGP-session-changes or BGPsessions, instead of &lsquo;BGP Session Changes&rsquo;.
Filter names are also case sensitive.</p>
 </div>


<p>You must restart the NetQ Notifier service after configuring filters so
they can take effect; run the <code>netq config ts restart notifier</code> command.</p>

<h3 id="span-id-src-10453429-configureoptionalnetqcapabilities-filterrule-class-confluence-anchor-link-span-span-build-filter-rules-span"><span id="src-10453429_ConfigureOptionalNetQCapabilities-FilterRule" class="confluence-anchor-link"></span><span>Build Filter Rules </span></h3>

<p>Each rule is comprised of a single key-value pair. Creating multiple
rules for a given filter can provide a very defined filter. There is a
fixed set of valid rule keys. Values are entered as regular expressions
and <em>vary according to your deployment</em>.</p>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th><p>Rule Key</p></th>
<th><p>Rule Values</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>BgpSession</p></td>
<td><p>Regular expression identifying a hostname, peer name, ASN, or VRF</p>
<p>Examples:</p>
<ul>
<li><p>hostname: server02, leaf*, exit01, spine0*</p></li>
<li><p>peer_name: server4, leaf*, exit02, spine0*</p></li>
<li><p>asn: 65020, 65012</p></li>
<li><p>vrf: mgmt, default</p></li>
</ul></td>
</tr>
<tr class="even">
<td><p>ClagSession</p></td>
<td><p>Regular expression identifying a hostname or CLAG system MAC address</p>
<p>Examples:</p>
<ul>
<li><p>hostname: server02, leaf*, exit01, spine0*</p></li>
<li><p>Clag_sysmac: 44:38:39:00:00:5C</p></li>
</ul></td>
</tr>
<tr class="odd">
<td><p>Fan</p></td>
<td><p>Regular expression identifying a hostname, sensor name, or sensor description</p>
<p>Examples:</p>
<ul>
<li><p>hostname: server02, leaf*, exit01, spine0*</p></li>
<li><p>s_name: fan*</p></li>
<li><p>s_desc: 'fan 1, tray*' <span style="color: #ff0000;"> </span></p></li>
</ul></td>
</tr>
<tr class="even">
<td><p>hostname</p></td>
<td><p>Regular expression identifying a hostname</p>
<p>For example, hosts-0* or spine*.</p></td>
</tr>
<tr class="odd">
<td><p>License</p></td>
<td><p>Regular expression identifying a hostname or license name <span style="color: #ff0000;"> </span></p>
<p>Examples: <span style="color: #ff0000;"> </span></p>
<ul>
<li><p>hostname: server02, leaf*, exit01, spine0*</p></li>
<li><p>name: Cumulus Linux, Ubuntu, CentOS</p></li>
</ul></td>
</tr>
<tr class="even">
<td><p>Link</p></td>
<td><p>Regular expression identifying a hostname, interface name, or kind of link</p>
<p>Examples:</p>
<ul>
<li><p>hostname: server02, leaf*, exit01, spine0*</p></li>
<li><p>ifname: eth0, swp*</p></li>
<li><p>kind: bond, bridge, eth, loopback, macvlan, swp, vlan, vrf, vxlan</p></li>
</ul></td>
</tr>
<tr class="odd">
<td><p>LnvSession</p></td>
<td><p>Regular expression identifying a hostname or role</p>
<p>Examples:</p>
<ul>
<li><p>hostname: server02, leaf*, exit01, spine0*</p></li>
</ul></td>
</tr>
<tr class="even">
<td><p>OS</p></td>
<td><p>Regular expression identifying a hostname</p>
<p>For example, hosts-0* or spine*.</p></td>
</tr>
<tr class="odd">
<td><p>Port</p></td>
<td><p>Regular expression identifying a hostname or interface name</p>
<p>Examples:</p>
<ul>
<li><p>hostname: server02, leaf*, exit01, spine0*</p></li>
<li><p>ifname : eth0, swp*</p></li>
</ul></td>
</tr>
<tr class="even">
<td><p>PSU</p></td>
<td><p>Regular expression identifying a hostname, sensor name</p>
<p>Examples:</p>
<ul>
<li><p>hostname: server02, leaf*, exit01, spine0*</p></li>
<li><p>s_nam e: psu*, psu2</p></li>
</ul></td>
</tr>
<tr class="odd">
<td><p>Services</p></td>
<td><p>Regular expression identifying a hostname, service name, or VRF</p>
<p>Examples:</p>
<ul>
<li><p>hostname: server02, leaf*, exit01, spine0*</p></li>
<li><p>name: clagd, lldpd, ssh, ntp, netqd, net-agent</p></li>
<li><p>vrf: mgmt, default</p></li>
</ul></td>
</tr>
<tr class="even">
<td><p>Temp</p></td>
<td><p>Regular expression identifying a hostname, sensor name, sensor description</p>
<p>Examples:</p>
<ul>
<li><p>hostname: server02, leaf*, exit01, spine0*</p></li>
<li><p>s_name: psu1temp*, temp*</p></li>
<li><p>s_desc: <span style="color: #222222;"> 'board sensor near fan' </span></p></li>
</ul></td>
</tr>
</tbody>
</table>


<div class="notices info" > <p>Rules are case sensitive. Use Tab completion to view the command options
syntax.</p>
 </div>


<h3 id="span-specify-output-location-span"><span>Specify Output Location</span></h3>

<p>The filter results may be output to a defined integration (integration
name), to syslog (<em>default</em>), to all integrations and syslog (<em>all</em>), or
not at all (<em>None</em>).</p>

<h3 id="span-example-create-a-filter-for-events-from-selected-switches-span"><span>Example: Create a Filter for Events from Selected Switches</span></h3>

<p>In this example, we created a NetQ Notifier integration with an existing
Slack channel called <em>slack-channel-leaf-alerts</em>. We then created a
filter called <em>leaf-filter</em> for any notifications that mention switches
named <em>leaf-0*</em>. The result is that any log messages mentioning one of
those host names is filtered to the <em>slack-channel-leaf-alerts</em> channel.</p>

<pre><code>cumulus@ts:~$ netq config ts add notifier integration slack slack-channel-leaf-alerts webhook https://hooks.slack.com/services/text/moretext/evenmoretext severity info 
cumulus@ts:~$ netq config ts add notifier filter leaf-filter rule hostname leaf-0* output slack-channel-leaf-alerts
cumulus@ts:~$ netq config ts restart notifier 
cumulus@ts:~$ netq config ts show notifier 
Integration Name           Attribute    Value
-------------------------  -----------  -----------------------------------------------------------
slack-channel-leaf-alerts  type         slack
                           webhook      https://hooks.slack.com/services/text/moretext/evenmoretext
                           severity     info


Filter Name    Attribute    Value
-------------  -----------  -------------------------
leaf-filter    output       slack-channel-leaf-alerts
               rule         hostname: leaf-0*
default        output       ALL
               rule
</code></pre>

<h3 id="span-example-verify-netq-notifier-status-span"><span>Example: Verify NetQ Notifier Status</span></h3>

<p>In this example, we are looking to see whether the NetQ Notifier is up
and running. If it were not, we would want to restart it.</p>

<pre><code>cumulus@ts:/$ netq config ts status notifier
netq-notifier... Running
</code></pre>

<h3 id="span-example-add-multiple-rules-to-a-filter-span"><span>Example: Add Multiple Rules to a Filter</span></h3>

<p>In this example, we created a filter with three rules to drop
notifications from a particular link.</p>

<pre><code>cumulus@ts:~$ netq config ts add notifier filter leaf01-swp1-drop rule type Link output None
cumulus@ts:~$ netq config ts add notifier filter leaf01-swp1-drop rule hostname leaf01 output None
cumulus@ts:~$ netq config ts add notifier filter leaf01-swp1-drop rule ifname swp1 output None
cumulus@ts:~$ netq config ts restart notifier 
cumulus@ts:!$ netq config ts show notifier
Integration Name           Attribute    Value
-------------------------  -----------  -----------------------------------------------------------
None

Filter Name       Attribute    Value
-------------     -----------  -------------------------
leaf01-swp1-drop  output       None
                  rule         type: Link
                               hostname: leaf01
                               ifname: swp1

default        output       ALL
               rule
</code></pre>

<h3 id="span-example-place-one-filter-before-or-after-another-filter-span"><span>Example: Place One Filter Before or After Another Filter</span></h3>

<p>In this example, we created a filter, <em>interface-filter</em>, that is
processed after <em>bgp-filter</em> (an existing filter) and sent the
notifications to a defined slack channel, <em>slack-channel-if-alerts</em>. Use
the <strong>before</strong> keyword to place the new filter before the <em>bgp-filter</em>.
Note that you must restart the Notifier for this configuration change to
take effect. Verify the configuration using the <code>show</code> command.</p>

<pre><code>cumulus@ts:~$ netq config ts add notifier filter interface-filter after bgp-filter rule Port swp* output slack-channel-if-alerts
cumulus@ts:~$ netq config ts restart notifier 
cumulus@ts:!$ netq config ts show notifier
Integration Name           Attribute    Value
-------------------------  -----------  -----------------------------------------------------------
slack-channel-bgp-alerts   type         slack
                           webhook      https://hooks.slack.com/services/text/moretext/evenmoretext
                           severity     info
slack-channel-if-alerts    type         slack
                           webhook      https://hooks.slack.com/services/text/moretext/evenmoretext
                           severity     info

Filter Name    Attribute    Value
-------------  -----------  -------------------------
bgp-filter     output       slack-channel-bgp-alerts
               rule         BgpSession: all
if-filter      output       slack-channel-if-alerts
               rule         Port: swp*
default        output       ALL
               rule
</code></pre>

<p>Alternately, you may edit the <code>netq.yml</code> file directly adding the
following integrations and filters:</p>

<pre><code>cumulus@ts:~$ nano netq.yml
...
notifier-integrations:
  - name: slack-channel-bgp-alerts
    type: slack
    webhook: &quot;https://hooks.slack.com/services/sometext/moretext/evenmoretext&quot;
    severity: INFO
  - name: slack-channel-if-alerts
    type: slack
    webhook: &quot;https://hooks.slack.com/services/sometext/moretext/evenmoretext&quot;
    severity: INFO

notifier-filters:
  - name: bgp-filter
    rule:
      BgpSession: all
    output:
      - slack-channel-bgp-alerts
  - name: if-filter
    rule:
      Port: swp*
    output:
      - slack-channel-if-alerts
...
cumulus@ts:~$ netq config ts restart notifier
</code></pre>

<h3 id="span-example-create-a-filter-to-drop-notifications-from-a-given-interface-span"><span>Example: Create a Filter to Drop Notifications from a Given Interface</span></h3>

<p>In this example, we created a filter, <em>ifswp21drop</em>, that drops
notifications for events from interface <em>swp21</em>. Make sure to capitalize
the Port rule option. Note that you must restart the Notifier for this
configuration change to take effect.</p>

<pre><code>cumulus@ts:~$ netq config ts add notifier filter ifswp1drop rule Port swp21
cumulus@ts:~$ netq config ts add notifier filter ifswp1drop output None
cumulus@ts:~$ netq config ts restart notifier 
</code></pre>

<p>or</p>

<pre><code>cumulus@ts:~$ nano netq.yml
...
notifier-filters:
  - name: ifswp21drop
    rule:
      Port: swp21
    output:
      - None
...
cumulus@ts:~$ netq config ts restart notifier
</code></pre>

<h3 id="span-example-create-a-filter-to-send-bgp-session-state-notifications-to-slack-span"><span>Example: Create a Filter to Send BGP Session State Notifications to Slack</span></h3>

<p>In this example, we created a filter, <em>BGPslackchannel</em>, to send BGP
session state notifications to an existing Slack channel,
<em>slack-channel-BGP</em>, and all other event notifications to a generic
Slack channel, <em>slack-channel-catchall</em>. The Slack integration should be
created before creating the filter. Note that you must restart the
Notifier for this configuration change to take effect.</p>

<pre><code>cumulus@ts:~$ netq config ts add notifier filter BGPslackchannel rule BgpSession all
cumulus@ts:~$ netq config ts add notifier filter BGPslackchannel output slack-channel-BGP
cumulus@ts:~$ netq config ts add notifier filter default output slack-channel-catchall
cumulus@ts:~$ netq config ts restart notifier
</code></pre>

<p>or</p>

<pre><code>notifier-filters:
 - name: BGPslackchannel
  rule:
    type: BgpSession
  output:
   - slack-channel-BGP
- name: default
 rule:
 output:
  - slack-channel-catchall
</code></pre>

<h3 id="span-example-create-a-filter-to-drop-all-temperature-related-event-notifications-span"><span>Example: Create a Filter to Drop All Temperature-Related Event Notifications</span></h3>

<p>In this example, we created a filter, tempDrop, to drop all temperature
related event notifications. Note: capitalization is important with
these rules. Use Tab completion to view the command options syntax.
Restart the Notifier for this configuration change to take effect.</p>

<pre><code>cumulus@ts:~$ netq config ts add notifier filter tempDrop rule Temp all
cumulus@ts:~$ netq config ts add notifier filter tempDrop output None
cumulus@ts:~$ netq config ts restart notifier
</code></pre>

<h3 id="span-example-create-a-filter-for-license-validation-event-notifications-span"><span>Example: Create a Filter for License Validation Event Notifications</span></h3>

<p>In this example, we created a filter, license-valid, to notify persons
with access to a PagerDuty messages on the pager-duty-license channel
when an invalid license is detected on <em>spine01</em>. Note: capitalization
is important with these rules. Use Tab completion to view the command
options syntax. Restart the Notifier for this configuration change to
take effect.</p>

<pre><code>cumulus@ts:~$ netq config ts add notifier pagerduty pager-duty-license api-access-key 1234567890 api-integration-key 9876543210
cumulus@ts:~$ netq config ts add notifier filter license-valid rule License spine01
cumulus@ts:~$ netq config ts add notifier filter license-valid output pager-duty-license
cumulus@ts:~$ netq config ts restart notifier

cumulus@ts:~$ netq config ts show notifier integration
Integration Name    Attribute    Value
------------------  -----------  -----------------------------------------------------------
pager-duty-license  api_integration_key  9876543210
                    type                 pagerduty
                    severity             info
                    api_access_key       1234567890

Filter Name     Attribute    Value
-------------   -----------  -------
license-expired output      pager-duty-license
                rule        License: spine01
default         output      ALL
                rule
</code></pre>

<h2 id="span-id-src-10453429-configureoptionalnetqcapabilities-haconfig-class-confluence-anchor-link-span-span-configure-high-availability-mode-span"><span id="src-10453429_ConfigureOptionalNetQCapabilities-HAConfig" class="confluence-anchor-link"></span><span>Configure High Availability Mode</span></h2>

<p>NetQ supports high availability  that is, the ability to continue
functioning even in the absence of a single failure of a Telemetry
Server node. To make the NetQ Telemetry Server highly available (<em>HA
mode</em>), you need to run three instances of the Telemetry Server.
Currently, exactly three instances are supported in HA mode. Of the
three instances, one is considered the <em>master</em> and is writeable while
the other two are read-only <em>replicas</em>. Each server instance is mapped
to port 6379 on the host. A Redis
<em><a href="https://redis.io/topics/sentinel" target="_blank">sentinel</a></em> on each Telemetry Server
host monitors the health of the database cluster and decides which
database is the current master. If the master becomes unavailable, the
sentinel promotes one of the replicas to become the new master. Each
sentinel runs on port 26379.</p>

<p>HA mode is optional.</p>

<h3 id="span-configure-ha-mode-span"><span>Configure HA Mode</span></h3>

<p>Perform the following steps to configure HA Mode:</p>








<img class = "confluence-embedded-image" src = "/images/download/attachments/10453429/image2018-7-19-14_24_39.png" alt = "/images/download/attachments/10453429/image2018-7-19-14_24_39.png"


width = 700

 />


<ol>
<li><p>Install the Telemetry Server image on three separate physical hosts
to form a database cluster.</p>

<ol>
<li><p>Use the instructions for installing the TS here.</p>


<div class="notices note" > <pre><code>    For proper operation of the HA mode you must specify the IP
    addresses for the Telemetry Servers. You cannot use DNS names.
</code></pre>
 </div>
</li>

<li><p>Note the IP address of each instance.</p></li>
</ol></li>

<li><p>Enable HA Mode<br />
These steps assume three Telemetry Servers, ts01 (the original one
which was <a href="/version/cumulus-netq-141/Cumulus-NetQ-Deployment-Guide/Install-NetQ">already
configured</a>
as the Telemetry Server), ts02 and ts03, which are assigned IP
addresses 10.0.0.5, 10.0.0.6 and 10.0.0.7, respectively. The servers
are all assumed to be up and reachable and can communicate with each
other.<br />
On each Telemetry Server, specify the IP address of the master and
both replicas, and then restart the netq-notifier service. Wait at
least 30 seconds between each instance of the command.</p>

<pre><code>cumulus@ts01:~$ netq config ts add server 10.0.0.5 10.0.0.6 10.0.0.7
cumulus@ts01:~$ sudo systemctl restart netq-notifier.service

cumulus@ts02:~$ netq config ts add server 10.0.0.5 10.0.0.6 10.0.0.7
cumulus@ts02:~$ sudo systemctl restart netq-notifier.service

cumulus@ts03:~$ netq config ts add server 10.0.0.5 10.0.0.6 10.0.0.7
cumulus@ts03:~$ sudo systemctl restart netq-notifier.service
</code></pre></li>

<li><p>Verify that HA mode is configured on the three Telemetry Servers.<br />
Each server should indicate that ts01 (using IP address 10.0.0.5) is
the master.</p>

<pre><code>cumulus@ts01:~$ netq config ts show server
Server    Role     Master    Replicas            Status    Last Changed
--------  -------  --------  ------------------  --------  --------------
10.0.0.5  master   10.0.0.5  10.0.0.7, 10.0.0.6  ok        55s
10.0.0.6  replica  10.0.0.5  -                   ok        55s
10.0.0.7  replica  10.0.0.5  -                   ok        55s

cumulus@ts02:~$ netq config ts show server 
Server    Role     Master    Replicas            Status    Last Changed 
--------  -------  --------  ------------------  --------  -------------- 
10.0.0.5  master   10.0.0.5  10.0.0.7, 10.0.0.6  ok        55s 
10.0.0.6  replica  10.0.0.5  -                   ok        55s 
10.0.0.7  replica  10.0.0.5  -                   ok        55s

cumulus@ts03:~$ netq config ts show server
Server    Role     Master    Replicas            Status    Last Changed
--------  -------  --------  ------------------  --------  --------------
10.0.0.5  master   10.0.0.5  10.0.0.7, 10.0.0.6  ok        55s
10.0.0.6  replica  10.0.0.5  -                   ok        55s
10.0.0.7  replica  10.0.0.5  -                   ok        55s
</code></pre></li>

<li><p>Update the NetQ Agent on each switch and server node you are
monitoring to point to the HA cluster, and restart the NetQ Agent.</p>

<pre><code>cumulus@switch:~$ netq config add server 10.0.0.5 10.0.0.6 10.0.0.7
Restarting netqd... Success!
cumulus@switch:~$ netq config restart agent
Restarting netq-agent... Success!
</code></pre>

<p>You could automate this step to update all of the agents on your
monitored nodes.</p></li>
</ol>

<h3 id="span-check-database-cluster-status-span"><span>Check Database Cluster Status </span></h3>

<p>Run the following <code>show</code> command from one of the Telemetry Servers.</p>

<pre><code>cumulus@ts01:~$ netq config ts show server
</code></pre>

<p>Optionally, you can view detailed output for a specific server in the
cluster by specifying that server&rsquo;s IP address.</p>

<pre><code>cumulus@ts01:~$ netq config ts show server 10.0.0.7
</code></pre>

<h3 id="span-restart-ha-mode-services-span"><span>Restart HA Mode Services</span></h3>

<p>You can restart the <code>netq-appliance</code> service using:</p>

<pre><code>cumulus@ts01:~$ sudo systemctl restart netq-appliance.service
</code></pre>

<h3 id="span-change-the-master-telemetry-server-span"><span>Change the Master Telemetry Server</span></h3>

<p>You can change which Telemetry Server you want to be the master simply
by changing the order in which you specify them with the <code>netq config ts
add server</code> command. You need to run the following command on each
Telemetry Server, waiting at least 30 seconds in between updating the
configuration on each server.</p>

<p>For example, notice that the Telemetry Server <em>ts01</em> is the master in
the following configuration:</p>

<pre><code>cumulus@ts01:~$ netq config ts show server
Server    Role     Master    Replicas            Status    Last Changed
--------  -------  --------  ------------------  --------  --------------
10.0.0.5  master   10.0.0.5  10.0.0.6, 10.0.0.7  ok        50s
10.0.0.6  replica  10.0.0.5  -                   ok        50s
10.0.0.7  replica  10.0.0.5  -                   ok        50s
</code></pre>

<p>To make the first replica the new master, run the following command on
each Telemetry Server (you don&rsquo;t need to change anything on the switch
and server nodes):</p>

<pre><code>cumulus@ts01:~$ netq config ts add server 10.0.0.6 10.0.0.5 10.0.0.7

cumulus@ts02:~$ netq config ts add server 10.0.0.6 10.0.0.5 10.0.0.7

cumulus@ts03:~$ netq config ts add server 10.0.0.6 10.0.0.5 10.0.0.7
</code></pre>

<p>Verify that <em>ts02</em> is the new master:</p>

<pre><code>cumulus@ts01:~$ netq config ts show server
Server    Role     Master    Replicas            Status    Last Changed
--------  -------  --------  ------------------  --------  --------------
10.0.0.5  replica  10.0.0.6  -                   ok        28s
10.0.0.6  master   10.0.0.6  10.0.0.7, 10.0.0.5  ok        28s
10.0.0.7  replica  10.0.0.6  -                   ok        28s
</code></pre>

<h3 id="span-replace-a-replica-with-a-new-server-span"><span>Replace a Replica with a New Server</span></h3>

<p>If you need to replace a Telemetry Server with a different physical
system, follow the instructions include in this topic.</p>


<div class="notices note" > <p>Do not try and replace the master server. You can only replace a
replica. If you need to replace the master, make it a replica first, as
described above.</p>
 </div>


<p>For illustrative purposes, we are using the following cluster of
Telemetry Servers, where 10.0.0.5 (ts01) is the master, while 10.0.0.6
(ts02) and 10.0.0.7 (ts03) are the replicas.</p>

<pre><code>cumulus@ts01:~$ netq config ts show server
Server    Role     Master    Replicas            Status    Last Changed
--------  -------  --------  ------------------  --------  --------------
10.0.0.5  master   10.0.0.5  10.0.0.6, 10.0.0.7  ok        14m:10s
10.0.0.6  replica  10.0.0.5  -                   ok        14m:10s
10.0.0.7  replica  10.0.0.5  -                   ok        14m:10s
</code></pre>

<p>In our example, you want to replace ts03 with ts04 (10.0.0.8):</p>

<ol>
<li><p>Bring up the new Telemetry Server (ts04) and make sure the
connectivity is okay.</p></li>

<li><p>Log in to the Telemetry Server you are replacing (ts03) and power it
down:</p>

<pre><code>cumulus@ts03:~$ sudo shutdown
</code></pre></li>

<li><p>Execute the following NetQ command on every Telemetry Server to
create a cluster with the new Telemetry Server. Wait at least 30
seconds between each instance of the command.</p>

<pre><code>cumulus@ts01:~$ netq config ts add server 10.0.0.5 10.0.0.6 10.0.0.8

cumulus@ts02:~$ netq config ts add server 10.0.0.5 10.0.0.6 10.0.0.8

cumulus@ts04:~$ netq config ts add server 10.0.0.5 10.0.0.6 10.0.0.8
</code></pre></li>

<li><p>Verify the HA status on one of the Telemetry Servers. The status
should be the same on all the three Telemetry Servers indicating
that ts01 (10.0.0.5) is the master.</p>

<pre><code>cumulus@ts01:~$ netq config ts show server
Server    Role     Master    Replicas            Status    Last Changed
--------  -------  --------  ------------------  --------  --------------
10.0.0.5  master   10.0.0.5  10.0.0.6, 10.0.0.8  ok        5m:10s
10.0.0.6  replica  10.0.0.5  -                   ok        5m:10s
10.0.0.8  replica  10.0.0.5  -                   ok        5m:10s
</code></pre></li>

<li><p>Update the agent on each switch and server node to point to the new
HA cluster, and restart the NetQ Agent on each node:</p>

<pre><code>cumulus@switch:~$ netq config add server 10.0.0.5 10.0.0.6 10.0.0.8
Restarting netqd... Success!
cumulus@switch:~$ netq config restart agent
Restarting netq-agent... Success!
</code></pre></li>
</ol>

<h3 id="span-reset-the-database-cluster-span"><span>Reset the Database Cluster</span></h3>

<p>You can force a reset of the Redis HA cluster using:</p>

<pre><code>cumulus@netq-ts:~$ netq config ts reset-cluster
</code></pre>

<h3 id="span-troubleshoot-ha-mode-span"><span>Troubleshoot HA Mode</span></h3>

<h4 id="span-relevant-services-and-configuration-files-span"><span>Relevant Services and Configuration Files</span></h4>

<p>The following <code>systemd</code> services are involved in HA mode:</p>

<ul>
<li><p>cts-auth.service: The Telemetry Server-side service that manages the
configuration.</p></li>

<li><p>cts-auth.socket: The Telemetry Server-side authorization shim socket
for the service console.</p></li>

<li><p>cts-backup.service: Runs a cron job to back up the Redis database.</p></li>

<li><p>cts-backup.timer: The timer for the backup service, with a minimum
interval of 5 minutes.</p></li>

<li><p>netqd.service: The service for the Telemetry Server CLI for use
locally on the server.</p></li>

<li><p>netq-appliance.service: Starts and stops all Telemetry Server
services <strong>except</strong> for the <code>ts-gui</code> service.</p></li>

<li><p>netq-gui.service: Starts and stops Telemetry Server <code>ts-gui</code>
service.</p></li>

<li><p>netq-influxdb.service: The service that manages the HA mode
InfluxDB.</p></li>

<li><p>netq-notifier.service: Starts and stops the NetQ Notifier service.</p></li>
</ul>

<p>The following configuration files are in the <code>/etc/cts/run/redis</code>
directory:</p>

<ul>
<li><p>redis_6379.conf: Contains the runtime Redis database configuration
and state.</p></li>

<li><p>snt1.conf: Contains the runtime Redis sentinel configuration and
state.</p></li>
</ul>

<p>The following log file is in the <code>/var/log</code> directory:</p>

<ul>
<li>netqd.log: The logs associated with running the NetQ CLI locally on
the machine.</li>
</ul>

<p>The NetQ Notifier log is:</p>

<ul>
<li>/var/log/netq- notifier .log</li>
</ul>

<p>Logging configurations are in:</p>

<ul>
<li><p>/etc/rsyslog.d</p></li>

<li><p>/etc/logrotate.d</p></li>
</ul>

<p>The following log files are in the <code>/var/log/cts</code> directory:</p>

<ul>
<li><p>cts-backup.log</p></li>

<li><p>cts-docker-compose.log</p></li>

<li><p>cts-dockerd.log</p></li>

<li><p>cts-redis.log</p></li>

<li><p>cts-sentinel.log</p></li>
</ul>

<p>The <code>/etc/cts/environment</code> file sets key environment variables that
control the behavior of the NetQ Telemetry Server.</p>

<ul>
<li><p><code>REDIS_MEMORY_PCT</code>: Setting this variable to a value between 10 and
90 allocates that specified percent of the VM&rsquo;s memory to REDIS. The
default value is 60. You can check the currrent allocation with the
following command:</p>

<pre><code>vagrant@netq-1:~$ /usr/sbin/netq-adjust-mem --show
Current maxmemory 2442384998 is 0.60 of 4070641664 available.
</code></pre></li>
</ul>

<p>For more information about the log files, see the <a href="/version/cumulus-netq-141/Cumulus-NetQ-Telemetry-User-Guide/Resolve-Issues/Investigate-NetQ-Issues">Investigate NetQ
Issues</a>
topic.</p>

<h4 id="span-one-replica-must-be-available-always-span"><span>One Replica Must Be Available Always</span></h4>

<p>While HA mode is enabled, if both the replica servers go down, the
master database stops accepting writes. This causes the NetQ agents to
go into a rotten state.</p>

<p>This serves to avoid having multiple masters in a split-brain condition.
Please refer to the section &ldquo;Example 2: basic setup with three boxes&rdquo; on
the <a href="https://redis.io/topics/sentinel" target="_blank">Redis Sentinel page</a> for more
details.</p>

<h2 id="span-integrate-with-a-hardware-chassis-span"><span>Integrate with a Hardware Chassis</span></h2>

<p>NetQ can run within a <a href="https://cumulusnetworks.com/products/cumulus-express/getting-started/backpack/" target="_blank">Facebook Backpack
chassis</a>,
<a href="https://cumulusnetworks.com/products/cumulus-express/getting-started/cx10256s-omp800/" target="_blank">Cumulus Express CX-10256-S
chassis</a>
or <a href="https://cumulusnetworks.com/products/cumulus-express/getting-started/cx10256s-omp800/" target="_blank">Edgecore OMP-800
chassis</a>.</p>

<p>Keep the following issues in mind if you intend to use NetQ with a
chassis:</p>

<ul>
<li><p>You must assign a unique hostname to every node that runs the NetQ
Agent. By default, all the fabric cards in the chassis have the same
hostname.</p></li>

<li><p>The NetQ Agent must be installed on every line card.</p></li>

<li><p>No information is returned about the ASIC when you run <code>netq show
inventory asic</code>. This is a known issue.</p></li>

<li><p>Since the chassis sensor information is shared, every line card and
fabric card can report the same sensor data. By default, sensor data
is disabled on a chassis to avoid this duplication . To enable
sensor data on a line card, edit <code>/etc/netq/netq.yml</code> or
<code>/etc/netq/config.d/user.yml</code> and set the <code>send_chassis_sensor_data</code>
keyword to <em>true</em>, then restart the NetQ Agent with <code>netq config
agent restart</code>. Configuring NetQ in this way prevents any
duplication of data in the NetQ database.</p>

<pre><code>cumulus@chassis-lc101:~$ sudo nano /etc/netq/netq.yml

...
netq-agent:
  send_chassis_sensor_data: true
...
</code></pre></li>
</ul>

<h2 id="span-extending-netq-with-custom-services-using-curl-span"><span>Extending NetQ with Custom Services Using curl</span></h2>

<p>You can extend NetQ to monitor parameters beyond what it monitors by
default. For example, you can create a service that runs a series of
pings to a known host or between two known hosts to ensure that
connectivity is valid. Or you can create a service that curls a URL and
sends the output to <code>/dev/null</code>. This method works with the <a href="/version/cumulus-netq-141/Cumulus-NetQ-Telemetry-User-Guide/Resolve-Issues/Methods-for-Diagnosing-Network-Issues">NetQ time
machine</a>
capability regarding <code>netq show services</code>.</p>

<ol>
<li><p>As the sudo user on a node running the NetQ agent, edit the
<code>/etc/netq/config.d/netq-agent-commands.yml</code> file.</p></li>

<li><p>Create the custom service. In the example below, the new service is
called <em>web</em>. You need to specify:</p>

<ul>
<li><p>The <em>period</em> in seconds.</p></li>

<li><p>The <em>key</em> that identifies the name of the service.</p></li>

<li><p>The command will <em>run</em> always. If you do not specify <em>always</em>
here, you must enable the service manually using <code>systemctl</code>.</p></li>

<li><p>The <em>command</em> to run. In this case we are using <code>curl</code> to ping a
web server.</p></li>
</ul>

<!-- end list -->

<pre><code>cumulus@leaf01:~$ sudo vi /etc/netq/config.d/netq-agent-commands.yml 

user-commands:
  - service: 'misc'
    commands:
      - period: &quot;60&quot;
        key: &quot;config-interfaces&quot;
        command: &quot;/bin/cat /etc/network/interfaces&quot;
      - period: &quot;60&quot;
        key: &quot;config-ntp&quot;
        command: &quot;/bin/cat /etc/ntp.conf&quot;
  - service: &quot;zebra&quot;
    commands:
      - period: &quot;60&quot;
        key: &quot;config-quagga&quot;
        command: [&quot;/usr/bin/vtysh&quot;, &quot;-c&quot;, &quot;show running-config&quot;]

  - service: &quot;web&quot;
    commands:
      - period: &quot;60&quot;
        key: &quot;webping&quot;
        run: &quot;always&quot;
        command: ['/usr/bin/curl https://cumulusnetworks.com/ -o /dev/null']
</code></pre></li>

<li><p>After you save and close the file, restart the NetQ agent:</p>

<pre><code>cumulus@leaf01:~$ netq config agent restart
</code></pre></li>

<li><p>You can verify the command is running by checking the
<code>/var/run/netq-agent-running.json</code> file:</p>

<pre><code>cumulus@leaf01:~$ cat /var/run/netq-agent-running.json
{&quot;commands&quot;: [{&quot;service&quot;: &quot;smond&quot;, &quot;always&quot;: false, &quot;period&quot;: 30, &quot;callback&quot;: {}, &quot;command&quot;: &quot;/usr/sbin/smonctl -j&quot;, &quot;key&quot;: &quot;smonctl-json&quot;}, {&quot;service&quot;: &quot;misc&quot;, &quot;always&quot;: false, &quot;period&quot;: 30, &quot;callback&quot;: {}, &quot;command&quot;: &quot;/usr/sbin/switchd -lic&quot;, &quot;key&quot;: &quot;cl-license&quot;}, {&quot;service&quot;: &quot;misc&quot;, &quot;always&quot;: false, &quot;period&quot;: 30, &quot;callback&quot;: {}, &quot;command&quot;: null, &quot;key&quot;: &quot;ports&quot;}, {&quot;service&quot;: &quot;misc&quot;, &quot;always&quot;: false, &quot;period&quot;: 60, &quot;callback&quot;: null, &quot;command&quot;: &quot;/bin/cat /etc/network/interfaces&quot;, &quot;key&quot;: &quot;config-interfaces&quot;}, {&quot;service&quot;: &quot;misc&quot;, &quot;always&quot;: false, &quot;period&quot;: 60, &quot;callback&quot;: null, &quot;command&quot;: &quot;/bin/cat /etc/ntp.conf&quot;, &quot;key&quot;: &quot;config-ntp&quot;}, {&quot;service&quot;: &quot;lldpd&quot;, &quot;always&quot;: false, &quot;period&quot;: 30, &quot;callback&quot;: {}, &quot;command&quot;: &quot;/usr/sbin/lldpctl -f json&quot;, &quot;key&quot;: &quot;lldp-neighbor-json&quot;}, {&quot;service&quot;: &quot;mstpd&quot;, &quot;always&quot;: false, &quot;period&quot;: 15, &quot;callback&quot;: {}, &quot;command&quot;: &quot;/sbin/mstpctl showall json&quot;, &quot;key&quot;: &quot;mstpctl-bridge-json&quot;}], &quot;backend&quot;: {&quot;server&quot;: &quot;10.0.0.165&quot;}}
</code></pre></li>

<li><p>And you can see the service is running on the host when you run
<code>netq show services</code>:</p>

<pre><code>cumulus@leaf01:~$ netq show services web
</code></pre></li>
</ol>

<article id="html-search-results" class="ht-content" style="display: none;">

</article>

<footer id="ht-footer">

</footer>
</article>

      <script src="https://utteranc.es/client.js"
        repo="CumulusNetworks/docs-internal"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
      </script>

    </div>
    

      


  

    <aside class="book-toc fixed">

  
    <div class="toc">
    
      <button>
      <a href="https://github.com/CumulusNetworks/docs/edit/master/content/version/cumulus-netq-141/Cumulus-NetQ-Deployment-Guide/Configure-Optional-NetQ-Capabilities.md" target="_blank" rel="noopener"><img src="/docs.cumulusnetworks.com/svg/pencil-circle.svg" alt="Edit" /> Edit this page</a>
      </button>
    
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#span-activate-early-access-features-span"><span>Activate Early Access Features</span></a></li>
<li><a href="#span-id-src-10453429-configureoptionalnetqcapabilities-integratenotification-class-confluence-anchor-link-span-span-integrate-netq-with-an-event-notification-application-span"><span id="src-10453429_ConfigureOptionalNetQCapabilities-IntegrateNotification" class="confluence-anchor-link"></span><span>Integrate NetQ with an Event Notification Application</span></a>
<ul>
<li><a href="#span-netq-notifier-span"><span>NetQ Notifier</span></a>
<ul>
<li><a href="#span-log-message-format-span"><span>Log Message Format</span></a></li>
<li><a href="#span-default-output-span"><span>Default Output</span></a></li>
</ul></li>
<li><a href="#span-netq-notifier-cli-overview-span"><span>NetQ Notifier CLI Overview</span></a></li>
<li><a href="#span-id-src-10453429-configureoptionalnetqcapabilities-notifierlog-class-confluence-anchor-link-span-span-configure-netq-notifier-logging-span"><span id="src-10453429_ConfigureOptionalNetQCapabilities-NotifierLog" class="confluence-anchor-link"></span><span>Configure NetQ Notifier Logging</span></a></li>
<li><a href="#span-id-src-10453429-configureoptionalnetqcapabilities-pdcli-class-confluence-anchor-link-span-span-configure-pagerduty-using-netq-notifier-cli-span"><span id="src-10453429_ConfigureOptionalNetQCapabilities-PDcli" class="confluence-anchor-link"></span><span>Configure PagerDuty Using NetQ Notifier CLI</span></a></li>
<li><a href="#span-configure-slack-using-netq-notifier-cli-span"><span>Configure Slack Using NetQ Notifier CLI</span></a></li>
<li><a href="#span-id-src-10453429-configureoptionalnetqcapabilities-pdman-class-confluence-anchor-link-span-span-configure-pagerduty-manually-span"><span id="src-10453429_ConfigureOptionalNetQCapabilities-PDman" class="confluence-anchor-link"></span><span>Configure PagerDuty Manually</span></a></li>
<li><a href="#span-configure-slack-manually-span"><span>Configure Slack Manually</span></a></li>
<li><a href="#span-view-integrations-span"><span>View Integrations</span></a></li>
<li><a href="#span-id-src-10453429-configureoptionalnetqcapabilities-elk-class-confluence-anchor-link-span-span-export-notifications-to-elk-span"><span id="src-10453429_ConfigureOptionalNetQCapabilities-elk" class="confluence-anchor-link"></span><span>Export Notifications to ELK</span></a></li>
<li><a href="#span-id-src-10453429-configureoptionalnetqcapabilities-splunk-class-confluence-anchor-link-span-span-export-notifications-to-splunk-span"><span id="src-10453429_ConfigureOptionalNetQCapabilities-splunk" class="confluence-anchor-link"></span><span>Export Notifications to Splunk</span></a></li>
</ul></li>
<li><a href="#span-id-src-10453429-configureoptionalnetqcapabilities-notifierfilters-class-confluence-anchor-link-span-span-create-netq-notifier-filters-span"><span id="src-10453429_ConfigureOptionalNetQCapabilities-NotifierFilters" class="confluence-anchor-link"></span><span>Create NetQ Notifier Filters</span></a>
<ul>
<li><a href="#span-id-src-10453429-configureoptionalnetqcapabilities-filterrule-class-confluence-anchor-link-span-span-build-filter-rules-span"><span id="src-10453429_ConfigureOptionalNetQCapabilities-FilterRule" class="confluence-anchor-link"></span><span>Build Filter Rules </span></a></li>
<li><a href="#span-specify-output-location-span"><span>Specify Output Location</span></a></li>
<li><a href="#span-example-create-a-filter-for-events-from-selected-switches-span"><span>Example: Create a Filter for Events from Selected Switches</span></a></li>
<li><a href="#span-example-verify-netq-notifier-status-span"><span>Example: Verify NetQ Notifier Status</span></a></li>
<li><a href="#span-example-add-multiple-rules-to-a-filter-span"><span>Example: Add Multiple Rules to a Filter</span></a></li>
<li><a href="#span-example-place-one-filter-before-or-after-another-filter-span"><span>Example: Place One Filter Before or After Another Filter</span></a></li>
<li><a href="#span-example-create-a-filter-to-drop-notifications-from-a-given-interface-span"><span>Example: Create a Filter to Drop Notifications from a Given Interface</span></a></li>
<li><a href="#span-example-create-a-filter-to-send-bgp-session-state-notifications-to-slack-span"><span>Example: Create a Filter to Send BGP Session State Notifications to Slack</span></a></li>
<li><a href="#span-example-create-a-filter-to-drop-all-temperature-related-event-notifications-span"><span>Example: Create a Filter to Drop All Temperature-Related Event Notifications</span></a></li>
<li><a href="#span-example-create-a-filter-for-license-validation-event-notifications-span"><span>Example: Create a Filter for License Validation Event Notifications</span></a></li>
</ul></li>
<li><a href="#span-id-src-10453429-configureoptionalnetqcapabilities-haconfig-class-confluence-anchor-link-span-span-configure-high-availability-mode-span"><span id="src-10453429_ConfigureOptionalNetQCapabilities-HAConfig" class="confluence-anchor-link"></span><span>Configure High Availability Mode</span></a>
<ul>
<li><a href="#span-configure-ha-mode-span"><span>Configure HA Mode</span></a></li>
<li><a href="#span-check-database-cluster-status-span"><span>Check Database Cluster Status </span></a></li>
<li><a href="#span-restart-ha-mode-services-span"><span>Restart HA Mode Services</span></a></li>
<li><a href="#span-change-the-master-telemetry-server-span"><span>Change the Master Telemetry Server</span></a></li>
<li><a href="#span-replace-a-replica-with-a-new-server-span"><span>Replace a Replica with a New Server</span></a></li>
<li><a href="#span-reset-the-database-cluster-span"><span>Reset the Database Cluster</span></a></li>
<li><a href="#span-troubleshoot-ha-mode-span"><span>Troubleshoot HA Mode</span></a>
<ul>
<li><a href="#span-relevant-services-and-configuration-files-span"><span>Relevant Services and Configuration Files</span></a></li>
<li><a href="#span-one-replica-must-be-available-always-span"><span>One Replica Must Be Available Always</span></a></li>
</ul></li>
</ul></li>
<li><a href="#span-integrate-with-a-hardware-chassis-span"><span>Integrate with a Hardware Chassis</span></a></li>
<li><a href="#span-extending-netq-with-custom-services-using-curl-span"><span>Extending NetQ with Custom Services Using curl</span></a></li>
</ul></li>
</ul>
</nav>
    </div>
  

</aside>






  </main>
  <footer class="footer-top">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <div class="footer-content">
            <div class="mb-4">
                <img src="https://static.cumulusnetworks.com/static/images/shared/cumulus-networks-rt-white-trademarked.ff839f1b2570.svg">
                <p> <script type="text/javascript">document.write(new Date().getFullYear());</script> Cumulus Networks.<br>
                Site by <a href="//unomena.com/" target="_blank">Unomena</a>.</p>
            </div>
            <ul class="mb-4">
              <li><h4>Products</h4></li>
              <li><a href="//cumulusnetworks.com/products/cumulus-linux/">Cumulus Linux</a></li>
              <li><a href="//cumulusnetworks.com/products/netq/">Cumulus NetQ</a></li>
              <li><a href="//cumulusnetworks.com/products/cumulus-express/">Cumulus Express</a></li>
            </ul>
            <ul class="mb-4">
              <li><h4>Learn</h4></li>
              <li><a href="//cumulusnetworks.com/learn/web-scale-networking-education/">Going web-scale</a></li>
              <li><a href="//cumulusnetworks.com/learn/events/">Events</a></li>
              <li><a href="//cumulusnetworks.com/blog/">Blog</a></li>
            </ul>
            <ul class="mb-4">
              <li><h4>About</h4></li>
              <li><a href="//cumulusnetworks.com/about/">Our story</a></li>
              <li><a href="//cumulusnetworks.com/about/careers/">Careers</a></li>
              <li><a href="//cumulusnetworks.com/about/media-coverage/">Media coverage</a></li>
              <li><a href="//docs.cumulusnetworks.com/" target="_blank">Tech docs</a></li>
              <li><a href="//cumulusnetworks.com/community/">Community</a></li>
            </ul>
            <ul>
              <li>
                <a href="//twitter.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M23 6.628l-2-.5 1-2-2.464.7A4.48 4.48 0 0 0 12 8.128v1c-3.539.73-6.634-1.2-9.5-4.5q-.75 4 1.5 6l-3-.5c.405 2.069 1.362 3.7 4 4l-2.5 1c1 2 2.566 2.31 5 2.5a10.748 10.748 0 0 1-6.5 2c12.755 5.669 20-2.664 20-10V8.3z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//www.facebook.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                      .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M17.768 7.5H13.5V5.6a.972.972 0 0 1 1.012-1.1c.418 0 2.988.01 2.988.01V.5h-4.329C9.244.5 8.5 3.474 8.5 5.355V7.5h-3v4h3v12h5v-12h3.851z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//linkedin.com/company/cumulus-networks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                      .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M6.5 22.5h-5v-13h5zm9-9a2 2 0 0 0-2 2v7h-5v-13h5v1.485a6.307 6.307 0 0 1 3.99-1.495c2.962 0 5.01 2.2 5.01 6.355V22.5h-5v-7a2 2 0 0 0-2-2zM6.5 5A2.5 2.5 0 1 1 4 2.5 2.5 2.5 0 0 1 6.5 5z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//vimeo.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M.5 7.393l.933 1.224S3.36 7.1 4 7.859s3.1 9.925 3.915 11.617c.714 1.483 2.684 3.444 4.845 2.042s9.34-7.529 10.626-14.769-8.642-5.723-9.693.583c2.627-1.577 4.03.642 2.686 3.154s-2.569 4.145-3.211 4.145-1.135-1.679-1.868-4.613c-.76-3.035-.755-8.5-3.911-7.882C4.412 2.721.5 7.393.5 7.393z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//www.github.com/cumulusnetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                        <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                        </style>
                    </defs>
                    <path class="a" d="M19.459 17c0-5.969-4.126-3.532-7.5-3.532s-7.5-2.375-7.5 3.532a3.5 3.5 0 0 0 3.5 3.5h8a3.5 3.5 0 0 0 3.5-3.5z"></path>
                    <path class="a" d="M21.489 10.214l.032.023s2.646-4.572-.6-7.237c-2 0-5.058 3.3-5.058 3.3l.022.016A14.152 14.152 0 0 0 8.1 6.3C8.083 6.285 5.037 3 3.042 3c-3.173 2.6-.729 7.012-.614 7.217a8.876 8.876 0 0 0-1.395 5.743c.241 3.126 2.847 6.54 5.982 6.54H16.9c3.135 0 5.742-3.414 5.982-6.54a8.857 8.857 0 0 0-1.393-5.746z"></path>
                    <ellipse class="a" cx="15.48" cy="17" rx="1" ry="1.5"></ellipse>
                    <ellipse class="a" cx="8.48" cy="17" rx="1" ry="1.5"></ellipse>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//slack.cumulusnetworks.com/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                        <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                        </style>
                    </defs>
                    <rect class="a" x=".5" y=".5" width="23" height="23" rx="6" ry="6"></rect>
                    <circle class="a" cx="12" cy="12" r="6"></circle>
                    <circle class="a" cx="19" cy="5" r="1.5"></circle>
                  </svg>
                </a>
              </li>
              <li>
                <p>Cumulus Networks<sup></sup>  Data center networking software for the open, modern data center.</p>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </footer>
  <div class="footer-bottom">
      <div class="container">
          <div class="row">
              <div class="col-12">
                  <ul>
                      <li><a href="//cumulusnetworks.com/legal/trademarks/">Trademarks</a></li>
                      <li><a href="//cumulusnetworks.com/legal/privacy/">Privacy</a></li>
                      <li><a href="//cumulusnetworks.com/legal/">Terms of service</a></li>
                  </ul>
              </div>
          </div>
      </div>
  </div>

  
  

</body>

</html>
