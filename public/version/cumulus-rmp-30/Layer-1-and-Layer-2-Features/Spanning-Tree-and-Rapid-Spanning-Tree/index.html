<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Spanning Tree and Rapid Spanning Tree | Cumulus Networks Documentation</title>

  
  <link href="https://fonts.googleapis.com/css?family=Oxygen|Oxygen+Mono:300,400,700" rel="stylesheet">

  
  
  
  <link rel="stylesheet" href="/docs.cumulusnetworks.com/book.min.a378d8a2da6f5357a83a43dff33d6f77fb70401e0399d5ba78faf81d7a1ae1a8.css">

  
  <link rel="icon" href="/docs.cumulusnetworks.com/icons/favicon.png" type="image/x-icon">

  
  <!--
  Made with Book Theme
  https://github.com/alex-shpak/hugo-book
  -->

  
  
  <script src = "/docs.cumulusnetworks.com/js/codecopy.js"> </script>

</head>


<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  
  <header id="site-nav">
    <div class="header-wrapper flex">
      <a href="/">
        <img src="/header-logo.png" alt="Cumulus Networks">
        <img src="/cumulus-networks-rt-white.svg" alt="Cumulus Networks" class="header-mobile">
        <span>Docs</span>
      </a>
      <ul class="flex">
        <li><a href="//cumulusnetworks.com">HOME</a></li>
        <li><a href="//support.cumulusnetworks.com/">SUPPORT</a></li>
        <li><a href="//docs.cumulusnetworks.com/">DOCS</a></li>
        <li><a href="//education.cumulusnetworks.com">EDUCATION</a></li>
        <li><a href="//cumulusnetworks.com/blog/">BLOG</a></li>
        <li><a href="//forums.cumulusnetworks.com/">FORUMS</a></li>
      </ul>
      <div class="burger-menu">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </header>
  <div id="product-nav" class="flex">
      
    
    <ul>
    
      <li><a href = docs.cumulusnetworks.com/cumulus-linux/ >
        Cumulus Linux </a> </li>
    
      <li><a href = docs.cumulusnetworks.com/cumulus-netq/ >
        Cumulus NetQ </a> </li>
    
      <li><a href = docs.cumulusnetworks.com/cumulus-vx/ >
        Cumulus VX </a> </li>
    
      <li>
        <div id="products-dropdown" class="dropdown">
            <button class="btn" type="button" id="dropdownMenuButton">
              Products
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <a class="dropdown-item" href="">Cumulus RMP</a>
              <a class="dropdown-item" href="">Cumulus Chassis</a>
              <a class="dropdown-item" href="">Cumulus Host Pack</a>
            </div>
        </div>
      </li>
    </ul>
    <div class="search-container">
      <div id="doc-search-box">
        <input type="text" class="doc-search-input" placeholder="Search" value="">
        <span><button type="submit"><img src="/icons/search_20x20.svg" alt=""></button></span>
      </div>
      <div id="dropdown" class="dropdown">
          <button class="btn" type="button" id="dropdownMenuButton">
            v3.0.1
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/cumulus-rmp/"> v3.7</a>
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-rmp-25esr/"> v2.5.12</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-rmp-30/"> v3.0.1</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-rmp-31/"> v3.1.2</a>
            
            
            
             
             
            <a class = "dropdown-item" href = "docs.cumulusnetworks.com/version/cumulus-rmp-321/"> v3.2.1</a>
            
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
             
            
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
             
            
            
             
             
            
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
             
            
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
             
            
          </div>
      </div>
    </div>
  </div>
  <main class="flex container">
    <aside class="book-menu fixed">

      <nav role="navigation">
        <h2 class="book-brand">
          <a href="docs.cumulusnetworks.com">Cumulus Networks Documentation</a>
        </h2>
        
        




  <ul class = "cn-book-section-container" id = "top">
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
            

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/" >
    Cumulus RMP User Guide
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/System-Management/" >
    System Management
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/System-Management/Authentication-Authorization-and-Accounting/" >
    Authentication, Authorization, and Accounting
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/System-Management/Authentication-Authorization-and-Accounting/SSH-for-Remote-Access/" >
    SSH for Remote Access
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/System-Management/Authentication-Authorization-and-Accounting/User-Accounts/" >
    User Accounts
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/System-Management/Authentication-Authorization-and-Accounting/Using-sudo-to-Delegate-Privileges/" >
    Using sudo to Delegate Privileges
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/System-Management/Authentication-Authorization-and-Accounting/LDAP-Authentication-and-Authorization/" >
    LDAP Authentication and Authorization
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/System-Management/Installation-Upgrading-and-Package-Management/" >
    Installation, Upgrading and Package Management
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/System-Management/Installation-Upgrading-and-Package-Management/Managing-Cumulus-RMP-Disk-Images/" >
    Managing Cumulus RMP Disk Images
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/System-Management/Installation-Upgrading-and-Package-Management/Adding-and-Updating-Packages/" >
    Adding and Updating Packages
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/System-Management/Installation-Upgrading-and-Package-Management/Zero-Touch-Provisioning/" >
    Zero Touch Provisioning
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/System-Management/Setting-Date-and-Time/" >
    Setting Date and Time
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/System-Management/Managing-Application-Daemons/" >
    Managing Application Daemons
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/System-Management/Configuring-switchd/" >
    Configuring switchd
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/Configuring-and-Managing-Network-Interfaces/" >
    Configuring and Managing Network Interfaces
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/Configuring-and-Managing-Network-Interfaces/Layer-1-and-Switch-Port-Attributes/" >
    Layer 1 and Switch Port Attributes
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/Configuring-and-Managing-Network-Interfaces/Configuring-DHCP-Relays/" >
    Configuring DHCP Relays
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/Layer-1-and-Layer-2-Features/" >
    Layer 1 and Layer 2 Features
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/Layer-1-and-Layer-2-Features/Ethernet-Bridging-VLANs/" >
    Ethernet Bridging - VLANs
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/Layer-1-and-Layer-2-Features/Ethernet-Bridging-VLANs/VLAN-Tagging/" >
    VLAN Tagging
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/Layer-1-and-Layer-2-Features/Ethernet-Bridging-VLANs/VLAN-aware-Bridge-Mode-for-Large-scale-Layer-2-Environments/" >
    VLAN-aware Bridge Mode for Large-scale Layer 2 Environments
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/Layer-1-and-Layer-2-Features/Spanning-Tree-and-Rapid-Spanning-Tree/"  class="active" >
    Spanning Tree and Rapid Spanning Tree
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/Layer-1-and-Layer-2-Features/Link-Layer-Discovery-Protocol/" >
    Link Layer Discovery Protocol
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/Layer-1-and-Layer-2-Features/Prescriptive-Topology-Manager-PTM/" >
    Prescriptive Topology Manager - PTM
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/Layer-1-and-Layer-2-Features/Bonding-Link-Aggregation/" >
    Bonding - Link Aggregation
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/Routing/" >
    Routing
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/Routing/Management-VRF/" >
    Management VRF
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/Monitoring-and-Troubleshooting/" >
    Monitoring and Troubleshooting
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/Monitoring-and-Troubleshooting/Understanding-and-Decoding-the-cl-support-Output-File/" >
    Understanding and Decoding the cl-support Output File
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/Monitoring-and-Troubleshooting/Understanding-and-Decoding-the-cl-support-Output-File/Troubleshooting-Log-Files/" >
    Troubleshooting Log Files
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/Monitoring-and-Troubleshooting/Understanding-and-Decoding-the-cl-support-Output-File/Troubleshooting-the-etc-Directory/" >
    Troubleshooting the etc Directory
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/Monitoring-and-Troubleshooting/Understanding-and-Decoding-the-cl-support-Output-File/Troubleshooting-the-support-Directory/" >
    Troubleshooting the support Directory
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/Monitoring-and-Troubleshooting/Troubleshooting-Network-Interfaces/" >
    Troubleshooting Network Interfaces
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/Monitoring-and-Troubleshooting/Troubleshooting-Network-Interfaces/Monitoring-Interfaces-and-Transceivers-Using-ethtool/" >
    Monitoring Interfaces and Transceivers Using ethtool
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/Monitoring-and-Troubleshooting/Network-Troubleshooting/" >
    Network Troubleshooting
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/Monitoring-and-Troubleshooting/Network-Troubleshooting/Using-netshow-to-Troubleshoot-Your-Network-Configuration/" >
    Using netshow to Troubleshoot Your Network Configuration
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/Monitoring-and-Troubleshooting/Network-Troubleshooting/Monitoring-System-Statistics-and-Network-Traffic-with-sFlow/" >
    Monitoring System Statistics and Network Traffic with sFlow
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/Monitoring-and-Troubleshooting/Single-User-Mode-Boot-Recovery/" >
    Single User Mode - Boot Recovery
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/Monitoring-and-Troubleshooting/Resource-Diagnostics-Using-cl-resource-query/" >
    Resource Diagnostics Using cl-resource-query
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/Monitoring-and-Troubleshooting/Monitoring-System-Hardware/" >
    Monitoring System Hardware
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/Monitoring-and-Troubleshooting/SNMP-Monitoring/" >
    SNMP Monitoring
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/Whats-New-in-Cumulus-RMP-3.0.0/" >
    What&#39;s New in Cumulus RMP 3.0.0
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/Quick-Start-Guide/" >
    Quick Start Guide
  </a>


    </li>
    
    <li >
      

  <a href="docs.cumulusnetworks.com/version/cumulus-rmp-30/Cumulus-RMP-Index/" >
    Cumulus RMP Index
  </a>


    </li>
    
  </ul>


  </li>


          
      
          
      
          
      
          
      
          
      
    
  </ul>









      </nav>

      
      
      
      

      <script src = "/docs.cumulusnetworks.com/js/menuBundle.js"> </script>


    </aside>

    <div class="book-page">

      
      <header class="align-center justify-between book-header">
        <label for="menu-control">
          <img src="/docs.cumulusnetworks.com/svg/menu.svg" alt="Menu" />
        </label>
        <strong>Spanning Tree and Rapid Spanning Tree</strong>
      </header>

      
      
<div class= "notices info" id = "info" >
    This documentation is for an older version of the software. If you are using the current version of Cumulus Linux, this content may not be up to date. The current version of the documentation is available [here](https://docs.cumulusnetworks.com/).
  </div>
<article class="markdown">
<h1>Spanning Tree and Rapid Spanning Tree</h1>

<p><details></p>

<p>Spanning tree protocol (STP) is always recommended in layer 2
topologies, as it prevents bridge loops and broadcast radiation on a
bridged network.</p>

<p><code>mstpd</code> is a daemon that implements IEEE802.1D 2004 and IEEE802.1Q 2011.
Currently, STP is disabled by default on the bridge in Cumulus RMP.</p>

<p>To enable STP, configure <code>brctl stp &lt;bridge&gt; on</code>.</p>


<div class="notices warning" > <p>The STP modes Cumulus RMP supports vary depending upon which <a href="/version/cumulus-rmp-30/Layer-1-and-Layer-2-Features/Ethernet-Bridging---VLANs/">bridge
driver
mode</a>
is in use. For a bridge configured in <em>traditional</em> mode, STP, RSTP,
PVST and PVRST are supported; with the default set to PVRST.
<em><a href="/version/cumulus-rmp-30/Layer-1-and-Layer-2-Features/Ethernet-Bridging---VLANs/VLAN-aware-Bridge-Mode-for-Large-scale-Layer-2-Environments">VLAN-aware</a></em>
bridges only operate in RSTP mode.</p>

<p>If a bridge running RSTP (802.1w) receives a common STP (802.1D) BPDU,
it will automatically fall back to 802.1D operation.</p>

<p>You can configure <code>mstpd</code> to be in common STP mode only, by setting
<code>setforcevers</code> to <em>STP</em>.</p>
 </div>


<h2 id="span-commands-span"><span>Commands</span></h2>

<ul>
<li><p>brctl</p></li>

<li><p>mstpctl</p></li>
</ul>

<p><code>mstpctl</code> is a utility to configure STP. <code>mstpd</code> is started by default
on bootup. <code>mstpd</code> logs and errors are located in <code>/var/log/daemon.log</code>.</p>

<h2 id="span-pvst-pvrst-span"><span>PVST/PVRST</span></h2>

<p>Per VLAN Spanning Tree (PVST) creates a spanning tree instance for a
bridge. Rapid PVST (PVRST) supports RSTP enhancements for each spanning
tree instance. You must create a bridge corresponding to the untagged
native/access VLAN, and all the physical switch ports must be part of
the same VLAN. When connected to a switch that has a native VLAN
configuration, the native VLAN <strong>must</strong> be configured to be VLAN 1 only.</p>

<p>Cumulus RMP supports the RSTP/PVRST/PVST modes of STP natively when the
bridge is configured in <a href="/version/cumulus-rmp-30/Layer-1-and-Layer-2-Features/Ethernet-Bridging---VLANs/">traditional
mode</a>.</p>

<h2 id="span-creating-a-bridge-and-configuring-stp-span"><span>Creating a Bridge and Configuring STP</span></h2>

<p>To create a bridge, configure the bridge stanza under
<code>/etc/network/interfaces</code>. More information on configuring bridges <a href="/version/cumulus-rmp-30/Layer-1-and-Layer-2-Features/Ethernet-Bridging---VLANs/">can
be found
here</a>.
To enable STP on the bridge, include the keyword <code>bridge-stp on</code>.</p>

<pre><code>auto br2
iface br2
    bridge-ports swp1.101 swp4.101 swp5.101
    bridge-stp on
</code></pre>

<p>To enable the bridge, run <code>ifreload -a</code>:</p>

<pre><code>cumulus@switch:~$ sudo ifreload -a
</code></pre>

<p><summary>Runtime Configuration (Advanced) </summary></p>

<p><code>You use brctl</code> to create the bridge, add bridge ports in the bridge and
configure STP on the bridge. <code>mstpctl</code> is used only when an admin needs
to change the default configuration parameters for STP:</p>

<pre><code>cumulus@switch:~$ sudo brctl addbr br2

cumulus@switch:~$ sudo brctl addif br2 swp1.101 swp4.101 swp5.101

cumulus@switch:~$ sudo brctl stp br2 on

cumulus@switch:~$ sudo ifconfig br2 up
</code></pre>

<p>To get the bridge state, use:</p>

<pre><code>cumulus@switch:~$ sudo brctl show
 bridge name     bridge id               STP enabled     interfaces
 br2             8000.001401010100       yes             swp1.101
                                                         swp4.101
                                                         swp5.101
</code></pre>

<p>To get the <code>mstpd</code> bridge state, use:</p>

<pre><code>cumulus@switch:~$ sudo mstpctl showbridge br2
 br2 CIST info
  enabled         yes
  bridge id       F.000.00:14:01:01:01:00
  designated root F.000.00:14:01:01:01:00
  regional root   F.000.00:14:01:01:01:00
  root port       none
  path cost     0          internal path cost   0
  max age       20         bridge max age       20
  forward delay 15         bridge forward delay 15
  tx hold count 6          max hops             20
  hello time    2          ageing time          200
  force protocol version     rstp
  time since topology change 90843s
  topology change count      4
  topology change            no
  topology change port       swp4.101
  last topology change port  swp5.101
</code></pre>

<p>To get the <code>mstpd</code> bridge port state, use:</p>

<pre><code>cumulus@switch:~$ sudo mstpctl showport br2
 E swp1.101 8.001 forw F.000.00:14:01:01:01:00 F.000.00:14:01:01:01:00 8.001 Desg
   swp4.101 8.002 forw F.000.00:14:01:01:01:00 F.000.00:14:01:01:01:00 8.002 Desg
 E swp5.101 8.003 forw F.000.00:14:01:01:01:00 F.000.00:14:01:01:01:00 8.003 Desg

cumulus@switch:~$ sudo mstpctl showportdetail br2 swp1.101
 br2:swp1.101 CIST info
  enabled            yes                     role                 Designated
  port id            8.001                   state                forwarding
  external port cost 2000                    admin external cost  0
  internal port cost 2000                    admin internal cost  0
  designated root    F.000.00:14:01:01:01:00 dsgn external cost   0
  dsgn regional root F.000.00:14:01:01:01:00 dsgn internal cost   0
  designated bridge  F.000.00:14:01:01:01:00 designated port      8.001
  admin edge port    no                      auto edge port       yes
  oper edge port     yes                     topology change ack  no
  point-to-point     yes                     admin point-to-point auto
  restricted role    no                      restricted TCN       no
  port hello time    2                       disputed             no
  bpdu guard port    no                      bpdu guard error     no
  network port       no                      BA inconsistent      no
  Num TX BPDU        45772                   Num TX TCN           4
  Num RX BPDU        0                       Num RX TCN           0
  Num Transition FWD 2                       Num Transition BLK   2
</code></pre>

<h2 id="span-configuring-spanning-tree-parameters-span"><span>Configuring Spanning Tree Parameters</span></h2>

<p>The persistent configuration for a bridge is set in
<code>/etc/network/interfaces</code>. The configuration below shows every possible
option configured. There is no requirement to configure any of these
options:</p>

<pre><code>auto br2
iface br2 inet static
  bridge-ports swp1 swp2 swp3
  bridge-stp on
  mstpctl-maxage 20
  mstpctl-fdelay 15
  mstpctl-maxhops 20
  mstpctl-txholdcount 6
  mstpctl-forcevers rstp
  mstpctl-treeprio 32768
  mstpctl-hello 2
  mstpctl-portpathcost swp1=0 swp2=0
  mstpctl-portadminedge swp1=no swp2=no
  mstpctl-portautoedge swp1=yes swp2=yes
  mstpctl-portp2p swp1=no swp2=no
  mstpctl-portrestrrole swp1=no swp2=no
  mstpctl-bpduguard swp1=no swp2=no
  mstpctl-portrestrtcn swp1=no swp2=no
  mstpctl-portnetwork swp1=no
  mstpctl-treeportprio swp3=128
</code></pre>

<h3 id="span-understanding-spanning-tree-parameters-span"><span>Understanding Spanning Tree Parameters</span></h3>

<p>The spanning tree parameters are defined in the IEEE
<a href="http://standards.ieee.org/getieee802/download/802.1D-2004.pdf" target="_blank">802.1D</a>,
<a href="http://standards.ieee.org/getieee802/download/802.1Q-2005.pdf" target="_blank">802.1Q</a>
specifications and in the table below.</p>

<p>While configuring spanning tree in a persistent configuration, as
described above, is the preferred method, you can also use <code>mstpctl(8)</code>
to configure spanning tree protocol parameters at runtime.</p>


<div class="notices warning" > <p>A runtime configuration is non-persistent, which means the configuration
you create here does not persist after you reboot the switch.</p>
 </div>


<p>The <code>mstp</code> daemon is an open source project that some network engineers
may be unfamiliar with. For example, many incumbent vendors use the
keyword <code>portfast</code> to describe a port that is automatically set to
forwarding when the port is brought up. The <code>mstpd</code>equivalent is
<code>mstpctl-portadminedge</code>. For more comparison <a href="https://support.cumulusnetworks.com/hc/en-us/articles/206908397" target="_blank">please read this knowledge
base
article</a>.</p>

<p>Examples are included below:</p>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th><p>Parameter</p></th>
<th><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p><strong>maxage</strong></p></td>
<td><p>Sets the bridge's <em>maximum age</em> to <code>&lt;max_age&gt;</code> seconds. The default is <em>20</em>.</p>
<p>The maximum age must meet the condition 2 * (Bridge Forward Delay - 1 second) &gt;= Bridge Max Age.</p>
<p>To set this parameter persistently, configure it under the bridge stanza:</p>
<pre><code>mstpctl-maxage 24</code></pre>
<p>To set this parameter at runtime, use:</p>
<p><code>mstpctl setmaxage &lt;bridge&gt; &lt;max_age&gt;</code></p>
<pre><code>cumulus@switch:~$ sudo mstpctl setmaxage br2 24</code></pre></td>
</tr>
<tr class="even">
<td><p><strong>ageing</strong></p></td>
<td><p>Sets the Ethernet (MAC) address <em>ageing time</em> in <code>&lt;time&gt;</code> seconds for the bridge when the running version is STP, but not RSTP/MSTP. The default is <em>300</em>.</p>
<p>To set this parameter persistently, configure it under the bridge stanza:</p>
<pre><code>mstpctl-ageing 240</code></pre>
<p>To set this parameter at runtime, use:</p>
<pre><code>mstpctl setageing &lt;bridge&gt; &lt;time&gt;</code></pre>
<pre><code>cumulus@switch:~$ sudo mstpctl setageing br2 240</code></pre></td>
</tr>
<tr class="odd">
<td><p><strong>fdelay</strong></p></td>
<td><p>Sets the bridge's <em>bridge forward delay</em> to <code>&lt;time&gt;</code> seconds. The default is <em>15</em>.</p>
<p>The bridge forward delay must meet the condition 2 * (Bridge Forward Delay - 1 second) &gt;= Bridge Max Age.</p>
<p>To set this parameter persistently, configure it under the bridge stanza:</p>
<pre><code>mstpctl-fdelay 15</code></pre>
<p>To set this parameter at runtime, use:</p>
<pre><code>mstpctl setfdelay &lt;bridge&gt; &lt;time&gt;</code></pre>
<pre><code>cumulus@switch:~$ sudo mstpctl setfdelay br2 15</code></pre></td>
</tr>
<tr class="even">
<td><p><strong>maxhops</strong></p></td>
<td><p>Sets the bridge's <em>maximum hops</em> to <code>&lt;max_hops&gt;</code>. The default is <em>20</em>.</p>
<p>To set this parameter persistently, configure it under the bridge stanza:</p>
<pre><code>mstpctl-maxhops 24</code></pre>
<p>To set this parameter at runtime, use:</p>
<pre><code>mstpctl setmaxhops &lt;bridge&gt; &lt;max_hops&gt;</code></pre>
<pre><code>cumulus@switch:~$ sudo mstpctl setmaxhops br2 24</code></pre></td>
</tr>
<tr class="odd">
<td><p><strong>txholdcount</strong></p></td>
<td><p>Sets the bridge's <em>bridge transmit hold count</em> to <code>&lt;tx_hold_count&gt;</code>. The default is <em>6</em>.</p>
<p>To set this parameter persistently, configure it under the bridge stanza:</p>
<pre><code>mstpctl-txholdcount 6</code></pre>
<p>To set this parameter at runtime, use:</p>
<p><code>mstpctl settxholdcount &lt;bridge&gt; &lt;tx_hold_count&gt;</code></p>
<pre><code>cumulus@switch:~$ sudo mstpctl settxholdcount br2 5</code></pre></td>
</tr>
<tr class="even">
<td><p><strong>forcevers</strong></p></td>
<td><p>Sets the bridge's <em>force STP version</em> to either RSTP/STP. MSTP is not supported currently. The default is <em>RSTP</em>.</p>
<p>To set this parameter persistently, configure it under the bridge stanza:</p>
<pre><code>mstpctl-forcevers rstp</code></pre>
<p>To set this parameter at runtime, use:</p>
<pre><code>mstpctl setforcevers &lt;bridge&gt; {mstp|rstp|stp}</code></pre>
<pre><code>cumulus@switch:~$ sudo mstpctl setforcevers br2 rstp</code></pre></td>
</tr>
<tr class="odd">
<td><p><strong>treeprio</strong></p></td>
<td><p>Sets the bridge's <em>tree priority</em> to <code>&lt;priority&gt;</code> for an MSTI instance. The priority value is a number between 0 and 65535 and must be a multiple of 4096. The bridge with the lowest priority is elected the <em>root bridge</em>. The default is <em>32768</em>.</p>

<div class="notices warning" > <p></p>
<p>For <code>msti</code>, only 0 is supported currently.</p>
<p></p>
 </div>

<p>To set this parameter persistently, configure it under the bridge stanza:</p>
<pre><code>mstpctl-treeprio 8192</code></pre>
<p>To set this parameter at runtime, use:</p>
<pre><code>mstpctl settreeprio &lt;bridge&gt; &lt;mstid&gt; &lt;priority&gt;</code></pre>
<pre><code>cumulus@switch:~$ sudo mstpctl settreeprio br2 0 8192</code></pre></td>
</tr>
<tr class="even">
<td><p><strong>treeportprio</strong></p></td>
<td><p>Sets the <em>priority</em> of port <code>&lt;port&gt;</code> to <code>&lt;priority&gt;</code> for the MSTI instance. The priority value is a number between 0 and 240 and must be a multiple of 16. The default is <em>128</em>.</p>

<div class="notices warning" > <p></p>
<p>For <code>msti</code>, only <em>0</em> is supported currently.</p>
<p></p>
 </div>

<p>To set this parameter persistently, configure it under the bridge stanza:</p>
<pre><code>mstpctl-treeportprio swp4.101 64</code></pre>
<p>To set this parameter at runtime, use:</p>
<pre><code>mstpctl settreeportprio &lt;bridge&gt; &lt;port&gt; &lt;mstid&gt; &lt;priority&gt;</code></pre>
<pre><code>cumulus@switch:~$ sudo mstpctl settreeportprio br2 swp4.101 0 64</code></pre></td>
</tr>
<tr class="odd">
<td><p><strong>hello</strong></p></td>
<td><p>Sets the bridge's <em>bridge hello time</em> to <code>&lt;time&gt;</code> seconds. The default is <em>2</em>.</p>
<p>To set this parameter persistently, configure it under the bridge stanza:</p>
<pre><code>mstpctl-hello 20</code></pre>
<p>To set this parameter at runtime, use:</p>
<pre><code>mstpctl sethello &lt;bridge&gt; &lt;time&gt;</code></pre>
<pre><code>cumulus@switch:~$ sudo mstpctl sethello br2 20</code></pre></td>
</tr>
<tr class="even">
<td><p><strong>portpathcost</strong></p></td>
<td><p>Sets the <em>port cost</em> of the port <code>&lt;port&gt;</code> in bridge <code>&lt;bridge&gt;</code> to <code>&lt;cost&gt;</code>. The default is <em>0</em>.</p>
<p><code>mstpd</code> supports only long mode; that is, 32 bits for the path cost.</p>
<p>To set this parameter persistently, configure it under the bridge stanza:</p>
<pre><code>mstpctl-portpathcost swp1.101=10</code></pre>
<p>To set this parameter at runtime, use:</p>
<pre><code>mstpctl setportpathcost &lt;bridge&gt; &lt;port&gt; &lt;cost&gt;</code></pre>
<pre><code>cumulus@switch:~$ sudo mstpctl setportpathcost br2 swp1.101 10</code></pre></td>
</tr>
<tr class="odd">
<td><p><strong>portadminedge</strong></p></td>
<td><p>Enables/disables the <em>initial edge state</em> of the port <code>&lt;port&gt;</code> in bridge <code>&lt;bridge&gt;</code>. The default is <em>no</em>.</p>
<p>To set this parameter persistently, configure it under the bridge stanza:</p>
<pre><code>mstpctl-portadminedge swp1.101=yes</code></pre>
<p>To set this parameter at runtime, use:</p>
<pre><code>mstpctl setportadminedge &lt;bridge&gt; &lt;port&gt; {yes|no}</code></pre>
<pre><code>cumulus@switch:~$ sudo mstpctl setportadminedge br2 swp1.101 yes</code></pre></td>
</tr>
<tr class="even">
<td><p><strong>portautoedge</strong></p></td>
<td><p>Enables/disables the <em>auto transition</em> to/from the edge state of the port <code>&lt;port&gt;</code> in bridge <code>&lt;bridge&gt;</code>. The default is <em>yes</em>.</p>
<p>To set this parameter persistently, configure it under the bridge stanza:</p>
<pre><code>mstpctl-portautoedge swp1.101=no</code></pre>
<p>To set this parameter at runtime, use:</p>
<pre><code>mstpctl setportautoedge &lt;bridge&gt; &lt;port&gt; {yes|no}</code></pre>
<pre><code>cumulus@switch:~$ sudo mstpctl setportautoedge br2 swp1.101 no</code></pre></td>
</tr>
<tr class="odd">
<td><p><strong>portp2p</strong></p></td>
<td><p>Enables/disables the <em>point-to-point detection mode</em> of the port <code>&lt;port&gt;</code> in bridge <code>&lt;bridge&gt;</code>. The default is <em>auto</em>.</p>
<p>To set this parameter persistently, configure it under the bridge stanza:</p>
<pre><code>mstpctl-portp2p swp1.101=no</code></pre>
<p>To set this parameter at runtime, use:</p>
<pre><code>mstpctl setportp2p &lt;bridge&gt; &lt;port&gt; {yes|no|auto}</code></pre>
<pre><code>cumulus@switch:~$ sudo mstpctl setportp2p br2 swp1.101 no</code></pre></td>
</tr>
<tr class="even">
<td><p><strong>portrestrrole</strong></p></td>
<td><p>Enables/disables the ability of the port <code>&lt;port&gt;</code> in bridge <code>&lt;bridge&gt;</code> to take the <em>root role</em>. The default is <em>no</em>.</p>
<p>To set this parameter persistently, configure it under the bridge stanza:</p>
<pre><code>mstpctl-portrestrrole swp1.101=no</code></pre>
<p>To set this parameter at runtime, use:</p>
<pre><code>mstpctl setportrestrrole &lt;bridge&gt; &lt;port&gt; {yes|no}</code></pre>
<pre><code>cumulus@switch:~$ sudo mstpctl setportrestrrole br2 swp1.101 yes</code></pre></td>
</tr>
<tr class="odd">
<td><p><strong>portrestrtcn</strong></p></td>
<td><p>Enables/disables the ability of the port <code>&lt;port&gt;</code> in bridge <code>&lt;bridge&gt;</code> to propagate <em>received topology change notifications</em>. The default is <em>no</em>.</p>
<p>To set this parameter persistently, configure it under the bridge stanza:</p>
<pre><code>mstpctl-portrestrtcn swp1.101=yes</code></pre>
<p>To set this parameter at runtime, use:</p>
<pre><code>mstpctl setportrestrtcn &lt;bridge&gt; &lt;port&gt; {yes|no}</code></pre>
<pre><code>cumulus@switch:~$ sudo mstpctl setportrestrtcn br2 swp1.101 yes</code></pre></td>
</tr>
<tr class="even">
<td><p><strong>portnetwork</strong></p></td>
<td><p>Enables/disables the <em>bridge assurance capability</em> for a network port <code>&lt;port&gt;</code> in bridge <code>&lt;bridge&gt;</code>. The default is <em>no</em>.</p>
<p>To set this parameter persistently, configure it under the bridge stanza:</p>
<pre><code>mstpctl-portnetwork swp4.101=yes</code></pre>
<p>To set this parameter at runtime, use:</p>
<pre><code>mstpctl setportnetwork &lt;bridge&gt; &lt;port&gt; {yes|no}</code></pre>
<pre><code>cumulus@switch:~$ sudo mstpctl setportnetwork br2 swp4.101 yes</code></pre></td>
</tr>
<tr class="odd">
<td><p><strong>bpduguard</strong></p></td>
<td><p>Enables/disables the <em>BPDU guard configuration</em> of the port <code>&lt;port&gt;</code> in bridge <code>&lt;bridge&gt;</code>. The default is <em>no</em>.</p>
<p>To set this parameter persistently, configure it under the bridge stanza:</p>
<pre><code>mstpctl-bpduguard swp1=no</code></pre>
<p>To set this parameter at runtime, use:</p>
<pre><code>mstpctl setbpduguard &lt;bridge&gt; &lt;port&gt; {yes|no}</code></pre>
<pre><code>cumulus@switch:~$ sudo mstpctl setbpduguard br2 swp1.101 yes</code></pre></td>
</tr>
<tr class="even">
<td><p><strong>portbpdufilter</strong></p></td>
<td><p>Enables/disables the <em>BPDU filter</em> functionality for a port <code>&lt;port&gt;</code> in bridge <code>&lt;bridge&gt;</code>. The default is <em>no</em>.</p>
<p>To set this parameter persistently, configure it under the bridge stanza:</p>
<pre><code>mstpctl-bpdufilter swp4.101=yes</code></pre>
<p>To set this parameter at runtime, use:</p>
<pre><code>mstpctl setportbpdufilter &lt;bridge&gt; &lt;port&gt; {yes|no}</code></pre>
<pre><code>cumulus@switch:~$ sudo mstpctl setportbpdufilter br2 swp4.101 yes</code></pre></td>
</tr>
</tbody>
</table>

<h2 id="span-bridge-assurance-span"><span>Bridge Assurance</span></h2>

<p>On a point-to-point link where RSTP is running, if you want to detect
unidirectional links and put the port in a discarding state (in error),
you can enable bridge assurance on the port by enabling port type
network. The port would be in a bridge assurance inconsistent state
until a BPDU is received from the peer. You need to configure the port
type network on both the ends of the link:</p>

<pre><code>cumulus@switch:~$ sudo mstpctl setportnetwork br1007 swp1.1007 yes

cumulus@switch:~$ sudo mstpctl showportdetail br1007 swp1.1007 | grep network
  network port       yes                     BA inconsistent      yes

cumulus@switch:~$ sudo grep -in assurance /var/log/daemon.log | grep mstp
 1365:Jun 25 18:03:17 mstpd: br1007:swp1.1007 Bridge assurance inconsistent
</code></pre>

<h2 id="span-id-src-5118731-spanningtreeandrapidspanningtree-bpdu-class-confluence-anchor-link-span-span-bpdu-guard-span"><span id="src-5118731_SpanningTreeandRapidSpanningTree-bpdu" class="confluence-anchor-link"></span><span>BPDU Guard</span></h2>

<p>To protect the spanning tree topology from unauthorized switches
affecting the forwarding path, you can configure <em>BPDU guard</em> (Bridge
Protocol Data Unit). One very common example is when someone hooks up a
new switch to an access port off of a leaf switch. If this new switch is
configured with a low priority, it could become the new root switch and
affect the forwarding path for the entire Layer 2 topology.</p>

<h3 id="span-configuring-bpdu-guard-span"><span>Configuring BPDU Guard</span></h3>

<p>You configure BPDU guard under the bridge stanza in
<code>/etc/network/interfaces</code>:</p>

<pre><code>auto br2
iface br2 inet static
  bridge-ports swp1 swp2 swp3 swp4 swp5 swp6
  bridge-stp on
  mstpctl-bpduguard swp1=yes swp2=yes swp3=yes swp4=yes
</code></pre>

<p>To load the new configuration, run <code>ifreload -a</code>:</p>

<pre><code>cumulus@switch:~$ sudo ifreload -a
</code></pre>

<h4 id="span-non-persistent-configuration-span"><span>Non-Persistent Configuration</span></h4>

<p>You can also configure BPDU guard on an individual port using a runtime
configuration.</p>

<p><summary>Runtime Configuration (Advanced) </summary></p>


<div class="notices warning" > <p>A runtime configuration is non-persistent, which means the configuration
you create here does not persist after you reboot the switch.</p>
 </div>


<pre><code>cumulus@switch:~$ sudo mstpctl setbpduguard br2 swp1 yes
cumulus@switch:~$ sudo mstpctl setbpduguard br2 swp2 yes
cumulus@switch:~$ sudo mstpctl setbpduguard br2 swp3 yes
cumulus@switch:~$ sudo mstpctl setbpduguard br2 swp4 yes
</code></pre>

<h3 id="span-recovering-a-port-disabled-by-bpdu-guard-span"><span>Recovering a Port Disabled by BPDU Guard</span></h3>

<p>If a BPDU is received on the port, STP will bring down the port and log
an error in <code>/var/log/syslog</code>. The following is a sample error:</p>

<pre><code>mstpd: error, MSTP_IN_rx_bpdu: bridge:bond0 Recvd BPDU on BPDU Guard Port - Port Down
</code></pre>

<p>To determine whether BPDU guard is configured, or if a BPDU has been
received, run <code>mstpctl showportdetail &lt;bridge name&gt;</code>:</p>

<pre><code>cumulus@switch:~$ sudo mstpctl showportdetail br2 swp1 | grep guard
 bpdu guard port    yes                     bpdu guard error     yes
</code></pre>

<p>The only way to recover a port that has been placed in the disabled
state is to manually un-shut or bring up the port with <code>sudo ifup
</code><code>[port]</code>, as shown in the example below:</p>


<div class="notices note" > <p>Bringing up the disabled port does not fix the problem if the
configuration on the connected end-station has not been rectified.</p>
 </div>


<pre><code>cumulus@leaf2$ mstpctl showportdetail bridge bond0
bridge:bond0 CIST info
  enabled            no                      role                 Disabled
  port id            8.001                   state                discarding
  external port cost 305                     admin external cost  0
  internal port cost 305                     admin internal cost  0
  designated root    8.000.6C:64:1A:00:4F:9C dsgn external cost   0
  dsgn regional root 8.000.6C:64:1A:00:4F:9C dsgn internal cost   0
  designated bridge  8.000.6C:64:1A:00:4F:9C designated port      8.001
  admin edge port    no                      auto edge port       yes
  oper edge port     no                      topology change ack  no
  point-to-point     yes                     admin point-to-point auto
  restricted role    no                      restricted TCN       no
  port hello time    10                      disputed             no
  bpdu guard port    yes                      bpdu guard error     yes
  network port       no                      BA inconsistent      no
  Num TX BPDU        3                       Num TX TCN           2
  Num RX BPDU        488                     Num RX TCN           2
  Num Transition FWD 1                       Num Transition BLK   2
  bpdufilter port    no                     
  clag ISL           no                      clag ISL Oper UP     no
  clag role          unknown                 clag dual conn mac   0:0:0:0:0:0
  clag remote portID F.FFF                   clag system mac      0:0:0:0:0:0


cumulus@leaf2$ sudo ifup bond0


cumulus@leaf2$ mstpctl showportdetail bridge bond0
bridge:bond0 CIST info
  enabled            yes                     role                 Root
  port id            8.001                   state                forwarding
  external port cost 305                     admin external cost  0
  internal port cost 305                     admin internal cost  0
  designated root    8.000.6C:64:1A:00:4F:9C dsgn external cost   0
  dsgn regional root 8.000.6C:64:1A:00:4F:9C dsgn internal cost   0
  designated bridge  8.000.6C:64:1A:00:4F:9C designated port      8.001
  admin edge port    no                      auto edge port       yes
  oper edge port     no                      topology change ack  no
  point-to-point     yes                     admin point-to-point auto
  restricted role    no                      restricted TCN       no
  port hello time    2                       disputed             no
  bpdu guard port    no                      bpdu guard error     no
  network port       no                      BA inconsistent      no
  Num TX BPDU        3                       Num TX TCN           2
  Num RX BPDU        43                      Num RX TCN           1
  Num Transition FWD 1                       Num Transition BLK   0
  bpdufilter port    no                     
  clag ISL           no                      clag ISL Oper UP     no
  clag role          unknown                 clag dual conn mac   0:0:0:0:0:0
  clag remote portID F.FFF                   clag system mac      0:0:0:0:0:0
</code></pre>

<h2 id="span-bpdu-filter-span"><span>BPDU Filter</span></h2>

<p>You can enable <code>bpdufilter</code> on a switch port, which filters BPDUs in
both directions. This effectively disables STP on the port.</p>

<p>To enable it, add the following to <code>/etc/network/interfaces</code> under the
<code>bridge port iface</code> section example:</p>

<pre><code>auto br100
iface br100
     bridge-ports swp1.100 swp2.100
     mstpctl-portbpdufilter swp1=yes swp2=yes
</code></pre>

<p>To load the new configuration from <code>/etc/network/interfaces</code>, run
<code>ifreload -a</code>:</p>

<pre><code>cumulus@switch:~$ sudo ifreload -a
</code></pre>

<p>For more information, see <code>man(5) ifupdown-addons-interfaces</code>.</p>

<p><summary>Runtime Configuration (Advanced) </summary></p>


<div class="notices warning" > <p>A runtime configuration is non-persistent, which means the configuration
you create here does not persist after you reboot the switch.</p>
 </div>


<p>To enable BPDU filter at runtime, run <code>mstpctl</code>:</p>

<pre><code>cumulus@switch:~$ sudo mstpctl setportbpdufilter br100 swp1.100=yes swp2.100=yes
</code></pre>

<h2 id="span-storm-control-span"><span>Storm Control</span></h2>

<p><em>Storm control</em> provides protection against excessive inbound BUM
(broadcast, unknown unicast, multicast) traffic on layer 2 switch port
interfaces, which can cause poor network performance.</p>

<p>You configure storm control in <code>/etc/cumulus/switchd.conf</code>. The
configuration persists across reboots and restarting <code>switchd</code>. If you
change the storm control configuration in this file after rebooting the
switch, you must <a href="/display/RMP30/Configuring+switchd#Configuringswitchd-restartswitchd">restart
<code>switchd</code></a>
to activate the new configuration.</p>

<p>You configure storm control for each physical port. For example, to
enable broadcast and multicast storm control at 400 packets per second
(pps) and 3000 pps, respectively, for swp1, edit
<code>/etc/cumulus/switchd.conf</code> and configure it as follows:</p>

<pre><code># Storm Control setting on a port, in pps, 0 means disable
interface.swp1.storm_control.broadcast = 400
interface.swp1.storm_control.multicast = 3000
</code></pre>

<h2 id="span-configuration-files-span"><span>Configuration Files</span></h2>

<ul>
<li>/etc/network/interfaces</li>
</ul>

<h2 id="span-man-pages-span"><span>Man Pages</span></h2>

<ul>
<li><p>brctl(8)</p></li>

<li><p>bridge-utils-interfaces(5)</p></li>

<li><p>ifupdown-addons-interfaces(5)</p></li>

<li><p>mstpctl(8)</p></li>

<li><p>mstpctl-utils-interfaces(5)</p></li>
</ul>

<h2 id="span-useful-links-span"><span>Useful Links</span></h2>

<p>The source code for <code>mstpd/mstpctl</code>was written by <a href="mailto:vitas%40nppfactor.kiev.ua" target="_blank">Vitalii
Demianets</a> and is hosted at the
sourceforge URL below.</p>

<ul>
<li><p><a href="https://sourceforge.net/projects/mstpd/" target="_blank">https://sourceforge.net/projects/mstpd/</a></p></li>

<li><p><a href="http://en.wikipedia.org/wiki/Spanning_Tree_Protocol" target="_blank">http://en.wikipedia.org/wiki/Spanning_Tree_Protocol</a></p></li>
</ul>

<h2 id="span-caveats-and-errata-span"><span>Caveats and Errata</span></h2>

<ul>
<li>MSTP is not supported currently. However, interoperability with MSTP
networks can be accomplished using PVRSTP or PVSTP.</li>
</ul>

<article id="html-search-results" class="ht-content" style="display: none;">

</article>

<footer id="ht-footer">

</footer>

<p></details></p>
</article>

      <script src="https://utteranc.es/client.js"
        repo="CumulusNetworks/docs-internal"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
      </script>

    </div>
    

      


  

    <aside class="book-toc fixed">

  
    <div class="toc">
    
      <button>
      <a href="https://github.com/CumulusNetworks/docs/edit/master/content/version/cumulus-rmp-30/Layer-1-and-Layer-2-Features/Spanning-Tree-and-Rapid-Spanning-Tree.md" target="_blank" rel="noopener"><img src="/docs.cumulusnetworks.com/svg/pencil-circle.svg" alt="Edit" /> Edit this page</a>
      </button>
    
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#span-commands-span"><span>Commands</span></a></li>
<li><a href="#span-pvst-pvrst-span"><span>PVST/PVRST</span></a></li>
<li><a href="#span-creating-a-bridge-and-configuring-stp-span"><span>Creating a Bridge and Configuring STP</span></a></li>
<li><a href="#span-configuring-spanning-tree-parameters-span"><span>Configuring Spanning Tree Parameters</span></a>
<ul>
<li><a href="#span-understanding-spanning-tree-parameters-span"><span>Understanding Spanning Tree Parameters</span></a></li>
</ul></li>
<li><a href="#span-bridge-assurance-span"><span>Bridge Assurance</span></a></li>
<li><a href="#span-id-src-5118731-spanningtreeandrapidspanningtree-bpdu-class-confluence-anchor-link-span-span-bpdu-guard-span"><span id="src-5118731_SpanningTreeandRapidSpanningTree-bpdu" class="confluence-anchor-link"></span><span>BPDU Guard</span></a>
<ul>
<li><a href="#span-configuring-bpdu-guard-span"><span>Configuring BPDU Guard</span></a>
<ul>
<li><a href="#span-non-persistent-configuration-span"><span>Non-Persistent Configuration</span></a></li>
</ul></li>
<li><a href="#span-recovering-a-port-disabled-by-bpdu-guard-span"><span>Recovering a Port Disabled by BPDU Guard</span></a></li>
</ul></li>
<li><a href="#span-bpdu-filter-span"><span>BPDU Filter</span></a></li>
<li><a href="#span-storm-control-span"><span>Storm Control</span></a></li>
<li><a href="#span-configuration-files-span"><span>Configuration Files</span></a></li>
<li><a href="#span-man-pages-span"><span>Man Pages</span></a></li>
<li><a href="#span-useful-links-span"><span>Useful Links</span></a></li>
<li><a href="#span-caveats-and-errata-span"><span>Caveats and Errata</span></a></li>
</ul></li>
</ul>
</nav>
    </div>
  

</aside>






  </main>
  <footer class="footer-top">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <div class="footer-content">
            <div class="mb-4">
                <img src="https://static.cumulusnetworks.com/static/images/shared/cumulus-networks-rt-white-trademarked.ff839f1b2570.svg">
                <p> <script type="text/javascript">document.write(new Date().getFullYear());</script> Cumulus Networks.<br>
                Site by <a href="//unomena.com/" target="_blank">Unomena</a>.</p>
            </div>
            <ul class="mb-4">
              <li><h4>Products</h4></li>
              <li><a href="//cumulusnetworks.com/products/cumulus-linux/">Cumulus Linux</a></li>
              <li><a href="//cumulusnetworks.com/products/netq/">Cumulus NetQ</a></li>
              <li><a href="//cumulusnetworks.com/products/cumulus-express/">Cumulus Express</a></li>
            </ul>
            <ul class="mb-4">
              <li><h4>Learn</h4></li>
              <li><a href="//cumulusnetworks.com/learn/web-scale-networking-education/">Going web-scale</a></li>
              <li><a href="//cumulusnetworks.com/learn/events/">Events</a></li>
              <li><a href="//cumulusnetworks.com/blog/">Blog</a></li>
            </ul>
            <ul class="mb-4">
              <li><h4>About</h4></li>
              <li><a href="//cumulusnetworks.com/about/">Our story</a></li>
              <li><a href="//cumulusnetworks.com/about/careers/">Careers</a></li>
              <li><a href="//cumulusnetworks.com/about/media-coverage/">Media coverage</a></li>
              <li><a href="//docs.cumulusnetworks.com/" target="_blank">Tech docs</a></li>
              <li><a href="//cumulusnetworks.com/community/">Community</a></li>
            </ul>
            <ul>
              <li>
                <a href="//twitter.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M23 6.628l-2-.5 1-2-2.464.7A4.48 4.48 0 0 0 12 8.128v1c-3.539.73-6.634-1.2-9.5-4.5q-.75 4 1.5 6l-3-.5c.405 2.069 1.362 3.7 4 4l-2.5 1c1 2 2.566 2.31 5 2.5a10.748 10.748 0 0 1-6.5 2c12.755 5.669 20-2.664 20-10V8.3z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//www.facebook.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                      .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M17.768 7.5H13.5V5.6a.972.972 0 0 1 1.012-1.1c.418 0 2.988.01 2.988.01V.5h-4.329C9.244.5 8.5 3.474 8.5 5.355V7.5h-3v4h3v12h5v-12h3.851z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//linkedin.com/company/cumulus-networks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                      .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M6.5 22.5h-5v-13h5zm9-9a2 2 0 0 0-2 2v7h-5v-13h5v1.485a6.307 6.307 0 0 1 3.99-1.495c2.962 0 5.01 2.2 5.01 6.355V22.5h-5v-7a2 2 0 0 0-2-2zM6.5 5A2.5 2.5 0 1 1 4 2.5 2.5 2.5 0 0 1 6.5 5z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//vimeo.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M.5 7.393l.933 1.224S3.36 7.1 4 7.859s3.1 9.925 3.915 11.617c.714 1.483 2.684 3.444 4.845 2.042s9.34-7.529 10.626-14.769-8.642-5.723-9.693.583c2.627-1.577 4.03.642 2.686 3.154s-2.569 4.145-3.211 4.145-1.135-1.679-1.868-4.613c-.76-3.035-.755-8.5-3.911-7.882C4.412 2.721.5 7.393.5 7.393z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//www.github.com/cumulusnetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                        <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                        </style>
                    </defs>
                    <path class="a" d="M19.459 17c0-5.969-4.126-3.532-7.5-3.532s-7.5-2.375-7.5 3.532a3.5 3.5 0 0 0 3.5 3.5h8a3.5 3.5 0 0 0 3.5-3.5z"></path>
                    <path class="a" d="M21.489 10.214l.032.023s2.646-4.572-.6-7.237c-2 0-5.058 3.3-5.058 3.3l.022.016A14.152 14.152 0 0 0 8.1 6.3C8.083 6.285 5.037 3 3.042 3c-3.173 2.6-.729 7.012-.614 7.217a8.876 8.876 0 0 0-1.395 5.743c.241 3.126 2.847 6.54 5.982 6.54H16.9c3.135 0 5.742-3.414 5.982-6.54a8.857 8.857 0 0 0-1.393-5.746z"></path>
                    <ellipse class="a" cx="15.48" cy="17" rx="1" ry="1.5"></ellipse>
                    <ellipse class="a" cx="8.48" cy="17" rx="1" ry="1.5"></ellipse>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//slack.cumulusnetworks.com/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                        <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                        </style>
                    </defs>
                    <rect class="a" x=".5" y=".5" width="23" height="23" rx="6" ry="6"></rect>
                    <circle class="a" cx="12" cy="12" r="6"></circle>
                    <circle class="a" cx="19" cy="5" r="1.5"></circle>
                  </svg>
                </a>
              </li>
              <li>
                <p>Cumulus Networks<sup></sup>  Data center networking software for the open, modern data center.</p>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </footer>
  <div class="footer-bottom">
      <div class="container">
          <div class="row">
              <div class="col-12">
                  <ul>
                      <li><a href="//cumulusnetworks.com/legal/trademarks/">Trademarks</a></li>
                      <li><a href="//cumulusnetworks.com/legal/privacy/">Privacy</a></li>
                      <li><a href="//cumulusnetworks.com/legal/">Terms of service</a></li>
                  </ul>
              </div>
          </div>
      </div>
  </div>

  
  

</body>

</html>
