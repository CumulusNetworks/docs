<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>VLAN-aware Bridge Mode for Large-scale Layer 2 Environments | Cumulus Networks Documentation</title>

  
  <link href="https://fonts.googleapis.com/css?family=Oxygen|Oxygen+Mono:300,400,700" rel="stylesheet">

  
  
  
  <link rel="stylesheet" href="/book.min.a4ec20f62c4bbaad99f9db40524ec8653f6279bcde229add21ff46dfd05dfa96.css">

  
  <link rel="icon" href="/favicon.png" type="image/x-icon">

  
  <!--
  Made with Book Theme
  https://github.com/alex-shpak/hugo-book
  -->

</head>


<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  
  <header id="site-nav">
    <div class="header-wrapper flex">
      <a href="/">
        <img src="/header-logo.png" alt="Cumulus Networks">
        <img src="/cumulus-networks-rt-white.svg" alt="Cumulus Networks" class="header-mobile">
        <span>Docs</span>
      </a>
      <ul class="flex">
        <li><a href="//cumulusnetworks.com">HOME</a></li>
        <li><a href="//support.cumulusnetworks.com/">SUPPORT</a></li>
        <li><a href="//docs.cumulusnetworks.com/">DOCS</a></li>
        <li><a href="//education.cumulusnetworks.com">EDUCATION</a></li>
        <li><a href="//cumulusnetworks.com/blog/">BLOG</a></li>
        <li><a href="//forums.cumulusnetworks.com/">FORUMS</a></li>
      </ul>
      <div class="burger-menu">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </header>
  <div id="product-nav" class="flex">
    <ul>
      <li class="active"><a href="/Cumulus_Linux/">Cumulus Linux</a></li>
      <li><a href="/Cumulus_NetQ/">Cumulus NetQ</a></li>
      <li><a href="/Chassis/">Cumulus Express</a></li>
      <li><a href="">Cumulus VX</a></li>
    </ul>
    <div class="search-container">
      <div id="doc-search-box">
        <input type="text" class="doc-search-input" placeholder="Search" value="">
        <span><button type="submit"><img src="/icons/search_20x20.svg" alt=""></button></span>
      </div>
      <div id="dropdown" class="dropdown">
          <button class="btn" type="button" id="dropdownMenuButton">
            v3.76
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            <a class="dropdown-item" href="#">v3.5</a>
            <a class="dropdown-item" href="#">v2.1</a>
            <a class="dropdown-item" href="#">v1.43</a>
          </div>
      </div>
    </div>
  </div>
  <main class="flex container">
    <aside class="book-menu fixed">

      <nav role="navigation">
        <h2 class="book-brand">
          <a href="http://example.org/">Cumulus Networks Documentation</a>
        </h2>
        
        




  <ul id = "top" class = "cn-book-section-container">
  
    

  <li class="cn-book-section">
      

  <a href="/version2/" >
    Version2s
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/" >
    Cumulus Linux User Guide
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Installation_Management/" >
    Installation Management
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Installation_Management/Managing_Cumulus_Linux_Disk_Images/" >
    Managing Cumulus Linux Disk Images
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Installation_Management/Installing_a_New_Cumulus_Linux_Image/" >
    Installing a New Cumulus Linux Image
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Installation_Management/Upgrading_Cumulus_Linux/" >
    Upgrading Cumulus Linux
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Installation_Management/Using_Snapshots/" >
    Using Snapshots
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Installation_Management/Adding_and_Updating_Packages/" >
    Adding and Updating Packages
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Installation_Management/Zero_Touch_Provisioning_-_ZTP/" >
    Zero Touch Provisioning - ZTP
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/System_Configuration/" >
    System Configuration
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/System_Configuration/Network_Command_Line_Utility_-_NCLU/" >
    Network Command Line Utility - NCLU
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/System_Configuration/Network_Command_Line_Utility_-_NCLU/Network_Command_Line_Utility/" >
    Network Command Line Utility
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/System_Configuration/Authentication_Authorization_and_Accounting/" >
    Authentication, Authorization and Accounting
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/System_Configuration/Authentication_Authorization_and_Accounting/SSH_for_Remote_Access/" >
    SSH for Remote Access
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/System_Configuration/Authentication_Authorization_and_Accounting/User_Accounts/" >
    User Accounts
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/System_Configuration/Authentication_Authorization_and_Accounting/Using_sudo_to_Delegate_Privileges/" >
    Using sudo to Delegate Privileges
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/System_Configuration/Authentication_Authorization_and_Accounting/LDAP_Authentication_and_Authorization/" >
    LDAP Authentication and Authorization
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/System_Configuration/Authentication_Authorization_and_Accounting/TACACS_Plus/" >
    TACACS Plus
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/System_Configuration/Authentication_Authorization_and_Accounting/RADIUS_AAA/" >
    RADIUS AAA
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/System_Configuration/Netfilter_-_ACLs/" >
    Netfilter - ACLs
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/System_Configuration/Netfilter_-_ACLs/Default_Cumulus_Linux_ACL_Configuration/" >
    Default Cumulus Linux ACL Configuration
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/System_Configuration/Netfilter_-_ACLs/Filtering_Learned_MAC_Addresses/" >
    Filtering Learned MAC Addresses
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/System_Configuration/Setting_Date_and_Time/" >
    Setting Date and Time
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/System_Configuration/Managing_Application_Daemons/" >
    Managing Application Daemons
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/System_Configuration/Configuring_switchd/" >
    Configuring switchd
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/System_Configuration/Power_over_Ethernet_-_PoE/" >
    Power over Ethernet - PoE
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/System_Configuration/Configuring_a_Global_Proxy/" >
    Configuring a Global Proxy
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/System_Configuration/HTTP_API/" >
    HTTP API
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Interface_Configuration_and_Management/" >
    Interface Configuration and Management
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Interface_Configuration_and_Management/Buffer_and_Queue_Management/" >
    Buffer and Queue Management
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Interface_Configuration_and_Management/Buffer_and_Queue_Management/Configuring_Hardware-enabled_DDOS_Protection/" >
    Configuring Hardware-enabled DDOS Protection
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Interface_Configuration_and_Management/Layer_1_and_Switch_Port_Attributes/" >
    Layer 1 and Switch Port Attributes
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Interface_Configuration_and_Management/Configuring_DHCP_Relays/" >
    Configuring DHCP Relays
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Interface_Configuration_and_Management/Configuring_DHCP_Servers/" >
    Configuring DHCP Servers
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Interface_Configuration_and_Management/802.1X_Interfaces/" >
    802.1X Interfaces
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Layer_1_and_2/" >
    Layer 1 and 2
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Layer_1_and_2/Link_Layer_Discovery_Protocol/" >
    Link Layer Discovery Protocol
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_1_and_2/Link_Layer_Discovery_Protocol/Voice_VLAN/" >
    Voice VLAN
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Layer_1_and_2/Ethernet_Bridging_-_VLANs/" >
    Ethernet Bridging - VLANs
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_1_and_2/Ethernet_Bridging_-_VLANs/VLAN-aware_Bridge_Mode_for_Large-scale_Layer_2_Environments/"  class="active" >
    VLAN-aware Bridge Mode for Large-scale Layer 2 Environments
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_1_and_2/Ethernet_Bridging_-_VLANs/Traditional_Mode_Bridges/" >
    Traditional Mode Bridges
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_1_and_2/Ethernet_Bridging_-_VLANs/VLAN_Tagging/" >
    VLAN Tagging
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Layer_1_and_2/Virtual_Router_Redundancy_-_VRR/" >
    Virtual Router Redundancy - VRR
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_1_and_2/Virtual_Router_Redundancy_-_VRR/ifplugd/" >
    ifplugd
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_1_and_2/Spanning_Tree_and_Rapid_Spanning_Tree/" >
    Spanning Tree and Rapid Spanning Tree
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_1_and_2/Prescriptive_Topology_Manager_-_PTM/" >
    Prescriptive Topology Manager - PTM
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_1_and_2/Bonding_-_Link_Aggregation/" >
    Bonding - Link Aggregation
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_1_and_2/Multi-Chassis_Link_Aggregation_-_MLAG/" >
    Multi-Chassis Link Aggregation - MLAG
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_1_and_2/LACP_Bypass/" >
    LACP Bypass
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_1_and_2/IGMP_and_MLD_Snooping/" >
    IGMP and MLD Snooping
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Network_Virtualization/" >
    Network Virtualization
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Network_Virtualization/Static_VXLAN_Configurations/" >
    Static VXLAN Configurations
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Network_Virtualization/Static_VXLAN_Configurations/Static_VXLAN_Tunnels/" >
    Static VXLAN Tunnels
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Network_Virtualization/Static_VXLAN_Configurations/Static_MAC_Bindings_with_VXLAN/" >
    Static MAC Bindings with VXLAN
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Network_Virtualization/Lightweight_Network_Virtualization_-_LNV_Overview/" >
    Lightweight Network Virtualization - LNV Overview
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Network_Virtualization/Lightweight_Network_Virtualization_-_LNV_Overview/LNV_VXLAN_Active-Active_Mode/" >
    LNV VXLAN Active-Active Mode
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Network_Virtualization/Lightweight_Network_Virtualization_-_LNV_Overview/LNV_Full_Example/" >
    LNV Full Example
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Network_Virtualization/Virtualization_Integrations/" >
    Virtualization Integrations
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Network_Virtualization/Virtualization_Integrations/Integrating_Hardware_VTEPs_with_Midokura_MidoNet_and_OpenStack/" >
    Integrating Hardware VTEPs with Midokura MidoNet and OpenStack
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Network_Virtualization/Virtualization_Integrations/Integrating_Hardware_VTEPs_with_VMware_NSX-V/" >
    Integrating Hardware VTEPs with VMware NSX-V
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Network_Virtualization/Virtualization_Integrations/Integrating_Hardware_VTEPs_with_VMware_NSX/" >
    Integrating Hardware VTEPs with VMware NSX
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Network_Virtualization/Ethernet_Virtual_Private_Network_-_EVPN/" >
    Ethernet Virtual Private Network - EVPN
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Network_Virtualization/VXLAN_Routing/" >
    VXLAN Routing
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Network_Virtualization/VXLAN_Scale/" >
    VXLAN Scale
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Network_Virtualization/Hybrid_Cloud_Connectivity_with_QinQ_and_VXLANs/" >
    Hybrid Cloud Connectivity with QinQ and VXLANs
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Layer_3/" >
    Layer 3
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Layer_3/FRRouting_Overview/" >
    FRRouting Overview
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_3/FRRouting_Overview/Upgrading_from_Quagga_to_FRRouting/" >
    Upgrading from Quagga to FRRouting
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Layer_3/Configuring_FRRouting/" >
    Configuring FRRouting
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_3/Configuring_FRRouting/Comparing_NCLU_and_vtysh_Commands/" >
    Comparing NCLU and vtysh Commands
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_3/Routing/" >
    Routing
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_3/Introduction_to_Routing_Protocols/" >
    Introduction to Routing Protocols
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_3/Network_Topology/" >
    Network Topology
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_3/Open_Shortest_Path_First_-_OSPF_-_Protocol/" >
    Open Shortest Path First - OSPF - Protocol
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_3/Open_Shortest_Path_First_v3_-_OSPFv3_-_Protocol/" >
    Open Shortest Path First v3 - OSPFv3 - Protocol
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_3/Border_Gateway_Protocol_-_BGP/" >
    Border Gateway Protocol - BGP
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_3/Bidirectional_Forwarding_Detection_-_BFD/" >
    Bidirectional Forwarding Detection - BFD
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_3/Equal_Cost_Multipath_Load_Sharing_-_Hardware_ECMP/" >
    Equal Cost Multipath Load Sharing - Hardware ECMP
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_3/Redistribute_Neighbor/" >
    Redistribute Neighbor
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_3/Virtual_Routing_and_Forwarding_-_VRF/" >
    Virtual Routing and Forwarding - VRF
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_3/Management_VRF/" >
    Management VRF
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_3/Protocol_Independent_Multicast_-_PIM/" >
    Protocol Independent Multicast - PIM
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_3/Segment_Routing/" >
    Segment Routing
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/" >
    Monitoring and Troubleshooting
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/Monitoring_System_Hardware/" >
    Monitoring System Hardware
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/Monitoring_System_Hardware/Network_Switch_Port_LED_and_Status_LED_Guidelines/" >
    Network Switch Port LED and Status LED Guidelines
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/Understanding_the_cl-support_Output_File/" >
    Understanding the cl-support Output File
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/Understanding_the_cl-support_Output_File/Troubleshooting_Log_Files/" >
    Troubleshooting Log Files
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/Understanding_the_cl-support_Output_File/Troubleshooting_the_etc_Directory/" >
    Troubleshooting the etc Directory
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/Troubleshooting_Network_Interfaces/" >
    Troubleshooting Network Interfaces
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/Troubleshooting_Network_Interfaces/Monitoring_Interfaces_and_Transceivers_Using_ethtool/" >
    Monitoring Interfaces and Transceivers Using ethtool
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/Network_Troubleshooting/" >
    Network Troubleshooting
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/Network_Troubleshooting/Using_NCLU_to_Troubleshoot_Your_Network_Configuration/" >
    Using NCLU to Troubleshoot Your Network Configuration
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/Network_Troubleshooting/Monitoring_System_Statistics_and_Network_Traffic_with_sFlow/" >
    Monitoring System Statistics and Network Traffic with sFlow
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/SNMP_Monitoring/" >
    SNMP Monitoring
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/SNMP_Monitoring/Using_Nutanix_Prism_as_a_Monitoring_Tool/" >
    Using Nutanix Prism as a Monitoring Tool
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/Single_User_Mode_-_Boot_Recovery/" >
    Single User Mode - Boot Recovery
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/Resource_Diagnostics_Using_cl-resource-query/" >
    Resource Diagnostics Using cl-resource-query
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/Monitoring_Virtual_Device_Counters/" >
    Monitoring Virtual Device Counters
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/Buffer_Monitoring/" >
    Buffer Monitoring
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/Monitoring_Best_Practices/" >
    Monitoring Best Practices
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Network_Solutions/" >
    Network Solutions
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Network_Solutions/Data_Center_Host_to_ToR_Architecture/" >
    Data Center Host to ToR Architecture
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Network_Solutions/Cumulus_Networks_Services_Demos/" >
    Cumulus Networks Services Demos
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Network_Solutions/Docker_on_Cumulus_Linux/" >
    Docker on Cumulus Linux
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Network_Solutions/OpenStack_Neutron_ML2_and_Cumulus_Linux/" >
    OpenStack Neutron ML2 and Cumulus Linux
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Network_Solutions/Anycast_Design_Guide/" >
    Anycast Design Guide
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Network_Solutions/RDMA_over_Converged_Ethernet_-_RoCE/" >
    RDMA over Converged Ethernet - RoCE
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Quick_Start_Guide/" >
    Quick Start Guide
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Cumulus_Linux_Index/" >
    Cumulus Linux Index
  </a>


    </li>
    
  </ul>


  </li>


    
    
  </ul>


  </li>


  
  </ul>









      </nav>

      
      
      
      

      <script src = "http://example.org/js/menuBundle.js"> </script>

    </aside>

    <div class="book-page">

      
      <header class="align-center justify-between book-header">
        <label for="menu-control">
          <img src="/svg/menu.svg" alt="Menu" />
        </label>
        <strong>VLAN-aware Bridge Mode for Large-scale Layer 2 Environments</strong>
      </header>

      
      
<article class="markdown">
<h1>VLAN-aware Bridge Mode for Large-scale Layer 2 Environments</h1>

<p>The Cumulus Linux bridge driver supports two configuration modes, one
that is VLAN-aware, and one that follows a more traditional Linux bridge
model.</p>

<p>For <a href="/version2/cumulus-linux-35/Layer_1_and_2/Ethernet_Bridging_-_VLANs/Traditional_Mode_Bridges">traditional Linux
bridges</a>,
the kernel supports VLANs in the form of VLAN subinterfaces. Enabling
bridging on multiple VLANs means configuring a bridge for each VLAN and,
for each member port on a bridge, creating one or more VLAN
subinterfaces out of that port. This mode poses scalability challenges
in terms of configuration size as well as boot time and run time state
management, when the number of ports times the number of VLANs becomes
large.</p>

<p>The VLAN-aware mode in Cumulus Linux implements a configuration model
for large-scale L2 environments, with <strong>one single</strong> <strong>instance</strong> of
<a href="/version2/cumulus-linux-35/Layer_1_and_2/Spanning_Tree_and_Rapid_Spanning_Tree">Spanning
Tree</a>.
Each physical bridge member port is configured with the list of allowed
VLANs as well as its port VLAN ID (either PVID or native VLAN — see
below). MAC address learning, filtering and forwarding are <em>VLAN-aware</em>.
This significantly reduces the configuration size, and eliminates the
large overhead of managing the port/VLAN instances as subinterfaces,
replacing them with lightweight VLAN bitmaps and state updates.</p>


<div class="notices tip" > <p>You can configure both VLAN-aware and traditional mode bridges on the
same network in Cumulus Linux; however you should not have more than one
VLAN-aware bridge on a given switch.</p>
 </div>


<h2 id="configuring-a-vlan-aware-bridge">Configuring a VLAN-aware Bridge</h2>

<p>VLAN-aware bridges can be configured with the Network Command Line
Utility
(<a href="/version2/cumulus-linux-35/System_Configuration/Network_Command_Line_Utility_-_NCLU/Network_Command_Line_Utility_-_NCLU">NCLU</a>).
The example below shows the NCLU commands required to create a
VLAN-aware bridge configured for STP, that contains two switch ports,
and includes 3 VLANs — the tagged VLANs 100 and 200 and the untagged
(native) VLAN of 1:</p>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td>






<img class = "confluence-embedded-image confluence-thumbnail" src = "/images/download/thumbnails/8357447/vlan-aware_basic_trunking.png" alt = "/images/download/thumbnails/8357447/vlan-aware_basic_trunking.png"


width = 300

 />
</td>
<td><pre><code>                   
cumulus@switch:~$ net add bridge bridge ports swp1-2 
cumulus@switch:~$ net add bridge bridge vids 100,200 
cumulus@switch:~$ net add bridge bridge pvid 1
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit
cumulus@switch:~$ net show configuration files
 
...
 
auto bridge
iface bridge
    bridge-ports swp1 swp2
    bridge-pvid 1
    bridge-vids 100 200
    bridge-vlan-aware yes
 
...
   
    </code></pre></td>
</tr>
</tbody>
</table>

<p>The following attributes are useful for configuring VLAN-aware bridges:</p>

<ul>
<li><p><code>bridge-vlan-aware</code>: Is automatically set to <em>yes</em> to indicate that
the bridge is in VLAN-aware mode.</p></li>

<li><p><code>bridge-pvid</code>: A PVID is the bridge&rsquo;s <em>Primary VLAN Identifer</em>. The
PVID defaults to 1; specifying the PVID identifies that VLAN as the
native VLAN.</p></li>

<li><p><code>bridge-vids</code>: A VID is the <em>VLAN Identifier</em>, which declares the
VLANs associated with this bridge.</p></li>

<li><p><code>bridge-access</code>: Declares the physical switch port as an <em>access
port</em>. Access ports ignore all tagged packets; put all untagged
packets into the <code>bridge-pvid</code>.</p></li>

<li><p><code>bridge-allow-untagged</code>: When set to <em>no</em>, it drops any untagged
frames for a given switch port.</p></li>
</ul>


<div class="notices tip" > <p>If you specify <code>bridge-vids</code>, <code>bridge-access</code> or <code>bridge-pvid</code> at the
bridge level, these configurations are inherited by all ports in the
bridge. However, specifying any of these settings for a specific port
overrides the setting in the bridge.</p>
 </div>


<p>For a definitive list of bridge attributes, run <code>ifquery --syntax-help</code>
and look for the entries under <strong>bridge</strong>, <strong>bridgevlan</strong> and
<strong>mstpctl</strong>.</p>


<div class="notices note" > <p>The <code>bridge-pvid 1</code> is implied by default. You do not have to specify
<code>bridge-pvid</code> for a bridge or a port; in this case, the VLAN is
untagged. And while it does not hurt the configuration, it helps other
users for readability.</p>

<p>The following configurations are identical to each other and the
configuration above:</p>

<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<tbody>
<tr class="odd">
<td><pre><code>                   
auto bridge
iface bridge
    bridge-ports swp1 swp2
    bridge-vids 1 100 200
    bridge-vlan-aware yes
   
    </code></pre></td>
<td><pre><code>                   
auto bridge
iface bridge
    bridge-ports swp1 swp2
    bridge-pvid 1
    bridge-vids 1 100 200
    bridge-vlan-aware yes
   
    </code></pre></td>
<td><pre><code>                   
auto bridge
iface bridge
    bridge-ports swp1 swp2
    bridge-vids 100 200
    bridge-vlan-aware yes
   
    </code></pre></td>
</tr>
</tbody>
</table>
 </div>



<div class="notices warning" > <p>Do not try to bridge the management port, eth0, with any switch ports
(like swp0, swp1 and so forth). For example, if you created a bridge
with eth0 and swp1, it will not work properly and may disrupt access to
the management interface.</p>
 </div>


<h2 id="example-configurations">Example Configurations</h2>

<h3 id="vlan-filtering-vlan-pruning">VLAN Filtering/VLAN Pruning</h3>

<p>By default, the bridge port inherits the bridge VIDs. A port&rsquo;s
configuration can override the bridge VIDs, by using the <code>bridge-vids</code>
attribute:</p>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td>






<img class = "confluence-embedded-image confluence-thumbnail" src = "/images/download/thumbnails/8357447/vlan-aware_pruned.png" alt = "/images/download/thumbnails/8357447/vlan-aware_pruned.png"


width = 300

 />
</td>
<td><pre><code>                   
cumulus@switch:~$ net add bridge bridge ports swp1-3
cumulus@switch:~$ net add bridge bridge vids 100,200
cumulus@switch:~$ net add bridge bridge pvid 1
cumulus@switch:~$ net add interface swp3 bridge vids 200
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit
cumulus@switch:~$ net show configuration files
 
...
auto bridge
iface bridge
    bridge-ports swp1 swp2 swp3
    bridge-pvid 1
    bridge-vids 100 200
    bridge-vlan-aware yes
 
auto swp3
iface swp3
  bridge-vids 200
   
    </code></pre></td>
</tr>
</tbody>
</table>

<h3 id="untagged-access-ports">Untagged/Access Ports</h3>

<p>Access ports ignore all tagged packets. In the configuration below, swp1
and swp2 are configured as access ports, while all untagged traffic goes
to VLAN 100, as specified in the example below:</p>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td>






<img class = "confluence-embedded-image confluence-thumbnail" src = "/images/download/thumbnails/8357447/vlan-aware_untagged_access_ports.png" alt = "/images/download/thumbnails/8357447/vlan-aware_untagged_access_ports.png"


width = 300

 />
</td>
<td><pre><code>                   
cumulus@switch:~$ net add bridge bridge ports swp1-2
cumulus@switch:~$ net add bridge bridge vids 100,200
cumulus@switch:~$ net add bridge bridge pvid 1
cumulus@switch:~$ net add interface swp1 bridge access 100
cumulus@switch:~$ net add interface swp2 bridge access 100
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit
cumulus@switch:~$ net show configuration files
 
...
auto bridge
iface bridge
    bridge-ports swp1 swp2
    bridge-pvid 1
    bridge-vids 100 200
    bridge-vlan-aware yes
 
auto swp1
iface swp1
    bridge-access 100
 
auto swp2
iface swp2
    bridge-access 100
...
   
    </code></pre></td>
</tr>
</tbody>
</table>

<h3 id="dropping-untagged-frames">Dropping Untagged Frames</h3>

<p>With VLAN-aware bridge mode, a switch port can be configured to drop any
untagged frames. To do this, add <code>bridge-allow-untagged no</code> to the
<strong>switch port</strong> (not to the bridge). This leaves the bridge port without
a PVID and drops untagged packets.</p>

<p>Consider the following example bridge:</p>

<pre><code>                   
auto bridge
iface bridge
  bridge-ports swp1 swp2
  bridge-pvid 1
  bridge-vids 10 100 200
  bridge-vlan-aware yes
   
    
</code></pre>

<p>Here is the VLAN membership for that configuration:</p>

<pre><code>                   
cumulus@switch:~$ net show bridge vlan
 
Interface      VLAN  Flags
-----------  ------  ---------------------
swp1              1  PVID, Egress Untagged
                100
                200
swp2              1  PVID, Egress Untagged
                 10
                100
                200
   
    
</code></pre>

<p>To configure swp2 to drop untagged frames, add <code>bridge-allow-untagged
no</code>:</p>

<pre><code>                   
cumulus@switch:~$ net add interface swp2 bridge allow-untagged no
   
    
</code></pre>

<p>This command creates the following configuration snippet in the
<code>/etc/network/interfaces</code> file. Note the <code>bridge-allow-untagged</code>
configuration is under swp2:</p>

<pre><code>                   
cumulus@switch:~$ cat /etc/network/interfaces
 
...
 
auto swp1
iface swp1
 
auto swp2
iface swp2
    bridge-allow-untagged no 
 
auto bridge
iface bridge
  bridge-ports swp1 swp2
  bridge-pvid 1
  bridge-vids 10 100 200
  bridge-vlan-aware yes
 
...
   
    
</code></pre>

<p>When you check VLAN membership for that port, it shows that there is
<strong>no</strong> untagged VLAN.</p>

<pre><code>                   
cumulus@switch:~$ net show bridge vlan
 
Interface      VLAN  Flags
-----------  ------  ---------------------
swp1              1  PVID, Egress Untagged
                 10
                100
                200
swp2             10
                100
                200
   
    
</code></pre>

<h3 id="vlan-layer-3-addressing-switch-virtual-interfaces-and-other-vlan-attributes">VLAN Layer 3 Addressing — Switch Virtual Interfaces and Other VLAN Attributes</h3>

<p>When configuring the VLAN attributes for the bridge, specify the
attributes for each VLAN interface, each of which is named
<em>vlan&lt;vlanid&gt;</em>. If you are configuring the SVI for the native VLAN,
you must declare the native VLAN and specify its IP address. Specifying
the IP address in the bridge stanza itself returns an error.</p>

<pre><code>                   
cumulus@switch:~$ net add vlan 100 ip address 192.168.10.1/24
cumulus@switch:~$ net add vlan 100 ipv6 address 2001:db8::1/32
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit
   
    
</code></pre>

<p>These commands create the following configuration in the
<code>/etc/network/interfaces</code> file:</p>

<pre><code>                   
auto bridge
iface bridge
    bridge-ports swp1 swp2
    bridge-pvid 1
    bridge-vids 10 100 200
    bridge-vlan-aware yes
 
auto vlan100
iface vlan100
    address 192.168.10.1/24
    address 2001:db8::1/32
    vlan-id 100
    vlan-raw-device bridge
   
    
</code></pre>


<div class="notices note" > <p>In the above configuration, if your switch is configured for multicast
routing, you do not need to specify <code>bridge-igmp-querier-src</code>, as there
is no need for a static IGMP querier configuration on the switch.
Otherwise, the static IGMP querier configuration helps to probe the
hosts to refresh their IGMP reports.</p>
 </div>


<p>You can specify a range of VLANs as well. For example:</p>

<pre><code>                   
cumulus@switch:~$ net add vlan 1-200
   
    
</code></pre>

<h3 id="configuring-arp-timers">Configuring ARP Timers</h3>

<p>Cumulus Linux does not often interact directly with end systems as much
as end systems interact with one another. Thus, after a successful
<a href="http://linux-ip.net/html/ether-arp.html" target="_blank">address resolution protocol</a>
(ARP) places a neighbor into a reachable state, Cumulus Linux may not
interact with the client again for a long enough period of time for the
neighbor to move into a stale state. To keep neighbors in the reachable
state, Cumulus Linux includes a background process
(<code>/usr/bin/neighmgrd</code>) that tracks neighbors that move into a stale,
delay or probe state, and attempts to refresh their state ahead of any
removal from the Linux kernel, and thus before it would be removed from
the hardware forwarding.</p>

<p>The ARP refresh timer defaults to 1080 seconds (18 minutes). You can
change this setting by following the procedures outlined in this
<a href="https://support.cumulusnetworks.com/hc/en-us/articles/202012933" target="_blank">knowledge base
article</a>.</p>

<h3 id="configuring-multiple-ports-in-a-range">Configuring Multiple Ports in a Range</h3>

<p>The <code>bridge-ports</code> attribute takes a range of numbers. The &ldquo;swp1-52&rdquo; in
the example below indicates that swp1 through swp52 are part of the
bridge, which is a shortcut that saves you from enumerating each port
individually:</p>

<pre><code>                   
cumulus@switch:~$ net add bridge bridge ports swp1-52
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit
   
    
</code></pre>

<p>These commands create the following configuration in the
<code>/etc/network/interfaces</code> file:</p>

<pre><code>                   
auto bridge
iface bridge
      bridge-ports swp1 swp2 swp3 ... swp51 swp52
      bridge-vids 310 700 707 712 850 910
      bridge-vlan-aware yes
   
    
</code></pre>

<h3 id="access-ports-and-pruned-vlans">Access Ports and Pruned VLANs</h3>

<p>The following example configuration contains an access port and switch
port that are <em>pruned</em>; they only sends and receive traffic tagged
to/from a specific set of VLANs declared by the <code>bridge-vids</code> attribute.
It also contains other switch ports that send and receive traffic from
all the defined VLANs.</p>

<pre><code>                   
cumulus@switch:~$ net show configuration files
 
...
# ports swp3-swp48 are trunk ports which inherit vlans from the 'bridge'
# ie vlans 310,700,707,712,850,910
#
auto bridge
iface bridge
      bridge-ports swp1 swp2 swp3 ... swp51 swp52
      bridge-vids 310 700 707 712 850 910
      bridge-vlan-aware yes
 
auto swp1
iface swp1
      bridge-access 310
      mstpctl-bpduguard yes
      mstpctl-portadminedge yes
 
# The following is a trunk port that is &quot;pruned&quot;.
# native vlan is 1, but only .1q tags of 707, 712, 850 are
# sent and received
#
auto swp2
iface swp2
      mstpctl-bpduguard yes
      mstpctl-portadminedge yes
      bridge-vids 707 712 850
     
# The following port is the trunk uplink and inherits all vlans
# from 'bridge'; bridge assurance is enabled using 'portnetwork' attribute
auto swp49
iface swp49
      mstpctl-portnetwork yes
      mstpctl-portpathcost 10
 
# The following port is the trunk uplink and inherits all vlans
# from 'bridge'; bridge assurance is enabled using 'portnetwork' attribute
auto swp50
iface swp50
      mstpctl-portnetwork yes
      mstpctl-portpathcost 0
 
...
   
    
</code></pre>

<h3 id="large-bond-set-configuration">Large Bond Set Configuration</h3>

<p>The configuration below demonstrates a VLAN-aware bridge with a large
set of bonds. The bond configurations are generated from a
<a href="http://www.makotemplates.org/" target="_blank">Mako</a> template.</p>

<pre><code>                   
cumulus@switch:~$ net show configuration files
 
...
#
# vlan-aware bridge with bonds example
#
# uplink1, peerlink and downlink are bond interfaces.
# 'bridge' is a vlan aware bridge with ports uplink1, peerlink
# and downlink (swp2-20).
# 
# native vlan is by default 1
#
# 'bridge-vids' attribute is used to declare vlans.
# 'bridge-pvid' attribute is used to specify native vlans if other than 1
# 'bridge-access' attribute is used to declare access port
# 
auto lo
iface lo
 
auto eth0
iface eth0 inet dhcp
 
# bond interface
auto uplink1
iface uplink1
    bond-slaves swp32
    bridge-vids 2000-2079
 
# bond interface
auto peerlink
iface peerlink
    bond-slaves swp30 swp31
    bridge-vids 2000-2079 4094
 
# bond interface
auto downlink
iface downlink
    bond-slaves swp1
    bridge-vids 2000-2079
 
#
# Declare vlans for all swp ports
# swp2-20 get vlans from 2004 to 2022.
# The below uses mako templates to generate iface sections
# with vlans for swp ports
#
%for port, vlanid in zip(range(2, 20), range(2004, 2022)) :
    auto swp${port}
    iface swp${port}
        bridge-vids ${vlanid}
 
%endfor
 
# svi vlan 2000
auto bridge.2000
iface bridge.2000
    address 11.100.1.252/24
 
# l2 attributes for vlan 2000
auto bridge.2000
vlan bridge.2000
    bridge-igmp-querier-src 172.16.101.1
 
#
# vlan-aware bridge
#
auto bridge
iface bridge
    bridge-ports uplink1 peerlink downlink swp1 swp2 swp49 swp50
    bridge-vlan-aware yes
 
# svi peerlink vlan
auto peerlink.4094
iface peerlink.4094
    address 192.168.10.1/30
    broadcast 192.168.10.3
 
...
   
    
</code></pre>

<h3 id="vxlans-with-vlan-aware-bridges">VXLANs with VLAN-aware Bridges</h3>

<p>Cumulus Linux supports using VXLANs with VLAN-aware bridge
configuration. This provides improved scalability, as multiple VXLANs
can be added to a single VLAN-aware bridge. A 1:1 association is used
between the VXLAN VNI and the VLAN, using the bridge access VLAN
definition on the VXLAN, and the VLAN membership definition on the local
bridge member interfaces.</p>

<p>The configuration example below shows the differences between a VXLAN
configured for traditional bridge mode and one configured for VLAN-aware
mode. The configurations use head end replication (HER), along with the
VLAN-aware bridge to map VLANs to VNIs.</p>


<div class="notices note" > <p>The current tested scale limit for Cumulus Linux 3.2 is 512 VNIs.</p>
 </div>


<pre><code>                   
cumulus@switch:~$ net show configuration files
 
...
 
auto lo
iface lo inet loopback
    address 10.35.0.10/32
 
auto bridge
iface bridge
    bridge-ports uplink regex vni.*
    bridge-pvid 1
    bridge-vids 1-100
    bridge-vlan-aware yes
auto vni-10000
iface vni-10000
    alias CUSTOMER X VLAN 10
    bridge-access 10
    vxlan-id 10000
    vxlan-local-tunnelip 10.35.0.10
    vxlan-remoteip 10.35.0.34
 
...
   
    
</code></pre>

<h3 id="configuring-a-static-mac-address-entry">Configuring a Static MAC Address Entry</h3>

<p>You can add a static MAC address entry to the layer 2 table for an
interface within the VLAN-aware bridge by running a command similar to
the following:</p>

<pre><code>                   
cumulus@switch:~$ sudo bridge fdb add 12:34:56:12:34:56 dev swp1 vlan 150 master static
cumulus@switch:~$ sudo bridge fdb show
44:38:39:00:00:7c dev swp1 master bridge permanent
12:34:56:12:34:56 dev swp1 vlan 150 master bridge static
44:38:39:00:00:7c dev swp1 self permanent
12:12:12:12:12:12 dev swp1 self permanent
12:34:12:34:12:34 dev swp1 self permanent
12:34:56:12:34:56 dev swp1 self permanent
12:34:12:34:12:34 dev bridge master bridge permanent
44:38:39:00:00:7c dev bridge vlan 500 master bridge permanent
12:12:12:12:12:12 dev bridge master bridge permanent
   
    
</code></pre>

<h2 id="caveats-and-errata">Caveats and Errata</h2>

<h3 id="spanning-tree-protocol-stp">Spanning Tree Protocol (STP)</h3>

<p>VLAN-aware mode supports a single instance of STP across all VLANs, as
STP is enabled on a per-bridge basis. A common practice when using a
single STP instance for all VLANs is to define every VLAN on every
switch in the spanning tree instance.</p>

<p><code>mstpd</code> remains the user space protocol daemon.</p>

<p>Cumulus Linux supports Rapid Spanning Tree Protocol (RSTP).</p>

<h3 id="igmp-snooping">IGMP Snooping</h3>

<p>IGMP snooping and group membership are supported on a per-VLAN basis,
though the IGMP snooping configuration (including enable/disable and
mrouter ports) are defined on a per-bridge port basis.</p>

<h3 id="reserved-vlan-range">Reserved VLAN Range</h3>

<p>For hardware data plane internal operations, the switching silicon
requires VLANs for every physical port, Linux bridge, and layer 3
subinterface. Cumulus Linux reserves a range of 1000 VLANs by default;
the reserved range is 3000-3999. The reserved range can be modified if
it conflicts with any user-defined VLANs, as long the new range is a
contiguous set of VLANs with IDs anywhere between 2 and 4094, and the
minimum size of the range is 300 VLANs.</p>

<p>To configure the reserved range:</p>

<ol>
<li><p>Open <code>/etc/cumulus/switchd.conf</code> in a text editor.</p></li>

<li><p>Uncomment the following line, specify a new range, and save the
file:</p>

<pre><code>                       
resv_vlan_range
       
        
</code></pre></li>

<li><p>Restart <code>switchd</code> to implement the change:</p>

<pre><code>                       
cumulus@switch:~$ sudo systemctl restart switchd.service
       
        
</code></pre>


<div class="notices note" > <pre><code>While restarting `switchd`, all running ports will flap, and
forwarding will be interrupted.
</code></pre>
 </div>
</li>
</ol>

<h3 id="vlan-translation">VLAN Translation</h3>

<p>A bridge in VLAN-aware mode cannot have VLAN translation enabled for it.
Only traditional mode bridges can utilize VLAN translation.</p>

<h3 id="converting-bridges-between-supported-modes">Converting Bridges between Supported Modes</h3>

<p>Traditional mode bridges cannot be automatically converted to/from a
VLAN-aware bridge. The original configuration must be deleted, and all
member switch ports must be brought down, then a new bridge can be
created.</p>

<article id="html-search-results" class="ht-content" style="display: none;">

</article>

<footer id="ht-footer">

</footer>
</article>



    </div>
    

      


  

    <aside class="book-toc fixed">

  

  <button> </button>

      <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#configuring-a-vlan-aware-bridge">Configuring a VLAN-aware Bridge</a></li>
<li><a href="#example-configurations">Example Configurations</a>
<ul>
<li><a href="#vlan-filtering-vlan-pruning">VLAN Filtering/VLAN Pruning</a></li>
<li><a href="#untagged-access-ports">Untagged/Access Ports</a></li>
<li><a href="#dropping-untagged-frames">Dropping Untagged Frames</a></li>
<li><a href="#vlan-layer-3-addressing-switch-virtual-interfaces-and-other-vlan-attributes">VLAN Layer 3 Addressing — Switch Virtual Interfaces and Other VLAN Attributes</a></li>
<li><a href="#configuring-arp-timers">Configuring ARP Timers</a></li>
<li><a href="#configuring-multiple-ports-in-a-range">Configuring Multiple Ports in a Range</a></li>
<li><a href="#access-ports-and-pruned-vlans">Access Ports and Pruned VLANs</a></li>
<li><a href="#large-bond-set-configuration">Large Bond Set Configuration</a></li>
<li><a href="#vxlans-with-vlan-aware-bridges">VXLANs with VLAN-aware Bridges</a></li>
<li><a href="#configuring-a-static-mac-address-entry">Configuring a Static MAC Address Entry</a></li>
</ul></li>
<li><a href="#caveats-and-errata">Caveats and Errata</a>
<ul>
<li><a href="#spanning-tree-protocol-stp">Spanning Tree Protocol (STP)</a></li>
<li><a href="#igmp-snooping">IGMP Snooping</a></li>
<li><a href="#reserved-vlan-range">Reserved VLAN Range</a></li>
<li><a href="#vlan-translation">VLAN Translation</a></li>
<li><a href="#converting-bridges-between-supported-modes">Converting Bridges between Supported Modes</a></li>
</ul></li>
</ul></li>
</ul>
</nav>

      
      <button>
      <a href="https://github.com/cawleyflower/testDocs/edit/dev/content/version2/cumulus-linux-35/Layer_1_and_2/Ethernet_Bridging_-_VLANs/VLAN-aware_Bridge_Mode_for_Large-scale_Layer_2_Environments.md" target="_blank" rel="noopener">
        <img src="/svg/pencil-circle.svg" alt="Edit" /> Edit this page
      </a>
    </button>
    


    

</aside>





  </main>
  <footer class="footer-top">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <div class="footer-content">
            <div class="mb-4">
                <img src="https://static.cumulusnetworks.com/static/images/shared/cumulus-networks-rt-white-trademarked.ff839f1b2570.svg">
                <p>© <script type="text/javascript">document.write(new Date().getFullYear());</script> Cumulus Networks.<br>
                Site by <a href="//unomena.com/" target="_blank">Unomena</a>.</p>
            </div>
            <ul class="mb-4">
              <li><h4>Products</h4></li>
              <li><a href="//cumulusnetworks.com/products/cumulus-linux/">Cumulus Linux</a></li>
              <li><a href="//cumulusnetworks.com/products/netq/">Cumulus NetQ</a></li>
              <li><a href="//cumulusnetworks.com/products/cumulus-express/">Cumulus Express</a></li>
            </ul>
            <ul class="mb-4">
              <li><h4>Learn</h4></li>
              <li><a href="//cumulusnetworks.com/learn/web-scale-networking-education/">Going web-scale</a></li>
              <li><a href="//cumulusnetworks.com/learn/events/">Events</a></li>
              <li><a href="//cumulusnetworks.com/blog/">Blog</a></li>
            </ul>
            <ul class="mb-4">
              <li><h4>About</h4></li>
              <li><a href="//cumulusnetworks.com/about/">Our story</a></li>
              <li><a href="//cumulusnetworks.com/about/careers/">Careers</a></li>
              <li><a href="//cumulusnetworks.com/about/media-coverage/">Media coverage</a></li>
              <li><a href="//docs.cumulusnetworks.com/" target="_blank">Tech docs</a></li>
              <li><a href="//cumulusnetworks.com/community/">Community</a></li>
            </ul>
            <ul>
              <li>
                <a href="//twitter.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M23 6.628l-2-.5 1-2-2.464.7A4.48 4.48 0 0 0 12 8.128v1c-3.539.73-6.634-1.2-9.5-4.5q-.75 4 1.5 6l-3-.5c.405 2.069 1.362 3.7 4 4l-2.5 1c1 2 2.566 2.31 5 2.5a10.748 10.748 0 0 1-6.5 2c12.755 5.669 20-2.664 20-10V8.3z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//www.facebook.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                      .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M17.768 7.5H13.5V5.6a.972.972 0 0 1 1.012-1.1c.418 0 2.988.01 2.988.01V.5h-4.329C9.244.5 8.5 3.474 8.5 5.355V7.5h-3v4h3v12h5v-12h3.851z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//linkedin.com/company/cumulus-networks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                      .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M6.5 22.5h-5v-13h5zm9-9a2 2 0 0 0-2 2v7h-5v-13h5v1.485a6.307 6.307 0 0 1 3.99-1.495c2.962 0 5.01 2.2 5.01 6.355V22.5h-5v-7a2 2 0 0 0-2-2zM6.5 5A2.5 2.5 0 1 1 4 2.5 2.5 2.5 0 0 1 6.5 5z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//vimeo.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M.5 7.393l.933 1.224S3.36 7.1 4 7.859s3.1 9.925 3.915 11.617c.714 1.483 2.684 3.444 4.845 2.042s9.34-7.529 10.626-14.769-8.642-5.723-9.693.583c2.627-1.577 4.03.642 2.686 3.154s-2.569 4.145-3.211 4.145-1.135-1.679-1.868-4.613c-.76-3.035-.755-8.5-3.911-7.882C4.412 2.721.5 7.393.5 7.393z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//www.github.com/cumulusnetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                        <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                        </style>
                    </defs>
                    <path class="a" d="M19.459 17c0-5.969-4.126-3.532-7.5-3.532s-7.5-2.375-7.5 3.532a3.5 3.5 0 0 0 3.5 3.5h8a3.5 3.5 0 0 0 3.5-3.5z"></path>
                    <path class="a" d="M21.489 10.214l.032.023s2.646-4.572-.6-7.237c-2 0-5.058 3.3-5.058 3.3l.022.016A14.152 14.152 0 0 0 8.1 6.3C8.083 6.285 5.037 3 3.042 3c-3.173 2.6-.729 7.012-.614 7.217a8.876 8.876 0 0 0-1.395 5.743c.241 3.126 2.847 6.54 5.982 6.54H16.9c3.135 0 5.742-3.414 5.982-6.54a8.857 8.857 0 0 0-1.393-5.746z"></path>
                    <ellipse class="a" cx="15.48" cy="17" rx="1" ry="1.5"></ellipse>
                    <ellipse class="a" cx="8.48" cy="17" rx="1" ry="1.5"></ellipse>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//slack.cumulusnetworks.com/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                        <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                        </style>
                    </defs>
                    <rect class="a" x=".5" y=".5" width="23" height="23" rx="6" ry="6"></rect>
                    <circle class="a" cx="12" cy="12" r="6"></circle>
                    <circle class="a" cx="19" cy="5" r="1.5"></circle>
                  </svg>
                </a>
              </li>
              <li>
                <p>Cumulus Networks<sup>®</sup> — Data center networking software for the open, modern data center.</p>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </footer>
  <div class="footer-bottom">
      <div class="container">
          <div class="row">
              <div class="col-12">
                  <ul>
                      <li><a href="//cumulusnetworks.com/legal/trademarks/">Trademarks</a></li>
                      <li><a href="//cumulusnetworks.com/legal/privacy/">Privacy</a></li>
                      <li><a href="//cumulusnetworks.com/legal/">Terms of service</a></li>
                  </ul>
              </div>
          </div>
      </div>
  </div>

  
  

</body>

</html>
