<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Ethernet Virtual Private Network - EVPN | Cumulus Networks Documentation</title>

  
  <link href="https://fonts.googleapis.com/css?family=Oxygen|Oxygen+Mono:300,400,700" rel="stylesheet">

  
  
  
  <link rel="stylesheet" href="/book.min.a4ec20f62c4bbaad99f9db40524ec8653f6279bcde229add21ff46dfd05dfa96.css">

  
  <link rel="icon" href="/favicon.png" type="image/x-icon">

  
  <!--
  Made with Book Theme
  https://github.com/alex-shpak/hugo-book
  -->

</head>


<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  
  <header id="site-nav">
    <div class="header-wrapper flex">
      <a href="/">
        <img src="/header-logo.png" alt="Cumulus Networks">
        <img src="/cumulus-networks-rt-white.svg" alt="Cumulus Networks" class="header-mobile">
        <span>Docs</span>
      </a>
      <ul class="flex">
        <li><a href="//cumulusnetworks.com">HOME</a></li>
        <li><a href="//support.cumulusnetworks.com/">SUPPORT</a></li>
        <li><a href="//docs.cumulusnetworks.com/">DOCS</a></li>
        <li><a href="//education.cumulusnetworks.com">EDUCATION</a></li>
        <li><a href="//cumulusnetworks.com/blog/">BLOG</a></li>
        <li><a href="//forums.cumulusnetworks.com/">FORUMS</a></li>
      </ul>
      <div class="burger-menu">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </header>
  <div id="product-nav" class="flex">
    <ul>
      <li class="active"><a href="/Cumulus_Linux/">Cumulus Linux</a></li>
      <li><a href="/Cumulus_NetQ/">Cumulus NetQ</a></li>
      <li><a href="/Chassis/">Cumulus Express</a></li>
      <li><a href="">Cumulus VX</a></li>
    </ul>
    <div class="search-container">
      <div id="doc-search-box">
        <input type="text" class="doc-search-input" placeholder="Search" value="">
        <span><button type="submit"><img src="/icons/search_20x20.svg" alt=""></button></span>
      </div>
      <div id="dropdown" class="dropdown">
          <button class="btn" type="button" id="dropdownMenuButton">
            v3.76
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            <a class="dropdown-item" href="#">v3.5</a>
            <a class="dropdown-item" href="#">v2.1</a>
            <a class="dropdown-item" href="#">v1.43</a>
          </div>
      </div>
    </div>
  </div>
  <main class="flex container">
    <aside class="book-menu fixed">

      <nav role="navigation">
        <h2 class="book-brand">
          <a href="http://example.org/">Cumulus Networks Documentation</a>
        </h2>
        
        




  <ul id = "top" class = "cn-book-section-container">
  
    

  <li class="cn-book-section">
      

  <a href="/version2/" >
    Version2s
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/" >
    Cumulus Linux User Guide
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Installation_Management/" >
    Installation Management
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Installation_Management/Managing_Cumulus_Linux_Disk_Images/" >
    Managing Cumulus Linux Disk Images
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Installation_Management/Installing_a_New_Cumulus_Linux_Image/" >
    Installing a New Cumulus Linux Image
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Installation_Management/Upgrading_Cumulus_Linux/" >
    Upgrading Cumulus Linux
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Installation_Management/Using_Snapshots/" >
    Using Snapshots
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Installation_Management/Adding_and_Updating_Packages/" >
    Adding and Updating Packages
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Installation_Management/Zero_Touch_Provisioning_-_ZTP/" >
    Zero Touch Provisioning - ZTP
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/System_Configuration/" >
    System Configuration
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/System_Configuration/Network_Command_Line_Utility_-_NCLU/" >
    Network Command Line Utility - NCLU
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/System_Configuration/Network_Command_Line_Utility_-_NCLU/Network_Command_Line_Utility/" >
    Network Command Line Utility
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/System_Configuration/Authentication_Authorization_and_Accounting/" >
    Authentication, Authorization and Accounting
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/System_Configuration/Authentication_Authorization_and_Accounting/SSH_for_Remote_Access/" >
    SSH for Remote Access
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/System_Configuration/Authentication_Authorization_and_Accounting/User_Accounts/" >
    User Accounts
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/System_Configuration/Authentication_Authorization_and_Accounting/Using_sudo_to_Delegate_Privileges/" >
    Using sudo to Delegate Privileges
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/System_Configuration/Authentication_Authorization_and_Accounting/LDAP_Authentication_and_Authorization/" >
    LDAP Authentication and Authorization
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/System_Configuration/Authentication_Authorization_and_Accounting/TACACS_Plus/" >
    TACACS Plus
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/System_Configuration/Authentication_Authorization_and_Accounting/RADIUS_AAA/" >
    RADIUS AAA
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/System_Configuration/Netfilter_-_ACLs/" >
    Netfilter - ACLs
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/System_Configuration/Netfilter_-_ACLs/Default_Cumulus_Linux_ACL_Configuration/" >
    Default Cumulus Linux ACL Configuration
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/System_Configuration/Netfilter_-_ACLs/Filtering_Learned_MAC_Addresses/" >
    Filtering Learned MAC Addresses
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/System_Configuration/Setting_Date_and_Time/" >
    Setting Date and Time
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/System_Configuration/Managing_Application_Daemons/" >
    Managing Application Daemons
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/System_Configuration/Configuring_switchd/" >
    Configuring switchd
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/System_Configuration/Power_over_Ethernet_-_PoE/" >
    Power over Ethernet - PoE
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/System_Configuration/Configuring_a_Global_Proxy/" >
    Configuring a Global Proxy
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/System_Configuration/HTTP_API/" >
    HTTP API
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Interface_Configuration_and_Management/" >
    Interface Configuration and Management
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Interface_Configuration_and_Management/Buffer_and_Queue_Management/" >
    Buffer and Queue Management
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Interface_Configuration_and_Management/Buffer_and_Queue_Management/Configuring_Hardware-enabled_DDOS_Protection/" >
    Configuring Hardware-enabled DDOS Protection
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Interface_Configuration_and_Management/Layer_1_and_Switch_Port_Attributes/" >
    Layer 1 and Switch Port Attributes
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Interface_Configuration_and_Management/Configuring_DHCP_Relays/" >
    Configuring DHCP Relays
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Interface_Configuration_and_Management/Configuring_DHCP_Servers/" >
    Configuring DHCP Servers
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Interface_Configuration_and_Management/802.1X_Interfaces/" >
    802.1X Interfaces
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Layer_1_and_2/" >
    Layer 1 and 2
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Layer_1_and_2/Link_Layer_Discovery_Protocol/" >
    Link Layer Discovery Protocol
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_1_and_2/Link_Layer_Discovery_Protocol/Voice_VLAN/" >
    Voice VLAN
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Layer_1_and_2/Ethernet_Bridging_-_VLANs/" >
    Ethernet Bridging - VLANs
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_1_and_2/Ethernet_Bridging_-_VLANs/VLAN-aware_Bridge_Mode_for_Large-scale_Layer_2_Environments/" >
    VLAN-aware Bridge Mode for Large-scale Layer 2 Environments
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_1_and_2/Ethernet_Bridging_-_VLANs/Traditional_Mode_Bridges/" >
    Traditional Mode Bridges
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_1_and_2/Ethernet_Bridging_-_VLANs/VLAN_Tagging/" >
    VLAN Tagging
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Layer_1_and_2/Virtual_Router_Redundancy_-_VRR/" >
    Virtual Router Redundancy - VRR
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_1_and_2/Virtual_Router_Redundancy_-_VRR/ifplugd/" >
    ifplugd
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_1_and_2/Spanning_Tree_and_Rapid_Spanning_Tree/" >
    Spanning Tree and Rapid Spanning Tree
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_1_and_2/Prescriptive_Topology_Manager_-_PTM/" >
    Prescriptive Topology Manager - PTM
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_1_and_2/Bonding_-_Link_Aggregation/" >
    Bonding - Link Aggregation
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_1_and_2/Multi-Chassis_Link_Aggregation_-_MLAG/" >
    Multi-Chassis Link Aggregation - MLAG
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_1_and_2/LACP_Bypass/" >
    LACP Bypass
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_1_and_2/IGMP_and_MLD_Snooping/" >
    IGMP and MLD Snooping
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Network_Virtualization/" >
    Network Virtualization
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Network_Virtualization/Static_VXLAN_Configurations/" >
    Static VXLAN Configurations
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Network_Virtualization/Static_VXLAN_Configurations/Static_VXLAN_Tunnels/" >
    Static VXLAN Tunnels
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Network_Virtualization/Static_VXLAN_Configurations/Static_MAC_Bindings_with_VXLAN/" >
    Static MAC Bindings with VXLAN
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Network_Virtualization/Lightweight_Network_Virtualization_-_LNV_Overview/" >
    Lightweight Network Virtualization - LNV Overview
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Network_Virtualization/Lightweight_Network_Virtualization_-_LNV_Overview/LNV_VXLAN_Active-Active_Mode/" >
    LNV VXLAN Active-Active Mode
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Network_Virtualization/Lightweight_Network_Virtualization_-_LNV_Overview/LNV_Full_Example/" >
    LNV Full Example
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Network_Virtualization/Virtualization_Integrations/" >
    Virtualization Integrations
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Network_Virtualization/Virtualization_Integrations/Integrating_Hardware_VTEPs_with_Midokura_MidoNet_and_OpenStack/" >
    Integrating Hardware VTEPs with Midokura MidoNet and OpenStack
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Network_Virtualization/Virtualization_Integrations/Integrating_Hardware_VTEPs_with_VMware_NSX-V/" >
    Integrating Hardware VTEPs with VMware NSX-V
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Network_Virtualization/Virtualization_Integrations/Integrating_Hardware_VTEPs_with_VMware_NSX/" >
    Integrating Hardware VTEPs with VMware NSX
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Network_Virtualization/Ethernet_Virtual_Private_Network_-_EVPN/"  class="active" >
    Ethernet Virtual Private Network - EVPN
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Network_Virtualization/VXLAN_Routing/" >
    VXLAN Routing
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Network_Virtualization/VXLAN_Scale/" >
    VXLAN Scale
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Network_Virtualization/Hybrid_Cloud_Connectivity_with_QinQ_and_VXLANs/" >
    Hybrid Cloud Connectivity with QinQ and VXLANs
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Layer_3/" >
    Layer 3
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Layer_3/FRRouting_Overview/" >
    FRRouting Overview
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_3/FRRouting_Overview/Upgrading_from_Quagga_to_FRRouting/" >
    Upgrading from Quagga to FRRouting
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Layer_3/Configuring_FRRouting/" >
    Configuring FRRouting
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_3/Configuring_FRRouting/Comparing_NCLU_and_vtysh_Commands/" >
    Comparing NCLU and vtysh Commands
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_3/Routing/" >
    Routing
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_3/Introduction_to_Routing_Protocols/" >
    Introduction to Routing Protocols
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_3/Network_Topology/" >
    Network Topology
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_3/Open_Shortest_Path_First_-_OSPF_-_Protocol/" >
    Open Shortest Path First - OSPF - Protocol
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_3/Open_Shortest_Path_First_v3_-_OSPFv3_-_Protocol/" >
    Open Shortest Path First v3 - OSPFv3 - Protocol
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_3/Border_Gateway_Protocol_-_BGP/" >
    Border Gateway Protocol - BGP
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_3/Bidirectional_Forwarding_Detection_-_BFD/" >
    Bidirectional Forwarding Detection - BFD
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_3/Equal_Cost_Multipath_Load_Sharing_-_Hardware_ECMP/" >
    Equal Cost Multipath Load Sharing - Hardware ECMP
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_3/Redistribute_Neighbor/" >
    Redistribute Neighbor
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_3/Virtual_Routing_and_Forwarding_-_VRF/" >
    Virtual Routing and Forwarding - VRF
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_3/Management_VRF/" >
    Management VRF
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_3/Protocol_Independent_Multicast_-_PIM/" >
    Protocol Independent Multicast - PIM
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Layer_3/Segment_Routing/" >
    Segment Routing
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/" >
    Monitoring and Troubleshooting
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/Monitoring_System_Hardware/" >
    Monitoring System Hardware
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/Monitoring_System_Hardware/Network_Switch_Port_LED_and_Status_LED_Guidelines/" >
    Network Switch Port LED and Status LED Guidelines
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/Understanding_the_cl-support_Output_File/" >
    Understanding the cl-support Output File
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/Understanding_the_cl-support_Output_File/Troubleshooting_Log_Files/" >
    Troubleshooting Log Files
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/Understanding_the_cl-support_Output_File/Troubleshooting_the_etc_Directory/" >
    Troubleshooting the etc Directory
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/Troubleshooting_Network_Interfaces/" >
    Troubleshooting Network Interfaces
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/Troubleshooting_Network_Interfaces/Monitoring_Interfaces_and_Transceivers_Using_ethtool/" >
    Monitoring Interfaces and Transceivers Using ethtool
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/Network_Troubleshooting/" >
    Network Troubleshooting
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/Network_Troubleshooting/Using_NCLU_to_Troubleshoot_Your_Network_Configuration/" >
    Using NCLU to Troubleshoot Your Network Configuration
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/Network_Troubleshooting/Monitoring_System_Statistics_and_Network_Traffic_with_sFlow/" >
    Monitoring System Statistics and Network Traffic with sFlow
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/SNMP_Monitoring/" >
    SNMP Monitoring
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/SNMP_Monitoring/Using_Nutanix_Prism_as_a_Monitoring_Tool/" >
    Using Nutanix Prism as a Monitoring Tool
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/Single_User_Mode_-_Boot_Recovery/" >
    Single User Mode - Boot Recovery
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/Resource_Diagnostics_Using_cl-resource-query/" >
    Resource Diagnostics Using cl-resource-query
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/Monitoring_Virtual_Device_Counters/" >
    Monitoring Virtual Device Counters
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/Buffer_Monitoring/" >
    Buffer Monitoring
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Monitoring_and_Troubleshooting/Monitoring_Best_Practices/" >
    Monitoring Best Practices
  </a>


    </li>
    
  </ul>


  </li>


    
      

  <li class="cn-book-section">
      

  <a href="/version2/cumulus-linux-35/Network_Solutions/" >
    Network Solutions
  </a>



      

  <ul class="cn-book-section-container" id = "subsection">
    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Network_Solutions/Data_Center_Host_to_ToR_Architecture/" >
    Data Center Host to ToR Architecture
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Network_Solutions/Cumulus_Networks_Services_Demos/" >
    Cumulus Networks Services Demos
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Network_Solutions/Docker_on_Cumulus_Linux/" >
    Docker on Cumulus Linux
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Network_Solutions/OpenStack_Neutron_ML2_and_Cumulus_Linux/" >
    OpenStack Neutron ML2 and Cumulus Linux
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Network_Solutions/Anycast_Design_Guide/" >
    Anycast Design Guide
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Network_Solutions/RDMA_over_Converged_Ethernet_-_RoCE/" >
    RDMA over Converged Ethernet - RoCE
  </a>


    </li>
    
  </ul>


  </li>


    
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Quick_Start_Guide/" >
    Quick Start Guide
  </a>


    </li>
    
    <li >
      

  <a href="/version2/cumulus-linux-35/Cumulus_Linux_Index/" >
    Cumulus Linux Index
  </a>


    </li>
    
  </ul>


  </li>


    
    
  </ul>


  </li>


  
  </ul>









      </nav>

      
      
      
      

      <script src = "http://example.org/js/menuBundle.js"> </script>

    </aside>

    <div class="book-page">

      
      <header class="align-center justify-between book-header">
        <label for="menu-control">
          <img src="/svg/menu.svg" alt="Menu" />
        </label>
        <strong>Ethernet Virtual Private Network - EVPN</strong>
      </header>

      
      
<article class="markdown">
<h1>Ethernet Virtual Private Network - EVPN</h1>

<p>VXLAN is the de facto technology for implementing network virtualization
in the data center, enabling layer 2 segments to be extended over an IP
core (the underlay). The initial definition of VXLAN
(<a href="https://tools.ietf.org/html/rfc7348" target="_blank">RFC 7348</a>) did not include any
control plane and relied on a flood-and-learn approach for MAC address
learning. An alternate deployment model was to use a controller or a
technology such as <a href="https://docs.cumulusnetworks.com/display/DOCS/Lightweight+Network+Virtualization+-+LNV+Overview" target="_blank">Lightweight Network Virtualization
(LNV)</a>
in Cumulus Linux.</p>


<div class="notices note" > <p>When you are using EVPN, you cannot use LNV at the same time.</p>
 </div>


<p>Ethernet Virtual Private Network (EVPN) is a standards-based control
plane for
<a href="/version2/cumulus-linux-35/Network_Virtualization/Network_Virtualization">VXLAN</a>
defined in <a href="https://tools.ietf.org/html/rfc7432" target="_blank">RFC 7432</a> and
<a href="https://datatracker.ietf.org/doc/draft-ietf-bess-evpn-overlay/" target="_blank">draft-ietf-bess-evpn-overlay</a>
that allows for building and deploying VXLANs at scale. It relies on
multi-protocol BGP (MP-BGP) for exchanging information and is based on
BGP-MPLS IP VPNs (<a href="https://tools.ietf.org/html/rfc4364" target="_blank">RFC 4364</a>).
Hence, it has provisions to enable not only bridging between end systems
in the same layer 2 segment but also routing between different segments
(subnets). There is also inherent support for multi-tenancy. EVPN is
often referred to as the means of implementing <em>controller-less VXLAN</em>.</p>

<p>Cumulus Linux fully supports EVPN as the control plane for VXLAN,
including for both intra-subnet bridging and inter-subnet routing. Key
features include:</p>

<ul>
<li><p>VNI membership exchange between VTEPs using EVPN type-3 (Inclusive
multicast Ethernet tag) routes.</p></li>

<li><p>Exchange of host MAC and IP addresses using EVPN type-2 (MAC/IP
advertisement) routes.</p></li>

<li><p>Support for host/VM mobility (MAC and IP moves) through exchange of
the MAC Mobility Extended community.</p></li>

<li><p>Support for dual-attached hosts via <a href="/version2/cumulus-linux-35/Network_Virtualization/Lightweight_Network_Virtualization_-_LNV_Overview/LNV_VXLAN_Active-Active_Mode">VXLAN active-active
mode</a>.
MAC synchronization between the peer switches is done using
<a href="/version2/cumulus-linux-35/Layer_1_and_2/Multi-Chassis_Link_Aggregation_-_MLAG">MLAG</a>.</p></li>

<li><p>Support for ARP/ND suppression, which provides VTEPs with the
ability to suppress ARP flooding over VXLAN tunnels.</p></li>

<li><p>Support for exchange of static (sticky) MAC addresses through EVPN.</p></li>

<li><p>Support for distributed symmetric routing between different subnets.</p></li>

<li><p>Support for distributed asymmetric routing between different
subnets.</p></li>

<li><p>Support for centralized routing.</p></li>

<li><p>Support for prefix-based routing using EVPN type-5 routes (EVPN IP
prefix route)</p></li>

<li><p>Support for layer 3 multi-tenancy.</p></li>
</ul>

<p>EVPN address-family is supported with both eBGP and iBGP peering. If the
underlay routing is provisioned using eBGP, the same eBGP session can
also be used to carry EVPN routes. For example, in a typical 2-tier Clos
network topology where the leaf switches are the VTEPs, if eBGP sessions
are in use between the leaf and spine switches for the underlay routing,
the same sessions can be used to exchange EVPN routes; the spine
switches merely act as &ldquo;route forwarders&rdquo; and do not install any
forwarding state as they are not VTEPs. When EVPN routes are exchanged
over iBGP peering, OSPF can be used as the IGP or the next hops can also
be resolved using iBGP.</p>

<p>You can provision and manage EVPN using
<a href="/version2/cumulus-linux-35/System_Configuration/Network_Command_Line_Utility_-_NCLU/Network_Command_Line_Utility_-_NCLU">NCLU</a>.</p>


<div class="notices note" > <p>For Cumulus Linux 3.4 and later releases, the routing control plane
(including EVPN) is installed as part of the
<a href="https://frrouting.org" target="_blank">FRRouting</a> (FRR) package. For more information
about FRR, refer to the <a href="https://docs.cumulusnetworks.com/display/DOCS/FRRouting+Overview" target="_blank">FRR
Overview</a>.</p>
 </div>


<h2 id="basic-evpn-configuration">Basic EVPN Configuration</h2>

<p>The following three steps represent the fundamental configuration to use
EVPN as the control plane for VXLAN. These steps are in addition to
configuring VXLAN interfaces, attaching them to a bridge and mapping
VLANs to VNIs.</p>

<ol>
<li><p>Enable EVPN route exchange (that is, address-family L2VPN/EVPN)
between BGP peers</p></li>

<li><p>Enable EVPN on the system to advertise VNIs and host reachability
information (MAC addresses learned on associated VLANs) to BGP peers</p></li>

<li><p>Disable MAC learning on VXLAN interfaces as EVPN is responsible for
installing remote MACs</p></li>
</ol>

<p>There are additional steps (configuration) to enable ARP/ND suppression,
provision inter-subnet routing, and so forth. These steps depend on the
deployment scenario. Various other BGP parameters can also be
configured, if desired.</p>

<h3 id="enabling-evpn-between-bgp-neighbors">Enabling EVPN between BGP Neighbors</h3>

<p>You enable EVPN between
<a href="/version2/cumulus-linux-35/Layer_3/Border_Gateway_Protocol_-_BGP">BGP</a>
neighbors by adding the address family <em>evpn</em> to the existing neighbor
address-family activation command.</p>

<p>For a non-VTEP device that is merely participating in EVPN route
exchange, such as a spine switch (the network deployment uses hop-by-hop
eBGP or the switch is acting as an iBGP route reflector), activating the
interface for the EVPN address family is the fundamental configuration
needed in
<a href="/version2/cumulus-linux-35/Layer_3/FRRouting_Overview/FRRouting_Overview">FRRouting</a>.
Additional configuration options for specific scenarios are described
later on in this chapter.</p>

<p>The other BGP neighbor address-family-specific configurations supported
for EVPN are <code>allowas-in</code> and <code>route-reflector-client</code>.</p>

<p>To configure an EVPN route exchange with a BGP peer, you must activate
the peer or peer-group within the EVPN address-family:</p>

<pre><code>                   
cumulus@switch:~$ net add bgp autonomous-system 65000
cumulus@switch:~$ net add bgp neighbor swp1 remote-as external
cumulus@switch:~$ net add bgp l2vpn evpn neighbor swp1 activate
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit
   
    
</code></pre>


<div class="notices note" > <p>Adjust the <code>remote-as</code> above to be appropriate for your environment.</p>
 </div>



<div class="notices note" > <p>The command syntax <code>bgp evpn</code> is also permitted for backwards
compatibility with prior versions of Cumulus Linux, but the syntax <code>bgp
l2vpn evpn</code> is recommended in order to standardize the BGP
address-family configuration to the AFI/SAFI format.</p>
 </div>


<p>These commands create the following configuration snippet in
<code>/etc/frr/frr.conf</code>:</p>

<pre><code>                   
router bgp 65000
 neighbor swp1 interface remote-as external
 address-family l2vpn evpn
  neighbor swp1 activate
   
    
</code></pre>

<p>The above configuration does not result in BGP knowing about the local
VNIs defined on the system and advertising them to peers. This requires
additional configuration, <a href="#src-8357510_EthernetVirtualPrivateNetwork-EVPN-allvnis">as described
below</a>.</p>

<h3 id="advertising-all-vnis">Advertising All VNIs</h3>

<p>A single configuration variable enables the BGP control plane for all
VNIs configured on the switch. Set the variable <code>advertise-all-vni</code> to
provision all locally configured VNIs to be advertised by the BGP
control plane. FRR is not aware of any local VNIs and MACs and hosts
(neighbors) associated with those VNIs until <code>advertise-all-vni</code> is
configured.</p>

<p>To build upon the previous example, run the following commands to
advertise all VNIs:</p>

<pre><code>                   
cumulus@switch:~$ net add bgp autonomous-system 65000
cumulus@switch:~$ net add bgp neighbor swp1 remote-as external
cumulus@switch:~$ net add bgp l2vpn evpn neighbor swp1 activate 
cumulus@switch:~$ net add bgp l2vpn evpn advertise-all-vni
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit
   
    
</code></pre>


<div class="notices note" > <p>Adjust the <code>remote-as</code> above to be appropriate for your environment.</p>
 </div>


<p>These commands create the following configuration snippet in
<code>/etc/frr/frr.conf</code>:</p>

<pre><code>                   
router bgp 65000
 neighbor swp1 interface remote-as external
 address-family l2vpn evpn
  neighbor swp1 activate
  advertise-all-vni
   
    
</code></pre>


<div class="notices note" > <p>This configuration is only needed on leaf switches that are VTEPs. EVPN
routes received from a BGP peer are accepted, even without this explicit
EVPN configuration. These routes are maintained in the global EVPN
routing table. However, they only become effective (that is, imported
into the per-VNI routing table and appropriate entries installed in the
kernel) when the VNI corresponding to the received route is locally
known.</p>
 </div>


<h3 id="auto-derivation-of-rds-and-rts">Auto-derivation of RDs and RTs</h3>

<p>When a local VNI is learned by FRR and there is no explicit
configuration for that VNI in FRR, the route distinguisher (RD) and
import and export route targets (RTs) for this VNI are automatically
derived — the RD uses “RouterId:VNI-Index” and the import and export RTs
use “AS:VNI”. The RD and RTs are used in the EVPN route exchange. The RD
disambiguates EVPN routes in different VNIs (as they may have the same
MAC and/or IP address) while the RTs describe the VPN membership for the
route. The &ldquo;VNI-Index&rdquo; used for the RD is a unique, internally generated
number for a VNI. It solely has local significance; on remote switches,
its only role is for route disambiguation. This number is used instead
of the VNI value itself because this number has to be less than or equal
to 65535. In the RT, the AS part is always encoded as a 2-byte value to
allow room for a large VNI. If the router has a 4-byte AS, only the
lower 2 bytes are used. This ensures a unique RT for different VNIs
while having the same RT for the same VNI across routers in the same AS.</p>

<p>For eBGP EVPN peering, the peers are in a different AS so using an
automatic RT of &ldquo;AS:VNI&rdquo; does not work for route import. Therefore, the
import RT is treated as &ldquo;*:VNI&rdquo; to determine which received routes are
applicable to a particular VNI. This only applies when the import RT is
auto-derived and not configured.</p>

<h3 id="user-defined-rds-and-rts">User-defined RDs and RTs</h3>

<p>EVPN also supports manual configuration of RDs and RTs, if you don&rsquo;t
want them derived automatically. To manually define RDs and RTs, use the
<code>vni</code> option within NCLU to configure the switch:</p>

<pre><code>                   
cumulus@switch:~$ net add bgp l2vpn evpn vni 10200 rd 172.16.10.1:20
cumulus@switch:~$ net add bgp l2vpn evpn vni 10200 route-target import 65100:20
cumulus@switch:~$ net add bgp l2vpn evpn advertise-all-vni
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit
   
    
</code></pre>

<p>These commands create the following configuration snippet in
<code>/etc/frr/frr.conf</code>:</p>

<pre><code>                   
 address-family l2vpn evpn
  advertise-all-vni
  vni 10200
   rd 172.16.10.1:20
   route-target import 65100:20
   
    
</code></pre>


<div class="notices note" > <p>These commands are per VNI and must be specified under <code>address-family
l2vpn evpn</code> in BGP.</p>
 </div>



<div class="notices note" > <p>If you delete the RD or RT later, it reverts back to its corresponding
default value.</p>
 </div>


<p>You can configure multiple RT values for import or export for a VNI. In
addition, you can configure both the import and export route targets
with a single command by using <code>route-target both</code>:</p>

<pre><code>                   
cumulus@switch:~$ net add bgp evpn vni 10400 route-target import 100:400
cumulus@switch:~$ net add bgp evpn vni 10400 route-target import 100:500
cumulus@switch:~$ net add bgp evpn vni 10500 route-target both 65000:500
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit
   
    
</code></pre>

<p>The above commands create the following configuration snippet in the
<code>/etc/frr/frr.conf</code> file:</p>

<pre><code>                   
address-family l2vpn evpn
  vni 10400
    route-target import 100:400
    route-target import 100:500
  vni 10500
    route-target import 65000:500
    route-target export 65000:500
   
    
</code></pre>

<h3 id="enabling-evpn-in-an-ibgp-environment-with-an-ospf-underlay">Enabling EVPN in an iBGP Environment with an OSPF Underlay</h3>

<p>EVPN can be deployed with an
<a href="/version2/cumulus-linux-35/Layer_3/Open_Shortest_Path_First_-_OSPF_-_Protocol">OSPF</a>
or static route underlay if needed. This is a more complex configuration
than using eBGP. In this case, iBGP advertises EVPN routes directly
between VTEPs, and the spines are unaware of EVPN or BGP.</p>

<p>The leaf switches peer with each other in a full mesh within the EVPN
address family without using route reflectors. The leafs generally peer
to their loopback addresses, which are advertised in OSPF. The receiving
VTEP imports routes into a specific VNI with a matching route target
community.</p>

<pre><code>                   
cumulus@switch:~$ net add bgp autonomous-system 65020
cumulus@switch:~$ net add bgp evpn neighbor 10.1.1.2 remote-as internal
cumulus@switch:~$ net add bgp evpn neighbor 10.1.1.3 remote-as internal
cumulus@switch:~$ net add bgp evpn neighbor 10.1.1.4 remote-as internal
cumulus@switch:~$ net add bgp evpn neighbor 10.1.1.2 activate 
cumulus@switch:~$ net add bgp evpn neighbor 10.1.1.3 activate 
cumulus@switch:~$ net add bgp evpn neighbor 10.1.1.4 activate 
cumulus@switch:~$ net add bgp evpn advertise-all-vni
cumulus@switch:~$ net add ospf router-id 10.1.1.1
cumulus@switch:~$ net add loopback lo ospf area 0.0.0.0
cumulus@switch:~$ net add ospf passive-interface lo
cumulus@switch:~$ net add interface swp50 ospf area 0.0.0.0
cumulus@switch:~$ net add interface swp51 ospf area 0.0.0.0
cumulus@switch:~$ net add interface swp50 ospf network point-to-point
cumulus@switch:~$ net add interface swp51 ospf network point-to-point
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit
   
    
</code></pre>

<p>These commands create the following configuration snippet in
<code>/etc/frr/frr.conf</code>:</p>

<pre><code>                   
interface lo
 ip ospf area 0.0.0.0
!
interface swp50
 ip ospf area 0.0.0.0
 ip ospf network point-to-point
 
interface swp51
 ip ospf area 0.0.0.0
 ip ospf network point-to-point
!
router bgp 65020
 neighbor 10.1.1.2 remote-as internal
 neighbor 10.1.1.3 remote-as internal
 neighbor 10.1.1.4 remote-as internal
 !
 address-family l2vpn evpn
  neighbor 10.1.1.2 activate
  neighbor 10.1.1.3 activate
  neighbor 10.1.1.4 activate
  advertise-all-vni
 exit-address-family
 !
Router ospf
    Ospf router-id 10.1.1.1
    Passive-interface lo
   
    
</code></pre>

<h3 id="disabling-data-plane-mac-learning-over-vxlan-tunnels">Disabling Data Plane MAC Learning over VXLAN Tunnels</h3>

<p>When EVPN is provisioned, data plane MAC learning should be disabled for
VXLAN interfaces because the purpose of EVPN is to exchange MACs between
VTEPs in the control plane. In the <code>/etc/network/interfaces</code> file,
configure the <code>bridge-learning</code> value to <em>off</em>:</p>

<pre><code>                   
cumulus@switch:~$ net add vxlan vni200 vxlan id 10200
cumulus@switch:~$ net add vxlan vni200 vxlan local-tunnelip 10.0.0.1
cumulus@switch:~$ net add vxlan vni200 bridge access 200
cumulus@switch:~$ net add vxlan vni200 bridge learning off
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit
   
    
</code></pre>

<p>These commands create the following code snippet in the
<code>/etc/network/interfaces</code> file:</p>

<pre><code>                   
auto vni200
iface vni200
    bridge-access 200
    bridge-learning off
    vxlan-id 10200
    vxlan-local-tunnelip 10.0.0.1
   
    
</code></pre>


<div class="notices tip" > <p>For a bridge in <a href="/version2/cumulus-linux-35/Layer_1_and_2/Ethernet_Bridging_-_VLANs/Traditional_Mode_Bridges">traditional
mode</a>,
you must edit the bridge configuration in the <code>/etc/network/interfaces</code>
file in a text editor:</p>

<pre><code>                   
auto bridge1
iface bridge1
    bridge-ports swp3.100 swp4.100 vni100
    bridge-learning vni100=off
   
    
</code></pre>
 </div>


<h3 id="handling-bum-traffic">Handling BUM Traffic</h3>

<p>With EVPN, the only method of handling BUM traffic is <a href="Lightweight_Network_Virtualization_-_LNV_Overview.html#src-8357484_LightweightNetworkVirtualization-LNVOverview-head-end" target="_blank">Head End
Replication
(HER)</a>.
HER is enabled by default, as it is when <a href="https://docs.cumulusnetworks.com/display/DOCS/Lightweight+Network+Virtualization+-+LNV+Overview" target="_blank">Lightweight Network
Virtualization
(LNV)</a>
is used.</p>

<h2 id="arp-and-nd-suppression">ARP and ND Suppression</h2>

<p>ARP suppression in an EVPN context refers to the ability of a VTEP to
suppress ARP flooding over VXLAN tunnels as much as possible. Instead, a
local proxy handles ARP requests received from locally attached hosts
for remote hosts. ARP suppression is the implementation for IPv4; ND
suppression is the implementation for IPv6.</p>


<div class="notices note" > <p>On switches with the Mellanox Spectrum chipset, ND suppression only
functions with the <a href="https://support.cumulusnetworks.com/hc/en-us/articles/115015646107" target="_blank">Spectrum A1
chip</a>.</p>
 </div>


<p>ARP and ND suppression are not enabled by default. You configure ARP/ND
suppression on a VXLAN interface. You also need to create an SVI for the
neighbor entry.</p>

<p>To configure ARP or ND suppression, use
<a href="/version2/cumulus-linux-35/System_Configuration/Network_Command_Line_Utility_-_NCLU/Network_Command_Line_Utility_-_NCLU">NCLU</a>.
Here&rsquo;s an example configuration using 2 VXLANs, 10100 and 10200, and 2
VLANs, 100 and 200:</p>

<pre><code>                   
cumulus@switch:~$ net add bridge bridge ports vni100,vni200
cumulus@switch:~$ net add bridge bridge vids 100,200
cumulus@switch:~$ net add vxlan vni100 vxlan id 10100
cumulus@switch:~$ net add vxlan vni200 vxlan id 10200
cumulus@switch:~$ net add vxlan vni100 bridge learning off
cumulus@switch:~$ net add vxlan vni200 bridge learning off
cumulus@switch:~$ net add vxlan vni100 bridge access 100
cumulus@switch:~$ net add vxlan vni100 bridge arp-nd-suppress on
cumulus@switch:~$ net add vxlan vni200 bridge arp-nd-suppress on
cumulus@switch:~$ net add vxlan vni200 bridge access 200
cumulus@switch:~$ net add vxlan vni100 vxlan local-tunnelip 110.0.0.1
cumulus@switch:~$ net add vxlan vni200 vxlan local-tunnelip 110.0.0.1
cumulus@switch:~$ net add vlan 100 ip forward off
cumulus@switch:~$ net add vlan 100 ipv6 forward off
cumulus@switch:~$ net add vlan 200 ip forward off
cumulus@switch:~$ net add vlan 200 ipv6 forward off
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit
   
    
</code></pre>

<p>These commands create the following configuration in the
<code>/etc/network/interfaces</code> file:</p>

<pre><code>                   
auto bridge
iface bridge
    bridge-ports vni100 vni200
    bridge-stp on
    bridge-vids 100 200
    bridge-vlan-aware yes
 
auto vlan100
iface vlan100
    ip6-forward off
    ip-forward off
    vlan-id 100
    vlan-raw-device bridge
 
auto vlan200
iface vlan200
    ip6-forward off
    ip-forward off
    vlan-id 200
    vlan-raw-device bridge
 
auto vni100
iface vni100
    bridge-access 100
    bridge-arp-nd-suppress on
    bridge-learning off
    vxlan-id 10100
    vxlan-local-tunnelip 110.0.0.1
 
auto vni200
iface vni200
     bridge-learning off
     bridge-access 200
     bridge-arp-nd-suppress on
     vxlan-id 10200
     vxlan-local-tunnelip 110.0.0.1
   
    
</code></pre>


<div class="notices tip" > <p>For a bridge in <a href="/version2/cumulus-linux-35/Layer_1_and_2/Ethernet_Bridging_-_VLANs/Traditional_Mode_Bridges">traditional
mode</a>,
you must edit the bridge configuration in the <code>/etc/network/interfaces</code>
file in a text editor:</p>

<pre><code>                   
auto bridge1
iface bridge1
    bridge-ports swp3.100 swp4.100 vni100
    bridge-learning vni100=off
    bridge-arp-nd-suppress vni100=on
    ip6-forward off
    ip-forward off 
   
    
</code></pre>
 </div>


<h3 id="using-uft-profiles-other-than-the-default">Using UFT Profiles Other than the Default</h3>

<p>When deploying EVPN and VXLAN using a hardware profile other than the
default UFT profile, you need to ensure that the Linux kernel ARP sysctl
settings <code>gc_thresh2</code> and <code>gc_thresh3</code> are both set to a value larger
than the number of the neighbor (ARP/ND) entries anticipated in the
deployment.</p>

<p>To configure these settings, edit <code>/etc/sysctl.d/neigh.conf</code> in a text
editor. If your network has more hosts than the values used in the
example below, change the sysctl entries accordingly.</p>

<pre><code>                   
cumulus@switch:~$ sudo nano /etc/sysctl.d/neigh.conf
...
net.ipv4.neigh.default.gc_thresh3=14336
net.ipv6.neigh.default.gc_thresh3=16384
net.ipv4.neigh.default.gc_thresh2=7168
net.ipv6.neigh.default.gc_thresh2=8192
...
   
    
</code></pre>

<p>After you save your settings, reboot the switch to apply the new
configuration.</p>

<h2 id="evpn-and-vxlan-active-active-mode">EVPN and VXLAN Active-Active Mode</h2>

<p>No additional EVPN-specific configuration is needed for <a href="/version2/cumulus-linux-35/Network_Virtualization/Lightweight_Network_Virtualization_-_LNV_Overview/LNV_VXLAN_Active-Active_Mode">VXLAN
active-active
mode</a>.
Both switches in the
<a href="/version2/cumulus-linux-35/Layer_1_and_2/Multi-Chassis_Link_Aggregation_-_MLAG">MLAG</a>
pair establish EVPN peering with other EVPN speakers (for example, with
spine switches, if using hop-by-hop eBGP) and inform about their locally
known VNIs and MACs. When MLAG is active, both switches announce this
information with the shared anycast IP address.</p>

<p>The active-active configuration should include the following:</p>

<ul>
<li><p>The <code>clagd-vxlan-anycast-ip</code> parameter must be under the <a href="LNV_VXLAN_Active-Active_Mode.html#src-8357503_LNVVXLANActive-ActiveMode-anycast" target="_blank">loopback
stanza</a>
on both peers</p></li>

<li><p>The anycast address should be advertised to the routed fabric from
both peers</p></li>

<li><p>The
<a href="LNV_VXLAN_Active-Active_Mode.html#src-8357503_LNVVXLANActive-ActiveMode-example" target="_blank">VNIs</a>
must be configured identically on both peers. However,
<code>vxlan-local-</code><code>tunnelip</code> must be sourced from the switch&rsquo;s unique
loopback stanza IP address.</p></li>

<li><p>The
<a href="LNV_VXLAN_Active-Active_Mode.html#src-8357503_LNVVXLANActive-ActiveMode-example" target="_blank">peerlink</a>
must belong to the bridge</p></li>
</ul>

<p>MLAG syncs information between the two switches in the MLAG pair; EVPN
does not synchronize.</p>

<h2 id="inter-subnet-routing">Inter-subnet Routing</h2>

<p>There are multiple models in EVPN for routing between different subnets
(VLANs). These models arise due to the following two main
considerations:</p>

<ul>
<li><p>Does every VTEP act as an L3 gateway and do routing, or only
specific VTEPs do routing?</p></li>

<li><p>Is routing done only at the ingress of the VXLAN tunnel or is it
done at both the ingress and the egress of the VXLAN tunnel?</p></li>
</ul>

<p>These models are:</p>

<ul>
<li><p><strong>Centralized routing:</strong> Specific VTEPs act as designated L3
gateways and do routing between subnets; other VTEPs just do
bridging.</p></li>

<li><p><strong>Distributed asymmetric routing:</strong> Every VTEP participates in
routing, but all routing is done at the ingress VTEP; the egress
VTEP only does bridging.</p></li>

<li><p><strong>Distributed symmetric routing:</strong> Every VTEP participates in
routing and routing is done at both the ingress VTEP and the egress
VTEP.</p></li>
</ul>

<p>Distributed routing — asymmetric or symmetric — is commonly deployed
with the VTEPs configured with an <em>anycast IP/MAC address</em> for each
subnet. That is, each VTEP that has a particular subnet is configured
with the same IP/MAC for that subnet. Such a model facilitates easy
host/VM mobility as there is no need to change the host/VM configuration
when it moves from one VTEP to another.</p>

<p>EVPN in Cumulus Linux supports all of the routing models listed above.
The models are described further in the following sections.</p>

<p>All routing happens in the context of a tenant VRF (<a href="/version2/cumulus-linux-35/Layer_3/Virtual_Routing_and_Forwarding_-_VRF">virtual routing and
forwarding</a>).
A VRF instance is provisioned for each tenant, and the subnets of the
tenant are associated with that VRF (the corresponding SVI is attached
to the VRF). Inter-subnet routing for each tenant occurs within the
context of that tenant&rsquo;s VRF, and is separate from the routing for other
tenants.</p>


<div class="notices note" > <p>When configuring <a href="/version2/cumulus-linux-35/Network_Virtualization/VXLAN_Routing">VXLAN
routing</a>,
Cumulus Networks recommends enabling ARP suppression on all VXLAN
interfaces. Otherwise, when a locally attached host ARPs for the
gateway, it will receive multiple responses, one from each anycast
gateway.</p>
 </div>


<h3 id="centralized-routing">Centralized Routing</h3>

<p>In centralized routing, a specific VTEP is configured to act as the
default gateway for all the hosts in a particular subnet throughout the
EVPN fabric. It is common to provision a pair of VTEPs in active-active
mode as the default gateway, using an anycast IP/MAC address for each
subnet. All subnets need to be configured on such gateway VTEP(s). When
a host in one subnet wants to communicate with a host in another subnet,
it addresses the packets to the gateway VTEP. The ingress VTEP (to which
the source host is attached) bridges the packets to the gateway VTEP
over the corresponding VXLAN tunnel. The gateway VTEP performs the
routing to the destinaion host and post-routing, the packet gets bridged
to the egress VTEP (to which the destination host is attached). The
egress VTEP then bridges the packet on to the destination host.</p>

<h4 id="advertising-the-default-gateway">Advertising the Default Gateway</h4>

<p>In order to enable centralized routing, the gateway VTEPs must be
configured to advertise their IP/MAC address. This is done using the
<code>advertise-default-gw command.</code></p>

<pre><code>                   
cumulus@leaf01:~$ net add bgp autonomous-system 65000
cumulus@leaf01:~$ net add bgp l2vpn evpn advertise-default-gw
cumulus@leaf01:~$ net pending
cumulus@leaf01:~$ net commit
   
    
</code></pre>

<p>These commands create the following configuration snippet in
<code>/etc/frr/frr.conf</code>:</p>

<pre><code>                   
router bgp 65000
  address-family l2vpn evpn
   advertise-default-gw
  exit-address-family
   
    
</code></pre>


<div class="notices note" > <ul>
<li><p>Centralized routing can be deployed at the VNI level. Thus, you can
configure the <code>advertise-default-gw</code> command per VNI so that
centralized routing is used for some VNIs while distributed routing
(described below) is used for other VNIs. This type of configuration
is not recommended unless the deployment requires it.</p></li>

<li><p>When centralized routing is in use, even if the source host and
destination host are attached to the same VTEP, the packets travel
to the gateway VTEP to get routed and then come back.</p></li>
</ul>
 </div>


<h3 id="asymmetric-routing">Asymmetric Routing</h3>

<p>In distributed asymmetric routing, each VTEP acts as a layer 3 gateway,
performing routing for its attached hosts. The routing is called
asymmetric because only the ingress VTEP performs routing, the egress
VTEP only performs the bridging. Asymmetric routing is easy to deploy as
it can be achieved with only host routing and does not involve any
interconnecting VNIs. However, each VTEP must be provisioned with all
VLANs/VNIs — the subnets between which communication can take place;
this is required even if there are no locally-attached hosts for a
particular VLAN.</p>


<div class="notices tip" > <p>The only additional configuration required to implement asymmetric
routing beyond the standard configuration for a layer 2 VTEP described
earlier is to ensure that each VTEP has all VLANs (and corresponding
VNIs) provisioned on it and the SVI for each such VLAN is configured
with an anycast IP/MAC address.</p>
 </div>


<h3 id="symmetric-routing">Symmetric Routing</h3>

<p>In distributed symmetric routing, each VTEP acts as a layer 3 gateway,
performing routing for its attached hosts. This is the same as in
asymmetric routing. The difference is that in symmetric routing, both
the ingress VTEP and egress VTEP route the packets. Thus, it can be
compared to the traditional routing behavior of routing to a next hop
router. In the VXLAN encapsulated packet, the inner destination MAC
address is set to the router MAC address of the egress VTEP as an
indication that the egress VTEP is the next hop and also needs to
perform routing. All routing happens in the context of a tenant (VRF).
For a packet received by the ingress VTEP from a locally attached host,
the SVI interface corresponding to the VLAN determines the VRF. For a
packet received by the egress VTEP over VXLAN tunnel, the VNI in the
packet has to specify the VRF. For symmetric routing, this is a VNI
corresponding to the tenant and is different from either the source VNI
or the destination VNI. This VNI is referred to as the L3-VNI or
interconnecting VNI; it has to be provisioned by the operator and is
exchanged through the EVPN control plane. In order to make the
distinction clear, the regular VNI, which is used to map a VLAN, is
referred to as the L2-VNI.</p>


<div class="notices note" > <ul>
<li><p>There is a one-to-one mapping between an L3-VNI and a tenant (VRF).</p></li>

<li><p>The VRF to L3-VNI mapping has to be consistent across all VTEPs. The
L3-VNI has to be provisioned by the operator.</p></li>

<li><p>L3-VNI and L2-VNI cannot share the same number space.</p></li>
</ul>
 </div>


<p>In addition to the L3-VNI, the other parameter relevant to symmetric
routing is the router MAC address. This should be a MAC address of the
VTEP so that it knows to route the packet after VXLAN decapsulation.
This parameter is automatically derived from the MAC address of the SVI
corresponding to the L3-VNI. It is also exchanged through the EVPN
control plane.</p>

<p>For EVPN symmetric routing, the additional configuration required is as
follows:</p>

<ol>
<li><p>Configure a per-tenant VXLAN interface that specifies the L3-VNI for
the tenant. This VXLAN interface is part of the bridge and router
MAC addresses of remote VTEPs is installed over this interface.</p></li>

<li><p>Configure an SVI (layer 3 interface) corresponding to the per-tenant
VXLAN interface. This is attached to the tenant&rsquo;s VRF. Remote host
routes for symmetric routing are installed over this SVI.</p></li>

<li><p>Specify the mapping of VRF to L3-VNI. This configuration is for the
BGP control plane.</p></li>
</ol>

<h4 id="vxlan-interface-corresponding-to-the-l3-vni">VXLAN Interface Corresponding to the L3-VNI</h4>

<pre><code>                   
cumulus@leaf01:~$ net add vxlan vni104001 vxlan id 104001
cumulus@leaf01:~$ net add vxlan vni104001 bridge access 4001
cumulus@leaf01:~$ net add vxlan vni104001 vxlan local-tunnelip 10.0.0.11
cumulus@leaf01:~$ net add vxlan vni104001 bridge learning off
cumulus@leaf01:~$ net add vxlan vni104001 bridge arp-nd-suppress on
cumulus@leaf01:~$ net add bridge bridge ports vni104001
cumulus@leaf01:~$ net pending
cumulus@leaf01:~$ net commit
   
    
</code></pre>

<p>The above commands create the following snippet in the
<code>/etc/network/interfaces</code> file:</p>

<pre><code>                   
auto vni104001
iface vni104001
    bridge-access 4001
    bridge-arp-nd-suppress on
    bridge-learning off
    vxlan-id 104001
    vxlan-local-tunnelip 10.0.0.11
 
auto bridge
iface bridge
    bridge-ports vni104001
    bridge-vlan-aware yes
   
    
</code></pre>

<h4 id="svi-for-the-l3-vni">SVI for the L3-VNI</h4>

<pre><code>                   
cumulus@leaf01:~$ net add vlan 4001 vrf blue
cumulus@leaf01:~$ net pending
cumulus@leaf01:~$ net commit
   
    
</code></pre>

<p>These commands create the following snippet in the
<code>/etc/network/interfaces</code> file:</p>

<pre><code>                   
auto vlan4001
iface vlan4001
    vlan-id 4001
    vlan-raw-device bridge
    vrf blue
   
    
</code></pre>


<div class="notices note" > <p>When two VTEPs are operating in VXLAN active-active mode and performing
symmetric routing, their router MAC needs to be configured corresponding
to each L3-VNI in order to ensure both VTEPs use the same MAC address.
Do this by specifying the <code>hwaddress</code> (MAC address) for the SVI
corresponding to the L3-VNI, with the same address used on both switches
in the MLAG pair. It is recommended that you use the MLAG system MAC
address for this purpose. The corresponding snippet of configuration in
the <code>/etc/network/interfaces</code> file looks like this:</p>

<pre><code>                   
auto vlan4001
iface vlan4001
    hwaddress 44:39:39:FF:40:94
    vlan-id 4001
    vlan-raw-device bridge
    vrf blue
   
    
</code></pre>
 </div>


<h4 id="vrf-to-l3-vni-mapping">VRF to L3-VNI Mapping</h4>

<pre><code>                   
cumulus@leaf01:~$ net add vrf blue vni 104001
cumulus@leaf01:~$ net pending
cumulus@leaf01:~$ net commit
   
    
</code></pre>

<p>These commands create the following configuration snippet in
<code>/etc/frr/frr.conf</code>:</p>

<pre><code>                   
vrf blue
 vni 104001
!
   
    
</code></pre>

<h4 id="advertising-the-locally-attached-subnets">Advertising the Locally-attached Subnets</h4>

<p>Symmetric routing presents a problem in the presence of silent hosts. If
the ingress VTEP does not have the destination subnet and the host route
is not advertised for the destination host, the ingress VTEP cannot
route the packet to its destination. This problem can be overcome by
having VTEPs announce the subnet prefixes corresponding to their
connected subnets in addition to announcing host routes. These routes
must be announced as EVPN prefix (type-5) routes.</p>

<p>To advertise locally attached subnets, you must:</p>

<ol>
<li><p>Enable advertisement of EVPN prefix (type-5) routes. Refer to the
<a href="#src-8357510_EthernetVirtualPrivateNetwork-EVPN-type5">next
section</a> for
the steps to do this.</p></li>

<li><p>Ensure that the routes corresponding to the connected subnets are
known in the BGP VRF routing table by injecting them using the
<code>network</code> command or redistributing them using the <code>redistribute
connected</code> command.</p></li>
</ol>


<div class="notices note" > <p>This configuration is recommended only if the deployment is known to
have silent hosts. It is also recommended that this should be enabled on
only one VTEP per subnet, or two for redundancy.</p>
 </div>



<div class="notices note" > <p>An earlier version of this chapter referred to the <code>advertise-subnet</code>
command. This command has been deprecated and should not be used.</p>
 </div>


<h2 id="prefix-based-routing-evpn-type-5-routes">Prefix-based Routing — EVPN Type-5 Routes</h2>

<p>EVPN in Cumulus Linux supports prefix-based routing using EVPN type-5
(prefix) routes. Type-5 routes (or prefix routes) are primarily used to
route to destinations outside of the data center fabric.</p>

<p>EVPN prefix routes carry the L3-VNI and router MAC address and follow
the symmetric routing model for routing to the destination prefix.</p>


<div class="notices tip" > <p>When connecting to a WAN edge router to reach destinations outside the
data center, it is highly recommended that specific border/exit leaf
switches be deployed to originate the type-5 routes.</p>
 </div>



<div class="notices note" > <p>On switches with the Mellanox Spectrum chipset, centralized routing,
symmetric routing and prefix-based routing only functions with the
Spectrum A1 chip.</p>
 </div>



<div class="notices note" > <p>If you are using a Broadcom Trident II+ switch as a border/exit leaf,
<a href="https://support.cumulusnetworks.com/hc/en-us/articles/115015543848#rn766" target="_blank">review release
note 766</a>
for a necessary workaround; the workaround only applies to Trident II+
switches, not Tomahawk or Spectrum.</p>
 </div>


<h3 id="configuring-the-switch-to-install-evpn-type-5-routes">Configuring the Switch to Install EVPN Type-5 Routes</h3>

<p>In order for a switch to be able to install EVPN type-5 routes into the
routing table, it must be configured with the L3-VNI related
information. This configuration is the same as what you use for
symmetric routing. That is, you need to:</p>

<ol>
<li><p>Configure a per-tenant VXLAN interface that specifies the L3-VNI for
the tenant. This VXLAN interface is part of the bridge; router MAC
addresses of remote VTEPs are installed over this interface.</p></li>

<li><p>Configure an SVI (layer 3 interface) corresponding to the per-tenant
VXLAN interface. This is attached to the tenant&rsquo;s VRF. The remote
prefix routes are installed over this SVI.</p></li>

<li><p>Specify the mapping of the VRF to L3-VNI. This configuration is for
the BGP control plane.</p></li>
</ol>

<h3 id="announcing-evpn-type-5-routes">Announcing EVPN Type-5 Routes</h3>

<p>The following configuration is needed in the tenant VRF in order to
announce IP prefixes in BGP&rsquo;s RIB as EVPN type-5 routes.</p>

<pre><code>                   
cumulus@bl1:~$ net add bgp vrf vrf1 l2vpn evpn advertise ipv4 unicast
cumulus@bl1:~$ net pending
cumulus@bl1:~$ net commit
   
    
</code></pre>

<p>These commands create the following snippet in the <code>/etc/frr/frr.conf</code>
file:</p>

<pre><code>                   
router bgp 65005 vrf vrf1
  address-family l2vpn evpn
    advertise ipv4 unicast
  exit-address-family
end
   
    
</code></pre>

<h2 id="static-sticky-mac-addresses">Static (Sticky) MAC Addresses</h2>

<p>MAC addresses that are intended to be pinned to a particular VTEP can be
provisioned on the VTEP as a static bridge FDB entry. EVPN picks up
these MAC addresses and advertises them to peers as remote static MACs.
You configure static bridge FDB entries for sticky MACs under the bridge
configuration using NCLU:</p>

<pre><code>                   
cumulus@switch:~$ net add bridge post-up bridge fdb add 00:11:22:33:44:55 dev swp1 vlan 101 master static
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit
   
    
</code></pre>

<p>These commands create the following configuration in the
<code>/etc/network/interfaces</code> file:</p>

<pre><code>                   
auto bridge
iface bridge
    bridge-ports swp1 vni10101
    bridge-vids 101
    bridge-vlan-aware yes
    post-up bridge fdb add 00:11:22:33:44:55 dev swp1 vlan 101 master static
   
    
</code></pre>


<div class="notices tip" > <p>For a bridge in <a href="/version2/cumulus-linux-35/Layer_1_and_2/Ethernet_Bridging_-_VLANs/Traditional_Mode_Bridges">traditional
mode</a>,
you must edit the bridge configuration in the <code>/etc/network/interfaces</code>
file in a text editor:</p>

<pre><code>                   
auto br101
iface br101
    bridge-ports swp1.101 vni10101
    bridge-learning vni10101=off
    post-up bridge fdb add 00:11:22:33:44:55 dev swp1.101 master static
   
    
</code></pre>
 </div>


<h2 id="evpn-operational-commands">EVPN Operational Commands</h2>

<h3 id="general-linux-commands-related-to-evpn">General Linux Commands Related to EVPN</h3>

<p>You can use various <code>iproute2</code> commands to examine links, VLAN mappings
and the bridge MAC forwarding database known to the Linux kernel. You
can also use such commands to examine the neighbor cache and the routing
table (for the underlay or for a specific tenant VRF). Some of the key
commands are:</p>

<ul>
<li><p>ip [-d] link show</p></li>

<li><p>bridge link show</p></li>

<li><p>bridge vlan show</p></li>

<li><p>bridge [-s] fdb show</p></li>

<li><p>ip neighbor show</p></li>

<li><p>ip route show [table &lt;vrf-name&gt;]</p></li>
</ul>

<p>A sample output of <code>ip -d link show type vxlan</code> is shown below for one
VXLAN interface. Some relevant parameters are the VNI value, the state,
the local IP address for the VXLAN tunnel, the UDP port number (4789)
and the bridge that the interface is part of (<em>bridge</em> in the example
below). The output also shows that MAC learning is disabled (<em>off</em>) on
the VXLAN interface.</p>

<pre><code>                   
cumulus@leaf01:~$ ip -d link show type vxlan
9: vni100:  mtu 1500 qdisc noqueue master bridge state UNKNOWN mode DEFAULT group default 
    link/ether 72:bc:b4:a3:eb:1e brd ff:ff:ff:ff:ff:ff promiscuity 1 
    vxlan id 10100 local 110.0.0.1 srcport 0 0 dstport 4789 nolearning ageing 300 
    bridge_slave state forwarding priority 8 cost 100 hairpin off guard off root_block off fastleave off learning off flood on port_id 0x8001 port_no 0x1 designated_port 32769 designated_cost 0 designated_bridge 8000.0:1:0:0:11:0 designated_root 8000.0:1:0:0:11:0 hold_timer    0.00 message_age_timer    0.00 forward_delay_timer    0.00 topology_change_ack 0 config_pending 0 proxy_arp off proxy_arp_wifi off mcast_router 1 mcast_fast_leave off mcast_flood on neigh_suppress on group_fwd_mask 0x0 group_fwd_mask_str 0x0 group_fwd_maskhi 0x0 group_fwd_maskhi_str 0x0 addrgenmode eui64 
...
cumulus@leaf01:~$
   
    
</code></pre>

<p>A sample output of <code>bridge fdb show</code> is depicted below. Some information
of interest from this output are:</p>

<ul>
<li><p>swp3 and swp4 are access ports with VLAN ID 100. This is mapped to
VXLAN interface vni100.</p></li>

<li><p>00:02:00:00:00:01 is a local host MAC learned on swp3.</p></li>

<li><p>The remote VTEPs which participate in VLAN ID 100 are 110.0.0.3,
110.0.0.4 and 110.0.0.2. This is evident from the FDB entries with a
MAC address of 00:00:00:00:00:00. These entries are used for BUM
traffic replication.</p></li>

<li><p>00:02:00:00:00:06 is a remote host MAC reachable over the VXLAN
tunnel to 110.0.0.2.</p></li>
</ul>

<!-- end list -->

<pre><code>                   
cumulus@leaf01:~$ bridge fdb show
00:02:00:00:00:13 dev swp3 master bridge permanent
00:02:00:00:00:01 dev swp3 vlan 100 master bridge 
00:02:00:00:00:02 dev swp4 vlan 100 master bridge 
72:bc:b4:a3:eb:1e dev vni100 master bridge permanent
00:02:00:00:00:06 dev vni100 vlan 100 offload master bridge 
00:00:00:00:00:00 dev vni100 dst 110.0.0.3 self permanent
00:00:00:00:00:00 dev vni100 dst 110.0.0.4 self permanent
00:00:00:00:00:00 dev vni100 dst 110.0.0.2 self permanent
00:02:00:00:00:06 dev vni100 dst 110.0.0.2 self offload 
...
   
    
</code></pre>

<p>A sample output of <code>ip neigh show</code> is depicted below. Some interesting
information from this output includes:</p>

<ul>
<li><p>50.1.1.11 is a locally-attached host on VLAN 100. It is shown twice
because of the configuration of the anycast IP/MAC on the switch.</p></li>

<li><p>50.1.1.42 is a remote host on VLAN 100 and 60.1.1.23 is a remote
host on VLAN 200. The MAC address of these hosts can be examined
using the <code>bridge fdb show</code> command described earlier to determine
the VTEPs behind which these hosts are located.</p></li>
</ul>

<!-- end list -->

<pre><code>                   
cumulus@leaf01:~$ ip neigh show
50.1.1.11 dev vlan100-v0 lladdr 00:02:00:00:00:01 STALE
50.1.1.42 dev vlan100 lladdr 00:02:00:00:00:0e offload REACHABLE
60.1.1.23 dev vlan200 lladdr 00:02:00:00:00:07 offload REACHABLE
50.1.1.11 dev vlan100 lladdr 00:02:00:00:00:01 REACHABLE
...
   
    
</code></pre>

<h3 id="general-bgp-operational-commands-relevant-to-evpn">General BGP Operational Commands Relevant to EVPN</h3>

<p>The following commands are not unique to EVPN but help troubleshoot
connectivity and route propagation. If BGP is used for the underlay
routing, you can view a summary of the layer 3 fabric connectivity by
running the <code>net show bgp summary</code> command:</p>

<pre><code>                   
cumulus@leaf01:~$ net show bgp summary
show bgp ipv4 unicast summary
=============================
BGP router identifier 110.0.0.1, local AS number 65001 vrf-id 0
BGP table version 9
RIB entries 11, using 1496 bytes of memory
Peers 2, using 42 KiB of memory
Peer groups 1, using 72 bytes of memory
 
Neighbor        V         AS MsgRcvd MsgSent   TblVer  InQ OutQ  Up/Down State/PfxRcd
s1(swp49s0)     4      65100      43      49        0    0    0 02:04:00            4
s2(swp49s1)     4      65100      43      49        0    0    0 02:03:59            4
Total number of neighbors 2
 
show bgp ipv6 unicast summary
=============================
No IPv6 neighbor is configured
 
show bgp evpn summary
=====================
BGP router identifier 110.0.0.1, local AS number 65001 vrf-id 0
BGP table version 0
RIB entries 15, using 2040 bytes of memory
Peers 2, using 42 KiB of memory
Peer groups 1, using 72 bytes of memory
 
Neighbor        V         AS MsgRcvd MsgSent   TblVer  InQ OutQ  Up/Down State/PfxRcd
s1(swp49s0)     4      65100      43      49        0    0    0 02:04:00           30
s2(swp49s1)     4      65100      43      49        0    0    0 02:03:59           30
Total number of neighbors 2
   
    
</code></pre>

<p>You can examine the underlay routing, which determines how remote VTEPs
are reached, by running the <code>net show route</code> command. Here is some
sample output from a leaf switch:</p>

<pre><code>                   
cumulus@leaf01:~$ net show route
show ip route
=============
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, P - PIM, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel,
       &gt; - selected route, * - FIB route
K&gt;* 0.0.0.0/0 [0/0] via 192.168.0.2, eth0, 1d03h41m
B&gt;* 20.0.0.1/32 [20/0] via fe80::202:ff:fe00:29, swp1, 1d03h40m
B&gt;* 20.0.0.2/32 [20/0] via fe80::202:ff:fe00:2d, swp2, 1d03h40m
C&gt;* 110.0.0.1/32 is directly connected, lo, 1d03h41m
B&gt;* 110.0.0.2/32 [20/0] via fe80::202:ff:fe00:29, swp1, 1d03h40m
  *                     via fe80::202:ff:fe00:2d, swp2, 1d03h40m
B&gt;* 110.0.0.3/32 [20/0] via fe80::202:ff:fe00:29, swp1, 1d03h40m
  *                     via fe80::202:ff:fe00:2d, swp2, 1d03h40m
B&gt;* 110.0.0.4/32 [20/0] via fe80::202:ff:fe00:29, swp1, 1d03h40m
  *                     via fe80::202:ff:fe00:2d, swp2, 1d03h40m
C&gt;* 192.168.0.0/24 is directly connected, eth0, 1d03h41m
 
show ipv6 route
===============
Codes: K - kernel route, C - connected, S - static, R - RIPng,
       O - OSPFv3, I - IS-IS, B - BGP, N - NHRP, T - Table,
       v - VNC, V - VNC-Direct, A - Babel,
       &gt; - selected route, * - FIB route
C * fe80::/64 is directly connected, swp2, 1d03h41m
C * fe80::/64 is directly connected, swp1, 1d03h41m
C&gt;* fe80::/64 is directly connected, eth0, 1d03h41m
cumulus@leaf01:~$
   
    
</code></pre>

<p>You can view the MAC forwarding database on the switch by running the
<code>net show bridge macs</code> command:</p>

<pre><code>                   
cumulus@leaf01:~$ net show bridge macs
VLAN      Master    Interface    MAC                TunnelDest    State      Flags          LastSeen
--------  --------  -----------  -----------------  ------------  ---------  -------------  ---------------
100       br0       br0          00:00:5e:00:01:01                permanent                 1 day, 03:38:43
100       br0       br0          00:01:00:00:11:00                permanent                 1 day, 03:38:43
100       br0       swp3         00:02:00:00:00:01                                          00:00:26
100       br0       swp4         00:02:00:00:00:02                                          00:00:16
100       br0       vni100     00:02:00:00:00:0a                           offload        1 day, 03:38:20
100       br0       vni100     00:02:00:00:00:0d                           offload        1 day, 03:38:20
100       br0       vni100     00:02:00:00:00:0e                           offload        1 day, 03:38:20
100       br0       vni100     00:02:00:00:00:05                           offload        1 day, 03:38:19
100       br0       vni100     00:02:00:00:00:06                           offload        1 day, 03:38:19
100       br0       vni100     00:02:00:00:00:09                           offload        1 day, 03:38:20
200       br0       br0          00:00:5e:00:01:01                permanent                 1 day, 03:38:42
200       br0       br0          00:01:00:00:11:00                permanent                 1 day, 03:38:43
200       br0       swp5         00:02:00:00:00:03                                          00:00:26
200       br0       swp6         00:02:00:00:00:04                                          00:00:26
200       br0       vni200     00:02:00:00:00:0b                           offload        1 day, 03:38:20
200       br0       vni200     00:02:00:00:00:0c                           offload        1 day, 03:38:20
200       br0       vni200     00:02:00:00:00:0f                           offload        1 day, 03:38:20
200       br0       vni200     00:02:00:00:00:07                           offload        1 day, 03:38:19
200       br0       vni200     00:02:00:00:00:08                           offload        1 day, 03:38:19
200       br0       vni200     00:02:00:00:00:10                           offload        1 day, 03:38:20
4001      br0       br0          00:01:00:00:11:00                permanent                 1 day, 03:38:42
4001      br0       vni4001    00:01:00:00:12:00                           offload        1 day, 03:38:19
4001      br0       vni4001    00:01:00:00:13:00                           offload        1 day, 03:38:20
4001      br0       vni4001    00:01:00:00:14:00                           offload        1 day, 03:38:20
untagged            br0          00:00:5e:00:01:01                permanent  self           never
untagged            vlan100      00:00:5e:00:01:01                permanent  self           never
untagged            vlan200      00:00:5e:00:01:01                permanent  self           never
...
   
    
</code></pre>

<h3 id="displaying-evpn-address-family-peers">Displaying EVPN address-family Peers</h3>

<p>The BGP peers participating in the L2VPN/EVPN address-family and their
states can be shown using the <code>net show bgp l2vpn evpn summary
</code>command. The following sample output from a leaf switch shows eBGP
peering with 2 spine switches for exchanging EVPN routes; both peering
sessions are in the <em>established</em> state.</p>

<pre><code>                   
cumulus@leaf01:~$ net show bgp l2vpn evpn summary
BGP router identifier 110.0.0.1, local AS number 65001 vrf-id 0
BGP table version 0
RIB entries 15, using 2280 bytes of memory
Peers 2, using 39 KiB of memory
Peer groups 1, using 64 bytes of memory
Neighbor        V         AS MsgRcvd MsgSent   TblVer  InQ OutQ  Up/Down State/PfxRcd
s1(swp1)        4      65100     103     107        0    0    0 1d02h08m           30
s2(swp2)        4      65100     103     107        0    0    0 1d02h08m           30
Total number of neighbors 2
cumulus@leaf01:~$
   
    
</code></pre>

<h3 id="displaying-vnis-in-evpn">Displaying VNIs in EVPN</h3>

<p>You can display the configured VNIs on a network device participating in
BGP EVPN by running the <code>show bgp evpn vni</code> command. This command is
only relevant on a VTEP. If symmetric routing is configured, this
command displays the special L3-VNIs that are configured per tenant VRF.</p>

<p>The following example from a leaf switch shows 2 L2-VNIs — 10100 and
10200 — as well as a L3-VNI — 104001. For L2-VNIs, the number of
associated MAC and neighbor entries are shown. The VXLAN interface and
VRF corresponding to each VNI are also shown.</p>

<pre><code>                   
cumulus@leaf01:~$ net show evpn vni
VNI        Type VxLAN IF              # MACs   # ARPs   # Remote VTEPs  Tenant VRF                           
10200      L2   vni200              8        12       3               vrf1                                 
10100      L2   vni100              8        12       3               vrf1                                 
104001     L3   vni4001             3        3        n/a             vrf1                                 
cumulus@leaf01:~$
   
    
</code></pre>

<p>You can examine the EVPN information for a specific VNI in detail. The
following output shows the details for the L2-VNI 10100 as well as for
the L3-VNI 104001. For the L2-VNI, the remote VTEPs which have that VNI
are shown. For the L3-VNI, the router MAC and associated L2-VNIs are
shown. The state of the L3-VNI depends on the state of its associated
VRF as well as the states of its underlying VXLAN interface and SVI.</p>

<pre><code>                   
cumulus@leaf01:~$ net show evpn vni 10100
VNI: 10100
 Type: L2
 Tenant VRF: vrf1
 VxLAN interface: vni100
 VxLAN ifIndex: 9
 Local VTEP IP: 110.0.0.1
 Remote VTEPs for this VNI:
  110.0.0.2
  110.0.0.4
  110.0.0.3
 Number of MACs (local and remote) known for this VNI: 8
 Number of ARPs (IPv4 and IPv6, local and remote) known for this VNI: 12
 Advertise-gw-macip: No
cumulus@leaf01:~$ 
cumulus@leaf01:~$ net show evpn vni 104001
VNI: 104001
  Type: L3
  Tenant VRF: vrf1
  Local Vtep Ip: 110.0.0.1
  Vxlan-Intf: vni4001
  SVI-If: vlan4001
  State: Up
  Router MAC: 00:01:00:00:11:00
  L2 VNIs: 10100 10200 
cumulus@leaf01:~$
   
    
</code></pre>

<h3 id="examining-local-and-remote-mac-addresses-for-a-vni-in-evpn">Examining Local and Remote MAC Addresses for a VNI in EVPN</h3>

<p>You can examine all local and remote MAC addresses for a VNI by running
<code>net show evpn mac vni &lt;vni&gt;</code>. This command is only relevant for an
L2-VNI:</p>

<pre><code>                   
cumulus@leaf01:~$ net show evpn mac vni 10100
Number of MACs (local and remote) known for this VNI: 8
MAC               Type   Intf/Remote VTEP      VLAN 
00:02:00:00:00:0e remote 110.0.0.4            
00:02:00:00:00:06 remote 110.0.0.2            
00:02:00:00:00:05 remote 110.0.0.2            
00:02:00:00:00:02 local  swp4                  100  
00:00:5e:00:01:01 local  vlan100-v0            100  
00:02:00:00:00:09 remote 110.0.0.3            
00:01:00:00:11:00 local  vlan100               100  
00:02:00:00:00:01 local  swp3                  100  
00:02:00:00:00:0a remote 110.0.0.3            
00:02:00:00:00:0d remote 110.0.0.4            
cumulus@leaf01:~$
   
    
</code></pre>

<p>You can examine MAC addresses for all VNIs using <code>net show evpn mac vni
all.</code></p>

<p>You can examine the details for a specific MAC addresses or query all
remote MAC addresses behind a specific VTEP:</p>

<pre><code>                   
cumulus@leaf01:~$ net show evpn mac vni 10100 mac 00:02:00:00:00:02
MAC: 00:02:00:00:00:02
 Intf: swp4(6) VLAN: 100
 Neighbors:
    50.1.1.12 Active
cumulus@leaf01:~$ net show evpn mac vni 10100 mac 00:02:00:00:00:05
MAC: 00:02:00:00:00:05
 Remote VTEP: 110.0.0.2
 Neighbors:
    50.1.1.21 
cumulus@leaf01:~$ net show evpn mac vni 10100 vtep 110.0.0.3
VNI 10100
MAC               Type   Intf/Remote VTEP      VLAN 
00:02:00:00:00:09 remote 110.0.0.3            
00:02:00:00:00:0a remote 110.0.0.3            
cumulus@leaf01:~$
   
    
</code></pre>

<h3 id="examining-local-and-remote-neighbors-for-a-vni-in-evpn">Examining Local and Remote Neighbors for a VNI in EVPN</h3>

<p>You can examine all local and remote neighbors (ARP entries) for a VNI
by running <code>net show evpn arp-cache vni &lt;vni&gt;</code>. This command is only
relevant for an L2-VNI and the output shows both IPv4 and IPv6 neighbor
entries:</p>

<pre><code>                   
cumulus@leaf01:~$ net show evpn arp-cache vni 10100
Number of ARPs (local and remote) known for this VNI: 12
IP                      Type   MAC               Remote VTEP          
50.1.1.11               local  00:02:00:00:00:01
50.1.1.12               local  00:02:00:00:00:02
50.1.1.22               remote 00:02:00:00:00:06 110.0.0.2            
fe80::201:ff:fe00:1100  local  00:01:00:00:11:00
50.1.1.1                local  00:01:00:00:11:00
50.1.1.31               remote 00:02:00:00:00:09 110.0.0.3            
fe80::200:5eff:fe00:101 local  00:00:5e:00:01:01
...
   
    
</code></pre>

<p>You can examine neighbor entries for all VNIs using <code>net show evpn
arp-cache vni all.</code></p>

<h3 id="examining-remote-router-macs-in-evpn">Examining Remote Router MACs in EVPN</h3>

<p>When symmetric routing is deployed, you can examine the router MACs
corresponding to all remote VTEPs by running <code>net show evpn rmac vni
&lt;vni&gt;</code>. This command is only relevant for an L3-VNI:</p>

<pre><code>                   
cumulus@leaf01:~$ net show evpn rmac vni 104001
Number of Remote RMACs known for this VNI: 3
MAC               Remote VTEP          
00:01:00:00:14:00 110.0.0.4            
00:01:00:00:12:00 110.0.0.2            
00:01:00:00:13:00 110.0.0.3            
cumulus@leaf01:~$
   
    
</code></pre>

<p>You can examine router MACs for all L3-VNIs using <code>net show evpn rmac
vni all.</code></p>

<h3 id="examining-gateway-next-hops-in-evpn">Examining Gateway Next Hops in EVPN</h3>

<p>When symmetric routing is deployed, you can examine the gateway next
hops by running <code>net show evpn next-hops vni &lt;vni&gt;</code>. This command is
only relevant for an L3-VNI. In general, the gateway next hop IP
addresses should correspond to the remote VTEP IP addresses. Remote host
and prefix routes are installed via these next hops:</p>

<pre><code>                   
cumulus@leaf01:~$ net show evpn next-hops vni 104001
Number of NH Neighbors known for this VNI: 3
IP              RMAC             
110.0.0.3       00:01:00:00:13:00
110.0.0.4       00:01:00:00:14:00
110.0.0.2       00:01:00:00:12:00
cumulus@leaf01:~$
   
    
</code></pre>

<p>You can examine gateway next hops for all L3-VNIs using <code>net show evpn
next-hops vni all</code>.</p>

<p>You can query a specific next hop; the output displays the remote host
and prefix routes via this next hop:</p>

<pre><code>                   
cumulus@leaf01:~$ net show evpn next-hops vni 104001 ip 110.0.0.4
Ip: 110.0.0.4
  RMAC: 00:01:00:00:14:00
  Refcount: 4
  Prefixes:
    50.1.1.41/32
    50.1.1.42/32
    60.1.1.43/32
    60.1.1.44/32
cumulus@leaf01:~$
   
    
</code></pre>

<h3 id="displaying-the-vrf-routing-table-in-frr">Displaying the VRF Routing Table in FRR</h3>

<p>You can examine the VRF routing table by running <code>net show route vrf
&lt;vrf-name&gt;</code>. This command is not specific to EVPN. In the context of
EVPN, this command is relevant when symmetric routing is deployed and
can be used to verify that remote host and prefix routes are installed
in the VRF routing table and point to the appropriate gateway next hop:</p>

<pre><code>                   
cumulus@leaf01:~$ net show route vrf vrf1
show ip route vrf vrf1 
=======================
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, P - PIM, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel,
       &gt; - selected route, * - FIB route
 
VRF vrf1:
K * 0.0.0.0/0 [255/8192] unreachable (ICMP unreachable), 1d02h42m
C * 50.1.1.0/24 is directly connected, vlan100-v0, 1d02h42m
C&gt;* 50.1.1.0/24 is directly connected, vlan100, 1d02h42m
B&gt;* 50.1.1.21/32 [20/0] via 110.0.0.2, vlan4001 onlink, 1d02h41m
B&gt;* 50.1.1.22/32 [20/0] via 110.0.0.2, vlan4001 onlink, 1d02h41m
B&gt;* 50.1.1.31/32 [20/0] via 110.0.0.3, vlan4001 onlink, 1d02h41m
B&gt;* 50.1.1.32/32 [20/0] via 110.0.0.3, vlan4001 onlink, 1d02h41m
B&gt;* 50.1.1.41/32 [20/0] via 110.0.0.4, vlan4001 onlink, 1d02h41m
...
   
    
</code></pre>

<p>As you can see in the output above, the next hops for these routes are
specified by EVPN to be <em>onlink</em>, or reachable over the specified SVI.
This is necessary because this interface is not required to have an IP
address, and even if it is configured with an IP address, the next hop
would not be on the same subnet as it is usually the remote VTEP&rsquo;s IP
address, and hence, part of the underlay IP network.</p>

<h3 id="displaying-the-global-bgp-evpn-routing-table">Displaying the Global BGP EVPN Routing Table</h3>

<p>Run the <code>net show bgp l2vpn evpn route</code> command to display all EVPN
routes, both local and remote. The routes displayed here are based on RD
as they are across VNIs and VRFs:</p>

<pre><code>                   
cumulus@leaf01:~$ net show bgp l2vpn evpn route 
BGP table version is 0, local router ID is 110.0.0.1
Status codes: s suppressed, d damped, h history, * valid, &gt; best, i - internal
Origin codes: i - IGP, e - EGP, ? - incomplete
EVPN type-2 prefix: [2]:[ESI]:[EthTag]:[MAClen]:[MAC]
EVPN type-3 prefix: [3]:[EthTag]:[IPlen]:[OrigIP]
   Network          Next Hop            Metric LocPrf Weight Path
Route Distinguisher: 110.0.0.1:1
*&gt; [2]:[0]:[0]:[48]:[00:02:00:00:00:01]
                    110.0.0.1                          32768 i
*&gt; [2]:[0]:[0]:[48]:[00:02:00:00:00:01]:[32]:[50.1.1.11]
                    110.0.0.1                          32768 i
*&gt; [2]:[0]:[0]:[48]:[00:02:00:00:00:01]:[128]:[2001:50:1:1::11]
                    110.0.0.1                          32768 i
*&gt; [2]:[0]:[0]:[48]:[00:02:00:00:00:02]
                    110.0.0.1                          32768 i
*&gt; [2]:[0]:[0]:[48]:[00:02:00:00:00:02]:[32]:[50.1.1.12]
                    110.0.0.1                          32768 i
*&gt; [3]:[0]:[32]:[110.0.0.1]
                    110.0.0.1                          32768 i
Route Distinguisher: 110.0.0.1:2
*&gt; [2]:[0]:[0]:[48]:[00:02:00:00:00:01]
                    110.0.0.1                          32768 i
*&gt; [2]:[0]:[0]:[48]:[00:02:00:00:00:01]:[32]:[60.1.1.11]
                    110.0.0.1                          32768 i
*&gt; [2]:[0]:[0]:[48]:[00:02:00:00:00:02]
                    110.0.0.1                          32768 i
*&gt; [2]:[0]:[0]:[48]:[00:02:00:00:00:02]:[32]:[60.1.1.12]
                    110.0.0.1                          32768 i
*&gt; [3]:[0]:[32]:[110.0.0.1]
                    110.0.0.1                          32768 i
...
   
    
</code></pre>

<p>The routing table can be filtered based on EVPN route type. The
available options are as shown below:</p>

<pre><code>                   
cumulus@leaf01:~$ net show bgp l2vpn evpn route type 
    macip      :  MAC-IP (Type-2) route
    multicast  :  Multicast
    prefix     :  An IPv4 or IPv6 prefix
cumulus@leaf01:~$
   
    
</code></pre>

<h3 id="displaying-a-specific-evpn-route">Displaying a Specific EVPN Route</h3>

<p>To drill down on a specific route for more information, run the <code>net
show bgp l2vpn evpn route rd &lt;rd-value&gt;</code> command. This displays all EVPN
routes with that RD and with the path attribute details for each path.
Additional filtering is possible based on route type or by specifying
the MAC and/or IP address. The following example shows a specific MAC/IP
route. The output shows that this remote host is behind VTEP 110.0.0.4
and is reachable via two paths — one through either spine switch. This
example is from a symmetric routing deployment, so the route shows both
the L2-VNI (10200) and the L3-VNI (104001) as well as the EVPN route
target attributes corresponding to each and the associated router MAC
address.</p>

<pre><code>                   
cumulus@leaf01:~$ net show bgp l2vpn evpn route rd 110.0.0.4:3 mac 00:02:00:00:00:10 ip 60.1.1.44
BGP routing table entry for 110.0.0.4:3:[2]:[0]:[0]:[48]:[00:02:00:00:00:10]:[32]:[60.1.1.44]
Paths: (2 available, best #2)
  Advertised to non peer-group peers:
  s1(swp1) s2(swp2)
  Route [2]:[0]:[0]:[48]:[00:02:00:00:00:10]:[32]:[60.1.1.44] VNI 10200/104001
  65100 65004
    110.0.0.4 from s2(swp2) (20.0.0.2)
      Origin IGP, localpref 100, valid, external
      Extended Community: RT:65004:10200 RT:65004:104001 ET:8 Rmac:00:01:00:00:14:00
      AddPath ID: RX 0, TX 97
      Last update: Sun Dec 17 20:57:24 2017
  Route [2]:[0]:[0]:[48]:[00:02:00:00:00:10]:[32]:[60.1.1.44] VNI 10200/104001
  65100 65004
    110.0.0.4 from s1(swp1) (20.0.0.1)
      Origin IGP, localpref 100, valid, external, bestpath-from-AS 65100, best
      Extended Community: RT:65004:10200 RT:65004:104001 ET:8 Rmac:00:01:00:00:14:00
      AddPath ID: RX 0, TX 71
      Last update: Sun Dec 17 20:57:23 2017
 
Displayed 2 paths for requested prefix
cumulus@leaf01:~$
   
    
</code></pre>


<div class="notices note" > <ul>
<li><p>Only global VNIs are supported. So even though VNI values are
exchanged in the type-2 and type-5 routes, the received values are
not used when installing the routes into the forwarding plane; the
local configuration is used. You must ensure that the VLAN to VNI
mappings and the L3-VNI assignment for a tenant VRF are uniform
throughout the network.</p></li>

<li><p>If the remote host is dual attached, the next hop for the EVPN route
is the anycast IP address of the remote
<a href="/version2/cumulus-linux-35/Layer_1_and_2/Multi-Chassis_Link_Aggregation_-_MLAG">MLAG</a>
pair, when MLAG is active.</p></li>
</ul>
 </div>


<p>The following example shows a prefix (type-5) route. Such a route has
only the L3-VNI and the route target corresponding to this VNI. This
route is learned via two paths, one through each spine switch.</p>

<pre><code>                   
cumulus@leaf01:~$ net show bgp l2vpn evpn route rd 144.1.1.2:3 type prefix
EVPN type-2 prefix: [2]:[ESI]:[EthTag]:[MAClen]:[MAC]
EVPN type-3 prefix: [3]:[EthTag]:[IPlen]:[OrigIP]
EVPN type-5 prefix: [5]:[EthTag]:[IPlen]:[IP]
BGP routing table entry for 144.1.1.2:3:[5]:[0]:[30]:[144.1.1.0]
Paths: (2 available, best #2)
  Advertised to non peer-group peers:
  s1(swp1) s2(swp2)
  Route [5]:[0]:[30]:[144.1.1.0] VNI 104001
  65100 65050
    110.0.0.5 from s2(swp2) (20.0.0.2)
      Origin incomplete, localpref 100, valid, external
      Extended Community: RT:65050:104001 ET:8 Rmac:00:01:00:00:01:00
      AddPath ID: RX 0, TX 112
      Last update: Tue Dec 19 00:12:18 2017
  Route [5]:[0]:[30]:[144.1.1.0] VNI 104001
  65100 65050
    110.0.0.5 from s1(swp1) (20.0.0.1)
      Origin incomplete, localpref 100, valid, external, bestpath-from-AS 65100, best
      Extended Community: RT:65050:104001 ET:8 Rmac:00:01:00:00:01:00
      AddPath ID: RX 0, TX 71
      Last update: Tue Dec 19 00:12:17 2017
 
Displayed 1 prefixes (2 paths) with this RD (of requested type)
cumulus@leaf01:~$
   
    
</code></pre>

<h3 id="displaying-the-per-vni-evpn-routing-table">Displaying the per-VNI EVPN Routing Table</h3>

<p>Received EVPN routes are maintained in the global EVPN routing table
(described above), even if there are no appropriate local VNIs to
<strong>import</strong> them into. For example, a spine switch maintains the global
EVPN routing table even though there are no VNIs present on it. When
local VNIs are present, received EVPN routes are imported into the
per-VNI routing tables based on the route target attributes. The per-VNI
routing table can be examined using the <code>net show bgp l2vpn evpn route
vni &lt;vni&gt;</code> command:</p>

<pre><code>                   
cumulus@leaf01:~$ net show bgp l2vpn evpn route vni 10110
BGP table version is 8, local router ID is 110.0.0.1
Status codes: s suppressed, d damped, h history, * valid, &gt; best, i - internal
Origin codes: i - IGP, e - EGP, ? - incomplete
EVPN type-2 prefix: [2]:[ESI]:[EthTag]:[MAClen]:[MAC]:[IPlen]:[IP]
EVPN type-3 prefix: [3]:[EthTag]:[IPlen]:[OrigIP]
   Network          Next Hop            Metric LocPrf Weight Path
*&gt; [2]:[0]:[0]:[48]:[00:02:00:00:00:07]
                    110.0.0.1                          32768 i
*&gt; [2]:[0]:[0]:[48]:[00:02:00:00:00:07]:[32]:[50.1.1.11]
                    110.0.0.1                          32768 i
*&gt; [2]:[0]:[0]:[48]:[00:02:00:00:00:07]:[128]:[fe80::202:ff:fe00:7]
                    110.0.0.1                          32768 i
*&gt; [2]:[0]:[0]:[48]:[00:02:00:00:00:08]
                    110.0.0.1                          32768 i
*&gt; [2]:[0]:[0]:[48]:[00:02:00:00:00:08]:[32]:[50.1.1.12]
                    110.0.0.1                          32768 i
*&gt; [2]:[0]:[0]:[48]:[00:02:00:00:00:08]:[128]:[fe80::202:ff:fe00:8]
                    110.0.0.1                          32768 i
*&gt; [3]:[0]:[32]:[110.0.0.1]
                    110.0.0.1                          32768 i
Displayed 7 prefixes (7 paths)
cumulus@leaf01:~$
   
    
</code></pre>

<p>To display the VNI routing table for all VNIs, run <code>net show bgp l2vpn
evpn route vni all.</code></p>

<h3 id="displaying-the-per-vrf-bgp-routing-table">Displaying the per-VRF BGP Routing Table</h3>

<p>When symmetric routing is deployed, received type-2 and type-5 routes
are imported into the VRF routing table (against the corresponding
address-family: IPv4 unicast or IPv6 unicast) based on a match on the
route target attributes. You can examine BGP&rsquo;s VRF routing table using
<code>net show bgp vrf &lt;vrf-name&gt; ipv4 unicast</code> (or <code>net show bgp vrf
&lt;vrf-name&gt; ipv6 unicast</code>):</p>

<pre><code>                   
cumulus@leaf01:~$ net show bgp vrf vrf1 ipv4 unicast 
BGP table version is 8, local router ID is 50.1.1.250
Status codes: s suppressed, d damped, h history, * valid, &gt; best, = multipath,
              i internal, r RIB-failure, S Stale, R Removed
Origin codes: i - IGP, e - EGP, ? - incomplete
   Network          Next Hop            Metric LocPrf Weight Path
*  50.1.2.21/32     110.0.0.2                              0 65100 65002 i
*&gt;                  110.0.0.2                              0 65100 65002 i
*  50.1.2.22/32     110.0.0.2                              0 65100 65002 i
*&gt;                  110.0.0.2                              0 65100 65002 i
*  50.1.3.31/32     110.0.0.3                              0 65100 65003 i
*&gt;                  110.0.0.3                              0 65100 65003 i
*  50.1.3.32/32     110.0.0.3                              0 65100 65003 i
*&gt;                  110.0.0.3                              0 65100 65003 i
*  50.1.4.41/32     110.0.0.4                              0 65100 65004 i
*&gt;                  110.0.0.4                              0 65100 65004 i
*  50.1.4.42/32     110.0.0.4                              0 65100 65004 i
*&gt;                  110.0.0.4                              0 65100 65004 i
*  144.1.1.0/30     110.0.0.5                              0 65100 65050 ?
*&gt;                  110.0.0.5                              0 65100 65050 ?
*  144.2.1.0/30     110.0.0.6                              0 65100 65050 ?
*&gt;                  110.0.0.6                              0 65100 65050 ?
Displayed  8 routes and 16 total paths
cumulus@leaf01:~$
   
    
</code></pre>

<h3 id="examining-mac-moves">Examining MAC Moves</h3>

<p>The first time a MAC moves from behind one VTEP to behind another, BGP
associates a MAC Mobility (MM) extended community attribute of sequence
number 1, with the type-2 route for that MAC. From there, each time this
MAC moves to a new VTEP, the MM sequence number increments by 1. You can
examine the MM sequence number associated with a MAC&rsquo;s type-2 route
using <code>net show bgp evpn route vni &lt;vni&gt; mac &lt;mac&gt;</code>. The sample output
below shows the type-2 route for a MAC that has moved three times:</p>

<pre><code>                   
cumulus@switch:~$ net show bgp evpn route vni 10109 mac 00:02:22:22:22:02
BGP routing table entry for [2]:[0]:[0]:[48]:[00:02:22:22:22:02]
Paths: (1 available, best #1)
Not advertised to any peer
Route [2]:[0]:[0]:[48]:[00:02:22:22:22:02] VNI 10109
Local
6.0.0.184 from 0.0.0.0 (6.0.0.184)
Origin IGP, localpref 100, weight 32768, valid, sourced, local, bestpath-from-AS Local, best
Extended Community: RT:650184:10109 ET:8 MM:3
AddPath ID: RX 0, TX 10350121
Last update: Tue Feb 14 18:40:37 2017
 
Displayed 1 paths for requested prefix
   
    
</code></pre>

<h3 id="examining-sticky-mac-addresses">Examining Sticky MAC Addresses</h3>

<p>You can identify static or &ldquo;sticky&rdquo; MACs in EVPN by the presence of
&ldquo;MM:0, sticky MAC&rdquo; in the Extended Community line of the output from
<code>net show bgp evpn route vni &lt;vni&gt; mac &lt;mac&gt;:</code></p>

<pre><code>                   
cumulus@switch:~$ net show bgp evpn route vni 10101 mac 00:02:00:00:00:01
BGP routing table entry for [2]:[0]:[0]:[48]:[00:02:00:00:00:01]
Paths: (1 available, best #1)
  Not advertised to any peer
  Route [2]:[0]:[0]:[48]:[00:02:00:00:00:01] VNI 10101
  Local
    6.0.0.18 from 0.0.0.0 (6.0.0.18)
      Origin IGP, localpref 100, weight 32768, valid, sourced, local, bestpath-from-AS Local, best
      Extended Community: ET:8 RT:60176:10101 MM:0, sticky MAC
      AddPath ID: RX 0, TX 46
      Last update: Tue Apr 11 21:44:02 2017
 
Displayed 1 paths for requested prefix
   
    
</code></pre>

<h2 id="troubleshooting-evpn">Troubleshooting EVPN</h2>

<p>The primary way to troubleshoot EVPN is by enabling FRR debug logs. The
relevant debug options are:</p>

<ul>
<li><p><code>debug zebra vxlan</code> — which traces VNI addition and deletion (local
and remote) as well as MAC and neighbor addition and deletion (local
and remote).</p></li>

<li><p><code>debug zebra kernel</code> — which traces actual netlink messages
exchanged with the kernel, which includes everything, not just EVPN.</p></li>

<li><p><code>debug bgp updates</code> — which traces BGP update exchanges, including
all updates. Output is extended to show EVPN specific information.</p></li>

<li><p><code>debug bgp zebra</code> — which traces interactions between BGP and zebra
for EVPN (and other) routes.</p></li>
</ul>

<h2 id="caveats">Caveats</h2>

<p>The following caveats apply to EVPN in this version of Cumulus Linux:</p>

<ul>
<li><p>When EVPN is enabled on a switch (VTEP), all locally defined VNIs on
that switch and other information (such as MAC addresses) pertaining
to them will be advertised to EVPN peers. There is no provision to
only announce certain VNIs.</p></li>

<li><p>In a <a href="/version2/cumulus-linux-35/Network_Virtualization/Lightweight_Network_Virtualization_-_LNV_Overview/LNV_VXLAN_Active-Active_Mode">VXLAN
active-active</a>
configuration, ARPs may sometimes not be suppressed even if ARP
suppression is enabled. This is because the neighbor entries are not
synced between the two switches operating in active-active mode by a
control plane. This has no impact on forwarding.</p></li>

<li><p>Symmetric routing and prefix-based routing are only supported for
IPv4 hosts and IPv4 prefixes; IPv6 routing is currently supported
with asymmetric routing only.</p></li>

<li><p>Currently, only switches with the Mellanox Spectrum chipset or the
Broadcom Tomahawk chipset can be deployed as a border/exit leaf. If
you want to use a Broadcom Trident II+ switch as a border/exit leaf,
please <a href="https://support.cumulusnetworks.com/hc/en-us/articles/115015543848#rn766" target="_blank">read release
note 766</a>
for a necessary workaround; the workaround only applies to Trident
II+ switches, not Tomahawk or Spectrum.</p></li>

<li><p>The overlay (tenants) need to be configured in a specific VRF(s) and
separated from the underlay, which resides in the default VRF. An
L3-VNI mapping for the default VRF is not supported.</p></li>
</ul>

<h2 id="example-configuration">Example Configuration</h2>

<h3 id="example-configuration-for-evpn-for-bridging">Example Configuration for EVPN for Bridging</h3>

<p>The following configurations are used throughout this chapter. You can
find the flat-file configurations for the network devices in the Cumulus
Networks <a href="https://github.com/CumulusNetworks/cldemo-evpn/tree/master/config" target="_blank">GitHub
repository</a>.
Only a subset is shown here for brevity (not shown are configurations
for leaf03, leaf04, server03, server04). Here is the topology diagram:</p>








<img class = "confluence-embedded-image confluence-external-resource" src = "/images/raw.githubusercontent.com/CumulusNetworks/cldemo-evpn/master/images/evpn.png" alt = "/images/raw.githubusercontent.com/CumulusNetworks/cldemo-evpn/master/images/evpn.png"

height = 400


 />


<h4 id="leaf01-and-leaf02-configurations">leaf01 and leaf02 Configurations</h4>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><details>
<summary>leaf01 /etc/network/interfaces </summary>
<pre><code>                   
auto lo
iface lo inet loopback
    address 10.0.0.11/32
 
auto eth0
iface eth0 inet dhcp
 
# uplinks
auto swp51
iface swp51
 
auto swp52
iface swp52
 
auto bridge
iface bridge
    bridge-ports swp1 vxlan10001 vxlan10100 vxlan10200
    bridge-vlan-aware yes
    bridge-vids 1 100 200
    bridge-pvid 1
 
auto vxlan10001
iface vxlan10001
    vxlan-id 10001
    vxlan-local-tunnelip 10.0.0.11
    bridge-access 1
    bridge-learning off
 
auto vxlan10100
iface vxlan10100
     vxlan-id 10100
     vxlan-local-tunnelip 10.0.0.11
     bridge-access 100
     bridge-learning off
 
auto vxlan10200
iface vxlan10200
     vxlan-id 10200
     vxlan-local-tunnelip 10.0.0.11
     bridge-access 200
     bridge-learning off
   
    </code></pre>
</details></td>
<td><details>
<summary>leaf02 /etc/network/interfaces </summary>
<pre><code>                   
auto lo
iface lo inet loopback
    address 10.0.0.12/32
 
auto eth0
iface eth0 inet dhcp
 
# uplinks
auto swp51
iface swp51
 
auto swp52
iface swp52
 
auto bridge
iface bridge
    bridge-ports swp2 vxlan10001 vxlan10100 vxlan10200
    bridge-vlan-aware yes
    bridge-vids 1 100 200
    bridge-pvid 1
 
auto vxlan10001
iface vxlan10001
    vxlan-id 10001
    vxlan-local-tunnelip 10.0.0.12
    bridge-access 1
    bridge-learning off
 
auto vxlan10100
iface vxlan10100
    vxlan-id 10100
    vxlan-local-tunnelip 10.0.0.12
    bridge-access 100
    bridge-learning off
 
auto vxlan10200
iface vxlan10200
    vxlan-id 10200
    vxlan-local-tunnelip 10.0.0.12
    bridge-access 200
    bridge-learning off
   
    </code></pre>
</details></td>
</tr>
<tr class="even">
<td><details>
<summary>leaf01 /etc/frr/frr.conf </summary>
<pre><code>                   
!
interface swp51
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface swp52
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
router bgp 65011
 bgp router-id 10.0.0.11
 bgp bestpath as-path multipath-relax
 neighbor fabric peer-group
 neighbor fabric remote-as external
 neighbor fabric description Internal Fabric Network
 neighbor fabric capability extended-nexthop
 neighbor swp51 interface peer-group fabric
 neighbor swp52 interface peer-group fabric
 !
 address-family ipv4 unicast
  network 10.0.0.11/32
  neighbor fabric prefix-list dc-leaf-in in
  neighbor fabric prefix-list dc-leaf-out out
 exit-address-family
 !
!
 address-family ipv6 unicast
  neighbor fabric activate
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor fabric activate
  advertise-all-vni
 exit-address-family
 exit
!
ip prefix-list dc-leaf-in seq 10 permit 0.0.0.0/0
ip prefix-list dc-leaf-in seq 20 permit 10.0.0.0/24 le 32
ip prefix-list dc-leaf-in seq 500 deny any
ip prefix-list dc-leaf-out seq 20 permit 10.0.0.0/24 le 32
ip prefix-list dc-leaf-out seq 500 deny any
!
line vty
!
end
   
    </code></pre>
</details></td>
<td><details>
<summary>leaf02 /etc/frr/frr.conf </summary>
<pre><code>                   
!
interface swp51
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface swp52
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
router bgp 65012
 bgp router-id 10.0.0.12
 bgp bestpath as-path multipath-relax
 neighbor fabric peer-group
 neighbor fabric remote-as external
 neighbor fabric description Internal Fabric Network
 neighbor fabric capability extended-nexthop
 neighbor swp51 interface peer-group fabric
 neighbor swp52 interface peer-group fabric
 !
 address-family ipv4 unicast
  network 10.0.0.12/32
  neighbor fabric prefix-list dc-leaf-in in
  neighbor fabric prefix-list dc-leaf-out out
 exit-address-family
 !
!
 address-family ipv6 unicast
  neighbor fabric activate
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor fabric activate
  advertise-all-vni
 exit-address-family
 exit
!
ip prefix-list dc-leaf-in seq 10 permit 0.0.0.0/0
ip prefix-list dc-leaf-in seq 20 permit 10.0.0.0/24 le 32
ip prefix-list dc-leaf-in seq 500 deny any
ip prefix-list dc-leaf-out seq 20 permit 10.0.0.0/24 le 32
ip prefix-list dc-leaf-out seq 500 deny any
!
line vty
!
end
   
    </code></pre>
</details></td>
</tr>
</tbody>
</table>

<h4 id="spine01-and-spine02-configurations">spine01 and spine02 Configurations</h4>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><details>
<summary>spine01 /etc/network/interfaces </summary>
<pre><code>                   
auto lo
iface lo inet loopback
    address 10.0.0.21/32
 
auto eth0
iface eth0 inet dhcp
 
# downlinks
auto swp1
iface swp1
 
auto swp2
iface swp2
 
auto swp3
iface swp3
 
auto swp4
iface swp4
   
    </code></pre>
</details></td>
<td><details>
<summary>spine02 /etc/network/interfaces </summary>
<pre><code>                   
auto lo
iface lo inet loopback
    address 10.0.0.22/32
 
auto eth0
iface eth0 inet dhcp
 
# downlinks
auto swp1
iface swp1
 
auto swp2
iface swp2
 
auto swp3
iface swp3
 
auto swp4
iface swp4
   
    </code></pre>
</details></td>
</tr>
<tr class="even">
<td><details>
<summary>spine01 /etc/frr/frr.conf </summary>
<pre><code>                   
!
interface swp1
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface swp2
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface swp3
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface swp4
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
router bgp 65020
 bgp router-id 10.0.0.21
 bgp bestpath as-path multipath-relax
 neighbor fabric peer-group
 neighbor fabric remote-as external
 neighbor fabric description Internal Fabric Network
 neighbor fabric capability extended-nexthop
 neighbor swp1 interface peer-group fabric
 neighbor swp2 interface peer-group fabric
 neighbor swp3 interface peer-group fabric
 neighbor swp4 interface peer-group fabric
 !
 address-family ipv4 unicast
  network 10.0.0.21/32
  neighbor fabric prefix-list dc-spine in
  neighbor fabric prefix-list dc-spine out
 exit-address-family
 !
!
 address-family ipv6 unicast
  neighbor fabric activate
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor fabric activate
 exit-address-family
 exit
!
ip prefix-list dc-spine seq 10 permit 0.0.0.0/0
ip prefix-list dc-spine seq 20 permit 10.0.0.0/24 le 32
ip prefix-list dc-spine seq 500 deny any
!
line vty
!
end
   
    </code></pre>
</details></td>
<td><details>
<summary>spine02 /etc/frr/frr.conf </summary>
<pre><code>                   
!
interface swp1
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface swp2
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface swp3
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface swp4
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
router bgp 65020
 bgp router-id 10.0.0.22
 bgp bestpath as-path multipath-relax
 neighbor fabric peer-group
 neighbor fabric remote-as external
 neighbor fabric description Internal Fabric Network
 neighbor fabric capability extended-nexthop
 neighbor swp1 interface peer-group fabric
 neighbor swp2 interface peer-group fabric
 neighbor swp3 interface peer-group fabric
 neighbor swp4 interface peer-group fabric
 !
 address-family ipv4 unicast
  network 10.0.0.22/32
  neighbor fabric prefix-list dc-spine in
  neighbor fabric prefix-list dc-spine out
 exit-address-family
 !
!
 address-family ipv6 unicast
  neighbor fabric activate
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor fabric activate
 exit-address-family
 exit
!
ip prefix-list dc-spine seq 10 permit 0.0.0.0/0
ip prefix-list dc-spine seq 20 permit 10.0.0.0/24 le 32
ip prefix-list dc-spine seq 500 deny any
!
line vty
!
end
   
    </code></pre>
</details></td>
</tr>
</tbody>
</table>

<h4 id="server01-and-server02-configurations">server01 and server02 Configurations</h4>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><pre><code>                    server01 /etc/network/interfaces
                   
#configuration is for Cumulus VX
#in real life this is a server OS
 
auto eth0
iface eth0 inet dhcp
 
auto eth1
iface eth1
    address 172.16.1.101/24
 
auto eth1.100
iface eth1.100
    address 172.16.100.101/24
 
auto eth1.200
iface eth1.200
    address 172.16.200.101/24
   
    </code></pre></td>
<td><pre><code>                    server02 /etc/network/interfaces
                   
#configuration is for Cumulus VX
#in real life this is a server OS
 
auto eth0
iface eth0 inet dhcp
 
auto eth2
iface eth2
    address 172.16.1.102/24
 
auto eth2.100
iface eth2.100
    address 172.16.100.102/24
 
auto eth2.200
iface eth2.200
    address 172.16.200.102/24
   
    </code></pre></td>
</tr>
</tbody>
</table>

<h3 id="example-active-active-configuration">Example Active-active Configuration</h3>

<p>The following configurations demonstrate a dual-attached
(<a href="/version2/cumulus-linux-35/Layer_1_and_2/Multi-Chassis_Link_Aggregation_-_MLAG">MLAG</a>)
EVPN scenario. You can find the flat-file configurations for the network
devices in the Cumulus Networks <a href="https://github.com/CumulusNetworks/cldemo-evpn/" target="_blank">GitHub
repository</a>. Only a
subset is shown here for brevity (not shown are configurations for
leaf03, leaf04, server02, server04). Here is the topology diagram:</p>








<img class = "confluence-embedded-image confluence-external-resource" src = "/images/raw.githubusercontent.com/CumulusNetworks/cldemo-evpn/master/images/mlag.png" alt = "/images/raw.githubusercontent.com/CumulusNetworks/cldemo-evpn/master/images/mlag.png"

height = 400


 />


<h4 id="leaf01-and-leaf02-configurations-1">leaf01 and leaf02 Configurations</h4>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><details>
<summary>leaf01 /etc/network/interfaces </summary>
<pre><code>                   
cumulus@leaf01:~$ cat /etc/network/interfaces
 
auto lo
iface lo inet loopback
    alias loopback
    address 10.0.0.11/32
    clagd-vxlan-anycast-ip 10.10.10.20
 
auto eth0
iface eth0 inet dhcp
 
# uplinks
auto swp51
iface swp51
 
auto swp52
iface swp52
 
#host connections
auto swp1
iface swp1
 
auto server01
iface server01
  alias server01 MLAG bond
  bond-slaves swp1
  clag-id 1
 
auto peerlink
iface peerlink
  alias MLAG peerlink bond
  bond-slaves swp49 swp50
 
auto peerlink.4094
iface peerlink.4094
  address 169.254.1.1/30
  clagd-peer-ip 169.254.1.2
  clagd-backup-ip 192.168.200.12
  clagd-sys-mac 44:38:39:FF:40:94
 
auto bridge
iface bridge
    bridge-ports server01 peerlink vxlan10001 vxlan10100 vxlan10200
    bridge-vlan-aware yes
    bridge-vids 1 100 200
    bridge-pvid 1
 
auto vxlan10001
iface vxlan10001
    vxlan-id 10001
    vxlan-local-tunnelip 10.0.0.11
    bridge-access 1
    bridge-learning off
 
auto vxlan10100
iface vxlan10100
     vxlan-id 10100
     vxlan-local-tunnelip 10.0.0.11
     bridge-access 100
     bridge-learning off
 
auto vxlan10200
iface vxlan10200
     vxlan-id 10200
     vxlan-local-tunnelip 10.0.0.11
     bridge-access 200
     bridge-learning off
   
    </code></pre>
</details></td>
<td><details>
<summary>leaf02 /etc/network/interfaces </summary>
<pre><code>                   
cumulus@leaf02:~$ cat /etc/network/interfaces
 
auto lo
iface lo inet loopback
    alias loopback
    address 10.0.0.12/32
    clagd-vxlan-anycast-ip 10.10.10.20
 
auto eth0
iface eth0 inet dhcp
 
# uplinks
auto swp51
iface swp51
 
auto swp52
iface swp52
 
#host connections
auto swp1
iface swp1
 
auto server01
iface server01
  alias server01 MLAG bond
  bond-slaves swp1
  clag-id 1
 
auto peerlink
iface peerlink
  alias MLAG peerlink bond
  bond-slaves swp49 swp50
 
auto peerlink.4094
iface peerlink.4094
  address 169.254.1.2/30
  clagd-peer-ip 169.254.1.1
  clagd-backup-ip 192.168.200.11
  clagd-sys-mac 44:38:39:FF:40:94
 
auto bridge
iface bridge
    bridge-ports server01 peerlink vxlan10001 vxlan10100 vxlan10200
    bridge-vlan-aware yes
    bridge-vids 1 100 200
    bridge-pvid 1
 
auto vxlan10001
iface vxlan10001
    vxlan-id 10001
    vxlan-local-tunnelip 10.0.0.12
    bridge-access 1
    bridge-learning off
 
auto vxlan10100
iface vxlan10100
     vxlan-id 10100
     vxlan-local-tunnelip 10.0.0.12
     bridge-access 100
     bridge-learning off
 
auto vxlan10200
iface vxlan10200
     vxlan-id 10200
     vxlan-local-tunnelip 10.0.0.12
     bridge-access 200
     bridge-learning off
   
    </code></pre>
</details></td>
</tr>
<tr class="even">
<td><details>
<summary>leaf01 /etc/frr/frr.conf </summary>
<pre><code>                   
cumulus@leaf01:~$ cat /etc/frr/frr.conf 
!
username cumulus nopassword
!
log syslog
!
interface swp51
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface swp52
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
router bgp 65011
 bgp router-id 10.0.0.11
 bgp bestpath as-path multipath-relax
 neighbor FABRIC peer-group
 neighbor FABRIC remote-as external
 neighbor FABRIC description Internal FABRIC Network
 neighbor FABRIC capability extended-nexthop
 neighbor swp51 interface peer-group FABRIC
 neighbor swp52 interface peer-group FABRIC
 !
 address-family ipv4 unicast
  network 10.0.0.11/32
  network 10.10.10.20/32
 exit-address-family
 !
!
 address-family ipv6 unicast
  neighbor FABRIC activate
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor FABRIC activate
  advertise-all-vni
 exit-address-family
 exit
!
line vty
!
end
   
    </code></pre>
</details></td>
<td><details>
<summary>leaf02 /etc/frr/frr.conf </summary>
<pre><code>                   
cumulus@leaf02:~$ cat /etc/frr/frr.conf 
!
username cumulus nopassword
!
log syslog
!
interface swp51
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface swp52
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
router bgp 65012
 bgp router-id 10.0.0.12
 bgp bestpath as-path multipath-relax
 neighbor FABRIC peer-group
 neighbor FABRIC remote-as external
 neighbor FABRIC description Internal FABRIC Network
 neighbor FABRIC capability extended-nexthop
 neighbor swp51 interface peer-group FABRIC
 neighbor swp52 interface peer-group FABRIC
 !
 address-family ipv4 unicast
  network 10.0.0.12/32
  network 10.10.10.20/32
 exit-address-family
 !
!
 address-family ipv6 unicast
  neighbor FABRIC activate
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor FABRIC activate
  advertise-all-vni
 exit-address-family
 exit
!
line vty
!
end
   
    </code></pre>
</details></td>
</tr>
</tbody>
</table>

<h4 id="spine01-and-spine02-configurations-1">spine01 and spine02 Configurations</h4>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><pre><code>                    spine01 /etc/network/interfaces
                   
cumulus@spine01:~$ cat /etc/network/interfaces
auto lo
iface lo inet loopback
    address 10.0.0.21/32
 
auto eth0
iface eth0 inet dhcp
 
# downlinks
auto swp1
iface swp1
 
auto swp2
iface swp2
 
auto swp3
iface swp3
 
auto swp4
iface swp4
   
    </code></pre></td>
<td><pre><code>                    spine02 /etc/network/interfaces
                   
cumulus@spine01:~$ cat /etc/network/interfaces
auto lo
iface lo inet loopback
    address 10.0.0.22/32
 
auto eth0
iface eth0 inet dhcp
 
# downlinks
auto swp1
iface swp1
 
auto swp2
iface swp2
 
auto swp3
iface swp3
 
auto swp4
iface swp4
   
    </code></pre></td>
</tr>
<tr class="even">
<td><details>
<summary>spine01 /etc/frr/frr.conf </summary>
<pre><code>                   
cumulus@spine01:~$ cat /etc/frr/frr.conf 
!
username cumulus nopassword
!
log syslog
!
interface swp1
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface swp2
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface swp3
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface swp4
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
router bgp 65020
 bgp router-id 10.0.0.21
 bgp bestpath as-path multipath-relax
 neighbor fabric peer-group
 neighbor fabric remote-as external
 neighbor fabric description Internal Fabric Network
 neighbor fabric capability extended-nexthop
 neighbor swp1 interface peer-group fabric
 neighbor swp2 interface peer-group fabric
 neighbor swp3 interface peer-group fabric
 neighbor swp4 interface peer-group fabric
 !
 address-family ipv4 unicast
  network 10.0.0.21/32
 exit-address-family
 !
!
 address-family ipv6 unicast
  neighbor fabric activate
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor fabric activate
 exit-address-family
 exit
!
line vty
!
end
   
    </code></pre>
</details></td>
<td><details>
<summary>spine02 /etc/frr/frr.conf </summary>
<pre><code>                   
cumulus@spine02:~$ cat /etc/frr/frr.conf 
!
username cumulus nopassword
!
log syslog
!
interface swp1
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface swp2
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface swp3
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface swp4
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
router bgp 65020
 bgp router-id 10.0.0.22
 bgp bestpath as-path multipath-relax
 neighbor fabric peer-group
 neighbor fabric remote-as external
 neighbor fabric description Internal Fabric Network
 neighbor fabric capability extended-nexthop
 neighbor swp1 interface peer-group fabric
 neighbor swp2 interface peer-group fabric
 neighbor swp3 interface peer-group fabric
 neighbor swp4 interface peer-group fabric
 !
 address-family ipv4 unicast
  network 10.0.0.22/32
 exit-address-family
 !
!
 address-family ipv6 unicast
  neighbor fabric activate
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor fabric activate
 exit-address-family
 exit
!
line vty
!
end
   
    </code></pre>
</details></td>
</tr>
</tbody>
</table>

<h4 id="server01-and-server03-configurations">server01 and server03 Configurations</h4>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><pre><code>                    server01 /etc/network/interfaces
                   
cumulus@server01:~$ cat /etc/network/interfaces
 
auto eth0
iface eth0 inet dhcp
 
auto bond0
iface bond0
    bond-slaves eth1 eth2
    address 172.16.1.101/24
 
auto bond0.100
iface bond0.100
    address 172.16.100.101/24
 
auto bond0.200
iface bond0.200
    address 172.16.200.101/24
   
    </code></pre></td>
<td><pre><code>                    server03 /etc/network/interfaces
                   
cumulus@server03:~$ cat /etc/network/interfaces
 
auto eth0
iface eth0 inet dhcp
 
auto bond0
iface bond0
    bond-slaves eth1 eth2
    address 172.16.1.103/24
 
auto bond0.100
iface bond0.100
    address 172.16.100.103/24
 
auto bond0.200
iface bond0.200
    address 172.16.200.103/24
   
    </code></pre></td>
</tr>
</tbody>
</table>

<article id="html-search-results" class="ht-content" style="display: none;">

</article>

<footer id="ht-footer">

</footer>
</article>



    </div>
    

      


  

    <aside class="book-toc fixed">

  

  <button> </button>

      <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#basic-evpn-configuration">Basic EVPN Configuration</a>
<ul>
<li><a href="#enabling-evpn-between-bgp-neighbors">Enabling EVPN between BGP Neighbors</a></li>
<li><a href="#advertising-all-vnis">Advertising All VNIs</a></li>
<li><a href="#auto-derivation-of-rds-and-rts">Auto-derivation of RDs and RTs</a></li>
<li><a href="#user-defined-rds-and-rts">User-defined RDs and RTs</a></li>
<li><a href="#enabling-evpn-in-an-ibgp-environment-with-an-ospf-underlay">Enabling EVPN in an iBGP Environment with an OSPF Underlay</a></li>
<li><a href="#disabling-data-plane-mac-learning-over-vxlan-tunnels">Disabling Data Plane MAC Learning over VXLAN Tunnels</a></li>
<li><a href="#handling-bum-traffic">Handling BUM Traffic</a></li>
</ul></li>
<li><a href="#arp-and-nd-suppression">ARP and ND Suppression</a>
<ul>
<li><a href="#using-uft-profiles-other-than-the-default">Using UFT Profiles Other than the Default</a></li>
</ul></li>
<li><a href="#evpn-and-vxlan-active-active-mode">EVPN and VXLAN Active-Active Mode</a></li>
<li><a href="#inter-subnet-routing">Inter-subnet Routing</a>
<ul>
<li><a href="#centralized-routing">Centralized Routing</a>
<ul>
<li><a href="#advertising-the-default-gateway">Advertising the Default Gateway</a></li>
</ul></li>
<li><a href="#asymmetric-routing">Asymmetric Routing</a></li>
<li><a href="#symmetric-routing">Symmetric Routing</a>
<ul>
<li><a href="#vxlan-interface-corresponding-to-the-l3-vni">VXLAN Interface Corresponding to the L3-VNI</a></li>
<li><a href="#svi-for-the-l3-vni">SVI for the L3-VNI</a></li>
<li><a href="#vrf-to-l3-vni-mapping">VRF to L3-VNI Mapping</a></li>
<li><a href="#advertising-the-locally-attached-subnets">Advertising the Locally-attached Subnets</a></li>
</ul></li>
</ul></li>
<li><a href="#prefix-based-routing-evpn-type-5-routes">Prefix-based Routing — EVPN Type-5 Routes</a>
<ul>
<li><a href="#configuring-the-switch-to-install-evpn-type-5-routes">Configuring the Switch to Install EVPN Type-5 Routes</a></li>
<li><a href="#announcing-evpn-type-5-routes">Announcing EVPN Type-5 Routes</a></li>
</ul></li>
<li><a href="#static-sticky-mac-addresses">Static (Sticky) MAC Addresses</a></li>
<li><a href="#evpn-operational-commands">EVPN Operational Commands</a>
<ul>
<li><a href="#general-linux-commands-related-to-evpn">General Linux Commands Related to EVPN</a></li>
<li><a href="#general-bgp-operational-commands-relevant-to-evpn">General BGP Operational Commands Relevant to EVPN</a></li>
<li><a href="#displaying-evpn-address-family-peers">Displaying EVPN address-family Peers</a></li>
<li><a href="#displaying-vnis-in-evpn">Displaying VNIs in EVPN</a></li>
<li><a href="#examining-local-and-remote-mac-addresses-for-a-vni-in-evpn">Examining Local and Remote MAC Addresses for a VNI in EVPN</a></li>
<li><a href="#examining-local-and-remote-neighbors-for-a-vni-in-evpn">Examining Local and Remote Neighbors for a VNI in EVPN</a></li>
<li><a href="#examining-remote-router-macs-in-evpn">Examining Remote Router MACs in EVPN</a></li>
<li><a href="#examining-gateway-next-hops-in-evpn">Examining Gateway Next Hops in EVPN</a></li>
<li><a href="#displaying-the-vrf-routing-table-in-frr">Displaying the VRF Routing Table in FRR</a></li>
<li><a href="#displaying-the-global-bgp-evpn-routing-table">Displaying the Global BGP EVPN Routing Table</a></li>
<li><a href="#displaying-a-specific-evpn-route">Displaying a Specific EVPN Route</a></li>
<li><a href="#displaying-the-per-vni-evpn-routing-table">Displaying the per-VNI EVPN Routing Table</a></li>
<li><a href="#displaying-the-per-vrf-bgp-routing-table">Displaying the per-VRF BGP Routing Table</a></li>
<li><a href="#examining-mac-moves">Examining MAC Moves</a></li>
<li><a href="#examining-sticky-mac-addresses">Examining Sticky MAC Addresses</a></li>
</ul></li>
<li><a href="#troubleshooting-evpn">Troubleshooting EVPN</a></li>
<li><a href="#caveats">Caveats</a></li>
<li><a href="#example-configuration">Example Configuration</a>
<ul>
<li><a href="#example-configuration-for-evpn-for-bridging">Example Configuration for EVPN for Bridging</a>
<ul>
<li><a href="#leaf01-and-leaf02-configurations">leaf01 and leaf02 Configurations</a></li>
<li><a href="#spine01-and-spine02-configurations">spine01 and spine02 Configurations</a></li>
<li><a href="#server01-and-server02-configurations">server01 and server02 Configurations</a></li>
</ul></li>
<li><a href="#example-active-active-configuration">Example Active-active Configuration</a>
<ul>
<li><a href="#leaf01-and-leaf02-configurations-1">leaf01 and leaf02 Configurations</a></li>
<li><a href="#spine01-and-spine02-configurations-1">spine01 and spine02 Configurations</a></li>
<li><a href="#server01-and-server03-configurations">server01 and server03 Configurations</a></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</nav>

      
      <button>
      <a href="https://github.com/cawleyflower/testDocs/edit/dev/content/version2/cumulus-linux-35/Network_Virtualization/Ethernet_Virtual_Private_Network_-_EVPN.md" target="_blank" rel="noopener">
        <img src="/svg/pencil-circle.svg" alt="Edit" /> Edit this page
      </a>
    </button>
    


    

</aside>





  </main>
  <footer class="footer-top">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <div class="footer-content">
            <div class="mb-4">
                <img src="https://static.cumulusnetworks.com/static/images/shared/cumulus-networks-rt-white-trademarked.ff839f1b2570.svg">
                <p>© <script type="text/javascript">document.write(new Date().getFullYear());</script> Cumulus Networks.<br>
                Site by <a href="//unomena.com/" target="_blank">Unomena</a>.</p>
            </div>
            <ul class="mb-4">
              <li><h4>Products</h4></li>
              <li><a href="//cumulusnetworks.com/products/cumulus-linux/">Cumulus Linux</a></li>
              <li><a href="//cumulusnetworks.com/products/netq/">Cumulus NetQ</a></li>
              <li><a href="//cumulusnetworks.com/products/cumulus-express/">Cumulus Express</a></li>
            </ul>
            <ul class="mb-4">
              <li><h4>Learn</h4></li>
              <li><a href="//cumulusnetworks.com/learn/web-scale-networking-education/">Going web-scale</a></li>
              <li><a href="//cumulusnetworks.com/learn/events/">Events</a></li>
              <li><a href="//cumulusnetworks.com/blog/">Blog</a></li>
            </ul>
            <ul class="mb-4">
              <li><h4>About</h4></li>
              <li><a href="//cumulusnetworks.com/about/">Our story</a></li>
              <li><a href="//cumulusnetworks.com/about/careers/">Careers</a></li>
              <li><a href="//cumulusnetworks.com/about/media-coverage/">Media coverage</a></li>
              <li><a href="//docs.cumulusnetworks.com/" target="_blank">Tech docs</a></li>
              <li><a href="//cumulusnetworks.com/community/">Community</a></li>
            </ul>
            <ul>
              <li>
                <a href="//twitter.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M23 6.628l-2-.5 1-2-2.464.7A4.48 4.48 0 0 0 12 8.128v1c-3.539.73-6.634-1.2-9.5-4.5q-.75 4 1.5 6l-3-.5c.405 2.069 1.362 3.7 4 4l-2.5 1c1 2 2.566 2.31 5 2.5a10.748 10.748 0 0 1-6.5 2c12.755 5.669 20-2.664 20-10V8.3z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//www.facebook.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                      .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M17.768 7.5H13.5V5.6a.972.972 0 0 1 1.012-1.1c.418 0 2.988.01 2.988.01V.5h-4.329C9.244.5 8.5 3.474 8.5 5.355V7.5h-3v4h3v12h5v-12h3.851z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//linkedin.com/company/cumulus-networks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                      .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M6.5 22.5h-5v-13h5zm9-9a2 2 0 0 0-2 2v7h-5v-13h5v1.485a6.307 6.307 0 0 1 3.99-1.495c2.962 0 5.01 2.2 5.01 6.355V22.5h-5v-7a2 2 0 0 0-2-2zM6.5 5A2.5 2.5 0 1 1 4 2.5 2.5 2.5 0 0 1 6.5 5z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//vimeo.com/CumulusNetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                      <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                      </style>
                    </defs>
                    <path class="a" d="M.5 7.393l.933 1.224S3.36 7.1 4 7.859s3.1 9.925 3.915 11.617c.714 1.483 2.684 3.444 4.845 2.042s9.34-7.529 10.626-14.769-8.642-5.723-9.693.583c2.627-1.577 4.03.642 2.686 3.154s-2.569 4.145-3.211 4.145-1.135-1.679-1.868-4.613c-.76-3.035-.755-8.5-3.911-7.882C4.412 2.721.5 7.393.5 7.393z"></path>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//www.github.com/cumulusnetworks/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                        <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                        </style>
                    </defs>
                    <path class="a" d="M19.459 17c0-5.969-4.126-3.532-7.5-3.532s-7.5-2.375-7.5 3.532a3.5 3.5 0 0 0 3.5 3.5h8a3.5 3.5 0 0 0 3.5-3.5z"></path>
                    <path class="a" d="M21.489 10.214l.032.023s2.646-4.572-.6-7.237c-2 0-5.058 3.3-5.058 3.3l.022.016A14.152 14.152 0 0 0 8.1 6.3C8.083 6.285 5.037 3 3.042 3c-3.173 2.6-.729 7.012-.614 7.217a8.876 8.876 0 0 0-1.395 5.743c.241 3.126 2.847 6.54 5.982 6.54H16.9c3.135 0 5.742-3.414 5.982-6.54a8.857 8.857 0 0 0-1.393-5.746z"></path>
                    <ellipse class="a" cx="15.48" cy="17" rx="1" ry="1.5"></ellipse>
                    <ellipse class="a" cx="8.48" cy="17" rx="1" ry="1.5"></ellipse>
                  </svg>
                </a>
              </li>
              <li>
                <a href="//slack.cumulusnetworks.com/" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <defs>
                        <style>
                        .a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}
                        </style>
                    </defs>
                    <rect class="a" x=".5" y=".5" width="23" height="23" rx="6" ry="6"></rect>
                    <circle class="a" cx="12" cy="12" r="6"></circle>
                    <circle class="a" cx="19" cy="5" r="1.5"></circle>
                  </svg>
                </a>
              </li>
              <li>
                <p>Cumulus Networks<sup>®</sup> — Data center networking software for the open, modern data center.</p>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </footer>
  <div class="footer-bottom">
      <div class="container">
          <div class="row">
              <div class="col-12">
                  <ul>
                      <li><a href="//cumulusnetworks.com/legal/trademarks/">Trademarks</a></li>
                      <li><a href="//cumulusnetworks.com/legal/privacy/">Privacy</a></li>
                      <li><a href="//cumulusnetworks.com/legal/">Terms of service</a></li>
                  </ul>
              </div>
          </div>
      </div>
  </div>

  
  

</body>

</html>
