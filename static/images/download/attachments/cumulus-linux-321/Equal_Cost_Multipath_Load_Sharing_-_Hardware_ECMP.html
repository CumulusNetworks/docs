<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Equal Cost Multipath Load Sharing - Hardware ECMP - Cumulus Linux 3.2.1</title>

    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/scroll-tree.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>


<link rel="stylesheet" href="assets/css/content-style.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

    </head>

<body pageid="5126727">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">CL321</span>
                    <img class="space-logo" src="spacelogo.png" />
                </h1>
                <a href="Cumulus_Linux_User_Guide.html" class="ht-space-link">
                    <h2>Cumulus Linux 3.2.1</h2>
                </a>
            </header>

            <nav class="ht-pages-nav">
                <ul class="ht-pages-nav-top">
                                                <li class="leaf">
        <a class="ht-nav-page-link" href="Quick_Start_Guide.html">Quick Start Guide</a>

            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="Installation_Management.html">Installation Management</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Managing_Cumulus_Linux_Disk_Images.html">Managing Cumulus Linux Disk Images</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Installing_a_New_Cumulus_Linux_Image.html">Installing a New Cumulus Linux Image</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Upgrading_Cumulus_Linux.html">Upgrading Cumulus Linux</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Using_Snapshots.html">Using Snapshots</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Adding_and_Updating_Packages.html">Adding and Updating Packages</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Zero_Touch_Provisioning_-_ZTP.html">Zero Touch Provisioning - ZTP</a>

            </li>
                            </ul>
            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="System_Configuration.html">System Configuration</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Network_Command_Line_Utility.html">Network Command Line Utility</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Setting_Date_and_Time.html">Setting Date and Time</a>

            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Authentication,_Authorization,_and_Accounting.html">Authentication, Authorization, and Accounting</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="SSH_for_Remote_Access.html">SSH for Remote Access</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="User_Accounts.html">User Accounts</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Using_sudo_to_Delegate_Privileges.html">Using sudo to Delegate Privileges</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="LDAP_Authentication_and_Authorization.html">LDAP Authentication and Authorization</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="TACACS_Plus.html">TACACS Plus</a>

            </li>
                            </ul>
            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Netfilter_-_ACLs.html">Netfilter - ACLs</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Default_Cumulus_Linux_ACL_Configuration.html">Default Cumulus Linux ACL Configuration</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Managing_Application_Daemons.html">Managing Application Daemons</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Configuring_switchd.html">Configuring switchd</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Power_over_Ethernet_-_PoE.html">Power over Ethernet - PoE</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Configuring_a_Global_Proxy.html">Configuring a Global Proxy</a>

            </li>
                            </ul>
            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="Interface_Configuration_and_Management.html">Interface Configuration and Management</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Layer_1_and_Switch_Port_Attributes.html">Layer 1 and Switch Port Attributes</a>

            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Buffer_and_Queue_Management.html">Buffer and Queue Management</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Configuring_Hardware-enabled_DDOS_Protection.html">Configuring Hardware-enabled DDOS Protection</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Configuring_DHCP_Relays.html">Configuring DHCP Relays</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Configuring_DHCP_Servers.html">Configuring DHCP Servers</a>

            </li>
                            </ul>
            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="Layer_One_and_Two.html">Layer One and Two</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Spanning_Tree_and_Rapid_Spanning_Tree.html">Spanning Tree and Rapid Spanning Tree</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Link_Layer_Discovery_Protocol.html">Link Layer Discovery Protocol</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Prescriptive_Topology_Manager_-_PTM.html">Prescriptive Topology Manager - PTM</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Bonding_-_Link_Aggregation.html">Bonding - Link Aggregation</a>

            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Ethernet_Bridging_-_VLANs.html">Ethernet Bridging - VLANs</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VLAN-aware_Bridge_Mode_for_Large-scale_Layer_2_Environments.html">VLAN-aware Bridge Mode for Large-scale Layer 2 Environments</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Traditional_Mode_Bridges.html">Traditional Mode Bridges</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VLAN_Tagging.html">VLAN Tagging</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Multi-Chassis_Link_Aggregation_-_MLAG.html">Multi-Chassis Link Aggregation - MLAG</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="LACP_Bypass.html">LACP Bypass</a>

            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Virtual_Router_Redundancy_-_VRR.html">Virtual Router Redundancy - VRR</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="ifplugd.html">ifplugd</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="IGMP_and_MLD_Snooping.html">IGMP and MLD Snooping</a>

            </li>
                            </ul>
            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="Network_Virtualization.html">Network Virtualization</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Integrating_with_VMware_NSX.html">Integrating with VMware NSX</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Integrating_Hardware_VTEPs_with_Midokura_MidoNet_and_OpenStack.html">Integrating Hardware VTEPs with Midokura MidoNet and OpenStack</a>

            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Lightweight_Network_Virtualization_-_LNV_Overview.html">Lightweight Network Virtualization - LNV Overview</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="LNV_VXLAN_Active-Active_Mode.html">LNV VXLAN Active-Active Mode</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="LNV_Full_Example.html">LNV Full Example</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Static_MAC_Bindings_with_VXLAN.html">Static MAC Bindings with VXLAN</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Ethernet_Virtual_Private_Network_-_EVPN.html">Ethernet Virtual Private Network - EVPN</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VXLAN_Hyperloop.html">VXLAN Hyperloop</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Static_VXLAN_Tunnels.html">Static VXLAN Tunnels</a>

            </li>
                            </ul>
            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="Layer_Three.html">Layer Three</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Routing.html">Routing</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Introduction_to_Routing_Protocols.html">Introduction to Routing Protocols</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Network_Topology.html">Network Topology</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Quagga_Overview.html">Quagga Overview</a>

            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Configuring_Quagga.html">Configuring Quagga</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Comparing_NCLU_and_vtysh_Commands.html">Comparing NCLU and vtysh Commands</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Open_Shortest_Path_First_-_OSPF_-_Protocol.html">Open Shortest Path First - OSPF - Protocol</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Open_Shortest_Path_First_v3_-_OSPFv3_-_Protocol.html">Open Shortest Path First v3 - OSPFv3 - Protocol</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Border_Gateway_Protocol_-_BGP.html">Border Gateway Protocol - BGP</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Bidirectional_Forwarding_Detection_-_BFD.html">Bidirectional Forwarding Detection - BFD</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link current" href="Equal_Cost_Multipath_Load_Sharing_-_Hardware_ECMP.html">Equal Cost Multipath Load Sharing - Hardware ECMP</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Redistribute_Neighbor.html">Redistribute Neighbor</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Virtual_Routing_and_Forwarding_-_VRF.html">Virtual Routing and Forwarding - VRF</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Management_VRF.html">Management VRF</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Protocol_Independent_Multicast_-_PIM.html">Protocol Independent Multicast - PIM</a>

            </li>
                            </ul>
            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="Monitoring_and_Troubleshooting.html">Monitoring and Troubleshooting</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Single_User_Mode_-_Boot_Recovery.html">Single User Mode - Boot Recovery</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Resource_Diagnostics_Using_cl-resource-query.html">Resource Diagnostics Using cl-resource-query</a>

            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Monitoring_System_Hardware.html">Monitoring System Hardware</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Network_Switch_Port_LED_and_Status_LED_Guidelines.html">Network Switch Port LED and Status LED Guidelines</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Monitoring_Virtual_Device_Counters.html">Monitoring Virtual Device Counters</a>

            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Understanding_the_cl-support_Output_File.html">Understanding the cl-support Output File</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Troubleshooting_Log_Files.html">Troubleshooting Log Files</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Troubleshooting_the_etc_Directory.html">Troubleshooting the etc Directory</a>

            </li>
                            </ul>
            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Troubleshooting_Network_Interfaces.html">Troubleshooting Network Interfaces</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Monitoring_Interfaces_and_Transceivers_Using_ethtool.html">Monitoring Interfaces and Transceivers Using ethtool</a>

            </li>
                            </ul>
            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Network_Troubleshooting.html">Network Troubleshooting</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Using_NCLU_to_Troubleshoot_Your_Network_Configuration.html">Using NCLU to Troubleshoot Your Network Configuration</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Monitoring_System_Statistics_and_Network_Traffic_with_sFlow.html">Monitoring System Statistics and Network Traffic with sFlow</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Using_netq_to_Troubleshoot_the_Network.html">Using netq to Troubleshoot the Network</a>

            </li>
                            </ul>
            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="SNMP_Monitoring.html">SNMP Monitoring</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Using_Nutanix_Prism_as_a_Monitoring_Tool.html">Using Nutanix Prism as a Monitoring Tool</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Monitoring_Best_Practices.html">Monitoring Best Practices</a>

            </li>
                            </ul>
            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="Network_Solutions.html">Network Solutions</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Data_Center_Host_to_ToR_Architecture.html">Data Center Host to ToR Architecture</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Cumulus_Networks_Services_Demos.html">Cumulus Networks Services Demos</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Docker_on_Cumulus_Linux.html">Docker on Cumulus Linux</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="OpenStack_Neutron_ML2_and_Cumulus_Linux.html">OpenStack Neutron ML2 and Cumulus Linux</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Anycast_Design_Guide.html">Anycast Design Guide</a>

            </li>
                            </ul>
            </li>
                                                <li class="leaf">
        <a class="ht-nav-page-link" href="Cumulus_Linux_Index.html">Cumulus Linux Index</a>

            </li>
                                    </ul>
            </nav>
        </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="Cumulus_Linux_User_Guide.html">Cumulus Linux 3.2.1</a></li>
                                                                                     <li><a href="Layer_Three.html">Layer Three</a></li>
                                                            </ul>
</div>            <h1 id="src-5127052"> <span>Equal Cost Multipath Load Sharing - Hardware ECMP</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">

    <p  >Cumulus Linux supports hardware-based <a  class="external-link" href="http://en.wikipedia.org/wiki/Equal-cost_multi-path_routing">equal cost multipath</a> (ECMP) load sharing. ECMP is enabled by default in Cumulus Linux. Load sharing occurs automatically for all routes with multiple next hops installed. ECMP load sharing supports both IPv4 and IPv6 routes.    </p>
    <div class="section section-1" id="src-5127052_EqualCostMultipathLoadSharing-HardwareECMP-Contents">
        <h1 class="heading "><span>Contents</span></h1>
    <p  class="expand-control-text">This chapter covers ...    </p>
    </div>
    <div class="section section-1" id="src-5127052_EqualCostMultipathLoadSharing-HardwareECMP-UnderstandingEqualCostRouting">
        <h1 class="heading "><span>Understanding Equal Cost Routing</span></h1>
    <p  >ECMP operates only on equal cost routes in the Linux routing table.    </p>
    <p  >In this example, the 10.1.1.0/24 route has two possible next hops that have been installed in the routing table:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">$ ip route show </code><code class="value">10.1</code><code class="plain">.</code><code class="value">1.0</code><code class="plain">/</code><code class="value">24</code></div>
<div class="line"><code class="value">10.1</code><code class="plain">.</code><code class="value">1.0</code><code class="plain">/</code><code class="value">24</code><code class="plain">  proto zebra  metric </code><code class="value">20</code></div>
<div class="line"><code class="plain"> nexthop via </code><code class="value">192.168</code><code class="plain">.</code><code class="value">1.1</code><code class="plain"> dev swp1 weight </code><code class="value">1</code><code class="plain"> onlink</code></div>
<div class="line"><code class="plain"> nexthop via </code><code class="value">192.168</code><code class="plain">.</code><code class="value">2.1</code><code class="plain"> dev swp2 weight </code><code class="value">1</code><code class="plain"> onlink</code></div>
</div>
    </div>
    <p  >For routes to be considered equal they must:    </p>
<ul class=" "><li class=" ">    <p  >Originate from the same routing protocol. Routes from different sources are not considered equal. For example, a static route and an OSPF route are not considered for ECMP load sharing.    </p>
</li><li class=" ">    <p  >Have equal cost. If two routes from the same protocol are unequal, only the best route is installed in the routing table.    </p>
</li></ul>    <div  class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <p  >As of Cumulus Linux 3.0, the BGP <tt class=" ">maximum-paths</tt> setting is enabled, so multiple routes are installed by default. See the <a   href="Border_Gateway_Protocol_-_BGP.html#src-5127049_BorderGatewayProtocol-BGP-ecmp">ECMP section</a> of the BGP chapter for more information.    </p>
        </div>
    </div>
    </div>
    <div class="section section-1" id="src-5127052_EqualCostMultipathLoadSharing-HardwareECMP-UnderstandingECMPHashing">
        <h1 class="heading "><span>Understanding ECMP Hashing</span></h1>
    <p  >Once multiple routes are installed in the routing table, a hash is used to determine which path a packet follows.    </p>
    <p  >Cumulus Linux hashes on the following <span id="src-5127052_EqualCostMultipathLoadSharing-HardwareECMP-hashfields"></span>fields:    </p>
<ul class=" "><li class=" ">    <p  >IP protocol    </p>
</li><li class=" ">    <p  >Ingress interface    </p>
</li><li class=" ">    <p  >Source IPv4 or IPv6 address    </p>
</li><li class=" ">    <p  >Destination IPv4 or IPv6 address    </p>
</li></ul>    <p  >For TCP/UDP frames, Cumulus Linux also hashes on:    </p>
<ul class=" "><li class=" ">    <p  >Source port    </p>
</li><li class=" ">    <p  >Destination port    </p>
</li></ul>    <p  >    <img  class="confluence-embedded-image" src="images/download/attachments/5127052/Packet_Hash.png" alt="images/download/attachments/5127052/Packet_Hash.png" width="500"  />
        </p>
    <p  >To prevent out of order packets, ECMP hashing is done on a per-flow basis, which means that all packets with the same source and destination IP addresses and the same source and destination ports always hash to the same next hop. ECMP hashing does not keep a record of flow states.    </p>
    <p  >ECMP hashing does not keep a record of packets that have hashed to each next hop and does not guarantee that traffic sent to each next hop is equal.    </p>
    <div class="section section-2" id="src-5127052_EqualCostMultipathLoadSharing-HardwareECMP-Usingcl-ecmpcalctoDeterminetheHashResult">
        <h2 class="heading "><span>Using cl-ecmpcalc to Determine the Hash Result</span></h2>
    <p  >Since the hash is deterministic and always provides the same result for the same input, you can query the hardware and determine the hash result of a given input. This is useful when determining exactly which path a flow takes through a network.    </p>
    <p  >On Cumulus Linux, use the <tt class=" ">cl-ecmpcalc</tt><span id="src-5127052_indexterm-3760847AD98FBA95891421B75110FF7A"> </span>command to determine a hardware hash result.    </p>
    <p  >In order to use <tt class=" ">cl-ecmpcalc</tt>, all fields that are used in the hash must be provided. This includes ingress interface, layer 3 source IP, layer 3 destination IP, layer 4 source port and layer 4 destination port.    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">$ sudo cl-ecmpcalc -i swp1 -s </code><code class="value">10.0</code><code class="plain">.</code><code class="value">0.1</code><code class="plain"> -d </code><code class="value">10.0</code><code class="plain">.</code><code class="value">0.1</code><code class="plain"> -p tcp --sport </code><code class="value">20000</code><code class="plain"> --dport </code><code class="value">80</code></div>
<div class="line"><code class="plain">ecmpcalc: will query hardware</code></div>
<div class="line"><code class="plain">swp3</code></div>
</div>
    </div>
    <p  >If any field is omitted, <tt class=" ">cl-ecmpcalc</tt> fails.    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">$ sudo cl-ecmpcalc -i swp1 -s </code><code class="value">10.0</code><code class="plain">.</code><code class="value">0.1</code><code class="plain"> -d </code><code class="value">10.0</code><code class="plain">.</code><code class="value">0.1</code><code class="plain"> -p tcp </code></div>
<div class="line"><code class="plain">ecmpcalc: will query hardware</code></div>
<div class="line"><code class="plain">usage: cl-ecmpcalc [-h] [-v] [-p PROTOCOL] [-s SRC] [--sport SPORT] [-d DST] </code></div>
<div class="line"><code class="plain">                   [--dport DPORT] [--vid VID] [-i IN_INTERFACE]</code></div>
<div class="line"><code class="plain">                   [--sportid SPORTID] [--smodid SMODID] [-o OUT_INTERFACE]</code></div>
<div class="line"><code class="plain">                   [--dportid DPORTID] [--dmodid DMODID] [--hardware] </code></div>
<div class="line"><code class="plain">                   [--nohardware] [-hs HASHSEED]</code></div>
<div class="line"><code class="plain">                   [-hf HASHFIELDS [HASHFIELDS ...]]</code></div>
<div class="line"><code class="plain">                   [--hashfunction {crc16-ccitt,crc16-bisync}] [-e EGRESS]</code></div>
<div class="line"><code class="plain">                   [-c MCOUNT]</code></div>
<div class="line"><code class="plain">cl-ecmpcalc: error: --sport and --dport required </code><code class="keyword">for</code><code class="plain"> TCP and UDP frames</code></div>
</div>
    </div>
    </div>
    <div class="section section-2" id="src-5127052_EqualCostMultipathLoadSharing-HardwareECMP-cl-ecmpcalcLimitations">
        <h2 class="heading "><span>cl-ecmpcalc Limitations</span></h2>
    <p  ><tt class=" ">cl-ecmpcalc</tt> can only take input interfaces that can be converted to a single physical port in the port tab file, like the physical switch ports (swp). Virtual interfaces like bridges, bonds, and subinterfaces are not supported.    </p>
    <p  ><tt class=" ">cl-ecmpcalc</tt> is supported only on switches with the <a  class="external-link" href="http://cumulusnetworks.com/hcl/">Spectrum, Tomahawk, Trident II+ and Trident II</a> chipsets.    </p>
    </div>
    <div class="section section-2" id="src-5127052_EqualCostMultipathLoadSharing-HardwareECMP-ECMPHashBuckets">
        <h2 class="heading "><span>ECMP Hash Buckets</span></h2>
    <p  >When multiple routes are installed in the routing table, each route is assigned to an ECMP <i class=" ">bucket</i>. When the ECMP hash is executed the result of the hash determines which bucket gets used.    </p>
    <p  >In the following example, 4 next hops exist. Three different flows are hashed to different hash buckets. Each next hop is assigned to a unique hash bucket.    </p>
    <p  >    <img  class="confluence-embedded-image" src="images/download/attachments/5127052/ECMP_Hash_Bucket.png" alt="images/download/attachments/5127052/ECMP_Hash_Bucket.png" width="500"  />
        </p>
    <div class="section section-3" id="src-5127052_EqualCostMultipathLoadSharing-HardwareECMP-AddingaNextHop">
        <h3 class="heading "><span>Adding a Next Hop</span></h3>
    <p  >When a next hop is added, a new hash bucket is created. The assignment of next hops to hash buckets, as well as the hash result, may change when additional next hops are added.    </p>
    <p  >    <img  class="confluence-embedded-image" src="images/download/attachments/5127052/ECMP_Hash_Bucket_Added.png" alt="images/download/attachments/5127052/ECMP_Hash_Bucket_Added.png" width="500"  />
    <br/>A new next hop is added and a new hash bucket is created. As a result, the hash and hash bucket assignment changed, causing the existing flows to be sent to different next hops.    </p>
    </div>
    <div class="section section-3" id="src-5127052_EqualCostMultipathLoadSharing-HardwareECMP-RemovingaNextHop">
        <h3 class="heading "><span>Removing a Next Hop</span></h3>
    <p  >When a next hop is removed, the remaining hash bucket assignments may change, again, potentially changing the next hop selected for an existing flow.    </p>
    <p  >    <img  class="confluence-embedded-image" src="images/download/attachments/5127052/Hash_Failure.png" alt="images/download/attachments/5127052/Hash_Failure.png" width="500"  />
     <img  class="confluence-embedded-image" src="images/download/attachments/5127052/Hash_Post-Failure.png" alt="images/download/attachments/5127052/Hash_Post-Failure.png" width="500"  />
<br/>A next hop fails and the next hop and hash bucket are removed. The remaining next hops may be reassigned.    </p>
    <p  >In most cases, the modification of hash buckets has no impact on traffic flows as traffic is being forward to a single end host. In deployments where multiple end hosts are using the same IP address (anycast), <i class=" ">resilient hashing</i> must be used.    </p>
    <p  ><span id="src-5127052_EqualCostMultipathLoadSharing-HardwareECMP-resilient_hashing"></span>    </p>
    </div>
    </div>
    </div>
    <div class="section section-1" id="src-5127052_EqualCostMultipathLoadSharing-HardwareECMP-ResilientHashing">
        <h1 class="heading "><span>Resilient Hashing</span></h1>
    <p  >In Cumulus Linux when a next hop fails or is removed from an ECMP pool, the hashing or hash bucket assignment can change. For deployments where there is a need for flows to always use the same next hop, like TCP anycast deployments, this can create session failures.    </p>
    <p  >The ECMP hash performed with resilient hashing is exactly the same as the default hashing mode. Only the method in which next hops are assigned to hash buckets differs.    </p>
    <p  >Resilient hashing supports both IPv4 and IPv6 routes.    </p>
    <p  >Resilient hashing is not enabled by default. See below for steps on configuring it.    </p>
    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <p  >Resilient hashing prevents disruptions when new next hops are removed. It does not prevent disruption when next hops are added.    </p>
        </div>
    </div>
    <div class="section section-2" id="src-5127052_EqualCostMultipathLoadSharing-HardwareECMP-ResilientHashBuckets">
        <h2 class="heading "><span>Resilient Hash Buckets</span></h2>
    <p  >When resilient hashing is configured, a fixed number of buckets are defined. Next hops are then assigned in round robin fashion to each of those buckets. In this example, 12 buckets are created and four next hops are assigned.    </p>
    <p  >    <img  class="confluence-embedded-image" src="images/download/attachments/5127052/Reshash_bucket_assignment.png" alt="images/download/attachments/5127052/Reshash_bucket_assignment.png" width="500"  />
        </p>
    </div>
    <div class="section section-2" id="src-5127052_EqualCostMultipathLoadSharing-HardwareECMP-RemovingNextHops">
        <h2 class="heading "><span>Removing Next Hops</span></h2>
    <p  >Unlike default ECMP hashing, when a next hop needs to be removed, the number of hash buckets does not change.    </p>
    <p  >    <img  class="confluence-embedded-image" src="images/download/attachments/5127052/Reshash_Failure.png" alt="images/download/attachments/5127052/Reshash_Failure.png" width="500"  />
    <br/>With 12 buckets assigned and four next hops, instead of reducing the number of buckets &mdash; which would impact flows to known good hosts &mdash; the remaining next hops replace the failed next hop.    </p>
    <p  >    <img  class="confluence-embedded-image" src="images/download/attachments/5127052/Reshash_Restore.png" alt="images/download/attachments/5127052/Reshash_Restore.png" width="500"  />
        </p>
    <p  >After the failed next hop is removed, the remaining next hops are installed as replacements. This prevents impact to any flows that hash to working next hops.    </p>
    </div>
    <div class="section section-2" id="src-5127052_EqualCostMultipathLoadSharing-HardwareECMP-AddingNextHops">
        <h2 class="heading "><span>Adding Next Hops</span></h2>
    <p  >Resilient hashing does not prevent possible impact to existing flows when new next hops are added. Due to the fact there are a fixed number of buckets, a new next hop requires reassigning next hops to buckets.    </p>
    <p  >    <img  class="confluence-embedded-image" src="images/download/attachments/5127052/Reshash_Add.png" alt="images/download/attachments/5127052/Reshash_Add.png" width="500"  />
        </p>
    <p  >As a result, some flows may hash to new next hops, which can impact anycast deployments.    </p>
    </div>
    <div class="section section-2" id="src-5127052_EqualCostMultipathLoadSharing-HardwareECMP-ConfiguringResilientHashing">
        <h2 class="heading "><span>Configuring Resilient Hashing</span></h2>
    <p  ><span id="src-5127052_indexterm-75987AD1D382685AB44D38344E4DF50E">Resilient </span><span id="src-5127052_indexterm-435D82BD41FB039BC37E583520157E48">hashing</span> is not enabled by default. When resilient hashing is enabled, 65,536 buckets are created to be shared among all ECMP groups. An ECMP group is a list of unique next hops that are referenced by multiple ECMP routes.    </p>
    <div  class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <p  >An ECMP route counts as a single route with multiple next hops. The following example is considered to be a single ECMP route:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">$ ip route show </code><code class="value">10.1</code><code class="plain">.</code><code class="value">1.0</code><code class="plain">/</code><code class="value">24</code></div>
<div class="line"><code class="value">10.1</code><code class="plain">.</code><code class="value">1.0</code><code class="plain">/</code><code class="value">24</code><code class="plain">  proto zebra  metric </code><code class="value">20</code></div>
<div class="line"><code class="plain"> nexthop via </code><code class="value">192.168</code><code class="plain">.</code><code class="value">1.1</code><code class="plain"> dev swp1 weight </code><code class="value">1</code><code class="plain"> onlink</code></div>
<div class="line"><code class="plain"> nexthop via </code><code class="value">192.168</code><code class="plain">.</code><code class="value">2.1</code><code class="plain"> dev swp2 weight </code><code class="value">1</code><code class="plain"> onlink</code></div>
</div>
    </div>
        </div>
    </div>
    <p  >All ECMP routes must use the same number of buckets (the number of buckets cannot be configured per ECMP route).    </p>
    <p  >The number of buckets can be configured as 64, 128, 256, 512 or 1024; the default is 128:    </p>
    <div  class="tablewrap">
        <table class="confluenceTable">
        <thead class=" ">    <tr>
            <td  class="confluenceTh" rowspan="1" colspan="1">
        <p  >Number of Hash Buckets    </p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
        <p  >Number of Supported ECMP Groups    </p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >64    </p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >1024    </p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  ><strong class=" ">128</strong>    </p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  ><strong class=" ">512</strong>    </p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >256    </p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >256    </p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >512    </p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >128    </p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >1024    </p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >64    </p>
            </td>
        </tr>
</tbody>        </table>
            </div>
    <p  >A larger number of ECMP buckets reduces the impact on adding new next hops to an ECMP route. However, the system supports fewer ECMP routes. If the maximum number of ECMP routes have been installed, new ECMP routes log an error and are not installed.    </p>
    <p  >To enable resilient hashing, edit <tt class=" ">/etc/cumulus/datapath/traffic.conf</tt>:    </p>
<ol class=" "><li class=" ">    <p  >Enable resilient hashing:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain"># Enable resilient hashing</code></div>
<div class="line"><code class="plain">resilient_hash_enable = TRUE</code></div>
</div>
    </div>
</li><li class=" ">    <p  ><strong class=" ">(Optional)</strong> Edit the number of hash buckets:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain"># Resilient hashing flowset entries per ECMP group</code></div>
<div class="line"><code class="plain"># Valid values - </code><code class="value">64</code><code class="plain">, </code><code class="value">128</code><code class="plain">, </code><code class="value">256</code><code class="plain">, </code><code class="value">512</code><code class="plain">, </code><code class="value">1024</code></div>
<div class="line"><code class="plain">resilient_hash_entries_ecmp = </code><code class="value">256</code></div>
</div>
    </div>
</li><li class=" ">    <p  ><a   href="Configuring_switchd.html#src-5126758_Configuringswitchd-restartswitchd">Restart</a> the <tt class=" ">switchd</tt> service:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus</code><code class="color1">@switch</code><code class="plain">:~$ sudo systemctl restart switchd.service</code></div>
</div>
    </div>
</li></ol>    </div>
    </div>
    <div class="section section-1" id="src-5127052_EqualCostMultipathLoadSharing-HardwareECMP-CaveatsandErrata">
        <h1 class="heading "><span>Caveats and Errata</span></h1>
    <p  >Resilient hashing is supported only on switches with the <a  class="external-link" href="http://cumulusnetworks.com/hcl/">Tomahawk, Trident II+ and Trident II</a> chipsets. You can run <tt class=" ">netshow system </tt>to determine the chipset.    </p>
    </div>
        </div>

    </article>


            <nav id="ht-post-nav">
                <a href="Bidirectional_Forwarding_Detection_-_BFD.html" class="ht-post-nav-prev">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-prev" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Bidirectional Forwarding Detection - BFD</span>
        </a>
                <a href="Redistribute_Neighbor.html" class="ht-post-nav-next">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-next" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-225.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Redistribute Neighbor</span>
        </a>
    </nav>    
            
            <article id="html-search-results" class="ht-content" style="display: none;">
            <header class="ht-content-header">
                <div id="ht-spacetitle">
                    <ul>
                        <li><a href="Cumulus_Linux_User_Guide.html">Cumulus Linux 3.2.1</a></li>
                    </ul>
                </div>
                <h1>Search results</h1>
            </header>
            <div id="search-results"></div>
        </article>
    
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>


</body>
</html>
