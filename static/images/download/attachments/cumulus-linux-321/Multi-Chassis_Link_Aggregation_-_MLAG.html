<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Multi-Chassis Link Aggregation - MLAG - Cumulus Linux 3.2.1</title>

    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/scroll-tree.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>


<link rel="stylesheet" href="assets/css/content-style.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

    </head>

<body pageid="5126727">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">CL321</span>
                    <img class="space-logo" src="spacelogo.png" />
                </h1>
                <a href="Cumulus_Linux_User_Guide.html" class="ht-space-link">
                    <h2>Cumulus Linux 3.2.1</h2>
                </a>
            </header>

            <nav class="ht-pages-nav">
                <ul class="ht-pages-nav-top">
                                                <li class="leaf">
        <a class="ht-nav-page-link" href="Quick_Start_Guide.html">Quick Start Guide</a>

            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="Installation_Management.html">Installation Management</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Managing_Cumulus_Linux_Disk_Images.html">Managing Cumulus Linux Disk Images</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Installing_a_New_Cumulus_Linux_Image.html">Installing a New Cumulus Linux Image</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Upgrading_Cumulus_Linux.html">Upgrading Cumulus Linux</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Using_Snapshots.html">Using Snapshots</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Adding_and_Updating_Packages.html">Adding and Updating Packages</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Zero_Touch_Provisioning_-_ZTP.html">Zero Touch Provisioning - ZTP</a>

            </li>
                            </ul>
            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="System_Configuration.html">System Configuration</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Network_Command_Line_Utility.html">Network Command Line Utility</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Setting_Date_and_Time.html">Setting Date and Time</a>

            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Authentication,_Authorization,_and_Accounting.html">Authentication, Authorization, and Accounting</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="SSH_for_Remote_Access.html">SSH for Remote Access</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="User_Accounts.html">User Accounts</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Using_sudo_to_Delegate_Privileges.html">Using sudo to Delegate Privileges</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="LDAP_Authentication_and_Authorization.html">LDAP Authentication and Authorization</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="TACACS_Plus.html">TACACS Plus</a>

            </li>
                            </ul>
            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Netfilter_-_ACLs.html">Netfilter - ACLs</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Default_Cumulus_Linux_ACL_Configuration.html">Default Cumulus Linux ACL Configuration</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Managing_Application_Daemons.html">Managing Application Daemons</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Configuring_switchd.html">Configuring switchd</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Power_over_Ethernet_-_PoE.html">Power over Ethernet - PoE</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Configuring_a_Global_Proxy.html">Configuring a Global Proxy</a>

            </li>
                            </ul>
            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="Interface_Configuration_and_Management.html">Interface Configuration and Management</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Layer_1_and_Switch_Port_Attributes.html">Layer 1 and Switch Port Attributes</a>

            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Buffer_and_Queue_Management.html">Buffer and Queue Management</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Configuring_Hardware-enabled_DDOS_Protection.html">Configuring Hardware-enabled DDOS Protection</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Configuring_DHCP_Relays.html">Configuring DHCP Relays</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Configuring_DHCP_Servers.html">Configuring DHCP Servers</a>

            </li>
                            </ul>
            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="Layer_One_and_Two.html">Layer One and Two</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Spanning_Tree_and_Rapid_Spanning_Tree.html">Spanning Tree and Rapid Spanning Tree</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Link_Layer_Discovery_Protocol.html">Link Layer Discovery Protocol</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Prescriptive_Topology_Manager_-_PTM.html">Prescriptive Topology Manager - PTM</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Bonding_-_Link_Aggregation.html">Bonding - Link Aggregation</a>

            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Ethernet_Bridging_-_VLANs.html">Ethernet Bridging - VLANs</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VLAN-aware_Bridge_Mode_for_Large-scale_Layer_2_Environments.html">VLAN-aware Bridge Mode for Large-scale Layer 2 Environments</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Traditional_Mode_Bridges.html">Traditional Mode Bridges</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VLAN_Tagging.html">VLAN Tagging</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link current" href="Multi-Chassis_Link_Aggregation_-_MLAG.html">Multi-Chassis Link Aggregation - MLAG</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="LACP_Bypass.html">LACP Bypass</a>

            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Virtual_Router_Redundancy_-_VRR.html">Virtual Router Redundancy - VRR</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="ifplugd.html">ifplugd</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="IGMP_and_MLD_Snooping.html">IGMP and MLD Snooping</a>

            </li>
                            </ul>
            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="Network_Virtualization.html">Network Virtualization</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Integrating_with_VMware_NSX.html">Integrating with VMware NSX</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Integrating_Hardware_VTEPs_with_Midokura_MidoNet_and_OpenStack.html">Integrating Hardware VTEPs with Midokura MidoNet and OpenStack</a>

            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Lightweight_Network_Virtualization_-_LNV_Overview.html">Lightweight Network Virtualization - LNV Overview</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="LNV_VXLAN_Active-Active_Mode.html">LNV VXLAN Active-Active Mode</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="LNV_Full_Example.html">LNV Full Example</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Static_MAC_Bindings_with_VXLAN.html">Static MAC Bindings with VXLAN</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Ethernet_Virtual_Private_Network_-_EVPN.html">Ethernet Virtual Private Network - EVPN</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VXLAN_Hyperloop.html">VXLAN Hyperloop</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Static_VXLAN_Tunnels.html">Static VXLAN Tunnels</a>

            </li>
                            </ul>
            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="Layer_Three.html">Layer Three</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Routing.html">Routing</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Introduction_to_Routing_Protocols.html">Introduction to Routing Protocols</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Network_Topology.html">Network Topology</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Quagga_Overview.html">Quagga Overview</a>

            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Configuring_Quagga.html">Configuring Quagga</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Comparing_NCLU_and_vtysh_Commands.html">Comparing NCLU and vtysh Commands</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Open_Shortest_Path_First_-_OSPF_-_Protocol.html">Open Shortest Path First - OSPF - Protocol</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Open_Shortest_Path_First_v3_-_OSPFv3_-_Protocol.html">Open Shortest Path First v3 - OSPFv3 - Protocol</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Border_Gateway_Protocol_-_BGP.html">Border Gateway Protocol - BGP</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Bidirectional_Forwarding_Detection_-_BFD.html">Bidirectional Forwarding Detection - BFD</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Equal_Cost_Multipath_Load_Sharing_-_Hardware_ECMP.html">Equal Cost Multipath Load Sharing - Hardware ECMP</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Redistribute_Neighbor.html">Redistribute Neighbor</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Virtual_Routing_and_Forwarding_-_VRF.html">Virtual Routing and Forwarding - VRF</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Management_VRF.html">Management VRF</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Protocol_Independent_Multicast_-_PIM.html">Protocol Independent Multicast - PIM</a>

            </li>
                            </ul>
            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="Monitoring_and_Troubleshooting.html">Monitoring and Troubleshooting</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Single_User_Mode_-_Boot_Recovery.html">Single User Mode - Boot Recovery</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Resource_Diagnostics_Using_cl-resource-query.html">Resource Diagnostics Using cl-resource-query</a>

            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Monitoring_System_Hardware.html">Monitoring System Hardware</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Network_Switch_Port_LED_and_Status_LED_Guidelines.html">Network Switch Port LED and Status LED Guidelines</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Monitoring_Virtual_Device_Counters.html">Monitoring Virtual Device Counters</a>

            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Understanding_the_cl-support_Output_File.html">Understanding the cl-support Output File</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Troubleshooting_Log_Files.html">Troubleshooting Log Files</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Troubleshooting_the_etc_Directory.html">Troubleshooting the etc Directory</a>

            </li>
                            </ul>
            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Troubleshooting_Network_Interfaces.html">Troubleshooting Network Interfaces</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Monitoring_Interfaces_and_Transceivers_Using_ethtool.html">Monitoring Interfaces and Transceivers Using ethtool</a>

            </li>
                            </ul>
            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Network_Troubleshooting.html">Network Troubleshooting</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Using_NCLU_to_Troubleshoot_Your_Network_Configuration.html">Using NCLU to Troubleshoot Your Network Configuration</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Monitoring_System_Statistics_and_Network_Traffic_with_sFlow.html">Monitoring System Statistics and Network Traffic with sFlow</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Using_netq_to_Troubleshoot_the_Network.html">Using netq to Troubleshoot the Network</a>

            </li>
                            </ul>
            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="SNMP_Monitoring.html">SNMP Monitoring</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Using_Nutanix_Prism_as_a_Monitoring_Tool.html">Using Nutanix Prism as a Monitoring Tool</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Monitoring_Best_Practices.html">Monitoring Best Practices</a>

            </li>
                            </ul>
            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="Network_Solutions.html">Network Solutions</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Data_Center_Host_to_ToR_Architecture.html">Data Center Host to ToR Architecture</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Cumulus_Networks_Services_Demos.html">Cumulus Networks Services Demos</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Docker_on_Cumulus_Linux.html">Docker on Cumulus Linux</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="OpenStack_Neutron_ML2_and_Cumulus_Linux.html">OpenStack Neutron ML2 and Cumulus Linux</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Anycast_Design_Guide.html">Anycast Design Guide</a>

            </li>
                            </ul>
            </li>
                                                <li class="leaf">
        <a class="ht-nav-page-link" href="Cumulus_Linux_Index.html">Cumulus Linux Index</a>

            </li>
                                    </ul>
            </nav>
        </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="Cumulus_Linux_User_Guide.html">Cumulus Linux 3.2.1</a></li>
                                                                                     <li><a href="Layer_One_and_Two.html">Layer One and Two</a></li>
                                                            </ul>
</div>            <h1 id="src-5126854"> <span>Multi-Chassis Link Aggregation - MLAG</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">

    <p  ><span id="src-5126854_indexterm-0015FA45295BFE2292ECFF2199BB8AFE">Multi-Chassis </span><span id="src-5126854_indexterm-1B4BEEE0F6AB6C7BBF3F93BAE7CAA4DB">Link Aggregation, or </span><span id="src-5126854_indexterm-4657A6FBD6E5ECB7768D6EDFBF98F700">MLAG, enables a server or switch with a two-port bond (such as a link aggregation group/LAG, EtherChannel, port group or trunk) to connect those ports to different switches and operate as if they are connected to a single, </span>logical switch. This provides greater redundancy and greater system throughput.    </p>
    <div  class="confbox admonition admonition-info">
                    <p class="title">MLAG or CLAG?</p>
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <p  >The Cumulus Linux implementation of MLAG is referred to by other vendors as CLAG, MC-LAG or VPC. You will even see references to CLAG in Cumulus Linux, including the management daemon, named <tt class=" ">clagd</tt>, and other options in the code, such as <tt class=" ">clag-id</tt>, which exist for historical purposes. But rest assured that the Cumulus Linux implementation is truly a multi-chassis link aggregation protocol, so we call it MLAG.    </p>
        </div>
    </div>
    <p  >    </p>
    <p  ><span id="src-5126854_indexterm-A8FA1AB70E5B1877AA1E1CABE53CB7D6">Dual-connected devices can create </span>LACP bonds that contain links to each physical switch. Thus, active-active links from the dual-connected devices are supported even though they are connected to two different physical switches.    </p>
    <p  >A basic setup looks like this:    </p>
    <p  >    <img  class="confluence-embedded-image confluence-thumbnail" src="images/download/thumbnails/5126854/host_ha1.png" alt="images/download/thumbnails/5126854/host_ha1.png" width="300"  />
        </p>
    <div  class="confbox admonition admonition-tip">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <p  >You can see an example of how to set up this configuration by running:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ net example clag basic-clag</code></div>
</div>
    </div>
        </div>
    </div>
    <p  >The two switches, S1 and S2, known as <i class=" ">peer switches</i>, cooperate so that they appear as a single device to host H1's bond. H1 distributes traffic between the two links to S1 and S2 in any manner that you configure on the host. Similarly, traffic inbound to H1 can traverse S1 or S2 and arrive at H1.    </p>
    <div class="section section-1" id="src-5126854_Multi-ChassisLinkAggregation-MLAG-Contents">
        <h1 class="heading "><span>Contents</span></h1>
    <p  class="expand-control-text">This chapter covers ...    </p>
    </div>
    <div class="section section-1" id="src-5126854_Multi-ChassisLinkAggregation-MLAG-reqsMLAGRequirements">
        <h1 class="heading "><span id="src-5126854_Multi-ChassisLinkAggregation-MLAG-reqs" class="confluence-anchor-link"></span><span>MLAG Requirements</span></h1>
    <p  >MLAG has these requirements:    </p>
<ul class=" "><li class=" ">    <p  >There must be a direct connection between the two peer switches implementing MLAG (S1 and S2). This is typically a bond for increased reliability and bandwidth.    </p>
</li><li class=" ">    <p  >There must be only two peer switches in one MLAG configuration, but you can have multiple configurations in a network for <i class=" ">switch-to-switch MLAG</i> (see below).    </p>
</li><li class=" ">    <p  >The peer switches implementing MLAG must be running Cumulus Linux version 2.5 or later.    </p>
</li><li class=" ">    <p  >You must specify a unique <tt class=" ">clag-id</tt> for every dual-connected bond on each peer switch; the value must be between 1 and 65535 and must be the same on both peer switches in order for the bond to be considered <i class=" ">dual-connected</i>.    </p>
</li><li class=" ">    <p  >The dual-connected devices (servers or switches) must use LACP (IEEE 802.3ad/802.1ax) to form the bond. The peer switches must also use LACP.    </p>
</li></ul>    <p  >More elaborate configurations are also possible. The number of links between the host and the switches can be greater than two, and does not have to be symmetrical:    </p>
    <p  >    <img  class="confluence-embedded-image confluence-thumbnail" src="images/download/thumbnails/5126854/host_ha2.png" alt="images/download/thumbnails/5126854/host_ha2.png" width="300"  />
        </p>
    <p  >Additionally, since S1 and S2 appear as a single switch to other bonding devices, pairs of MLAG switches can also be connected to each other in a switch-to-switch MLAG setup:    </p>
    <p  >    <img  class="confluence-embedded-image" src="images/download/attachments/5126854/2pair_mlag.png" alt="images/download/attachments/5126854/2pair_mlag.png"   />
        </p>
    <p  >In this case, L1 and L2 are also MLAG peer switches, and thus present a two-port bond from a single logical system to S1 and S2. S1 and S2 do the same as far as L1 and L2 are concerned. For a switch-to-switch MLAG configuration, each switch pair must have a unique system MAC address. In the above example, switches L1 and L2 each have the same system MAC address configured. Switch pair S1 and S2 each have the same system MAC address configured; however, it is a different system MAC address than the one used by the switch pair L1 and L2.    </p>
    </div>
    <div class="section section-1" id="src-5126854_Multi-ChassisLinkAggregation-MLAG-LACPandDual-Connectedness">
        <h1 class="heading "><span>LACP and Dual-Connectedness</span></h1>
    <p  ><span id="src-5126854_indexterm-4BF74753F29678E5A0E4B42DDB38BF36">In order for MLAG to operate correctly, the peer switches must know which links are </span><i class=" ">dual-connected</i>, or are connected to the same host or switch. To do this, specify a <tt class=" ">clag-id</tt> for every dual-connected bond on each peer switch; the <tt class=" ">clag-id</tt> must be the same for the corresponding bonds on both peer switches. <a  class="external-link" href="http://en.wikipedia.org/wiki/Link_Aggregation_Control_Protocol#Link_Aggregation_Control_Protocol">Link Aggregation Control Protocol (LACP)</a>, the IEEE standard protocol for managing bonds, is used for verifying dual-connectedness. LACP runs on the dual-connected device and on each of the peer switches. On the dual-connected device, the only configuration requirement is to create a bond that will be managed by LACP.    </p>
    <p  >On each of the peer switches, the links connected to the dual-connected host or switch must be placed in the bond. This is true even if the links are a single port on each peer switch, where each port is placed into a bond, as shown below:    </p>
    <p  >    <img  class="confluence-embedded-image confluence-thumbnail" src="images/download/thumbnails/5126854/2l_3h.png" alt="images/download/thumbnails/5126854/2l_3h.png" width="300"  />
        </p>
    <p  >All of the dual-connected bonds on the peer switches have their system ID set to the MLAG system ID. Therefore, from the point of view of the hosts, each of the links in its bond is connected to the same system, and so the host will use both links.    </p>
    <p  >Each peer switch periodically makes a list of the LACP partner MAC addresses for all of their bonds and sends that list to its peer (using the <tt class=" ">clagd</tt> service; see below). The LACP partner MAC address is the MAC address of the system at the other end of a bond, which in the figure above would be hosts H1, H2 and H3. When a switch receives this list from its peer, it compares the list to the LACP partner MAC addresses on its switch. If any matches are found and the <tt class=" ">clag-id</tt> for those bonds match, then that bond is a dual-connected bond. You can also find the LACP partner MAC address by running <tt class=" ">net show bridge macs</tt>, or by looking in the <tt class=" ">/sys/class/net/&lt;bondname&gt;/bonding/ad_partner_mac sysfs</tt> file for each bond.    </p>
    </div>
    <div class="section section-1" id="src-5126854_Multi-ChassisLinkAggregation-MLAG-configuringConfiguringMLAG">
        <h1 class="heading "><span id="src-5126854_Multi-ChassisLinkAggregation-MLAG-configuring" class="confluence-anchor-link"></span><span>Configuring MLAG</span></h1>
    <p  >Configuring MLAG involves:    </p>
<ul class=" "><li class=" ">    <p  >On the dual-connected devices, creating a bond that uses LACP.    </p>
</li><li class=" ">    <p  >On each peer switch, configuring the interfaces, including bonds, VLANs, bridges and peer links.    </p>
</li></ul>    <div  class="confbox admonition admonition-note">
                    <p class="title">Keep MLAG Configurations in Sync</p>
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <p  >MLAG synchronizes the dynamic state between the two peer switches, but it does not synchronize the switch configurations. After modifying the configuration of one peer switch, you must make the same changes to the configuration on the other peer switch. This applies to all configuration changes, including:    </p>
<ul class=" "><li class=" ">    <p  >Port configuration: For example, VLAN membership, <a   href="#src-5126854_Multi-ChassisLinkAggregation-MLAG-mtu">MTU</a> and bonding parameters.    </p>
</li><li class=" ">    <p  >Bridge configuration: For example, spanning tree parameters or bridge properties.    </p>
</li><li class=" ">    <p  >Static address entries: For example, static FDB entries and static IGMP entries.    </p>
</li><li class=" ">    <p  >QoS configuration: For example, ACL entries.    </p>
</li></ul>    <p  >You can verify the configuration of VLAN membership using the <tt class=" ">net show clag verify-vlans</tt> command.    </p>
    <p  class="expand-control-text">Click to see the output ...    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus</code><code class="color1">@leaf01</code><code class="plain">:~$ net show clag verify-vlans</code></div>
<div class="line"><code class="plain">Our Bond Interface   VlanId   Peer Bond Interface</code></div>
<div class="line"><code class="plain">------------------   ------   -------------------</code></div>
<div class="line"><code class="plain">server01                  </code><code class="value">1</code><code class="plain">   server01           </code></div>
<div class="line"><code class="plain">server01                 </code><code class="value">10</code><code class="plain">   server01           </code></div>
<div class="line"><code class="plain">server01                 </code><code class="value">20</code><code class="plain">   server01           </code></div>
<div class="line"><code class="plain">server01                 </code><code class="value">30</code><code class="plain">   server01           </code></div>
<div class="line"><code class="plain">server01                 </code><code class="value">40</code><code class="plain">   server01           </code></div>
<div class="line"><code class="plain">server01                 </code><code class="value">50</code><code class="plain">   server01           </code></div>
<div class="line"><code class="plain">uplink                    </code><code class="value">1</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                   </code><code class="value">10</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                   </code><code class="value">20</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                   </code><code class="value">30</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                   </code><code class="value">40</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                   </code><code class="value">50</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">100</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">101</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">102</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">103</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">104</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">105</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">106</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">107</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">108</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">109</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">110</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">111</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">112</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">113</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">114</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">115</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">116</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">117</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">118</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">119</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">120</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">121</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">122</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">123</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">124</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">125</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">126</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">127</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">128</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">129</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">130</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">131</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">132</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">133</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">134</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">135</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">136</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">137</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">138</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">139</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">140</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">141</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">142</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">143</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">144</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">145</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">146</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">147</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">148</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">149</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">150</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">151</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">152</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">153</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">154</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">155</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">156</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">157</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">158</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">159</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">160</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">161</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">162</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">163</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">164</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">165</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">166</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">167</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">168</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">169</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">170</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">171</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">172</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">173</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">174</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">175</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">176</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">177</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">178</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">179</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">180</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">181</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">182</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">183</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">184</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">185</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">186</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">187</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">188</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">189</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">190</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">191</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">192</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">193</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">194</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">195</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">196</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">197</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">198</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">199</code><code class="plain">   uplink             </code></div>
<div class="line"><code class="plain">uplink                  </code><code class="value">200</code><code class="plain">   uplink          </code></div>
</div>
    </div>
        </div>
    </div>
    <div class="section section-2" id="src-5126854_Multi-ChassisLinkAggregation-MLAG-ReservedMACAddressRange">
        <h2 class="heading "><span>Reserved MAC Address Range</span></h2>
    <p  >In order to prevent MAC address conflicts with other interfaces in the same bridged network, Cumulus Networks has <a  class="external-link" href="https://support.cumulusnetworks.com/hc/en-us/articles/203837076">reserved a range of MAC addresses</a> specifically to use with MLAG. This range of MAC addresses is 44:38:39:ff:00:00 to 44:38:39:ff:ff:ff.    </p>
    <p  >Cumulus Networks recommends you use this range of MAC addresses when configuring MLAG.    </p>
    </div>
    <div class="section section-2" id="src-5126854_Multi-ChassisLinkAggregation-MLAG-ConfiguringtheHostorSwitch">
        <h2 class="heading "><span>Configuring the Host or Switch</span></h2>
    <p  >On your dual-connected device, create a bond that uses LACP. The method you use varies with the type of device you are configuring. The following image is a basic MLAG configuration, showing all the essential elements; a more detailed two-leaf/two-spine configuration is <a   href="#src-5126854_Multi-ChassisLinkAggregation-MLAG-example">below</a>.    </p>
    <p  >    <img  class="confluence-embedded-image" src="images/download/attachments/5126854/mlag_basic.png" alt="images/download/attachments/5126854/mlag_basic.png" width="500"  />
        </p>
    </div>
    <div class="section section-2" id="src-5126854_Multi-ChassisLinkAggregation-MLAG-ConfiguringtheInterfaces">
        <h2 class="heading "><span>Configuring the Interfaces</span></h2>
    <p  >Every interface that connects to the MLAG pair from a dual-connected device should be placed into a <a   href="Bonding_-_Link_Aggregation.html">bond</a>, even if the bond contains only a single link on a single physical switch (even though the MLAG pair contains two or more links). Layer 2 data travels over this bond. In the examples throughout this chapter, <i class=" ">peerlink</i> is the name of the bond.    </p>
    <p  >Single-attached hosts, also known as <i class=" ">orphan ports</i>, can be just a member of the bridge.    </p>
    <p  >Additionally, the fast mode of LACP should be configured on the bond to allow more timely updates of the LACP state. These bonds are then placed in a bridge, which must include the peer link between the switches.    </p>
    <p  >In order to enable communication between the <tt class=" ">clagd</tt><span id="src-5126854_indexterm-FEF0CFEC27E4760DB21260B4A0DD6FAA"> services on the peer switches, you should choose an unused </span><span id="src-5126854_indexterm-9259E8FF64A968BB3C3756121E3A5760">VLAN (also known </span><span id="src-5126854_indexterm-1F323987942C22FABC55C02950B18FE3">as </span>a <i class=" ">switched virtual interface</i> or <i class=" ">SVI</i> here) and assign an unrouteable link-local address to give the peer switches layer 3 connectivity between each other. To ensure that the VLAN is completely independent of the bridge and spanning tree forwarding decisions, configure the VLAN as a VLAN subinterface on the peer link bond rather than the VLAN-aware bridge. Cumulus Networks recommends you use 4094 for the peer link VLAN (<i class=" ">peerlink.4094</i> below) if possible. In addition, to avoid issues with STP, make sure you include untagged traffic on the peer link.    </p>
    <p  >You can also specify a backup interface, which is any layer 3 backup interface for your peer links in the event that the peer link goes down. <a   href="#src-5126854_Multi-ChassisLinkAggregation-MLAG-backup">See below</a> for more information about the backup link.    </p>
    <p  >For example, if <i class=" ">peerlink</i> is the inter-chassis bond, and VLAN 4094 is the peer link VLAN, configure <i class=" ">peerlink.4094</i> as follows:    </p>
    <div  class="confbox admonition admonition-tip">
                    <p class="title">Configuring the peerlink Interface</p>
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus</code><code class="color1">@leaf01</code><code class="plain">:~$ net add </code><code class="keyword">interface</code><code class="plain"> peerlink.</code><code class="value">4094</code><code class="plain"> peerlink.</code><code class="value">4094</code></div>
<div class="line"><code class="plain">cumulus</code><code class="color1">@leaf01</code><code class="plain">:~$ net add </code><code class="keyword">interface</code><code class="plain"> peerlink.</code><code class="value">4094</code><code class="plain"> address </code><code class="value">169.254</code><code class="plain">.</code><code class="value">1.1</code><code class="plain">/</code><code class="value">30</code></div>
<div class="line"><code class="plain">cumulus</code><code class="color1">@leaf01</code><code class="plain">:~$ net add </code><code class="keyword">interface</code><code class="plain"> peerlink.</code><code class="value">4094</code><code class="plain"> clagd-peer-ip </code><code class="value">169.254</code><code class="plain">.</code><code class="value">1.2</code></div>
<div class="line"><code class="plain">cumulus</code><code class="color1">@leaf01</code><code class="plain">:~$ net add </code><code class="keyword">interface</code><code class="plain"> peerlink.</code><code class="value">4094</code><code class="plain"> clagd-backup-ip </code><code class="value">192.0</code><code class="plain">.</code><code class="value">2.50</code></div>
<div class="line"><code class="plain">cumulus</code><code class="color1">@leaf01</code><code class="plain">:~$ net add </code><code class="keyword">interface</code><code class="plain"> peerlink.</code><code class="value">4094</code><code class="plain"> clagd-sys-mac </code><code class="value">44</code><code class="plain">:</code><code class="value">38</code><code class="plain">:</code><code class="value">39</code><code class="plain">:FF:</code><code class="value">40</code><code class="plain">:</code><code class="value">94</code></div>
<div class="line"><code class="plain">cumulus</code><code class="color1">@leaf01</code><code class="plain">:~$ net pending</code></div>
<div class="line"><code class="plain">cumulus</code><code class="color1">@leaf01</code><code class="plain">:~$ net commit</code></div>
</div>
    </div>
    <p  >There is no need to add VLAN 4094 to the bridge VLAN list, as it is unnecessary there.    </p>
    <p  >The above commands produce the following configuration in the <tt class=" ">/etc/network/interfaces</tt> file:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">auto peerlink.4094</code></div>
<div class="line"><code class="plain">iface peerlink.4094</code></div>
<div class="line"><code class="plain">  address 169.254.1.1/30</code></div>
<div class="line"><code class="plain">  clagd-peer-ip 169.254.1.2</code></div>
<div class="line"><code class="plain">  clagd-backup-ip 192.0.2.50</code></div>
<div class="line"><code class="plain">  clagd-sys-mac 44:38:39:FF:40:94</code></div>
</div>
    </div>
    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <p  >Keep in mind that if you change the MLAG configuration by editing the <tt class=" ">interfaces</tt> file, the changes take effect when you bring the peer link interface up with <tt class=" ">ifup</tt>. Do <strong class=" ">not</strong> use <tt class=" ">systemctl restart clagd.service</tt> to apply the new configuration.    </p>
        </div>
    </div>
        </div>
    </div>
    <div  class="confbox admonition admonition-warning">
                    <p class="title">Don't Use 169.254.0.1</p>
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <p  >Do not use 169.254.0.1 as the MLAG peerlink IP address, as Cumulus Linux uses this address exclusively for <a   href="Border_Gateway_Protocol_-_BGP.html">BGP unnumbered</a> interfaces.    </p>
        </div>
    </div>
    </div>
    <div class="section section-2" id="src-5126854_Multi-ChassisLinkAggregation-MLAG-rolesUnderstandingSwitchRolesandSettingPriority">
        <h2 class="heading "><span id="src-5126854_Multi-ChassisLinkAggregation-MLAG-roles" class="confluence-anchor-link"></span><span>Understanding Switch Roles and Setting Priority</span></h2>
    <p  >Each MLAG-enabled switch in the pair has a <i class=" ">role</i>. When the peering relationship is established between the two switches, one switch is put into the <i class=" ">primary</i> role, and the other one is put into the <i class=" ">secondary</i> role. When an MLAG-enabled switch is in the secondary role, it does not send STP BPDUs on dual-connected links; it only sends BPDUs on single-connected links. The switch in the primary role sends STP BPDUs on all single- and dual-connected links.    </p>
    <div  class="tablewrap">
        <table class="confluenceTable">
        <thead class=" ">    <tr>
            <td  class="confluenceTh" rowspan="1" colspan="1">
        <p  >Sends BPDUs Via    </p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
        <p  >Primary    </p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
        <p  >Secondary    </p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >Single-connected links    </p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >Yes    </p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >Yes    </p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >Dual-connected links    </p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >Yes    </p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >No    </p>
            </td>
        </tr>
</tbody>        </table>
            </div>
    <p  >By default, the role is determined by comparing the MAC addresses of the two sides of the peering link; the switch with the lower MAC address assumes the primary role. You can override this by setting the <tt class=" ">clagd-priority</tt> option for the peer link:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@leaf01:~$ net add interface peerlink.4094 clagd-priority 2048</code></div>
<div class="line"><code class="plain">cumulus@leaf01:~$ net pending</code></div>
<div class="line"><code class="plain">cumulus@leaf01:~$ net commit</code></div>
</div>
    </div>
    <p  >The switch with the lower priority value is given the primary role; the default value is 32768, and the range is 0 to 65535. Read the <tt class=" ">clagd(8)</tt> and <tt class=" ">clagctl(8)</tt> man pages for more information.    </p>
    <p  >When the <tt class=" ">clagd</tt> service is exited during switch reboot or the service is stopped in the primary switch, the peer switch that is in the secondary role becomes the primary.    </p>
    <p  >However, if the primary switch goes down without stopping the <tt class=" ">clagd</tt> service for any reason, or if the peer link goes down, the secondary switch will <strong class=" ">not</strong> change its role. In case the peer switch is determined to be not alive, the switch in the secondary role will roll back the LACP system ID to be the bond interface MAC address instead of the <tt class=" ">clagd-sys-mac</tt> and the switch in primary role uses the <tt class=" ">clagd-sys-mac</tt> as the LACP system ID on the bonds.    </p>
    </div>
    </div>
    <div class="section section-1" id="src-5126854_Multi-ChassisLinkAggregation-MLAG-exampleExampleMLAGConfiguration">
        <h1 class="heading "><span id="src-5126854_Multi-ChassisLinkAggregation-MLAG-example" class="confluence-anchor-link"></span><span>Example MLAG Configuration</span></h1>
    <p  >An example configuration is included below. It configures two bonds for MLAG, each with a single port, a peer link that is a bond with two member ports, and three VLANs on each port.    </p>
    <p  >    <img  class="confluence-embedded-image" src="images/download/attachments/5126854/mlag_nclu.png" alt="images/download/attachments/5126854/mlag_nclu.png"  height="400" />
        </p>
    <p  >You configure these interfaces using <a   href="Network_Command_Line_Utility.html">NCLU</a>, so the bridges are in <a   href="VLAN-aware_Bridge_Mode_for_Large-scale_Layer_2_Environments.html">VLAN-aware mode</a>. The bridges use these Cumulus Linux-specific keywords:    </p>
<ul class=" "><li class=" ">    <p  ><tt class=" ">bridge-vids</tt>, which defines the allowed list of tagged 802.1q VLAN IDs for all bridge member interfaces. You can specify non-contiguous ranges with a space-separated list, like<br/><tt class=" ">bridge-vids 100-200 300 400-500</tt>.    </p>
</li><li class=" ">    <p  ><tt class=" ">bridge-pvid</tt>, which defines the untagged VLAN ID for each port. This is commonly referred to as the <i class=" ">native VLAN</i>.    </p>
</li></ul>    <p  >The bridge configurations below indicate that each bond carries tagged frames on VLANs 10, 20, 30, 40, 50 and 100 to 200 (as specified by <tt class=" ">bridge-vids</tt>), but untagged frames on VLAN 1 (as specified by <tt class=" ">bridge-pvid</tt>). Also, take note on how you configure the VLAN subinterfaces used for <tt class=" ">clagd</tt> communication (<i class=" ">peerlink.4090</i> and <i class=" ">peerlink.4094 </i>in the sample configuration below). Finally, the host configurations for server01 through server04 are not shown here. The configurations for each corresponding node are almost identical, except for the IP addresses used for managing the <tt class=" ">clagd</tt> service.    </p>
    <div  class="confbox admonition admonition-note">
                    <p class="title">VLAN Precautions</p>
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <p  >At minimum, this VLAN subinterface should not be in your layer 2 domain, and you should give it a very high VLAN ID (up to 4094). Read more about the <a   href="VLAN-aware_Bridge_Mode_for_Large-scale_Layer_2_Environments.html#src-5126846_VLAN-awareBridgeModeforLarge-scaleLayer2Environments-range">range of VLAN IDs you can use</a>.    </p>
        </div>
    </div>
    <p  >The commands to create the configurations for both spines should look like the following. Note that the <tt class=" ">clag-id</tt> and <tt class=" ">clagd-sys-mac</tt> must be the same for the corresponding bonds on spine01 and spine02:    </p>
    <div  class="tablewrap">
        <table class="confluenceTable">
        <thead class=" "></thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  ><strong class=" ">spine01</strong>    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@spine01:~$ net show configuration commands </code></div>
<div class="line"><code class="plain">echo 'auto lo' &gt; /etc/network/interfaces</code></div>
<div class="line"><code class="plain">echo 'iface lo inet loopback' &gt;&gt; /etc/network/interfaces</code></div>
<div class="line"><code class="plain">echo 'auto eth0' &gt;&gt; /etc/network/interfaces</code></div>
<div class="line"><code class="plain">echo 'iface eth0 inet dhcp' &gt;&gt; /etc/network/interfaces</code></div>
<div class="line"><code class="plain">echo 'zebra=yes' &gt; /etc/quagga/daemons</code></div>
<div class="line"><code class="plain">echo '' &gt; /etc/quagga/Quagga.conf</code></div>
<div class="line"><code class="plain">net abort</code></div>
<div class="line"><code class="plain">net add hostname spine01</code></div>
<div class="line"><code class="plain">net add interface swp1-4,29-30 mtu 9216</code></div>
<div class="line"><code class="plain">net add bond exit01-02 bond slaves swp29-30</code></div>
<div class="line"><code class="plain">net add bond leaf01-02 bond slaves swp1-2</code></div>
<div class="line"><code class="plain">net add bond leaf03-04 bond slaves swp3-4</code></div>
<div class="line"><code class="plain">net add bond peerlink bond slaves swp31-32</code></div>
<div class="line"><code class="plain">net add loopback lo ip address 10.0.0.21/32</code></div>
<div class="line"><code class="plain">net add interface eth0 ip address dhcp</code></div>
<div class="line"><code class="plain">net add bridge bridge ports leaf01-02,leaf03-04,exit01-02,peerlink</code></div>
<div class="line"><code class="plain">net add bridge bridge pvid 1</code></div>
<div class="line"><code class="plain">net add bridge bridge vids 10,20,30,40,50,100-200</code></div>
<div class="line"><code class="plain">net add bridge stp treeprio 4096</code></div>
<div class="line"><code class="plain">net add vlan 10 ip address 10.1.10.2/24</code></div>
<div class="line"><code class="plain">net add vlan 10 ip address-virtual 44:39:39:FF:00:10 10.1.10.1/24</code></div>
<div class="line"><code class="plain">net add vlan 20 ip address 10.1.20.2/24</code></div>
<div class="line"><code class="plain">net add vlan 20 ip address-virtual 44:39:39:FF:00:20 10.1.20.1/24</code></div>
<div class="line"><code class="plain">net add vlan 10 alias 'VM 10 Network'</code></div>
<div class="line"><code class="plain">net add vlan 20 alias 'VM 20 Network'</code></div>
<div class="line"><code class="plain">net add bond exit01-02 clag id 2930</code></div>
<div class="line"><code class="plain">net add bond exit01-02 mtu 9216</code></div>
<div class="line"><code class="plain">net add bond leaf01-02 mtu 9216</code></div>
<div class="line"><code class="plain">net add bond leaf03-04 mtu 9216</code></div>
<div class="line"><code class="plain">net add bond leaf01-02 clag id 1012</code></div>
<div class="line"><code class="plain">net add bond leaf03-04 clag id 1034</code></div>
<div class="line"><code class="plain">net add interface peerlink.4090 ip address 169.254.255.1/30</code></div>
<div class="line"><code class="plain">net add interface peerlink.4090 clag backup-ip 192.168.0.22</code></div>
<div class="line"><code class="plain">net add interface peerlink.4090 clag enable yes</code></div>
<div class="line"><code class="plain">net add interface peerlink.4090 clag peer-ip 169.254.255.2</code></div>
<div class="line"><code class="plain">net add interface peerlink.4090 clag sys-mac 44:39:39:FF:40:90</code></div>
<div class="line"><code class="plain">net add routing log file /var/log/quagga/quagga.log</code></div>
<div class="line"><code class="plain">net add routing log timestamp precision 6</code></div>
</div>
    </div>
    <p  class="expand-control-text">These commands create the following configuration ...    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@spine01:~$ cat /etc/network/interfaces</code></div>
<div class="line"><code class="plain"># The loopback network interface</code></div>
<div class="line"><code class="plain">auto lo</code></div>
<div class="line"><code class="plain">iface lo inet loopback</code></div>
<div class="line"><code class="plain">    address 10.0.0.21/32</code></div>
<div class="line"> </div>
<div class="line"><code class="plain"># The primary network interface</code></div>
<div class="line"><code class="plain">auto eth0</code></div>
<div class="line"><code class="plain">iface eth0 inet dhcp</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp1</code></div>
<div class="line"><code class="plain">iface swp1</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp2</code></div>
<div class="line"><code class="plain">iface swp2</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp3</code></div>
<div class="line"><code class="plain">iface swp3</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp4</code></div>
<div class="line"><code class="plain">iface swp4</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp29</code></div>
<div class="line"><code class="plain">iface swp29</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp30</code></div>
<div class="line"><code class="plain">iface swp30</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp31</code></div>
<div class="line"><code class="plain">iface swp31</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp32</code></div>
<div class="line"><code class="plain">iface swp32</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto bridge</code></div>
<div class="line"><code class="plain">iface bridge</code></div>
<div class="line"><code class="plain">    bridge-ports exit01-02 leaf01-02 leaf03-04 peerlink</code></div>
<div class="line"><code class="plain">    bridge-pvid 1</code></div>
<div class="line"><code class="plain">    bridge-vids 10 20 30 40 50 100-200</code></div>
<div class="line"><code class="plain">    bridge-vlan-aware yes</code></div>
<div class="line"><code class="plain">    mstpctl-treeprio 4096</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto exit01-02</code></div>
<div class="line"><code class="plain">iface exit01-02</code></div>
<div class="line"><code class="plain">    bond-slaves swp29 swp30</code></div>
<div class="line"><code class="plain">    clag-id 2930</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto leaf01-02</code></div>
<div class="line"><code class="plain">iface leaf01-02</code></div>
<div class="line"><code class="plain">    bond-slaves swp1 swp2</code></div>
<div class="line"><code class="plain">    clag-id 1012</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto leaf03-04</code></div>
<div class="line"><code class="plain">iface leaf03-04</code></div>
<div class="line"><code class="plain">    bond-slaves swp3 swp4</code></div>
<div class="line"><code class="plain">    clag-id 1034</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto peerlink</code></div>
<div class="line"><code class="plain">iface peerlink</code></div>
<div class="line"><code class="plain">    bond-slaves swp31 swp32</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto peerlink.4090</code></div>
<div class="line"><code class="plain">iface peerlink.4090</code></div>
<div class="line"><code class="plain">    address 169.254.255.1/30</code></div>
<div class="line"><code class="plain">    clagd-backup-ip 192.168.0.22</code></div>
<div class="line"><code class="plain">    clagd-enable yes</code></div>
<div class="line"><code class="plain">    clagd-peer-ip 169.254.255.2</code></div>
<div class="line"><code class="plain">    clagd-sys-mac 44:39:39:FF:40:90</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">auto vlan10</code></div>
<div class="line"><code class="plain">iface vlan10</code></div>
<div class="line"><code class="plain">    address 10.1.10.2/24</code></div>
<div class="line"><code class="plain">    address-virtual 44:39:39:FF:00:10 10.1.10.1/24</code></div>
<div class="line"><code class="plain">    alias VM 10 Network</code></div>
<div class="line"><code class="plain">    vlan-id 10</code></div>
<div class="line"><code class="plain">    vlan-raw-device bridge</code></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><code class="plain">auto vlan20</code></div>
<div class="line"><code class="plain">iface vlan20</code></div>
<div class="line"><code class="plain">    address 10.1.20.2/24</code></div>
<div class="line"><code class="plain">    address-virtual 44:39:39:FF:00:20 10.1.20.1/24</code></div>
<div class="line"><code class="plain">    alias VM 20 Network</code></div>
<div class="line"><code class="plain">    vlan-id 20</code></div>
<div class="line"><code class="plain">    vlan-raw-device bridge</code></div>
</div>
    </div>
    <p  >    </p>
    <p  >    </p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  ><strong class=" ">spine02</strong>    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus</code><code class="color1">@spine02</code><code class="plain">:~$ net show configuration commands </code></div>
<div class="line"><code class="plain">echo </code><code class="string">'auto lo'</code><code class="plain"> &gt; /etc/network/interfaces</code></div>
<div class="line"><code class="plain">echo </code><code class="string">'iface lo inet loopback'</code><code class="plain"> &gt;&gt; /etc/network/interfaces</code></div>
<div class="line"><code class="plain">echo </code><code class="string">'auto eth0'</code><code class="plain"> &gt;&gt; /etc/network/interfaces</code></div>
<div class="line"><code class="plain">echo </code><code class="string">'iface eth0 inet dhcp'</code><code class="plain"> &gt;&gt; /etc/network/interfaces</code></div>
<div class="line"><code class="plain">echo </code><code class="string">'zebra=yes'</code><code class="plain"> &gt; /etc/quagga/daemons</code></div>
<div class="line"><code class="plain">echo </code><code class="string">''</code><code class="plain"> &gt; /etc/quagga/Quagga.conf</code></div>
<div class="line"><code class="plain">net abort</code></div>
<div class="line"><code class="plain">net add hostname spine02</code></div>
<div class="line"><code class="plain">net add </code><code class="keyword">interface</code><code class="plain"> swp1-</code><code class="value">4</code><code class="plain">,</code><code class="value">29</code><code class="plain">-</code><code class="value">30</code><code class="plain"> mtu </code><code class="value">9216</code></div>
<div class="line"><code class="plain">net add bond exit01-</code><code class="value">02</code><code class="plain"> bond slaves swp29-</code><code class="value">30</code></div>
<div class="line"><code class="plain">net add bond leaf01-</code><code class="value">02</code><code class="plain"> bond slaves swp1-</code><code class="value">2</code></div>
<div class="line"><code class="plain">net add bond leaf03-</code><code class="value">04</code><code class="plain"> bond slaves swp3-</code><code class="value">4</code></div>
<div class="line"><code class="plain">net add bond peerlink bond slaves swp31-</code><code class="value">32</code></div>
<div class="line"><code class="plain">net add loopback lo ip address </code><code class="value">10.0</code><code class="plain">.</code><code class="value">0.22</code><code class="plain">/</code><code class="value">32</code></div>
<div class="line"><code class="plain">net add </code><code class="keyword">interface</code><code class="plain"> eth0 ip address dhcp</code></div>
<div class="line"><code class="plain">net add bridge bridge ports leaf01-</code><code class="value">02</code><code class="plain">,leaf03-</code><code class="value">04</code><code class="plain">,exit01-</code><code class="value">02</code><code class="plain">,peerlink</code></div>
<div class="line"><code class="plain">net add bridge bridge pvid </code><code class="value">1</code></div>
<div class="line"><code class="plain">net add bridge bridge vids </code><code class="value">10</code><code class="plain">,</code><code class="value">20</code><code class="plain">,</code><code class="value">30</code><code class="plain">,</code><code class="value">40</code><code class="plain">,</code><code class="value">50</code><code class="plain">,</code><code class="value">100</code><code class="plain">-</code><code class="value">200</code></div>
<div class="line"><code class="plain">net add bridge stp treeprio </code><code class="value">4096</code></div>
<div class="line"><code class="plain">net add vlan </code><code class="value">10</code><code class="plain"> ip address </code><code class="value">10.1</code><code class="plain">.</code><code class="value">10.3</code><code class="plain">/</code><code class="value">24</code></div>
<div class="line"><code class="plain">net add vlan </code><code class="value">10</code><code class="plain"> ip address-virtual </code><code class="value">44</code><code class="plain">:</code><code class="value">39</code><code class="plain">:</code><code class="value">39</code><code class="plain">:FF:</code><code class="value">00</code><code class="plain">:</code><code class="value">10</code><code class="plain"> </code><code class="value">10.1</code><code class="plain">.</code><code class="value">10.1</code><code class="plain">/</code><code class="value">24</code></div>
<div class="line"><code class="plain">net add vlan </code><code class="value">20</code><code class="plain"> ip address </code><code class="value">10.1</code><code class="plain">.</code><code class="value">20.3</code><code class="plain">/</code><code class="value">24</code></div>
<div class="line"><code class="plain">net add vlan </code><code class="value">20</code><code class="plain"> ip address-virtual </code><code class="value">44</code><code class="plain">:</code><code class="value">39</code><code class="plain">:</code><code class="value">39</code><code class="plain">:FF:</code><code class="value">00</code><code class="plain">:</code><code class="value">20</code><code class="plain"> </code><code class="value">10.1</code><code class="plain">.</code><code class="value">20.1</code><code class="plain">/</code><code class="value">24</code></div>
<div class="line"><code class="plain">net add vlan </code><code class="value">10</code><code class="plain"> alias </code><code class="string">'VM 10 Network'</code></div>
<div class="line"><code class="plain">net add vlan </code><code class="value">20</code><code class="plain"> alias </code><code class="string">'VM 20 Network'</code></div>
<div class="line"><code class="plain">net add bond exit01-</code><code class="value">02</code><code class="plain"> clag id </code><code class="value">2930</code></div>
<div class="line"><code class="plain">net add bond exit01-</code><code class="value">02</code><code class="plain"> mtu </code><code class="value">9216</code></div>
<div class="line"><code class="plain">net add bond leaf01-</code><code class="value">02</code><code class="plain"> mtu </code><code class="value">9216</code></div>
<div class="line"><code class="plain">net add bond leaf03-</code><code class="value">04</code><code class="plain"> mtu </code><code class="value">9216</code></div>
<div class="line"><code class="plain">net add bond leaf01-</code><code class="value">02</code><code class="plain"> clag id </code><code class="value">1012</code></div>
<div class="line"><code class="plain">net add bond leaf03-</code><code class="value">04</code><code class="plain"> clag id </code><code class="value">1034</code></div>
<div class="line"><code class="plain">net add </code><code class="keyword">interface</code><code class="plain"> peerlink.</code><code class="value">4090</code><code class="plain"> ip address </code><code class="value">169.254</code><code class="plain">.</code><code class="value">255.2</code><code class="plain">/</code><code class="value">30</code></div>
<div class="line"><code class="plain">net add </code><code class="keyword">interface</code><code class="plain"> peerlink.</code><code class="value">4090</code><code class="plain"> clag backup-ip </code><code class="value">192.168</code><code class="plain">.</code><code class="value">0.21</code></div>
<div class="line"><code class="plain">net add </code><code class="keyword">interface</code><code class="plain"> peerlink.</code><code class="value">4090</code><code class="plain"> clag enable yes</code></div>
<div class="line"><code class="plain">net add </code><code class="keyword">interface</code><code class="plain"> peerlink.</code><code class="value">4090</code><code class="plain"> clag peer-ip </code><code class="value">169.254</code><code class="plain">.</code><code class="value">255.1</code></div>
<div class="line"><code class="plain">net add </code><code class="keyword">interface</code><code class="plain"> peerlink.</code><code class="value">4090</code><code class="plain"> clag sys-mac </code><code class="value">44</code><code class="plain">:</code><code class="value">39</code><code class="plain">:</code><code class="value">39</code><code class="plain">:FF:</code><code class="value">40</code><code class="plain">:</code><code class="value">90</code></div>
<div class="line"><code class="plain">net add </code><code class="keyword">interface</code><code class="plain"> peerlink.</code><code class="value">4090</code><code class="plain"> alias </code><code class="string">'Spine01-Spine02 MLAG peerlink'</code></div>
<div class="line"><code class="plain">net add routing log file /var/log/quagga/quagga.log</code></div>
<div class="line"><code class="plain">net add routing log timestamp precision </code><code class="value">6</code></div>
</div>
    </div>
    <p  class="expand-control-text">These commands create the following configuration ...    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@spine02:~$ cat /etc/network/interfaces</code></div>
<div class="line"><code class="plain"># The loopback network interface</code></div>
<div class="line"><code class="plain">auto lo</code></div>
<div class="line"><code class="plain">iface lo inet loopback</code></div>
<div class="line"><code class="plain">    address 10.0.0.22/32</code></div>
<div class="line"> </div>
<div class="line"><code class="plain"># The primary network interface</code></div>
<div class="line"><code class="plain">auto eth0</code></div>
<div class="line"><code class="plain">iface eth0 inet dhcp</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp1</code></div>
<div class="line"><code class="plain">iface swp1</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp2</code></div>
<div class="line"><code class="plain">iface swp2</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp3</code></div>
<div class="line"><code class="plain">iface swp3</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp4</code></div>
<div class="line"><code class="plain">iface swp4</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp29</code></div>
<div class="line"><code class="plain">iface swp29</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp30</code></div>
<div class="line"><code class="plain">iface swp30</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp31</code></div>
<div class="line"><code class="plain">iface swp31</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp32</code></div>
<div class="line"><code class="plain">iface swp32</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto bridge</code></div>
<div class="line"><code class="plain">iface bridge</code></div>
<div class="line"><code class="plain">    bridge-ports exit01-02 leaf01-02 leaf03-04 peerlink</code></div>
<div class="line"><code class="plain">    bridge-pvid 1</code></div>
<div class="line"><code class="plain">    bridge-vids 10 20 30 40 50 100-200</code></div>
<div class="line"><code class="plain">    bridge-vlan-aware yes</code></div>
<div class="line"><code class="plain">    mstpctl-treeprio 4096</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto exit01-02</code></div>
<div class="line"><code class="plain">iface exit01-02</code></div>
<div class="line"><code class="plain">    bond-slaves swp29 swp30</code></div>
<div class="line"><code class="plain">    clag-id 2930</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto leaf01-02</code></div>
<div class="line"><code class="plain">iface leaf01-02</code></div>
<div class="line"><code class="plain">    bond-slaves swp1 swp2</code></div>
<div class="line"><code class="plain">    clag-id 1012</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto leaf03-04</code></div>
<div class="line"><code class="plain">iface leaf03-04</code></div>
<div class="line"><code class="plain">    bond-slaves swp3 swp4</code></div>
<div class="line"><code class="plain">    clag-id 1034</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto peerlink</code></div>
<div class="line"><code class="plain">iface peerlink</code></div>
<div class="line"><code class="plain">    bond-slaves swp31 swp32</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto peerlink.4090</code></div>
<div class="line"><code class="plain">iface peerlink.4090</code></div>
<div class="line"><code class="plain">    address 169.254.255.2/30</code></div>
<div class="line"><code class="plain">    alias Spine01-Spine02 MLAG peerlink</code></div>
<div class="line"><code class="plain">    clagd-backup-ip 192.168.0.21</code></div>
<div class="line"><code class="plain">    clagd-enable yes</code></div>
<div class="line"><code class="plain">    clagd-peer-ip 169.254.255.1</code></div>
<div class="line"><code class="plain">    clagd-sys-mac 44:39:39:FF:40:90</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">auto vlan10</code></div>
<div class="line"><code class="plain">iface vlan10</code></div>
<div class="line"><code class="plain">    address 10.1.10.3/24</code></div>
<div class="line"><code class="plain">    address-virtual 44:39:39:FF:00:10 10.1.10.1/24</code></div>
<div class="line"><code class="plain">    alias VM 10 Network</code></div>
<div class="line"><code class="plain">    vlan-id 10</code></div>
<div class="line"><code class="plain">    vlan-raw-device bridge</code></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><code class="plain">auto vlan20</code></div>
<div class="line"><code class="plain">iface vlan20</code></div>
<div class="line"><code class="plain">    address 10.1.20.3/24</code></div>
<div class="line"><code class="plain">    address-virtual 44:39:39:FF:00:20 10.1.20.1/24</code></div>
<div class="line"><code class="plain">    alias VM 20 Network</code></div>
<div class="line"><code class="plain">    vlan-id 20</code></div>
<div class="line"><code class="plain">    vlan-raw-device bridge</code></div>
</div>
    </div>
            </td>
        </tr>
</tbody>        </table>
            </div>
    <p  >Here is an example configuration for the switches leaf01 through leaf04. Note that the <tt class=" ">clag-id</tt> and <tt class=" ">clagd-sys-mac</tt> must be the same for the corresponding bonds on leaf01 and leaf02 as well as leaf03 and leaf04:    </p>
    <div  class="tablewrap">
        <table class="confluenceTable">
        <thead class=" "></thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  ><strong class=" ">leaf01</strong>    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@leaf01:~$ net show configuration commands </code></div>
<div class="line"><code class="plain">echo 'auto lo' &gt; /etc/network/interfaces</code></div>
<div class="line"><code class="plain">echo 'iface lo inet loopback' &gt;&gt; /etc/network/interfaces</code></div>
<div class="line"><code class="plain">echo 'auto eth0' &gt;&gt; /etc/network/interfaces</code></div>
<div class="line"><code class="plain">echo 'iface eth0 inet dhcp' &gt;&gt; /etc/network/interfaces</code></div>
<div class="line"><code class="plain">echo 'zebra=yes' &gt; /etc/quagga/daemons</code></div>
<div class="line"><code class="plain">echo '' &gt; /etc/quagga/Quagga.conf</code></div>
<div class="line"><code class="plain">rm /var/lib/cumulus/nclu/nclu_acl.conf</code></div>
<div class="line"><code class="plain">net abort</code></div>
<div class="line"><code class="plain">net add hostname leaf01</code></div>
<div class="line"><code class="plain">net add interface swp1,49-52 mtu 9216</code></div>
<div class="line"><code class="plain">net add bond peerlink bond slaves swp49-50</code></div>
<div class="line"><code class="plain">net add bond server01 bond slaves swp1</code></div>
<div class="line"><code class="plain">net add bond uplink bond slaves swp51-52</code></div>
<div class="line"><code class="plain">net add loopback lo ip address 10.0.0.11/32</code></div>
<div class="line"><code class="plain">net add interface eth0 ip address dhcp</code></div>
<div class="line"><code class="plain">net add bridge alias bridge01</code></div>
<div class="line"><code class="plain">net add bridge bridge ports peerlink,uplink,server01</code></div>
<div class="line"><code class="plain">net add bridge bridge vids 10,20,30,40,50,100-200</code></div>
<div class="line"><code class="plain">net add bridge stp treeprio 32768</code></div>
<div class="line"><code class="plain">net add vlan 500 ip address 192.168.1.252/24</code></div>
<div class="line"><code class="plain">net add vlan 500 address-virtual 00:00:5e:00:01:01 192.168.1.254/24</code></div>
<div class="line"><code class="plain">net add bond peerlink mtu 9216</code></div>
<div class="line"><code class="plain">net add bond server01 mtu 9216</code></div>
<div class="line"><code class="plain">net add bond uplink mtu 9216</code></div>
<div class="line"><code class="plain">net add interface peerlink.4094 ip address 169.254.255.1/30</code></div>
<div class="line"><code class="plain">net add interface peerlink.4094 clag backup-ip 192.168.0.12</code></div>
<div class="line"><code class="plain">net add interface peerlink.4094 clag peer-ip 169.254.255.2</code></div>
<div class="line"><code class="plain">net add interface peerlink.4094 clag sys-mac 44:39:39:FF:40:94</code></div>
<div class="line"><code class="plain">net add bond server01 bridge vids 10,20,30,40,50</code></div>
<div class="line"><code class="plain">net add bond server01 clag id 1</code></div>
<div class="line"><code class="plain">net add bond uplink clag id 1000</code></div>
<div class="line"><code class="plain">net add routing log file /var/log/quagga/quagga.log</code></div>
<div class="line"><code class="plain">net add routing log timestamp precision 6</code></div>
</div>
    </div>
    <p  class="expand-control-text">These commands create the following configuration ...    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@leaf01:~$ cat /etc/network/interfaces</code></div>
<div class="line"><code class="plain">auto lo</code></div>
<div class="line"><code class="plain">iface lo inet loopback</code></div>
<div class="line"><code class="plain">    address 10.0.0.11/32</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto eth0</code></div>
<div class="line"><code class="plain">iface eth0 inet dhcp</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp1</code></div>
<div class="line"><code class="plain">iface swp1</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp49</code></div>
<div class="line"><code class="plain">iface swp49</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp50</code></div>
<div class="line"><code class="plain">iface swp50</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp51</code></div>
<div class="line"><code class="plain">iface swp51</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp52</code></div>
<div class="line"><code class="plain">iface swp52</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto bridge</code></div>
<div class="line"><code class="plain">iface bridge</code></div>
<div class="line"><code class="plain">    alias bridge01</code></div>
<div class="line"><code class="plain">    bridge-ports peerlink server01 uplink</code></div>
<div class="line"><code class="plain">    bridge-vids 10 20 30 40 50 100-200</code></div>
<div class="line"><code class="plain">    bridge-vlan-aware yes</code></div>
<div class="line"><code class="plain">    mstpctl-treeprio 32768</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto peerlink</code></div>
<div class="line"><code class="plain">iface peerlink</code></div>
<div class="line"><code class="plain">    bond-slaves swp49 swp50</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto peerlink.4094</code></div>
<div class="line"><code class="plain">iface peerlink.4094</code></div>
<div class="line"><code class="plain">    address 169.254.255.1/30</code></div>
<div class="line"><code class="plain">    clagd-backup-ip 192.168.0.12</code></div>
<div class="line"><code class="plain">    clagd-peer-ip 169.254.255.2</code></div>
<div class="line"><code class="plain">    clagd-sys-mac 44:39:39:FF:40:94</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">auto server01</code></div>
<div class="line"><code class="plain">iface server01</code></div>
<div class="line"><code class="plain">    bond-slaves swp1</code></div>
<div class="line"><code class="plain">    clag-id 1</code></div>
<div class="line"><code class="plain">    bridge-vids 10 20 30 40 50</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto uplink</code></div>
<div class="line"><code class="plain">iface uplink</code></div>
<div class="line"><code class="plain">    bond-slaves swp51 swp52</code></div>
<div class="line"><code class="plain">    clag-id 1000</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">auto vlan500</code></div>
<div class="line"><code class="plain">iface vlan500</code></div>
<div class="line"><code class="plain">    address 192.168.1.252/24</code></div>
<div class="line"><code class="plain">    address-virtual 00:00:5e:00:01:01 192.168.1.254/24</code></div>
<div class="line"><code class="plain">    vlan-id 500</code></div>
<div class="line"><code class="plain">    vlan-raw-device bridge</code></div>
</div>
    </div>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  ><strong class=" ">leaf02</strong>    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@leaf02:~$ net show conf commands </code></div>
<div class="line"><code class="plain">echo 'auto lo' &gt; /etc/network/interfaces</code></div>
<div class="line"><code class="plain">echo 'iface lo inet loopback' &gt;&gt; /etc/network/interfaces</code></div>
<div class="line"><code class="plain">echo 'auto eth0' &gt;&gt; /etc/network/interfaces</code></div>
<div class="line"><code class="plain">echo 'iface eth0 inet dhcp' &gt;&gt; /etc/network/interfaces</code></div>
<div class="line"><code class="plain">echo 'zebra=yes' &gt; /etc/quagga/daemons</code></div>
<div class="line"><code class="plain">echo '' &gt; /etc/quagga/Quagga.conf</code></div>
<div class="line"><code class="plain">rm /var/lib/cumulus/nclu/nclu_acl.conf</code></div>
<div class="line"><code class="plain">net abort</code></div>
<div class="line"><code class="plain">net add hostname leaf02</code></div>
<div class="line"><code class="plain">net add interface swp1,49-52 mtu 9216</code></div>
<div class="line"><code class="plain">net add bond peerlink bond slaves swp49-50</code></div>
<div class="line"><code class="plain">net add bond server01 bond slaves swp1</code></div>
<div class="line"><code class="plain">net add bond uplink bond slaves swp51-52</code></div>
<div class="line"><code class="plain">net add loopback lo ip address 10.0.0.12/32</code></div>
<div class="line"><code class="plain">net add interface eth0 ip address dhcp</code></div>
<div class="line"><code class="plain">net add bridge bridge ports peerlink,uplink,server01</code></div>
<div class="line"><code class="plain">net add bridge bridge vids 10,20,30,40,50,100-200</code></div>
<div class="line"><code class="plain">net add bridge stp treeprio 32768</code></div>
<div class="line"><code class="plain">net add bond peerlink mtu 9216</code></div>
<div class="line"><code class="plain">net add bond server01 mtu 9216</code></div>
<div class="line"><code class="plain">net add bond uplink mtu 9216</code></div>
<div class="line"><code class="plain">net add interface peerlink.4094 ip address 169.254.255.2/30</code></div>
<div class="line"><code class="plain">net add interface peerlink.4094 clag backup-ip 192.168.0.11</code></div>
<div class="line"><code class="plain">net add interface peerlink.4094 clag peer-ip 169.254.255.1</code></div>
<div class="line"><code class="plain">net add interface peerlink.4094 clag sys-mac 44:39:39:FF:40:94</code></div>
<div class="line"><code class="plain">net add bond server01 bridge vids 10,20,30,40,50</code></div>
<div class="line"><code class="plain">net add bond server01 clag id 1</code></div>
<div class="line"><code class="plain">net add bond uplink clag id 1000</code></div>
<div class="line"><code class="plain">net add log file /var/log/quagga/quagga.log</code></div>
<div class="line"><code class="plain">net add log timestamp precision 6</code></div>
</div>
    </div>
    <p  class="expand-control-text">These commands create the following configuration ...    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@leaf02:~$ cat /etc/network/interfaces</code></div>
<div class="line"><code class="plain">auto lo</code></div>
<div class="line"><code class="plain">iface lo inet loopback</code></div>
<div class="line"><code class="plain">    address 10.0.0.12/32</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto eth0</code></div>
<div class="line"><code class="plain">iface eth0 inet dhcp</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp1</code></div>
<div class="line"><code class="plain">iface swp1</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp49</code></div>
<div class="line"><code class="plain">iface swp49</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp50</code></div>
<div class="line"><code class="plain">iface swp50</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp51</code></div>
<div class="line"><code class="plain">iface swp51</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp52</code></div>
<div class="line"><code class="plain">iface swp52</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto bridge</code></div>
<div class="line"><code class="plain">iface bridge</code></div>
<div class="line"><code class="plain">    bridge-vlan-aware yes</code></div>
<div class="line"><code class="plain">    bridge-ports peerlink server01 uplink</code></div>
<div class="line"><code class="plain">    bridge-vids 10 20 30 40 50 100-200</code></div>
<div class="line"><code class="plain">    mstpctl-treeprio 32768</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto peerlink</code></div>
<div class="line"><code class="plain">iface peerlink</code></div>
<div class="line"><code class="plain">    bond-slaves swp49 swp50</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto peerlink.4094</code></div>
<div class="line"><code class="plain">iface peerlink.4094</code></div>
<div class="line"><code class="plain">    clagd-backup-ip 192.168.0.11</code></div>
<div class="line"><code class="plain">    clagd-peer-ip 169.254.255.1</code></div>
<div class="line"><code class="plain">    clagd-sys-mac 44:39:39:FF:40:94</code></div>
<div class="line"><code class="plain">    address 169.254.255.2/30</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto server01</code></div>
<div class="line"><code class="plain">iface server01</code></div>
<div class="line"><code class="plain">    bond-slaves swp1</code></div>
<div class="line"><code class="plain">    clag-id 1</code></div>
<div class="line"><code class="plain">    bridge-vids 10 20 30 40 50</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto uplink</code></div>
<div class="line"><code class="plain">iface uplink</code></div>
<div class="line"><code class="plain">    bond-slaves swp51 swp52</code></div>
<div class="line"><code class="plain">    clag-id 1000</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
</div>
    </div>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  ><strong class=" ">leaf03</strong>    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@leaf03:~$ net show conf commands </code></div>
<div class="line"><code class="plain">echo 'auto lo' &gt; /etc/network/interfaces</code></div>
<div class="line"><code class="plain">echo 'iface lo inet loopback' &gt;&gt; /etc/network/interfaces</code></div>
<div class="line"><code class="plain">echo 'auto eth0' &gt;&gt; /etc/network/interfaces</code></div>
<div class="line"><code class="plain">echo 'iface eth0 inet dhcp' &gt;&gt; /etc/network/interfaces</code></div>
<div class="line"><code class="plain">echo 'zebra=yes' &gt; /etc/quagga/daemons</code></div>
<div class="line"><code class="plain">echo '' &gt; /etc/quagga/Quagga.conf</code></div>
<div class="line"><code class="plain">rm /var/lib/cumulus/nclu/nclu_acl.conf</code></div>
<div class="line"><code class="plain">net abort</code></div>
<div class="line"><code class="plain">net add hostname leaf03</code></div>
<div class="line"><code class="plain">net add interface swp1-2,51-52 mtu 9216</code></div>
<div class="line"><code class="plain">net add bond peerlink bond slaves swp49-50</code></div>
<div class="line"><code class="plain">net add bond server03 bond slaves swp1</code></div>
<div class="line"><code class="plain">net add bond server04 bond slaves swp2</code></div>
<div class="line"><code class="plain">net add bond uplink bond slaves swp51-52</code></div>
<div class="line"><code class="plain">net add loopback lo ip address 10.0.0.13/32</code></div>
<div class="line"><code class="plain">net add interface eth0 ip address dhcp</code></div>
<div class="line"><code class="plain">net add bridge bridge ports server03,server04,uplink,peerlink</code></div>
<div class="line"><code class="plain">net add bridge bridge pvid 1</code></div>
<div class="line"><code class="plain">net add bridge bridge vids 10,20,30,40,50,100-200</code></div>
<div class="line"><code class="plain">net add bridge stp treeprio 32768</code></div>
<div class="line"><code class="plain">net add interface peerlink.4093 ip address 169.254.255.1/30</code></div>
<div class="line"><code class="plain">net add interface peerlink.4093 alias 'Leaf03-Leaf04 MLAG peerlink'</code></div>
<div class="line"><code class="plain">net add interface peerlink.4093 clag backup-ip 192.168.0.14</code></div>
<div class="line"><code class="plain">net add interface peerlink.4093 clag enable yes</code></div>
<div class="line"><code class="plain">net add interface peerlink.4093 clag peer-ip 169.254.255.2</code></div>
<div class="line"><code class="plain">net add interface peerlink.4093 clag sys-mac 44:39:39:FF:40:93</code></div>
<div class="line"><code class="plain">net add bond server03 bridge pvid 1</code></div>
<div class="line"><code class="plain">net add bond server04 bridge pvid 1</code></div>
<div class="line"><code class="plain">net add bond server03 bridge vids 10,20,30,40,50</code></div>
<div class="line"><code class="plain">net add bond server04 bridge vids 10,20,30,40,50</code></div>
<div class="line"><code class="plain">net add bond server03 clag id 3</code></div>
<div class="line"><code class="plain">net add bond server03 mtu 9216</code></div>
<div class="line"><code class="plain">net add bond server04 mtu 9216</code></div>
<div class="line"><code class="plain">net add bond uplink mtu 9216</code></div>
<div class="line"><code class="plain">net add bond server04 clag id 4</code></div>
<div class="line"><code class="plain">net add bond uplink clag id 1000</code></div>
<div class="line"><code class="plain">net add log file /var/log/quagga/quagga.log</code></div>
<div class="line"><code class="plain">net add log timestamp precision 6</code></div>
</div>
    </div>
    <p  class="expand-control-text">These commands create the following configuration ...    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@leaf03:~$ cat /etc/network/interfaces</code></div>
<div class="line"><code class="plain"># This file describes the network interfaces available on your system</code></div>
<div class="line"><code class="plain"># and how to activate them. For more information, see interfaces(5), ifup(8)</code></div>
<div class="line"><code class="plain">#</code></div>
<div class="line"><code class="plain"># Please see /usr/share/doc/python-ifupdown2/examples/ for examples</code></div>
<div class="line"><code class="plain">#</code></div>
<div class="line"><code class="plain">#</code></div>
<div class="line"><code class="plain"># The loopback network interface</code></div>
<div class="line"><code class="plain">auto lo</code></div>
<div class="line"><code class="plain">iface lo inet loopback</code></div>
<div class="line"><code class="plain">    address 10.0.0.13/32</code></div>
<div class="line"> </div>
<div class="line"><code class="plain"># The primary network interface</code></div>
<div class="line"><code class="plain">auto eth0</code></div>
<div class="line"><code class="plain">iface eth0 inet dhcp</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp1</code></div>
<div class="line"><code class="plain">iface swp1</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp2</code></div>
<div class="line"><code class="plain">iface swp2</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp49</code></div>
<div class="line"><code class="plain">iface swp49</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp50</code></div>
<div class="line"><code class="plain">iface swp50</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp51</code></div>
<div class="line"><code class="plain">iface swp51</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp52</code></div>
<div class="line"><code class="plain">iface swp52</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto bridge</code></div>
<div class="line"><code class="plain">iface bridge</code></div>
<div class="line"><code class="plain">    bridge-ports peerlink server03 server04 uplink</code></div>
<div class="line"><code class="plain">    bridge-pvid 1</code></div>
<div class="line"><code class="plain">    bridge-vids 10 20 30 40 50 100-200</code></div>
<div class="line"><code class="plain">    bridge-vlan-aware yes</code></div>
<div class="line"><code class="plain">    mstpctl-treeprio 32768</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto peerlink</code></div>
<div class="line"><code class="plain">iface peerlink</code></div>
<div class="line"><code class="plain">    bond-slaves swp49 swp50</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto peerlink.4093</code></div>
<div class="line"><code class="plain">iface peerlink.4093</code></div>
<div class="line"><code class="plain">    address 169.254.255.1/30</code></div>
<div class="line"><code class="plain">    alias Leaf03-Leaf04 MLAG peerlink</code></div>
<div class="line"><code class="plain">    clagd-backup-ip 192.168.0.14</code></div>
<div class="line"><code class="plain">    clagd-enable yes</code></div>
<div class="line"><code class="plain">    clagd-peer-ip 169.254.255.2</code></div>
<div class="line"><code class="plain">    clagd-sys-mac 44:39:39:FF:40:93</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto server03</code></div>
<div class="line"><code class="plain">iface server03</code></div>
<div class="line"><code class="plain">    bond-slaves swp1</code></div>
<div class="line"><code class="plain">    bridge-pvid 1</code></div>
<div class="line"><code class="plain">    bridge-vids 10 20 30 40 50</code></div>
<div class="line"><code class="plain">    clag-id 3</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto server04</code></div>
<div class="line"><code class="plain">iface server04</code></div>
<div class="line"><code class="plain">    bond-slaves swp2</code></div>
<div class="line"><code class="plain">    bridge-pvid 1</code></div>
<div class="line"><code class="plain">    bridge-vids 10 20 30 40 50</code></div>
<div class="line"><code class="plain">    clag-id 4</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto uplink</code></div>
<div class="line"><code class="plain">iface uplink</code></div>
<div class="line"><code class="plain">    bond-slaves swp51 swp52</code></div>
<div class="line"><code class="plain">    clag-id 1000</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
</div>
    </div>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  ><strong class=" ">leaf04</strong>    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@leaf04:~$ net show configuration commands </code></div>
<div class="line"><code class="plain">echo 'auto lo' &gt; /etc/network/interfaces</code></div>
<div class="line"><code class="plain">echo 'iface lo inet loopback' &gt;&gt; /etc/network/interfaces</code></div>
<div class="line"><code class="plain">echo 'auto eth0' &gt;&gt; /etc/network/interfaces</code></div>
<div class="line"><code class="plain">echo 'iface eth0 inet dhcp' &gt;&gt; /etc/network/interfaces</code></div>
<div class="line"><code class="plain">echo 'zebra=yes' &gt; /etc/quagga/daemons</code></div>
<div class="line"><code class="plain">echo '' &gt; /etc/quagga/Quagga.conf</code></div>
<div class="line"><code class="plain">rm /var/lib/cumulus/nclu/nclu_acl.conf</code></div>
<div class="line"><code class="plain">net abort</code></div>
<div class="line"><code class="plain">net add hostname leaf04</code></div>
<div class="line"><code class="plain">net add interface swp1-2,51-52 mtu 9216</code></div>
<div class="line"><code class="plain">net add bond peerlink bond slaves swp49-50</code></div>
<div class="line"><code class="plain">net add bond server03 bond slaves swp1</code></div>
<div class="line"><code class="plain">net add bond server04 bond slaves swp2</code></div>
<div class="line"><code class="plain">net add bond uplink bond slaves swp51-52</code></div>
<div class="line"><code class="plain">net add loopback lo ip address 10.0.0.14/32</code></div>
<div class="line"><code class="plain">net add interface eth0 ip address dhcp</code></div>
<div class="line"><code class="plain">net add bridge bridge ports server03,server04,uplink,peerlink</code></div>
<div class="line"><code class="plain">net add bridge bridge pvid 1</code></div>
<div class="line"><code class="plain">net add bridge bridge vids 10,20,30,40,50,100-200</code></div>
<div class="line"><code class="plain">net add bridge stp treeprio 32768</code></div>
<div class="line"><code class="plain">net add interface peerlink.4093 ip address 169.254.255.2/30</code></div>
<div class="line"><code class="plain">net add interface peerlink.4093 alias 'Leaf03-Leaf04 MLAG peerlink'</code></div>
<div class="line"><code class="plain">net add interface peerlink.4093 clag backup-ip 192.168.0.13</code></div>
<div class="line"><code class="plain">net add interface peerlink.4093 clag enable yes</code></div>
<div class="line"><code class="plain">net add interface peerlink.4093 clag peer-ip 169.254.255.1</code></div>
<div class="line"><code class="plain">net add interface peerlink.4093 clag sys-mac 44:39:39:FF:40:93</code></div>
<div class="line"><code class="plain">net add bond server03 bridge pvid 1</code></div>
<div class="line"><code class="plain">net add bond server04 bridge pvid 1</code></div>
<div class="line"><code class="plain">net add bond server03 bridge vids 10,20,30,40,50</code></div>
<div class="line"><code class="plain">net add bond server04 bridge vids 10,20,30,40,50</code></div>
<div class="line"><code class="plain">net add bond server03 clag id 3</code></div>
<div class="line"><code class="plain">net add bond server03 mtu 9216</code></div>
<div class="line"><code class="plain">net add bond server04 mtu 9216</code></div>
<div class="line"><code class="plain">net add bond uplink mtu 9216</code></div>
<div class="line"><code class="plain">net add bond server04 clag id 4</code></div>
<div class="line"><code class="plain">net add bond uplink clag id 1000</code></div>
<div class="line"><code class="plain">net add log file /var/log/quagga/quagga.log</code></div>
<div class="line"><code class="plain">net add log timestamp precision 6</code></div>
</div>
    </div>
    <p  class="expand-control-text">These commands create the following configuration ...    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@leaf04:~$ cat /etc/network/interfaces</code></div>
<div class="line"><code class="plain"># This file describes the network interfaces available on your system</code></div>
<div class="line"><code class="plain"># and how to activate them. For more information, see interfaces(5), ifup(8)</code></div>
<div class="line"><code class="plain">#</code></div>
<div class="line"><code class="plain"># Please see /usr/share/doc/python-ifupdown2/examples/ for examples</code></div>
<div class="line"><code class="plain">#</code></div>
<div class="line"><code class="plain">#</code></div>
<div class="line"><code class="plain"># The loopback network interface</code></div>
<div class="line"><code class="plain">auto lo</code></div>
<div class="line"><code class="plain">iface lo inet loopback</code></div>
<div class="line"><code class="plain">    address 10.0.0.14/32</code></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><code class="plain"># The primary network interface</code></div>
<div class="line"><code class="plain">auto eth0</code></div>
<div class="line"><code class="plain">iface eth0 inet dhcp</code></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp1</code></div>
<div class="line"><code class="plain">iface swp1</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp2</code></div>
<div class="line"><code class="plain">iface swp2</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp49</code></div>
<div class="line"><code class="plain">iface swp49</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp50</code></div>
<div class="line"><code class="plain">iface swp50</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp51</code></div>
<div class="line"><code class="plain">iface swp51</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto swp52</code></div>
<div class="line"><code class="plain">iface swp52</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto bridge</code></div>
<div class="line"><code class="plain">iface bridge</code></div>
<div class="line"><code class="plain">    bridge-ports peerlink server03 server04 uplink</code></div>
<div class="line"><code class="plain">    bridge-pvid 1</code></div>
<div class="line"><code class="plain">    bridge-vids 10 20 30 40 50 100-200</code></div>
<div class="line"><code class="plain">    bridge-vlan-aware yes</code></div>
<div class="line"><code class="plain">    mstpctl-treeprio 32768</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto peerlink</code></div>
<div class="line"><code class="plain">iface peerlink</code></div>
<div class="line"><code class="plain">    bond-slaves swp49 swp50</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto peerlink.4093</code></div>
<div class="line"><code class="plain">iface peerlink.4093</code></div>
<div class="line"><code class="plain">    address 169.254.255.2/30</code></div>
<div class="line"><code class="plain">    alias Leaf03-Leaf04 MLAG peerlink</code></div>
<div class="line"><code class="plain">    clagd-backup-ip 192.168.0.13</code></div>
<div class="line"><code class="plain">    clagd-enable yes</code></div>
<div class="line"><code class="plain">    clagd-peer-ip 169.254.255.1</code></div>
<div class="line"><code class="plain">    clagd-sys-mac 44:39:39:FF:40:93</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto server03</code></div>
<div class="line"><code class="plain">iface server03</code></div>
<div class="line"><code class="plain">    bond-slaves swp1</code></div>
<div class="line"><code class="plain">    bridge-pvid 1</code></div>
<div class="line"><code class="plain">    bridge-vids 10 20 30 40 50</code></div>
<div class="line"><code class="plain">    clag-id 3</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto server04</code></div>
<div class="line"><code class="plain">iface server04</code></div>
<div class="line"><code class="plain">    bond-slaves swp2</code></div>
<div class="line"><code class="plain">    bridge-pvid 1</code></div>
<div class="line"><code class="plain">    bridge-vids 10 20 30 40 50</code></div>
<div class="line"><code class="plain">    clag-id 4</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto uplink</code></div>
<div class="line"><code class="plain">iface uplink</code></div>
<div class="line"><code class="plain">    bond-slaves swp51 swp52</code></div>
<div class="line"><code class="plain">    clag-id 1000</code></div>
<div class="line"><code class="plain">    mtu 9216</code></div>
</div>
    </div>
            </td>
        </tr>
</tbody>        </table>
            </div>
    <div class="section section-2" id="src-5126854_Multi-ChassisLinkAggregation-MLAG-DisablingclagdonanInterface">
        <h2 class="heading "><span>Disabling clagd on an Interface</span></h2>
    <p  >In the configurations above, the <tt class=" ">clagd-peer-ip</tt> and <tt class=" ">clagd-sys-mac</tt> parameters are mandatory, while the rest are optional. When mandatory <tt class=" ">clagd</tt> commands are present under a peer link subinterface, by default <tt class=" ">clagd-enable</tt> is set to <i class=" ">yes</i> and doesn't need to be specified; to disable <tt class=" ">clagd</tt> on the subinterface, set <tt class=" ">clagd-enable</tt> to <i class=" ">no</i>:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@spine01:~$ net add interface peerlink.4090 clag enable no </code></div>
<div class="line"><code class="plain">cumulus@spine01:~$ net pending</code></div>
<div class="line"><code class="plain">cumulus@spine01:~$ net commit</code></div>
</div>
    </div>
    <p  >Use <tt class=" ">clagd-priority</tt> to set the role of the MLAG peer switch to primary or secondary. Each peer switch in an MLAG pair must have the same <tt class=" ">clagd-sys-mac</tt> setting. Each <tt class=" ">clagd-sys-mac</tt> setting should be unique to each MLAG pair in the network. For more details, refer to <tt class=" ">man clagd</tt>.    </p>
    </div>
    </div>
    <div class="section section-1" id="src-5126854_Multi-ChassisLinkAggregation-MLAG-CheckingtheMLAGConfigurationStatus">
        <h1 class="heading "><span>Checking the MLAG Configuration Status</span></h1>
    <p  >You can easily check the status of your MLAG configuration using <tt class=" ">net show clag</tt>:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@spine01:~$ net show clag </code></div>
<div class="line"><code class="plain">The peer is alive</code></div>
<div class="line"><code class="plain">     Our Priority, ID, and Role: 32768 44:38:39:00:00:41 primary</code></div>
<div class="line"><code class="plain">    Peer Priority, ID, and Role: 32768 44:38:39:00:00:42 secondary</code></div>
<div class="line"><code class="plain">          Peer Interface and IP: peerlink.4090 169.254.255.2</code></div>
<div class="line"><code class="plain">                      Backup IP: 192.168.0.22 (active)</code></div>
<div class="line"><code class="plain">                     System MAC: 44:39:39:ff:40:90</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">CLAG Interfaces</code></div>
<div class="line"><code class="plain">Our Interface      Peer Interface     CLAG Id   Conflicts              Proto-Down Reason</code></div>
<div class="line"><code class="plain">----------------   ----------------   -------   --------------------   -----------------</code></div>
<div class="line"><code class="plain">       leaf03-04   leaf03-04          1034      -                      -              </code></div>
<div class="line"><code class="plain">       exit01-02   -                  2930      -                      -              </code></div>
<div class="line"><code class="plain">       leaf01-02   leaf01-02          1012      -                      -</code></div>
</div>
    </div>
    <div class="section section-2" id="src-5126854_Multi-ChassisLinkAggregation-MLAG-UsingtheclagdCommandLineInterface">
        <h2 class="heading "><span>Using the clagd Command Line Interface</span></h2>
    <p  ><span id="src-5126854_indexterm-03FCA83BBCAC23D14E2E7C753D4267B9">A command line utility called </span><tt class=" ">clagctl</tt> is available for interacting with a running <tt class=" ">clagd</tt> service to get status or alter operational behavior. For detailed explanation of the utility, please refer to the <tt class=" ">clagctl(8)</tt>man page.    </p>
    <p  class="expand-control-text">See the clagctl Output ...    </p>
    <p  >The following is a sample output of the MLAG operational status displayed by <tt class=" ">clagctl</tt>:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">The peer is alive</code></div>
<div class="line"><code class="plain">     Our Priority, ID, and Role: 32768 44:38:39:00:00:11 primary</code></div>
<div class="line"><code class="plain">    Peer Priority, ID, and Role: 32768 44:38:39:00:00:12 secondary</code></div>
<div class="line"><code class="plain">          Peer Interface and IP: peerlink.4094 169.254.255.2</code></div>
<div class="line"><code class="plain">                      Backup IP: 192.168.0.12 (active)</code></div>
<div class="line"><code class="plain">                     System MAC: 44:39:39:ff:40:94</code></div>
<div class="line"><code class="plain">CLAG Interfaces</code></div>
<div class="line"><code class="plain">Our Interface      Peer Interface     CLAG Id   Conflicts              Proto-Down Reason</code></div>
<div class="line"><code class="plain">----------------   ----------------   -------   --------------------   -----------------</code></div>
<div class="line"><code class="plain">        server01   server01           1         -                      -              </code></div>
<div class="line"><code class="plain">          uplink   uplink             1000      -                      -    </code></div>
</div>
    </div>
    </div>
    </div>
    <div class="section section-1" id="src-5126854_Multi-ChassisLinkAggregation-MLAG-ConfiguringMLAGwithaTraditionalModeBridge">
        <h1 class="heading "><span>Configuring MLAG with a Traditional Mode Bridge</span></h1>
    <p  >It's possible to configure MLAG with a bridge in <a   href="Traditional_Mode_Bridges.html">traditional mode</a> instead of <a   href="VLAN-aware_Bridge_Mode_for_Large-scale_Layer_2_Environments.html">VLAN-aware mode</a>.    </p>
    <div  class="confbox admonition admonition-note">
                    <p class="title">Traditional Mode Limitation</p>
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <p  >You cannot configure a traditional mode bridge using <a   href="Network_Command_Line_Utility.html">NCLU</a>; you must configure it manually in the <tt class=" ">/etc/network/interfaces</tt> file.    </p>
        </div>
    </div>
    <p  >In order to configure MLAG with a traditional mode bridge, the peer link and all dual-connected links must be configured as <a   href="Traditional_Mode_Bridges.html">untagged/native</a> ports on a bridge (note the absence of any VLANs in the <tt class=" ">bridge-ports</tt> line and the lack of the <tt class=" ">bridge-vlan-aware</tt> parameter below):    </p>
    <div  class="confbox admonition admonition-tip">
                    <p class="title">MLAG with a Traditional Mode Bridge</p>
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">auto br0</code></div>
<div class="line"><code class="plain">iface br0</code></div>
<div class="line"><code class="plain">  bridge-ports peerlink spine1-</code><code class="value">2</code><code class="plain"> host1 host2</code></div>
</div>
    </div>
        </div>
    </div>
    <p  >For a deeper comparison of traditional versus VLAN-aware bridge modes, read this <a  class="external-link" href="https://support.cumulusnetworks.com/hc/en-us/articles/204909397">knowledge base article</a>.    </p>
    </div>
    <div class="section section-1" id="src-5126854_Multi-ChassisLinkAggregation-MLAG-protodownPeerLinkInterfacesandtheprotodownState">
        <h1 class="heading "><span id="src-5126854_Multi-ChassisLinkAggregation-MLAG-protodown" class="confluence-anchor-link"></span><span>Peer Link Interfaces and the protodown State</span></h1>
    <p  ><span id="src-5126854_indexterm-6C1E5804F866807CE159A064BC8CD3FB">In </span><span id="src-5126854_indexterm-3FF46B24BADFEEF251DE599053AD7BEA">addition </span><span id="src-5126854_indexterm-EA192D08BE24ADDBD6A2D5960360E682">to </span>the standard UP and DOWN administrative states, an interface that is a member of an MLAG bond can also be in a <tt class=" ">protodown</tt> state. When MLAG detects a problem that could result in connectivity issues such as traffic black-holing or a network meltdown if the link carrier was left in an UP state, it can put that interface into <tt class=" ">protodown</tt> state. Such connectivity issues include:    </p>
<ul class=" "><li class=" ">    <p  >When the peer link goes down but the peer switch is up (that is, the backup link is active).    </p>
</li><li class=" ">    <p  >When the bond is configured with an MLAG ID, but the <tt class=" ">clagd</tt> service is not running (whether it was deliberately stopped or simply died).    </p>
</li><li class=" ">    <p  >When an MLAG-enabled node is booted or rebooted, the MLAG bonds are placed in a <tt class=" ">protodown</tt> state until the node establishes a connection to its peer switch, or five minutes have elapsed.    </p>
</li></ul>    <p  >When an interface goes into a <tt class=" ">protodown</tt> state, it results in a local OPER DOWN (carrier down) on the interface. As of Cumulus Linux 2.5.5, the <tt class=" ">protodown</tt> state can be manipulated with the <tt class=" ">ip link set</tt> command. Given its use in preventing network meltdowns, manually manipulating <tt class=" ">protodown</tt> is not recommended outside the scope of interaction with the Cumulus Networks support team.    </p>
    <p  >The following <tt class=" ">ip link show</tt> command output shows an interface in <tt class=" ">protodown</tt> state. Notice that the link carrier is down (NO-CARRIER):    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus</code><code class="color1">@switch</code><code class="plain">:~$ net show bridge link swp1</code></div>
<div class="line"><code class="value">3</code><code class="plain">: swp1 state DOWN: &lt;NO-CARRIER,BROADCAST,MULTICAST,MASTER,UP&gt; mtu </code><code class="value">9216</code><code class="plain"> master pfifo_fast master host-bond1 state DOWN mode DEFAULT qlen </code><code class="value">500</code><code class="plain"> protodown on</code></div>
<div class="line"><code class="plain">   link/ether </code><code class="value">44</code><code class="plain">:</code><code class="value">38</code><code class="plain">:</code><code class="value">39</code><code class="plain">:</code><code class="value">00</code><code class="plain">:</code><code class="value">69</code><code class="plain">:</code><code class="value">84</code><code class="plain"> brd ff:ff:ff:ff:ff:ff</code></div>
</div>
    </div>
    <div class="section section-2" id="src-5126854_Multi-ChassisLinkAggregation-MLAG-backupSpecifyingaBackupLink">
        <h2 class="heading "><span id="src-5126854_Multi-ChassisLinkAggregation-MLAG-backup" class="confluence-anchor-link"></span><span>Specifying a Backup Link</span></h2>
    <p  ><span id="src-5126854_indexterm-D5CEF7E0975AED4F35D65C1C6CE90232">You can specify a </span>backup link for your peer links in the event that the peer link goes down. When this happens, the <tt class=" ">clagd</tt> service uses the backup link to check the health of the peer switch. To configure this, add <tt class=" ">clagd-backup-ip &lt;ADDRESS&gt; </tt>to the peer link configuration:    </p>
    <div  class="confbox admonition admonition-tip">
                    <p class="title">Specifying a Backup Link</p>
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus</code><code class="color1">@spine01</code><code class="plain">:~$ net add </code><code class="keyword">interface</code><code class="plain"> peerlink.</code><code class="value">4094</code><code class="plain"> clag backup-ip </code><code class="value">192.0</code><code class="plain">.</code><code class="value">2.50</code></div>
<div class="line"><code class="plain">cumulus</code><code class="color1">@spine01</code><code class="plain">:~$ net pending</code></div>
<div class="line"><code class="plain">cumulus</code><code class="color1">@spine01</code><code class="plain">:~$ net commit</code></div>
</div>
    </div>
    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <p  >The backup IP address must be different than the peer link IP address (<tt class=" ">clagd-peer-ip</tt>). It must be reachable by a route that doesn't use the peer link and it must be in the same network namespace as the peer link IP address.    </p>
    <p  >Cumulus Networks recommends you use the switch's management IP address for this purpose.    </p>
        </div>
    </div>
    <p  >You can also specify the backup UDP port. The port defaults to 5342, but you can configure it as an argument in <tt class=" ">clagd-args</tt> using <tt class=" ">--backupPort &lt;PORT&gt;</tt>.    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus</code><code class="color1">@spine01</code><code class="plain">:~$ net add </code><code class="keyword">interface</code><code class="plain"> peerlink.</code><code class="value">4094</code><code class="plain"> clag args --backupPort </code><code class="value">5400</code></div>
<div class="line"><code class="plain">cumulus</code><code class="color1">@spine01</code><code class="plain">:~$ net pending</code></div>
<div class="line"><code class="plain">cumulus</code><code class="color1">@spine01</code><code class="plain">:~$ net commit</code></div>
</div>
    </div>
    <p  >You can see the backup IP address if you run <tt class=" ">net show clag</tt>:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus</code><code class="color1">@spine01</code><code class="plain">:~$ net show clag </code></div>
<div class="line"><code class="plain">The peer is alive</code></div>
<div class="line"><code class="plain">     Our Priority, ID, and Role: </code><code class="value">32768</code><code class="plain"> </code><code class="value">44</code><code class="plain">:</code><code class="value">38</code><code class="plain">:</code><code class="value">39</code><code class="plain">:</code><code class="value">00</code><code class="plain">:</code><code class="value">00</code><code class="plain">:</code><code class="value">41</code><code class="plain"> primary</code></div>
<div class="line"><code class="plain">    Peer Priority, ID, and Role: </code><code class="value">32768</code><code class="plain"> </code><code class="value">44</code><code class="plain">:</code><code class="value">38</code><code class="plain">:</code><code class="value">39</code><code class="plain">:</code><code class="value">00</code><code class="plain">:</code><code class="value">00</code><code class="plain">:</code><code class="value">42</code><code class="plain"> secondary</code></div>
<div class="line"><code class="plain">          Peer Interface and IP: peerlink.</code><code class="value">4090</code><code class="plain"> </code><code class="value">169.254</code><code class="plain">.</code><code class="value">255.2</code></div>
<div class="line"><code class="plain">                      Backup IP: </code><code class="value">192.168</code><code class="plain">.</code><code class="value">0.22</code><code class="plain"> (active)</code></div>
<div class="line"><code class="plain">                     System MAC: </code><code class="value">44</code><code class="plain">:</code><code class="value">39</code><code class="plain">:</code><code class="value">39</code><code class="plain">:ff:</code><code class="value">40</code><code class="plain">:</code><code class="value">90</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">CLAG Interfaces</code></div>
<div class="line"><code class="plain">Our Interface      Peer Interface     CLAG Id   Conflicts              Proto-Down Reason</code></div>
<div class="line"><code class="plain">----------------   ----------------   -------   --------------------   -----------------</code></div>
<div class="line"><code class="plain">       leaf03-</code><code class="value">04</code><code class="plain">   leaf03-</code><code class="value">04</code><code class="plain">          </code><code class="value">1034</code><code class="plain">      -                      -              </code></div>
<div class="line"><code class="plain">       exit01-</code><code class="value">02</code><code class="plain">   -                  </code><code class="value">2930</code><code class="plain">      -                      -              </code></div>
<div class="line"><code class="plain">       leaf01-</code><code class="value">02</code><code class="plain">   leaf01-</code><code class="value">02</code><code class="plain">          </code><code class="value">1012</code><code class="plain">      -                      -</code></div>
</div>
    </div>
        </div>
    </div>
    <div class="section section-3" id="src-5126854_Multi-ChassisLinkAggregation-MLAG-vrf_backupSpecifyingaBackupLinktoaVRF">
        <h3 class="heading "><span id="src-5126854_Multi-ChassisLinkAggregation-MLAG-vrf_backup" class="confluence-anchor-link"></span><span>Specifying a Backup Link to a VRF</span></h3>
    <p  >You can configure the backup link to a <a   href="Virtual_Routing_and_Forwarding_-_VRF.html">VRF</a> or <a   href="Management_VRF.html">management VRF</a>. Include the name of the VRF or management VRF when you specify <tt class=" ">clagd-backup-ip &lt;ADDRESS&gt; vrf &lt;VRF name&gt;</tt>. Here is a sample configuration:    </p>
    <div  class="confbox admonition admonition-tip">
                    <p class="title">Specifying a Backup Link to a VRF</p>
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus</code><code class="color1">@spine01</code><code class="plain">:~$ net add </code><code class="keyword">interface</code><code class="plain"> peerlink.</code><code class="value">4090</code><code class="plain"> clag backup-ip </code><code class="value">192.168</code><code class="plain">.</code><code class="value">0.22</code><code class="plain"> vrf mgmt</code></div>
<div class="line"><code class="plain">cumulus</code><code class="color1">@spine01</code><code class="plain">:~$ net pending</code></div>
<div class="line"><code class="plain">cumulus</code><code class="color1">@spine01</code><code class="plain">:~$ net commit</code></div>
</div>
    </div>
    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <p  >You cannot use the VRF on a peer link subinterface.    </p>
        </div>
    </div>
    <p  >Verify the backup link by running <tt class=" ">net show clag backup-ip</tt>:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus</code><code class="color1">@leaf01</code><code class="plain">:~$ net show clag backup-ip </code></div>
<div class="line"><code class="plain">Backup info:</code></div>
<div class="line"><code class="plain">IP: </code><code class="value">192.168</code><code class="plain">.</code><code class="value">0.12</code><code class="plain">; State: active; Role: primary</code></div>
<div class="line"><code class="plain">Peer priority and id: </code><code class="value">32768</code><code class="plain"> </code><code class="value">44</code><code class="plain">:</code><code class="value">38</code><code class="plain">:</code><code class="value">39</code><code class="plain">:</code><code class="value">00</code><code class="plain">:</code><code class="value">00</code><code class="plain">:</code><code class="value">12</code><code class="plain">; Peer role: secondary          </code></div>
</div>
    </div>
        </div>
    </div>
    <div  class="confbox admonition admonition-tip">
                    <p class="title">Comparing VRF and Management VRF Configurations</p>
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <p  >The configuration for both a VRF and management VRF is exactly the same. A sample configuration where the backup interface is in a VRF could be as follows:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus</code><code class="color1">@leaf01</code><code class="plain">:~$ net show configuration</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">...</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">auto swp52s0</code></div>
<div class="line"><code class="plain">iface swp52s0</code></div>
<div class="line"><code class="plain">    address </code><code class="value">192.0</code><code class="plain">.</code><code class="value">2.1</code><code class="plain">/</code><code class="value">24</code></div>
<div class="line"><code class="plain">    vrf green</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto green</code></div>
<div class="line"><code class="plain">iface green</code></div>
<div class="line"><code class="plain">    vrf-table auto</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto peer5.</code><code class="value">4000</code></div>
<div class="line"><code class="plain">iface peer5.</code><code class="value">4000</code></div>
<div class="line"><code class="plain">        address </code><code class="value">192.0</code><code class="plain">.</code><code class="value">2.15</code><code class="plain">/</code><code class="value">24</code></div>
<div class="line"><code class="plain">        clagd-peer-ip </code><code class="value">192.0</code><code class="plain">.</code><code class="value">2.16</code></div>
<div class="line"><code class="plain">        clagd-backup-ip </code><code class="value">192.0</code><code class="plain">.</code><code class="value">2.2</code><code class="plain"> vrf green</code></div>
<div class="line"><code class="plain">        clagd-sys-mac </code><code class="value">44</code><code class="plain">:</code><code class="value">38</code><code class="plain">:</code><code class="value">39</code><code class="plain">:</code><code class="value">01</code><code class="plain">:</code><code class="value">01</code><code class="plain">:</code><code class="value">01</code><code class="plain">    </code></div>
<div class="line"><code class="plain">...</code></div>
</div>
    </div>
    <p  >Which you can verify with <tt class=" ">net show clag status verbose</tt>:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus</code><code class="color1">@leaf01</code><code class="plain">:~$ net show clag status verbose</code></div>
<div class="line"><code class="plain">The peer is alive</code></div>
<div class="line"><code class="plain">    Peer Priority, ID, and Role: </code><code class="value">32768</code><code class="plain"> </code><code class="value">00</code><code class="plain">:</code><code class="value">02</code><code class="plain">:</code><code class="value">00</code><code class="plain">:</code><code class="value">00</code><code class="plain">:</code><code class="value">00</code><code class="plain">:</code><code class="value">13</code><code class="plain"> primary</code></div>
<div class="line"><code class="plain">     Our Priority, ID, and Role: </code><code class="value">32768</code><code class="plain"> c4:</code><code class="value">54</code><code class="plain">:</code><code class="value">44</code><code class="plain">:f6:</code><code class="value">44</code><code class="plain">:5a secondary</code></div>
<div class="line"><code class="plain">          Peer Interface and IP: peer5.</code><code class="value">4000</code><code class="plain"> </code><code class="value">192.0</code><code class="plain">.</code><code class="value">2.16</code></div>
<div class="line"><code class="plain">                      Backup IP: </code><code class="value">192.0</code><code class="plain">.</code><code class="value">2.2</code><code class="plain"> vrf green (active)</code></div>
<div class="line"><code class="plain">                     System MAC: </code><code class="value">44</code><code class="plain">:</code><code class="value">38</code><code class="plain">:</code><code class="value">39</code><code class="plain">:</code><code class="value">01</code><code class="plain">:</code><code class="value">01</code><code class="plain">:</code><code class="value">01</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">CLAG Interfaces</code></div>
<div class="line"><code class="plain">Our Interface      Peer Interface     CLAG Id   Conflicts              Proto-Down Reason</code></div>
<div class="line"><code class="plain">----------------   ----------------   -------   --------------------   -----------------</code></div>
<div class="line"><code class="plain">           bond4   bond4              </code><code class="value">4</code><code class="plain">         -                      -              </code></div>
<div class="line"><code class="plain">           bond1   bond1              </code><code class="value">1</code><code class="plain">         -                      -              </code></div>
<div class="line"><code class="plain">           bond2   bond2              </code><code class="value">2</code><code class="plain">         -                      -              </code></div>
<div class="line"><code class="plain">           bond3   bond3              </code><code class="value">3</code><code class="plain">         -                      -     </code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">...</code></div>
</div>
    </div>
        </div>
    </div>
    </div>
    </div>
    </div>
    <div class="section section-1" id="src-5126854_Multi-ChassisLinkAggregation-MLAG-MonitoringDual-ConnectedPeers">
        <h1 class="heading "><span>Monitoring Dual-Connected Peers</span></h1>
    <p  >Upon receipt of a valid message from its peer, the switch knows that <tt class=" ">clagd</tt> is alive and executing on that peer. This causes <tt class=" ">clagd</tt> to change the system ID of each bond that was assigned a <tt class=" ">clag-id</tt> from the default value (the MAC address of the bond) to the system ID assigned to both peer switches. This makes the hosts connected to each switch act as if they are connected to the same system so that they will use all ports within their bond. Additionally, <tt class=" ">clagd</tt> determines which bonds are dual-connected and modifies the forwarding and learning behavior to accommodate these dual-connected bonds.    </p>
    <p  >If the peer does not receive any messages for three update intervals, then that peer switch is assumed to no longer be acting as an MLAG peer. In this case, the switch reverts all configuration changes so that it operates as a standard non-MLAG switch. This includes removing all statically assigned MAC addresses, clearing the egress forwarding mask, and allowing addresses to move from any port to the peer port. Once a message is again received from the peer, MLAG operation starts again as described earlier. You can configure a custom timeout setting by adding <tt class=" ">--peerTimeout &lt;VALUE&gt;</tt> to <tt class=" ">clagd-args</tt>, like this:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus</code><code class="color1">@spine01</code><code class="plain">:~$ net add </code><code class="keyword">interface</code><code class="plain"> peerlink.</code><code class="value">4094</code><code class="plain"> clag args --peerTimeout </code><code class="value">900</code></div>
<div class="line"><code class="plain">cumulus</code><code class="color1">@spine01</code><code class="plain">:~$ net pending</code></div>
<div class="line"><code class="plain">cumulus</code><code class="color1">@spine01</code><code class="plain">:~$ net commit</code></div>
</div>
    </div>
    <p  >Once bonds are identified as dual-connected, <tt class=" ">clagd</tt> sends more information to the peer switch for those bonds. The MAC addresses (and VLANs) that have been dynamically learned on those ports are sent along with the LACP partner MAC address for each bond. When a switch receives MAC address information from its peer, it adds MAC address entries on the corresponding ports. As the switch learns and ages out MAC addresses, it informs the peer switch of these changes to its MAC address table so that the peer can keep its table synchronized. Periodically, at 45% of the bridge ageing time, a switch will send its entire MAC address table to the peer, so that peer switch can verify that its MAC address table is properly synchronized.    </p>
    <p  >The switch sends an update frequency value in the messages to its peer, which tells <tt class=" ">clagd</tt> how often the peer will send these messages. You can configure a different frequency by adding <tt class=" ">--lacpPoll &lt;SECONDS&gt;</tt> to <tt class=" ">clagd-args</tt>:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus</code><code class="color1">@spine01</code><code class="plain">:~$ net add </code><code class="keyword">interface</code><code class="plain"> peerlink.</code><code class="value">4094</code><code class="plain"> clag args --lacpPoll </code><code class="value">900</code></div>
<div class="line"><code class="plain">cumulus</code><code class="color1">@spine01</code><code class="plain">:~$ net pending</code></div>
<div class="line"><code class="plain">cumulus</code><code class="color1">@spine01</code><code class="plain">:~$ net commit</code></div>
</div>
    </div>
    </div>
    <div class="section section-1" id="src-5126854_Multi-ChassisLinkAggregation-MLAG-ConfiguringLayer3RoutedUplinks">
        <h1 class="heading "><span>Configuring Layer 3 Routed Uplinks</span></h1>
    <p  >In this scenario, the spine switches connect at layer 3, as shown in the image below. Alternatively, the spine switches can be singly connected to each core switch at layer 3 (not shown below).    </p>
    <p  >    <img  class="confluence-embedded-image" src="images/download/attachments/5126854/mlag_cfg_l3.png" alt="images/download/attachments/5126854/mlag_cfg_l3.png" width="500"  />
        </p>
    <p  >In this design, the spine switches route traffic between the server hosts in the layer 2 domains and the core. The servers (host1 - host4) each have a layer 2 connection up to the spine layer where the default gateway for the host subnets resides. However, since the spine switches as gateway devices communicate at layer 3, you need to configure a protocol such as <a   href="Virtual_Router_Redundancy_-_VRR.html">VRR</a> (Virtual Router Redundancy) between the spine switch pair to support active/active forwarding.    </p>
    <p  >Then, to connect the spine switches to the core switches, you need to determine whether the routing is static or dynamic. If it's dynamic, you must choose which protocol &mdash; <a   href="Open_Shortest_Path_First_-_OSPF_-_Protocol.html">OSPF</a> or <a   href="Border_Gateway_Protocol_-_BGP.html">BGP</a> &mdash; to use. When enabling a routing protocol in an MLAG environment it is also necessary to manage the uplinks, because by default MLAG is not aware of layer 3 uplink interfaces. In the event of a peer link failure MLAG does not remove static routes or bring down a BGP or OSPF adjacency unless a separate link state daemon such as <tt class=" ">ifplugd </tt>is used.    </p>
    </div>
    <div class="section section-1" id="src-5126854_Multi-ChassisLinkAggregation-MLAG-IGMPSnoopingwithMLAG">
        <h1 class="heading "><span>IGMP Snooping with MLAG</span></h1>
    <p  ><span id="src-5126854_indexterm-AB892D32DF0F8FEDEB0B56657C45BBBF">IGMP </span><span id="src-5126854_indexterm-DA445D0A39DCE2091D575B3C3D6D6716">snooping </span>processes IGMP reports received on a bridge port in a bridge to identify hosts that are configured to receive multicast traffic destined to that group. An IGMP query message received on a port is used to identify the port that is connected to a router and configured to receive multicast traffic.    </p>
    <p  >IGMP snooping is enabled by default on the bridge. IGMP snooping multicast database entries and router port entries are synced to the peer MLAG switch. If there is no multicast router in the VLAN, the IGMP querier can be configured on the switch to generate IGMP query messages by adding a configuration like the following:    </p>
    <div  class="confbox admonition admonition-tip">
                    <p class="title">Configuring IGMP Snooping</p>
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus</code><code class="color1">@spine01</code><code class="plain">:~$ net add bridge bridge mcsnoop yes</code></div>
<div class="line"><code class="plain">cumulus</code><code class="color1">@spine01</code><code class="plain">:~$ net add bridge bridge igmp-querier-src </code><code class="value">123.1</code><code class="plain">.</code><code class="value">1.1</code></div>
<div class="line"><code class="plain">cumulus</code><code class="color1">@spine01</code><code class="plain">:~$ net pending</code></div>
<div class="line"><code class="plain">cumulus</code><code class="color1">@spine01</code><code class="plain">:~$ net commit</code></div>
</div>
    </div>
    <p  >To display multicast group and router port information, use the <tt class=" ">net show bridge mdb</tt> command:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus</code><code class="color1">@switch</code><code class="plain">:~$ net show bridge mdb</code></div>
<div class="line"><code class="plain">dev br port bond0 vlan </code><code class="value">100</code><code class="plain"> grp </code><code class="value">234.1</code><code class="plain">.</code><code class="value">1.1</code><code class="plain"> temp</code></div>
<div class="line"><code class="plain">router ports on br: bond0</code></div>
</div>
    </div>
        </div>
    </div>
    </div>
    <div class="section section-1" id="src-5126854_Multi-ChassisLinkAggregation-MLAG-MonitoringtheStatusoftheclagdService">
        <h1 class="heading "><span>Monitoring the Status of the clagd Service</span></h1>
    <p  >Due to the critical nature of the <tt class=" ">clagd</tt><span id="src-5126854_indexterm-C8775E944F06F008B104E9F304AE5FA3"> service, </span><tt class=" ">systemd</tt> continuously monitors the status of <tt class=" ">clagd</tt>. <tt class=" ">systemd</tt> monitors the <tt class=" ">clagd</tt> service through the use of notify messages every 30 seconds. If the <tt class=" ">clagd</tt> service dies or becomes unresponsive for any reason and <tt class=" ">systemd</tt> receives no messages after 60 seconds, <tt class=" ">systemd</tt> restarts <tt class=" ">clagd</tt>. <tt class=" ">systemd</tt> logs these failures in <tt class=" ">/var/log/syslog</tt>, and, on the first failure, generates a <tt class=" ">cl-support </tt>file as well.    </p>
    <p  >This monitoring is automatically configured and enabled as long as <tt class=" ">clagd</tt> is enabled (that is, <tt class=" ">clagd-peer-ip</tt> and <tt class=" ">clagd-sys-mac</tt> are configured for an interface) and the <tt class=" ">clagd</tt> service is running. When <tt class=" ">clagd</tt> is explicitly stopped, for example with the <tt class=" ">systemctl stop clagd.service</tt> command, monitoring of <tt class=" ">clagd</tt> is also stopped.    </p>
    <div  class="confbox admonition admonition-tip">
                    <p class="title">Checking clagd Status</p>
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <p  >You can check the status of <tt class=" ">clagd</tt> monitoring by using the <tt class=" ">cl-service-summary</tt> command:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus</code><code class="color1">@switch</code><code class="plain">:~$ sudo cl-service-summary summary</code></div>
<div class="line"><code class="plain">The systemctl daemon </code><code class="value">5.4</code><code class="plain"> uptime: 15m</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">...</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">Service clagd        enabled    active </code></div>
<div class="line"> </div>
<div class="line"><code class="plain">...</code></div>
</div>
    </div>
    <p  >Or the <tt class=" ">systemctl status</tt> command:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus</code><code class="color1">@switch</code><code class="plain">:~$ sudo systemctl status clagd.service </code></div>
<div class="line"><code class="plain">● clagd.service - Cumulus Linux Multi-Chassis LACP Bonding Daemon</code></div>
<div class="line"><code class="plain">   Loaded: loaded (/lib/systemd/system/clagd.service; enabled)</code></div>
<div class="line"><code class="plain">   Active: active (running) since Mon </code><code class="value">2016</code><code class="plain">-</code><code class="value">10</code><code class="plain">-</code><code class="value">03</code><code class="plain"> </code><code class="value">20</code><code class="plain">:</code><code class="value">31</code><code class="plain">:</code><code class="value">50</code><code class="plain"> UTC; </code><code class="value">4</code><code class="plain"> days ago</code></div>
<div class="line"><code class="plain">     Docs: man:clagd(</code><code class="value">8</code><code class="plain">)</code></div>
<div class="line"><code class="plain"> Main PID: </code><code class="value">1235</code><code class="plain"> (clagd)</code></div>
<div class="line"><code class="plain">   CGroup: /system.slice/clagd.service</code></div>
<div class="line"><code class="plain">           ├─</code><code class="value">1235</code><code class="plain"> /usr/bin/python /usr/sbin/clagd --daemon </code><code class="value">169.254</code><code class="plain">.</code><code class="value">255.2</code><code class="plain"> peerlink.</code><code class="value">4090</code><code class="plain"> </code><code class="value">44</code><code class="plain">:</code><code class="value">39</code><code class="plain">:</code><code class="value">39</code><code class="plain">:FF:</code><code class="value">40</code><code class="plain">:</code><code class="value">90</code><code class="plain"> --prior...</code></div>
<div class="line"><code class="plain">           └─</code><code class="value">1307</code><code class="plain"> /sbin/bridge monitor fdb</code></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><code class="plain">Feb </code><code class="value">01</code><code class="plain"> </code><code class="value">23</code><code class="plain">:</code><code class="value">19</code><code class="plain">:</code><code class="value">30</code><code class="plain"> leaf01 clagd[</code><code class="value">1717</code><code class="plain">]: Cleanup is executing.</code></div>
<div class="line"><code class="plain">Feb </code><code class="value">01</code><code class="plain"> </code><code class="value">23</code><code class="plain">:</code><code class="value">19</code><code class="plain">:</code><code class="value">31</code><code class="plain"> leaf01 clagd[</code><code class="value">1717</code><code class="plain">]: Cleanup is finished</code></div>
<div class="line"><code class="plain">Feb </code><code class="value">01</code><code class="plain"> </code><code class="value">23</code><code class="plain">:</code><code class="value">19</code><code class="plain">:</code><code class="value">31</code><code class="plain"> leaf01 clagd[</code><code class="value">1717</code><code class="plain">]: Beginning execution of clagd version </code><code class="value">1.3</code><code class="plain">.</code><code class="value">0</code></div>
<div class="line"><code class="plain">Feb </code><code class="value">01</code><code class="plain"> </code><code class="value">23</code><code class="plain">:</code><code class="value">19</code><code class="plain">:</code><code class="value">31</code><code class="plain"> leaf01 clagd[</code><code class="value">1717</code><code class="plain">]: Invoked with: /usr/sbin/clagd --daemon </code><code class="value">169.254</code><code class="plain">.</code><code class="value">255.2</code><code class="plain"> peerlink.</code><code class="value">4094</code><code class="plain"> </code><code class="value">44</code><code class="plain">:</code><code class="value">39</code><code class="plain">:</code><code class="value">39</code><code class="plain">:FF:</code><code class="value">40</code><code class="plain">:</code><code class="value">94</code><code class="plain"> --pri...</code><code class="value">168.0</code><code class="plain">.</code><code class="value">12</code></div>
<div class="line"><code class="plain">Feb </code><code class="value">01</code><code class="plain"> </code><code class="value">23</code><code class="plain">:</code><code class="value">19</code><code class="plain">:</code><code class="value">31</code><code class="plain"> leaf01 clagd[</code><code class="value">1717</code><code class="plain">]: Role is now secondary</code></div>
<div class="line"><code class="plain">Feb </code><code class="value">01</code><code class="plain"> </code><code class="value">23</code><code class="plain">:</code><code class="value">19</code><code class="plain">:</code><code class="value">31</code><code class="plain"> leaf01 clagd[</code><code class="value">1717</code><code class="plain">]: Initial config loaded</code></div>
<div class="line"><code class="plain">Feb </code><code class="value">01</code><code class="plain"> </code><code class="value">23</code><code class="plain">:</code><code class="value">19</code><code class="plain">:</code><code class="value">31</code><code class="plain"> leaf01 systemd[</code><code class="value">1</code><code class="plain">]: Started Cumulus Linux Multi-Chassis LACP Bonding Daemon.</code></div>
<div class="line"><code class="plain">Feb </code><code class="value">01</code><code class="plain"> </code><code class="value">23</code><code class="plain">:</code><code class="value">24</code><code class="plain">:</code><code class="value">31</code><code class="plain"> leaf01 clagd[</code><code class="value">1717</code><code class="plain">]: HealthCheck: reload timeout.</code></div>
<div class="line"><code class="plain">Feb </code><code class="value">01</code><code class="plain"> </code><code class="value">23</code><code class="plain">:</code><code class="value">24</code><code class="plain">:</code><code class="value">31</code><code class="plain"> leaf01 clagd[</code><code class="value">1717</code><code class="plain">]: Role is now primary; Reload timeout</code></div>
<div class="line"><code class="plain">Hint: Some lines were ellipsized, use -l to show in full.</code></div>
</div>
    </div>
        </div>
    </div>
    </div>
    <div class="section section-1" id="src-5126854_Multi-ChassisLinkAggregation-MLAG-MLAGBestPractices">
        <h1 class="heading "><span>MLAG Best Practices</span></h1>
    <p  >For MLAG to function properly, the dual-connected hosts' interfaces should be configured identically on the pair of peering switches. See the note above in the <a   href="#src-5126854_Multi-ChassisLinkAggregation-MLAG-configuring">Configuring MLAG</a> section.    </p>
    <div class="section section-2" id="src-5126854_Multi-ChassisLinkAggregation-MLAG-mtuUnderstandingMTUinanMLAGConfiguration">
        <h2 class="heading "><span id="src-5126854_Multi-ChassisLinkAggregation-MLAG-mtu" class="confluence-anchor-link"></span><span>Understanding MTU in an MLAG Configuration</span></h2>
    <p  >Note that the <a   href="Layer_1_and_Switch_Port_Attributes.html">MTU</a><span id="src-5126854_indexterm-C7413608181EA87F3751D867784D2947"> in </span><span id="src-5126854_indexterm-51469CC3767E7424D8B368CDA7E762BC">MLAG </span>traffic is determined by the bridge MTU. Bridge MTU is determined by the lowest MTU setting of an interface that is a member of the bridge. If an MTU other than the default of 1500 bytes is desired, you must configure the MTU on each physical interface and bond interface that are members of the MLAG bridges in the entire bridged domain.    </p>
    <p  >For example, if an MTU of 9216 is desired through the MLAG domain in the example shown above:    </p>
    <p  >On all four leaf switches, <a   href="Layer_1_and_Switch_Port_Attributes.html">configure <tt class=" ">mtu 9216</tt> </a>for each of the following interfaces, since they are members of bridge <i class=" ">bridge</i>: peerlink, uplink, server01.    </p>
    <div  class="confbox admonition admonition-tip">
                    <p class="title">Configuring MTU</p>
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus</code><code class="color1">@leaf01</code><code class="plain">:~$ net add bond peerlink mtu </code><code class="value">9216</code></div>
<div class="line"><code class="plain">cumulus</code><code class="color1">@leaf01</code><code class="plain">:~$ net add bond uplink mtu </code><code class="value">9216</code></div>
<div class="line"><code class="plain">cumulus</code><code class="color1">@leaf01</code><code class="plain">:~$ net add bond server01 mtu </code><code class="value">9216</code></div>
<div class="line"><code class="plain">cumulus</code><code class="color1">@leaf01</code><code class="plain">:~$ net pending</code></div>
<div class="line"><code class="plain">cumulus</code><code class="color1">@leaf01</code><code class="plain">:~$ net commit</code></div>
</div>
    </div>
    <p  >The above commands produce the following configuration in the <tt class=" ">/etc/network/interfaces</tt> file:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">auto bridge</code></div>
<div class="line"><code class="plain">iface bridge</code></div>
<div class="line"><code class="plain">  bridge-ports peerlink uplink server01</code></div>
<div class="line"><code class="plain">  bridge-vids </code><code class="value">10</code><code class="plain"> </code><code class="value">20</code><code class="plain"> </code><code class="value">30</code><code class="plain"> </code><code class="value">40</code><code class="plain"> </code><code class="value">50</code><code class="plain"> </code><code class="value">100</code><code class="plain">-</code><code class="value">200</code></div>
<div class="line"><code class="plain">  bridge-vlan-aware yes</code></div>
<div class="line"><code class="plain">  mstpctl-treeprio </code><code class="value">32768</code></div>
</div>
    </div>
    <p  >Likewise, to ensure the MTU 9216 path is respected through the spine switches above, also change the MTU setting for bridge <i class=" ">bridge</i> by configuring <tt class=" ">mtu 9216</tt> for each of the following members of bridge <i class=" ">bridge</i> on both spine01 and spine02: leaf01-02, leaf03-04, exit01-02, peerlink.    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus</code><code class="color1">@spine01</code><code class="plain">:~$ net add bond leaf01-</code><code class="value">02</code><code class="plain"> mtu </code><code class="value">9216</code></div>
<div class="line"><code class="plain">cumulus</code><code class="color1">@spine01</code><code class="plain">:~$ net add bond leaf03-</code><code class="value">04</code><code class="plain"> mtu </code><code class="value">9216</code></div>
<div class="line"><code class="plain">cumulus</code><code class="color1">@spine01</code><code class="plain">:~$ net add bond leaf01-</code><code class="value">02</code><code class="plain"> mtu </code><code class="value">9216</code></div>
<div class="line"><code class="plain">cumulus</code><code class="color1">@spine01</code><code class="plain">:~$ net add bond peerlink mtu </code><code class="value">9216</code></div>
<div class="line"><code class="plain">cumulus</code><code class="color1">@spine01</code><code class="plain">:~$ net pending</code></div>
<div class="line"><code class="plain">cumulus</code><code class="color1">@spine01</code><code class="plain">:~$ net commit</code></div>
</div>
    </div>
    <p  >The above commands produce the following configuration in the <tt class=" ">/etc/network/interfaces</tt> file:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">auto bridge</code></div>
<div class="line"><code class="plain">iface bridge</code></div>
<div class="line"><code class="plain">  bridge-ports leaf01-</code><code class="value">02</code><code class="plain"> leaf03-</code><code class="value">04</code><code class="plain"> exit01-</code><code class="value">02</code><code class="plain"> peerlink</code></div>
<div class="line"><code class="plain">  bridge-pvid </code><code class="value">1</code></div>
<div class="line"><code class="plain">  bridge-vids </code><code class="value">10</code><code class="plain"> </code><code class="value">20</code><code class="plain"> </code><code class="value">30</code><code class="plain"> </code><code class="value">40</code><code class="plain"> </code><code class="value">50</code><code class="plain"> </code><code class="value">100</code><code class="plain">-</code><code class="value">200</code></div>
<div class="line"><code class="plain">  bridge-vlan-aware yes</code></div>
<div class="line"><code class="plain">  mstpctl-treeprio </code><code class="value">4096</code></div>
</div>
    </div>
        </div>
    </div>
    </div>
    <div class="section section-2" id="src-5126854_Multi-ChassisLinkAggregation-MLAG-SizingthePeerlink">
        <h2 class="heading "><span>Sizing the Peerlink</span></h2>
    <p  >What's the best size for a peerlink? Before we answer that, let's talk a little bit about the peerlink itself.    </p>
    <p  >The peerlink tends to carry very little traffic when compared to the bandwidth consumed by dataplane traffic. In a typical MLAG configuration, most every connection between the two switches in the MLAG pair is dual-connected, so the only traffic going across the peerlink is traffic from the <tt class=" ">clagd</tt> process and some LLDP or LACP traffic; the traffic received on the peerlink is not forwarded out of the dual-connected bonds.    </p>
    <p  >However, there are some instances where a host is connected to only one switch in the MLAG pair; these include:    </p>
<ul class=" "><li class=" ">    <p  >You have a hardware limitation on the host where there is only one PCIE slot, and thus, one NIC on the system, so the host is only single-connected across that interface.    </p>
</li><li class=" ">    <p  >The host doesn't support 802.3ad and you can't create a bond on it.    </p>
</li><li class=" ">    <p  >You are accounting for a link failure, where the host may become single connected until the failure is rectified.    </p>
</li></ul>    <p  >So, in terms of sizing the peerlink, in general, you need to determine how much bandwidth is traveling across the single-connected interfaces, and allocate half of that bandwidth to the peerlink. We recommend half of the single-connected bandwidth because, on average, one half of the traffic destined to the single-connected host will arrive on the switch directly connected to the single-connected host and the other half will arrive on the switch that is not directly connected to the single-connected host. When this happens, only the traffic that arrives on the switch that is not directly connected to the single-connected host needs to traverse the peerlink, which is how you calculate 50% of the traffic.    </p>
    <p  >In addition, you may want to add extra links to the peerlink bond to handle link failures in the peerlink bond itself.    </p>
    <p  >In illustration below, each host has 2 10G links, with each 10G link going to each switch in the MLAG pair. Each host has 20G of dual-connected bandwidth, so all three hosts have a total of 60G of dual-connected bandwidth. We recommend you allocate at least 15G of bandwidth to each peerlink bond, which represents half of the single-connected bandwidth.    </p>
    <p  >    <img  class="confluence-embedded-image" src="images/download/attachments/5126854/MLAG_UD-729.png" alt="images/download/attachments/5126854/MLAG_UD-729.png"  height="250" />
        </p>
    <p  >Scaling this example out to a full rack, when planning for link failures, you need only allocate enough bandwidth to meet your site's strategy for handling failure scenarios. Imagine a full rack with 40 servers and two switches in it. You may plan for, say, 4 to 6 servers to lose connectivity to a single switch and become single connected before you respond to the event. So expanding upon our previous example, if you have 40 hosts each with 20G of bandwidth dual-connected to the MLAG pair, you might allocate 20G to 30G of bandwidth to the peerlink &mdash; which accounts for half of the single-connected bandwidth for 4 to 6 hosts.    </p>
    </div>
    </div>
    <div class="section section-1" id="src-5126854_Multi-ChassisLinkAggregation-MLAG-STPInteroperabilitywithMLAG">
        <h1 class="heading "><span>STP Interoperability with MLAG</span></h1>
    <p  ><span id="src-5126854_indexterm-29AB620616D1C6264787A03A5B95F1D6">Cumulus </span><span id="src-5126854_indexterm-7592E3B0088332EB11E791C3A2EB4AF3">Networks </span>recommends that you always enable STP in your layer 2 network.    </p>
    <p  >Further, with MLAG, Cumulus Networks recommends you enable BPDU guard on the host-facing bond interfaces. (For more information about BPDU guard, see <a   href="Spanning_Tree_and_Rapid_Spanning_Tree.html#src-5126866_SpanningTreeandRapidSpanningTree-bpdu">BPDU Guard and Bridge Assurance</a>.)    </p>
    <div  class="confbox admonition admonition-tip">
                    <p class="title">Debugging STP with MLAG</p>
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <p  >Running <tt class=" ">net show &lt;interface&gt; spanning-tree</tt> displays MLAG information that can be useful when debugging:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus</code><code class="color1">@switch</code><code class="plain">:~$ net show bridge spanning-tree</code></div>
<div class="line"><code class="plain">bridge:peerlink CIST info</code></div>
<div class="line"><code class="plain">  enabled            yes                     role                 Designated</code></div>
<div class="line"><code class="plain">  port id            </code><code class="value">8.002</code><code class="plain">                   state                forwarding</code></div>
<div class="line"><code class="plain">  ..............</code></div>
<div class="line"><code class="plain">  bpdufilter port    no                     </code></div>
<div class="line"><code class="plain">  clag ISL           yes                     clag ISL Oper UP     yes</code></div>
<div class="line"><code class="plain">  clag role          primary                 clag dual conn mac   </code><code class="value">00</code><code class="plain">:</code><code class="value">00</code><code class="plain">:</code><code class="value">00</code><code class="plain">:</code><code class="value">00</code><code class="plain">:</code><code class="value">00</code><code class="plain">:</code><code class="value">00</code></div>
<div class="line"><code class="plain">  clag remote portID F.FFF                   clag system mac      </code><code class="value">44</code><code class="plain">:</code><code class="value">39</code><code class="plain">:</code><code class="value">39</code><code class="plain">:FF:</code><code class="value">40</code><code class="plain">:</code><code class="value">90</code></div>
</div>
    </div>
        </div>
    </div>
    <div class="section section-2" id="src-5126854_Multi-ChassisLinkAggregation-MLAG-BestPracticesforSTPwithMLAG">
        <h2 class="heading "><span>Best Practices for STP with MLAG</span></h2>
<ul class=" "><li class=" ">    <p  >The STP global configuration must be the same on both the switches.    </p>
</li><li class=" ">    <p  >The STP configuration for dual-connected ports should be the same on both peer switches.    </p>
</li><li class=" ">    <p  >Use <a   href="Network_Command_Line_Utility.html">NCLU</a> (<tt class=" ">net</tt>) commands for all spanning tree configurations, including bridge priority, path cost and so forth. Do not use <tt class=" ">brctl</tt> commands for spanning tree, except for <tt class=" ">brctl stp on/off</tt>, as changes are not reflected to <tt class=" ">mstpd</tt> and can create conflicts.    </p>
</li></ul>    </div>
    </div>
    <div class="section section-1" id="src-5126854_Multi-ChassisLinkAggregation-MLAG-TroubleshootingMLAG">
        <h1 class="heading "><span>Troubleshooting MLAG</span></h1>
    <div class="section section-2" id="src-5126854_Multi-ChassisLinkAggregation-MLAG-ViewingtheMLAGLogFile">
        <h2 class="heading "><span>Viewing the MLAG Log File</span></h2>
    <p  >By default, when <tt class=" ">clagd</tt> is running, it logs its status to the <tt class=" ">/var/log/clagd.log</tt> file and <tt class=" ">syslog</tt>. Example log file output is below:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@spine01:~$ sudo tail /var/log/clagd.log </code></div>
<div class="line"><code class="plain">2016-10-03T20:31:50.471400+00:00 spine01 clagd[1235]: Initial config loaded</code></div>
<div class="line"><code class="plain">2016-10-03T20:31:52.479769+00:00 spine01 clagd[1235]: The peer switch is active.</code></div>
<div class="line"><code class="plain">2016-10-03T20:31:52.496490+00:00 spine01 clagd[1235]: Initial data sync to peer done.</code></div>
<div class="line"><code class="plain">2016-10-03T20:31:52.540186+00:00 spine01 clagd[1235]: Role is now primary; elected</code></div>
<div class="line"><code class="plain">2016-10-03T20:31:54.250572+00:00 spine01 clagd[1235]: HealthCheck: role via backup is primary</code></div>
<div class="line"><code class="plain">2016-10-03T20:31:54.252642+00:00 spine01 clagd[1235]: HealthCheck: backup active</code></div>
<div class="line"><code class="plain">2016-10-03T20:31:54.537967+00:00 spine01 clagd[1235]: Initial data sync from peer done.</code></div>
<div class="line"><code class="plain">2016-10-03T20:31:54.538435+00:00 spine01 clagd[1235]: Initial handshake done.</code></div>
<div class="line"><code class="plain">2016-10-03T20:31:58.527464+00:00 spine01 clagd[1235]: leaf03-04 is now dual connected.</code></div>
<div class="line"><code class="plain">2016-10-03T22:47:35.255317+00:00 spine01 clagd[1235]: leaf01-02 is now dual connected.</code></div>
</div>
    </div>
    </div>
    <div class="section section-2" id="src-5126854_Multi-ChassisLinkAggregation-MLAG-dropsLargePacketDropsonthePeerlinkInterface">
        <h2 class="heading "><span id="src-5126854_Multi-ChassisLinkAggregation-MLAG-drops" class="confluence-anchor-link"></span><span>Large Packet Drops on the Peerlink Interface</span></h2>
    <p  >If you notice a large volume of packet drops across one of the peerlink interfaces, this could be expected behavior. These drops serve to prevent looping of BUM (broadcast, unknown unicast, multicast) packets. When a packet is received across the peerlink, if the destination lookup results in an egress interface that is a dual-connected bond, the switch does not forward the packet to prevent loops. This results in a drop being recorded on the peerlink.    </p>
    <p  >You can detect this issue by running <tt class=" ">net show counters</tt> or <tt class=" ">ethtool -S &lt;interface&gt;</tt>.    </p>
    <p  >Using <a   href="Network_Command_Line_Utility.html">NCLU</a>, the number of dropped packets is displayed in the RX_DRP column when you run <tt class=" ">net show counters</tt>:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ net show counters </code></div>
<div class="line"> </div>
<div class="line"><code class="plain">Kernel Interface table</code></div>
<div class="line"><code class="plain">Iface              MTU    Met    RX_OK    RX_ERR    RX_DRP    RX_OVR    TX_OK    TX_ERR    TX_DRP    TX_OVR  Flg</code></div>
<div class="line"><code class="plain">---------------  -----  -----    -------  --------  --------  --------  -------  --------  --------  ------  -----</code></div>
<div class="line"><code class="plain">peerlink        1500       0      19226721     0      2952460  0       55115330     0       364      0       BMmRU</code></div>
<div class="line"><code class="plain">peerlink.4094   1500       0      0            0      0        0       5379243      0       0        0       BMRU</code></div>
<div class="line"><code class="plain">swp51           1500       0      6587220      0      2129676  0       38957769     0       202      0       BMsRU</code></div>
<div class="line"><code class="plain">swp52           1500       0      12639501     0      822784   0       16157561     0       162      0       BMsRU</code></div>
</div>
    </div>
    <p  >When you run <tt class=" ">ethtool -S</tt> on a peerlink interface, the drops are indicated by the HwIfInDiscards counter:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ sudo ethtool -S swp51</code></div>
<div class="line"><code class="plain">NIC statistics:</code></div>
<div class="line"><code class="plain">HwIfInOctets: 669507330</code></div>
<div class="line"><code class="plain">HwIfInUcastPkts: 658871</code></div>
<div class="line"><code class="plain">HwIfInBcastPkts: 2231559</code></div>
<div class="line"><code class="plain">HwIfInMcastPkts: 3696790</code></div>
<div class="line"><code class="plain">HwIfOutOctets: 2752224343</code></div>
<div class="line"><code class="plain">HwIfOutUcastPkts: 1001632</code></div>
<div class="line"><code class="plain">HwIfOutMcastPkts: 3743199</code></div>
<div class="line"><code class="plain">HwIfOutBcastPkts: 34212938</code></div>
<div class="line"><code class="plain">HwIfInDiscards: 2129675</code></div>
</div>
    </div>
    </div>
    </div>
    <div class="section section-1" id="src-5126854_Multi-ChassisLinkAggregation-MLAG-CaveatsandErrata">
        <h1 class="heading "><span>Caveats and Errata</span></h1>
    <p  >If both the backup and peer connectivity are lost within a 30-second window, the switch in the secondary role misinterprets the event sequence, believing the peer switch is down, so it takes over as the primary.    </p>
    </div>
        </div>

    </article>


            <nav id="ht-post-nav">
                <a href="VLAN_Tagging.html" class="ht-post-nav-prev">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-prev" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>VLAN Tagging</span>
        </a>
                <a href="LACP_Bypass.html" class="ht-post-nav-next">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-next" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-225.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>LACP Bypass</span>
        </a>
    </nav>    
            
            <article id="html-search-results" class="ht-content" style="display: none;">
            <header class="ht-content-header">
                <div id="ht-spacetitle">
                    <ul>
                        <li><a href="Cumulus_Linux_User_Guide.html">Cumulus Linux 3.2.1</a></li>
                    </ul>
                </div>
                <h1>Search results</h1>
            </header>
            <div id="search-results"></div>
        </article>
    
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>


</body>
</html>
