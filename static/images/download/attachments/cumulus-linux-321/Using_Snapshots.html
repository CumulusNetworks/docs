<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Using Snapshots - Cumulus Linux 3.2.1</title>

    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/scroll-tree.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>


<link rel="stylesheet" href="assets/css/content-style.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

    </head>

<body pageid="5126727">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">CL321</span>
                    <img class="space-logo" src="spacelogo.png" />
                </h1>
                <a href="Cumulus_Linux_User_Guide.html" class="ht-space-link">
                    <h2>Cumulus Linux 3.2.1</h2>
                </a>
            </header>

            <nav class="ht-pages-nav">
                <ul class="ht-pages-nav-top">
                                                <li class="leaf">
        <a class="ht-nav-page-link" href="Quick_Start_Guide.html">Quick Start Guide</a>

            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="Installation_Management.html">Installation Management</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Managing_Cumulus_Linux_Disk_Images.html">Managing Cumulus Linux Disk Images</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Installing_a_New_Cumulus_Linux_Image.html">Installing a New Cumulus Linux Image</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Upgrading_Cumulus_Linux.html">Upgrading Cumulus Linux</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link current" href="Using_Snapshots.html">Using Snapshots</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Adding_and_Updating_Packages.html">Adding and Updating Packages</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Zero_Touch_Provisioning_-_ZTP.html">Zero Touch Provisioning - ZTP</a>

            </li>
                            </ul>
            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="System_Configuration.html">System Configuration</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Network_Command_Line_Utility.html">Network Command Line Utility</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Setting_Date_and_Time.html">Setting Date and Time</a>

            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Authentication,_Authorization,_and_Accounting.html">Authentication, Authorization, and Accounting</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="SSH_for_Remote_Access.html">SSH for Remote Access</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="User_Accounts.html">User Accounts</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Using_sudo_to_Delegate_Privileges.html">Using sudo to Delegate Privileges</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="LDAP_Authentication_and_Authorization.html">LDAP Authentication and Authorization</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="TACACS_Plus.html">TACACS Plus</a>

            </li>
                            </ul>
            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Netfilter_-_ACLs.html">Netfilter - ACLs</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Default_Cumulus_Linux_ACL_Configuration.html">Default Cumulus Linux ACL Configuration</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Managing_Application_Daemons.html">Managing Application Daemons</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Configuring_switchd.html">Configuring switchd</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Power_over_Ethernet_-_PoE.html">Power over Ethernet - PoE</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Configuring_a_Global_Proxy.html">Configuring a Global Proxy</a>

            </li>
                            </ul>
            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="Interface_Configuration_and_Management.html">Interface Configuration and Management</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Layer_1_and_Switch_Port_Attributes.html">Layer 1 and Switch Port Attributes</a>

            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Buffer_and_Queue_Management.html">Buffer and Queue Management</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Configuring_Hardware-enabled_DDOS_Protection.html">Configuring Hardware-enabled DDOS Protection</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Configuring_DHCP_Relays.html">Configuring DHCP Relays</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Configuring_DHCP_Servers.html">Configuring DHCP Servers</a>

            </li>
                            </ul>
            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="Layer_One_and_Two.html">Layer One and Two</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Spanning_Tree_and_Rapid_Spanning_Tree.html">Spanning Tree and Rapid Spanning Tree</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Link_Layer_Discovery_Protocol.html">Link Layer Discovery Protocol</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Prescriptive_Topology_Manager_-_PTM.html">Prescriptive Topology Manager - PTM</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Bonding_-_Link_Aggregation.html">Bonding - Link Aggregation</a>

            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Ethernet_Bridging_-_VLANs.html">Ethernet Bridging - VLANs</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VLAN-aware_Bridge_Mode_for_Large-scale_Layer_2_Environments.html">VLAN-aware Bridge Mode for Large-scale Layer 2 Environments</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Traditional_Mode_Bridges.html">Traditional Mode Bridges</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VLAN_Tagging.html">VLAN Tagging</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Multi-Chassis_Link_Aggregation_-_MLAG.html">Multi-Chassis Link Aggregation - MLAG</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="LACP_Bypass.html">LACP Bypass</a>

            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Virtual_Router_Redundancy_-_VRR.html">Virtual Router Redundancy - VRR</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="ifplugd.html">ifplugd</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="IGMP_and_MLD_Snooping.html">IGMP and MLD Snooping</a>

            </li>
                            </ul>
            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="Network_Virtualization.html">Network Virtualization</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Integrating_with_VMware_NSX.html">Integrating with VMware NSX</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Integrating_Hardware_VTEPs_with_Midokura_MidoNet_and_OpenStack.html">Integrating Hardware VTEPs with Midokura MidoNet and OpenStack</a>

            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Lightweight_Network_Virtualization_-_LNV_Overview.html">Lightweight Network Virtualization - LNV Overview</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="LNV_VXLAN_Active-Active_Mode.html">LNV VXLAN Active-Active Mode</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="LNV_Full_Example.html">LNV Full Example</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Static_MAC_Bindings_with_VXLAN.html">Static MAC Bindings with VXLAN</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Ethernet_Virtual_Private_Network_-_EVPN.html">Ethernet Virtual Private Network - EVPN</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VXLAN_Hyperloop.html">VXLAN Hyperloop</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Static_VXLAN_Tunnels.html">Static VXLAN Tunnels</a>

            </li>
                            </ul>
            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="Layer_Three.html">Layer Three</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Routing.html">Routing</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Introduction_to_Routing_Protocols.html">Introduction to Routing Protocols</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Network_Topology.html">Network Topology</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Quagga_Overview.html">Quagga Overview</a>

            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Configuring_Quagga.html">Configuring Quagga</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Comparing_NCLU_and_vtysh_Commands.html">Comparing NCLU and vtysh Commands</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Open_Shortest_Path_First_-_OSPF_-_Protocol.html">Open Shortest Path First - OSPF - Protocol</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Open_Shortest_Path_First_v3_-_OSPFv3_-_Protocol.html">Open Shortest Path First v3 - OSPFv3 - Protocol</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Border_Gateway_Protocol_-_BGP.html">Border Gateway Protocol - BGP</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Bidirectional_Forwarding_Detection_-_BFD.html">Bidirectional Forwarding Detection - BFD</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Equal_Cost_Multipath_Load_Sharing_-_Hardware_ECMP.html">Equal Cost Multipath Load Sharing - Hardware ECMP</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Redistribute_Neighbor.html">Redistribute Neighbor</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Virtual_Routing_and_Forwarding_-_VRF.html">Virtual Routing and Forwarding - VRF</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Management_VRF.html">Management VRF</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Protocol_Independent_Multicast_-_PIM.html">Protocol Independent Multicast - PIM</a>

            </li>
                            </ul>
            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="Monitoring_and_Troubleshooting.html">Monitoring and Troubleshooting</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Single_User_Mode_-_Boot_Recovery.html">Single User Mode - Boot Recovery</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Resource_Diagnostics_Using_cl-resource-query.html">Resource Diagnostics Using cl-resource-query</a>

            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Monitoring_System_Hardware.html">Monitoring System Hardware</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Network_Switch_Port_LED_and_Status_LED_Guidelines.html">Network Switch Port LED and Status LED Guidelines</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Monitoring_Virtual_Device_Counters.html">Monitoring Virtual Device Counters</a>

            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Understanding_the_cl-support_Output_File.html">Understanding the cl-support Output File</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Troubleshooting_Log_Files.html">Troubleshooting Log Files</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Troubleshooting_the_etc_Directory.html">Troubleshooting the etc Directory</a>

            </li>
                            </ul>
            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Troubleshooting_Network_Interfaces.html">Troubleshooting Network Interfaces</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Monitoring_Interfaces_and_Transceivers_Using_ethtool.html">Monitoring Interfaces and Transceivers Using ethtool</a>

            </li>
                            </ul>
            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Network_Troubleshooting.html">Network Troubleshooting</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Using_NCLU_to_Troubleshoot_Your_Network_Configuration.html">Using NCLU to Troubleshoot Your Network Configuration</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Monitoring_System_Statistics_and_Network_Traffic_with_sFlow.html">Monitoring System Statistics and Network Traffic with sFlow</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Using_netq_to_Troubleshoot_the_Network.html">Using netq to Troubleshoot the Network</a>

            </li>
                            </ul>
            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="SNMP_Monitoring.html">SNMP Monitoring</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Using_Nutanix_Prism_as_a_Monitoring_Tool.html">Using Nutanix Prism as a Monitoring Tool</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Monitoring_Best_Practices.html">Monitoring Best Practices</a>

            </li>
                            </ul>
            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="Network_Solutions.html">Network Solutions</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Data_Center_Host_to_ToR_Architecture.html">Data Center Host to ToR Architecture</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Cumulus_Networks_Services_Demos.html">Cumulus Networks Services Demos</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Docker_on_Cumulus_Linux.html">Docker on Cumulus Linux</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="OpenStack_Neutron_ML2_and_Cumulus_Linux.html">OpenStack Neutron ML2 and Cumulus Linux</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Anycast_Design_Guide.html">Anycast Design Guide</a>

            </li>
                            </ul>
            </li>
                                                <li class="leaf">
        <a class="ht-nav-page-link" href="Cumulus_Linux_Index.html">Cumulus Linux Index</a>

            </li>
                                    </ul>
            </nav>
        </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="Cumulus_Linux_User_Guide.html">Cumulus Linux 3.2.1</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="Installation_Management.html">Installation Management</a></li>
                                                                                     <li><a href="Managing_Cumulus_Linux_Disk_Images.html">Managing Cumulus Linux Disk Images</a></li>
                                                            </ul>
</div>            <h1 id="src-5126828"> <span>Using Snapshots</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">

    <p  >Cumulus Linux supports the ability to take snapshots of the complete file system as well as the ability to roll back to a previous snapshot. Snapshots are performed automatically right before and after you upgrade Cumulus Linux and right before and after you commit a switch configuration using <a   href="Network_Command_Line_Utility.html">NCLU</a>. In addition, you can take a snapshot at any time. You can roll back the entire file system to a specific snapshot or just retrieve specific files.    </p>
    <p  >The primary snapshot components are:    </p>
<ul class=" "><li class=" ">    <p  ><a  class="external-link" href="https://btrfs.wiki.kernel.org/index.php/Main_Page">btrfs</a> &mdash; an underlying file system in Cumulus Linux, which supports snapshots.    </p>
</li><li class=" ">    <p  ><a  class="external-link" href="http://snapper.io/documentation.html">snapper</a> &mdash; a userspace utility to create and manage snapshots on demand as well as taking snapshots automatically before and after running <tt class=" ">apt-get upgrade|install|remove|dist-upgrade</tt>. You can use <tt class=" ">snapper</tt> to roll back to earlier snapshots, view existing snapshots, or delete one or more snapshots.    </p>
</li><li class=" ">    <p  ><a   href="Network_Command_Line_Utility.html">NCLU</a> &mdash; takes snapshots automatically before and after committing network configurations. You can use NCLU to roll back to earlier snapshots, view existing snapshots, or delete one or more snapshots.    </p>
</li></ul>    <div class="section section-1" id="src-5126828_UsingSnapshots-Contents">
        <h1 class="heading "><span>Contents</span></h1>
    <p  class="expand-control-text">This chapter covers ...    </p>
    </div>
    <div class="section section-1" id="src-5126828_UsingSnapshots-InstallingtheSnapshotPackage">
        <h1 class="heading "><span>Installing the Snapshot Package</span></h1>
    <p  >If you're upgrading from a version of Cumulus Linux earlier than version 3.2, you need to install the <tt class=" ">cumulus-snapshot</tt> package before you can use snapshots.    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ sudo apt-get update</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ sudo apt-get install cumulus-snapshot</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ sudo apt-get upgrade</code></div>
</div>
    </div>
    </div>
    <div class="section section-1" id="src-5126828_UsingSnapshots-TakingandManagingSnapshots">
        <h1 class="heading "><span>Taking and Managing Snapshots</span></h1>
    <p  >As described above, snapshots are taken automatically:    </p>
<ul class=" "><li class=" ">    <p  >Before and after you update your switch configuration by running <tt class=" ">net commit</tt>, via NCLU.    </p>
</li><li class=" ">    <p  >Before and after you update Cumulus Linux by running <tt class=" ">apt-get upgrade|install|remove|dist-upgrade</tt>, via <tt class=" ">snapper</tt>.    </p>
</li></ul>    <p  >You can also take snapshots as needed using the <tt class=" ">snapper</tt> utility. Run:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ sudo snapper create -d SNAPSHOT_NAME</code></div>
</div>
    </div>
    <p  >For more information about using <tt class=" ">snapper</tt>, run <tt class=" ">snapper --help</tt> or <tt class=" ">man snapper(8)</tt>.    </p>
    <div class="section section-2" id="src-5126828_UsingSnapshots-ViewingAvailableSnapshots">
        <h2 class="heading "><span>Viewing Available Snapshots</span></h2>
    <p  >You can use both NCLU and <tt class=" ">snapper</tt> to view available snapshots on the switch.    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ net show commit history </code></div>
<div class="line"><code class="plain">  #  Date                             Description</code></div>
<div class="line"><code class="plain">---  -------------------------------  --------------------------------------</code></div>
<div class="line"><code class="plain"> 20  Thu 01 Dec 2016 01:43:29 AM UTC  nclu pre  'net commit' (user cumulus)</code></div>
<div class="line"><code class="plain"> 21  Thu 01 Dec 2016 01:43:31 AM UTC  nclu post 'net commit' (user cumulus)</code></div>
<div class="line"><code class="plain"> 22  Thu 01 Dec 2016 01:44:18 AM UTC  nclu pre  '20 rollback' (user cumulus)</code></div>
<div class="line"><code class="plain"> 23  Thu 01 Dec 2016 01:44:18 AM UTC  nclu post '20 rollback' (user cumulus)</code></div>
<div class="line"><code class="plain"> 24  Thu 01 Dec 2016 01:44:22 AM UTC  nclu pre  '22 rollback' (user cumulus)</code></div>
<div class="line"><code class="plain"> 31  Fri 02 Dec 2016 12:18:08 AM UTC  nclu pre  'ACL' (user cumulus)</code></div>
<div class="line"><code class="plain"> 32  Fri 02 Dec 2016 12:18:10 AM UTC  nclu post 'ACL' (user cumulus)</code></div>
</div>
    </div>
    <p  >However, <tt class=" ">net show commit history</tt> only displays snapshots taken when you update your switch configuration. It does not list any snapshots taken directly with <tt class=" ">snapper</tt>. To see all the snapshots on the switch, run:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ sudo snapper list</code></div>
<div class="line"><code class="plain">Type   | #  | Pre # | Date                            | User | Cleanup | Description                            | Userdata     </code></div>
<div class="line"><code class="plain">-------+----+-------+---------------------------------+------+---------+----------------------------------------+--------------</code></div>
<div class="line"><code class="plain">single | 0  |       |                                 | root |         | current                                |              </code></div>
<div class="line"><code class="plain">single | 1  |       | Sat 24 Sep 2016 01:45:36 AM UTC | root |         | first root filesystem                  |              </code></div>
<div class="line"><code class="plain">pre    | 20 |       | Thu 01 Dec 2016 01:43:29 AM UTC | root | number  | nclu pre  'net commit' (user cumulus)  |              </code></div>
<div class="line"><code class="plain">post   | 21 | 20    | Thu 01 Dec 2016 01:43:31 AM UTC | root | number  | nclu post 'net commit' (user cumulus)  |              </code></div>
<div class="line"><code class="plain">pre    | 22 |       | Thu 01 Dec 2016 01:44:18 AM UTC | root | number  | nclu pre  '20 rollback' (user cumulus) |              </code></div>
<div class="line"><code class="plain">post   | 23 | 22    | Thu 01 Dec 2016 01:44:18 AM UTC | root | number  | nclu post '20 rollback' (user cumulus) |              </code></div>
<div class="line"><code class="plain">single | 26 |       | Thu 01 Dec 2016 11:23:06 PM UTC | root |         | test_snapshot                          |              </code></div>
<div class="line"><code class="plain">pre    | 29 |       | Thu 01 Dec 2016 11:55:16 PM UTC | root | number  | pre-apt                                | important=yes</code></div>
<div class="line"><code class="plain">post   | 30 | 29    | Thu 01 Dec 2016 11:55:21 PM UTC | root | number  | post-apt                               | important=yes</code></div>
<div class="line"><code class="plain">pre    | 31 |       | Fri 02 Dec 2016 12:18:08 AM UTC | root | number  | nclu pre  'ACL' (user cumulus)         |              </code></div>
<div class="line"><code class="plain">post   | 32 | 31    | Fri 02 Dec 2016 12:18:10 AM UTC | root | number  | nclu post 'ACL' (user cumulus)         |            </code></div>
</div>
    </div>
    </div>
    <div class="section section-2" id="src-5126828_UsingSnapshots-ViewingDifferencesbetweenSnapshots">
        <h2 class="heading "><span>Viewing Differences between Snapshots</span></h2>
    <p  >To see a line by line comparison of changes between two snapshots, run:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ sudo snapper diff 20..21</code></div>
<div class="line"><code class="color3">--- /.snapshots/20/snapshot/etc/cumulus/acl/policy.d/50_nclu_acl.rules	2016-11-30 23:00:42.675092103 +0000</code></div>
<div class="line"><code class="string">+++ /.snapshots/21/snapshot/etc/cumulus/acl/policy.d/50_nclu_acl.rules	2016-12-01 01:43:30.029171289 +0000</code></div>
<div class="line"><code class="variable">@@ -1,7 +0,0 @@</code></div>
<div class="line"><code class="color3">-[iptables]</code></div>
<div class="line"><code class="color3">-# control-plane: acl ipv4 EXAMPLE1 inbound</code></div>
<div class="line"><code class="color3">--A INPUT --in-interface swp+ -j ACCEPT -p tcp -s 10.0.0.11/32 -d 10.0.0.12/32 --dport 110</code></div>
<div class="line"><code class="color3">-</code></div>
<div class="line"><code class="color3">-# swp1: acl ipv4 EXAMPLE1 inbound</code></div>
<div class="line"><code class="color3">--A FORWARD --in-interface swp1 --out-interface swp2 -j ACCEPT -p tcp -s 10.0.0.11/32 -d 10.0.0.12/32 --dport 110</code></div>
<div class="line"><code class="color3">-</code></div>
<div class="line"><code class="color3">--- /.snapshots/20/snapshot/var/lib/cumulus/nclu/nclu_acl.conf	2016-11-30 23:00:18.030079000 +0000</code></div>
<div class="line"><code class="string">+++ /.snapshots/21/snapshot/var/lib/cumulus/nclu/nclu_acl.conf	2016-12-01 00:23:10.096136000 +0000</code></div>
<div class="line"><code class="variable">@@ -1,8 +1,3 @@</code></div>
<div class="line"><code class="color3">-acl ipv4 EXAMPLE1 priority 10 accept tcp 10.0.0.11/32 10.0.0.12/32 pop3 outbound-interface swp2</code></div>
<div class="line"><code class="color1"> </code></div>
<div class="line"><code class="color3">-control-plane</code></div>
<div class="line"><code class="color3">-    acl ipv4 EXAMPLE1 inbound</code></div>
<div class="line"><code class="color1"> </code></div>
<div class="line"><code class="color3">-iface swp1</code></div>
<div class="line"><code class="color3">-    acl ipv4 EXAMPLE1 inbound</code></div>
</div>
    </div>
    <p  >You can view the diff for a single file by specifying the name in the command:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ sudo snapper diff 20..21 /var/lib/cumulus/nclu/nclu_acl.conf </code></div>
<div class="line"><code class="color3">--- /.snapshots/20/snapshot/var/lib/cumulus/nclu/nclu_acl.conf	2016-11-30 23:00:18.030079000 +0000</code></div>
<div class="line"><code class="string">+++ /.snapshots/21/snapshot/var/lib/cumulus/nclu/nclu_acl.conf	2016-12-01 00:23:10.096136000 +0000</code></div>
<div class="line"><code class="variable">@@ -1,8 +1,3 @@</code></div>
<div class="line"><code class="color3">-acl ipv4 EXAMPLE1 priority 10 accept tcp 10.0.0.11/32 10.0.0.12/32 pop3 outbound-interface swp2</code></div>
<div class="line"><code class="color1"> </code></div>
<div class="line"><code class="color3">-control-plane</code></div>
<div class="line"><code class="color3">-    acl ipv4 EXAMPLE1 inbound</code></div>
<div class="line"><code class="color1"> </code></div>
<div class="line"><code class="color3">-iface swp1</code></div>
<div class="line"><code class="color3">-    acl ipv4 EXAMPLE1 inbound</code></div>
</div>
    </div>
    <p  >For a higher level view, displaying the names of changed/added/deleted files only, run:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ sudo snapper status 20..21</code></div>
<div class="line"><code class="plain">c..... /etc/cumulus/acl/policy.d/50_nclu_acl.rules</code></div>
<div class="line"><code class="plain">c..... /var/lib/cumulus/nclu/nclu_acl.conf</code></div>
</div>
    </div>
    </div>
    <div class="section section-2" id="src-5126828_UsingSnapshots-DeletingSnapshots">
        <h2 class="heading "><span>Deleting Snapshots</span></h2>
    <p  >You can remove one or more snapshots using both NCLU and snapper.    </p>
    <div  class="confbox admonition admonition-warning">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <p  >Take care when deleting a snapshot, as you cannot restore it once it's been deleted.    </p>
        </div>
    </div>
    <p  >To remove a single snapshot or a range of them created with NCLU, run:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ net commit delete SNAPSHOT|SNAPSHOT1-SNAPSHOT2</code></div>
</div>
    </div>
    <p  >To remove a single snapshot or a range of snapshots using <tt class=" ">snapper</tt>, run:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ sudo snapper delete SNAPSHOT|SNAPSHOT1-SNAPSHOT2</code></div>
</div>
    </div>
    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <p  >Snapshot 0 is the running configuration. You can't roll back to it or delete it. However, you can take a snapshot of it.    </p>
    <p  >Snapshot 1 is the root file system.    </p>
        </div>
    </div>
    <p  >The <tt class=" ">snapper</tt> utility preserves a number of snapshots, and automatically deletes older snapshots once the limit is reached. It does this in two ways.    </p>
    <p  >By default, <tt class=" ">snapper</tt> preserves 10 snapshots that are labeled <i class=" ">important</i>. A snapshot is labeled important if it was created when you run <tt class=" ">apt-get</tt>. To change this number, run:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ sudo snapper set-config NUMBER_LIMIT_IMPORTANT=&lt;NUM&gt;</code></div>
</div>
    </div>
    <div  class="confbox admonition admonition-tip">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <p  >You should always make <tt class=" ">NUMBER_LIMIT_IMPORTANT</tt> an even number since two snapshots are always taken before and after an upgrade. This does not apply to <tt class=" ">NUMBER_LIMIT</tt>, described next.    </p>
        </div>
    </div>
    <p  ><tt class=" ">snapper</tt> also deletes unlabeled snapshots. The default number of snapshots <tt class=" ">snapper</tt> preserves is 5. To change this number, run:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ sudo snapper set-config NUMBER_LIMIT=&lt;NUM&gt;</code></div>
</div>
    </div>
    <p  >Also, you can prevent snapshots from being taken automatically before and running <tt class=" ">apt-get upgrade|install|remove|dist-upgrade</tt>. Edit <tt class=" ">/etc/cumulus/apt-snapshot.conf</tt> and set:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">APT_SNAPSHOT_ENABLE=no</code></div>
</div>
    </div>
    </div>
    </div>
    <div class="section section-1" id="src-5126828_UsingSnapshots-RollingBacktoEarlierSnapshots">
        <h1 class="heading "><span>Rolling Back to Earlier Snapshots</span></h1>
    <p  >If you need to restore Cumulus Linux to an earlier state, you can roll back to an older snapshot.    </p>
    <p  >For a snapshot created with NCLU, you can revert to a specific snapshot listed in the output from <tt class=" ">net show commit history</tt>, or you can revert to the previous snapshot by specifying <i class=" ">last</i> when you run:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ net rollback SNAPSHOT_NUMBER|last</code></div>
</div>
    </div>
    <p  >For any snapshot on the switch, you can use <tt class=" ">snapper</tt> to roll back to a specific snapshot. When running <tt class=" ">snapper rollback</tt>, you must reboot the switch for the rollback to complete:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ sudo snapper rollback SNAPSHOT_NUMBER</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ sudo reboot</code></div>
</div>
    </div>
    <p  >You can also revert to an earlier version of a specific file instead of rolling back the whole file system:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ sudo snapper undochange 31..32 /etc/cumulus/acl/policy.d/50_nclu_acl.rules</code></div>
</div>
    </div>
    <div  class="confbox admonition admonition-tip">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <p  >You can also copy the file directly from the snapshot directory:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ cp /.snapshots/32/snapshot/etc/cumulus/acl/policy.d/50_nclu_acl.rules /etc/cumulus/acl/policy.d/</code></div>
</div>
    </div>
        </div>
    </div>
    </div>
    <div class="section section-1" id="src-5126828_UsingSnapshots-ConfiguringAutomaticTime-basedSnapshots">
        <h1 class="heading "><span>Configuring Automatic Time-based Snapshots</span></h1>
    <p  >You can configure Cumulus Linux to take hourly snapshots. You need to enable <tt class=" ">TIMELINE_CREATE</tt> in the snapper configuration:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ sudo snapper set-config TIMELINE_CREATE=yes</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ sudo snapper get-config                                                                                            </code></div>
<div class="line"><code class="plain">Key                    | Value</code></div>
<div class="line"><code class="plain">-----------------------+------</code></div>
<div class="line"><code class="plain">ALLOW_GROUPS           |      </code></div>
<div class="line"><code class="plain">ALLOW_USERS            |      </code></div>
<div class="line"><code class="plain">BACKGROUND_COMPARISON  | yes  </code></div>
<div class="line"><code class="plain">EMPTY_PRE_POST_CLEANUP | yes  </code></div>
<div class="line"><code class="plain">EMPTY_PRE_POST_MIN_AGE | 1800 </code></div>
<div class="line"><code class="plain">FSTYPE                 | btrfs</code></div>
<div class="line"><code class="plain">NUMBER_CLEANUP         | yes  </code></div>
<div class="line"><code class="plain">NUMBER_LIMIT           | 5    </code></div>
<div class="line"><code class="plain">NUMBER_LIMIT_IMPORTANT | 10   </code></div>
<div class="line"><code class="plain">NUMBER_MIN_AGE         | 1800 </code></div>
<div class="line"><code class="plain">QGROUP                 |      </code></div>
<div class="line"><code class="plain">SPACE_LIMIT            | 0.5  </code></div>
<div class="line"><code class="plain">SUBVOLUME              | /    </code></div>
<div class="line"><code class="plain">SYNC_ACL               | no   </code></div>
<div class="line"><code class="plain">TIMELINE_CLEANUP       | yes  </code></div>
<div class="line"><code class="plain">TIMELINE_CREATE        | yes  </code></div>
<div class="line"><code class="plain">TIMELINE_LIMIT_DAILY   | 5    </code></div>
<div class="line"><code class="plain">TIMELINE_LIMIT_HOURLY  | 5    </code></div>
<div class="line"><code class="plain">TIMELINE_LIMIT_MONTHLY | 5    </code></div>
<div class="line"><code class="plain">TIMELINE_LIMIT_YEARLY  | 5    </code></div>
<div class="line"><code class="plain">TIMELINE_MIN_AGE       | 1800 </code></div>
</div>
    </div>
    </div>
    <div class="section section-1" id="src-5126828_UsingSnapshots-CaveatsandErrata">
        <h1 class="heading "><span>Caveats and Errata</span></h1>
    <div class="section section-2" id="src-5126828_UsingSnapshots-rootPartitionMountedMultipleTimes">
        <h2 class="heading "><span>root Partition Mounted Multiple Times</span></h2>
    <p  >You may notice that the root partition gets mounted multiple times. This is due to the way the <tt class=" ">btrfs</tt> file system handles subvolumes, mounting the root partition once for each subvolume. <tt class=" ">btrfs</tt> keeps one subvolume for each snapshot taken, which stores the snapshot data. While all snapshots are subvolumes, not all subvolumes are snapshots.    </p>
    <p  >Cumulus Linux excludes a number of directories when it takes a snapshot of the root file system (and from any rollbacks):    </p>
    <div  class="tablewrap">
        <table class="confluenceTable">
        <thead class=" ">    <tr>
            <td  class="confluenceTh" rowspan="1" colspan="1">
        <p  >Directory    </p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
        <p  >Reason    </p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >/home    </p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >Excluded to avoid user data loss on rollbacks.    </p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >/var/log, /var/support    </p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >Log file and Cumulus support location. Excluded from snapshots to allow post-rollback analysis.    </p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >/tmp, /var/tmp    </p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >No need to rollback temporary files.    </p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >/opt, /var/opt    </p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >Third-party software usually are installed in /opt. Exclude /opt to avoid re-installing these applications after rollbacks.    </p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >/srv    </p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >Contains data for HTTP and FTP servers. Excluded this directory to avoid server data loss on rollbacks.    </p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >/usr/local    </p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >This directory is used when installing locally built software. Exclude this directory to avoid re-installing these software after rollbacks.    </p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >/var/spool    </p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >Exclude this directory to avoid loss of mail after a rollback.    </p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >/var/lib/libvirt/images    </p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >This is the default directory for libvirt VM images. Exclude from the snapshot. Additionally disable Copy-On-Write (COW) for this subvolume as COW and VM image I/O access patterns do not play nice.    </p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >/boot/grub/i386-pc, /boot/grub/x86_64-efi, /boot/grub/arm-uboot    </p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >The GRUB kernel modules must stay in sync with the GRUB kernel installed in the master boot record or UEFI system partition.    </p>
            </td>
        </tr>
</tbody>        </table>
            </div>
    </div>
    </div>
        </div>

    </article>


            <nav id="ht-post-nav">
                <a href="Upgrading_Cumulus_Linux.html" class="ht-post-nav-prev">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-prev" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Upgrading Cumulus Linux</span>
        </a>
                <a href="Adding_and_Updating_Packages.html" class="ht-post-nav-next">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-next" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-225.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Adding and Updating Packages</span>
        </a>
    </nav>    
            
            <article id="html-search-results" class="ht-content" style="display: none;">
            <header class="ht-content-header">
                <div id="ht-spacetitle">
                    <ul>
                        <li><a href="Cumulus_Linux_User_Guide.html">Cumulus Linux 3.2.1</a></li>
                    </ul>
                </div>
                <h1>Search results</h1>
            </header>
            <div id="search-results"></div>
        </article>
    
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>


</body>
</html>
