<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Virtual Routing and Forwarding - VRF - Cumulus Linux 3.2.1</title>

    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/scroll-tree.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>


<link rel="stylesheet" href="assets/css/content-style.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

    </head>

<body pageid="5126727">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">CL321</span>
                    <img class="space-logo" src="spacelogo.png" />
                </h1>
                <a href="Cumulus_Linux_User_Guide.html" class="ht-space-link">
                    <h2>Cumulus Linux 3.2.1</h2>
                </a>
            </header>

            <nav class="ht-pages-nav">
                <ul class="ht-pages-nav-top">
                                                <li class="leaf">
        <a class="ht-nav-page-link" href="Quick_Start_Guide.html">Quick Start Guide</a>

            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="Installation_Management.html">Installation Management</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Managing_Cumulus_Linux_Disk_Images.html">Managing Cumulus Linux Disk Images</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Installing_a_New_Cumulus_Linux_Image.html">Installing a New Cumulus Linux Image</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Upgrading_Cumulus_Linux.html">Upgrading Cumulus Linux</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Using_Snapshots.html">Using Snapshots</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Adding_and_Updating_Packages.html">Adding and Updating Packages</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Zero_Touch_Provisioning_-_ZTP.html">Zero Touch Provisioning - ZTP</a>

            </li>
                            </ul>
            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="System_Configuration.html">System Configuration</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Network_Command_Line_Utility.html">Network Command Line Utility</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Setting_Date_and_Time.html">Setting Date and Time</a>

            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Authentication,_Authorization,_and_Accounting.html">Authentication, Authorization, and Accounting</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="SSH_for_Remote_Access.html">SSH for Remote Access</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="User_Accounts.html">User Accounts</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Using_sudo_to_Delegate_Privileges.html">Using sudo to Delegate Privileges</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="LDAP_Authentication_and_Authorization.html">LDAP Authentication and Authorization</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="TACACS_Plus.html">TACACS Plus</a>

            </li>
                            </ul>
            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Netfilter_-_ACLs.html">Netfilter - ACLs</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Default_Cumulus_Linux_ACL_Configuration.html">Default Cumulus Linux ACL Configuration</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Managing_Application_Daemons.html">Managing Application Daemons</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Configuring_switchd.html">Configuring switchd</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Power_over_Ethernet_-_PoE.html">Power over Ethernet - PoE</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Configuring_a_Global_Proxy.html">Configuring a Global Proxy</a>

            </li>
                            </ul>
            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="Interface_Configuration_and_Management.html">Interface Configuration and Management</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Layer_1_and_Switch_Port_Attributes.html">Layer 1 and Switch Port Attributes</a>

            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Buffer_and_Queue_Management.html">Buffer and Queue Management</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Configuring_Hardware-enabled_DDOS_Protection.html">Configuring Hardware-enabled DDOS Protection</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Configuring_DHCP_Relays.html">Configuring DHCP Relays</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Configuring_DHCP_Servers.html">Configuring DHCP Servers</a>

            </li>
                            </ul>
            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="Layer_One_and_Two.html">Layer One and Two</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Spanning_Tree_and_Rapid_Spanning_Tree.html">Spanning Tree and Rapid Spanning Tree</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Link_Layer_Discovery_Protocol.html">Link Layer Discovery Protocol</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Prescriptive_Topology_Manager_-_PTM.html">Prescriptive Topology Manager - PTM</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Bonding_-_Link_Aggregation.html">Bonding - Link Aggregation</a>

            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Ethernet_Bridging_-_VLANs.html">Ethernet Bridging - VLANs</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VLAN-aware_Bridge_Mode_for_Large-scale_Layer_2_Environments.html">VLAN-aware Bridge Mode for Large-scale Layer 2 Environments</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Traditional_Mode_Bridges.html">Traditional Mode Bridges</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VLAN_Tagging.html">VLAN Tagging</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Multi-Chassis_Link_Aggregation_-_MLAG.html">Multi-Chassis Link Aggregation - MLAG</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="LACP_Bypass.html">LACP Bypass</a>

            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Virtual_Router_Redundancy_-_VRR.html">Virtual Router Redundancy - VRR</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="ifplugd.html">ifplugd</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="IGMP_and_MLD_Snooping.html">IGMP and MLD Snooping</a>

            </li>
                            </ul>
            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="Network_Virtualization.html">Network Virtualization</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Integrating_with_VMware_NSX.html">Integrating with VMware NSX</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Integrating_Hardware_VTEPs_with_Midokura_MidoNet_and_OpenStack.html">Integrating Hardware VTEPs with Midokura MidoNet and OpenStack</a>

            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Lightweight_Network_Virtualization_-_LNV_Overview.html">Lightweight Network Virtualization - LNV Overview</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="LNV_VXLAN_Active-Active_Mode.html">LNV VXLAN Active-Active Mode</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="LNV_Full_Example.html">LNV Full Example</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Static_MAC_Bindings_with_VXLAN.html">Static MAC Bindings with VXLAN</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Ethernet_Virtual_Private_Network_-_EVPN.html">Ethernet Virtual Private Network - EVPN</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="VXLAN_Hyperloop.html">VXLAN Hyperloop</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Static_VXLAN_Tunnels.html">Static VXLAN Tunnels</a>

            </li>
                            </ul>
            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="Layer_Three.html">Layer Three</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Routing.html">Routing</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Introduction_to_Routing_Protocols.html">Introduction to Routing Protocols</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Network_Topology.html">Network Topology</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Quagga_Overview.html">Quagga Overview</a>

            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Configuring_Quagga.html">Configuring Quagga</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Comparing_NCLU_and_vtysh_Commands.html">Comparing NCLU and vtysh Commands</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Open_Shortest_Path_First_-_OSPF_-_Protocol.html">Open Shortest Path First - OSPF - Protocol</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Open_Shortest_Path_First_v3_-_OSPFv3_-_Protocol.html">Open Shortest Path First v3 - OSPFv3 - Protocol</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Border_Gateway_Protocol_-_BGP.html">Border Gateway Protocol - BGP</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Bidirectional_Forwarding_Detection_-_BFD.html">Bidirectional Forwarding Detection - BFD</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Equal_Cost_Multipath_Load_Sharing_-_Hardware_ECMP.html">Equal Cost Multipath Load Sharing - Hardware ECMP</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Redistribute_Neighbor.html">Redistribute Neighbor</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link current" href="Virtual_Routing_and_Forwarding_-_VRF.html">Virtual Routing and Forwarding - VRF</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Management_VRF.html">Management VRF</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Protocol_Independent_Multicast_-_PIM.html">Protocol Independent Multicast - PIM</a>

            </li>
                            </ul>
            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="Monitoring_and_Troubleshooting.html">Monitoring and Troubleshooting</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Single_User_Mode_-_Boot_Recovery.html">Single User Mode - Boot Recovery</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Resource_Diagnostics_Using_cl-resource-query.html">Resource Diagnostics Using cl-resource-query</a>

            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Monitoring_System_Hardware.html">Monitoring System Hardware</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Network_Switch_Port_LED_and_Status_LED_Guidelines.html">Network Switch Port LED and Status LED Guidelines</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Monitoring_Virtual_Device_Counters.html">Monitoring Virtual Device Counters</a>

            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Understanding_the_cl-support_Output_File.html">Understanding the cl-support Output File</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Troubleshooting_Log_Files.html">Troubleshooting Log Files</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Troubleshooting_the_etc_Directory.html">Troubleshooting the etc Directory</a>

            </li>
                            </ul>
            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Troubleshooting_Network_Interfaces.html">Troubleshooting Network Interfaces</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Monitoring_Interfaces_and_Transceivers_Using_ethtool.html">Monitoring Interfaces and Transceivers Using ethtool</a>

            </li>
                            </ul>
            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="Network_Troubleshooting.html">Network Troubleshooting</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Using_NCLU_to_Troubleshoot_Your_Network_Configuration.html">Using NCLU to Troubleshoot Your Network Configuration</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Monitoring_System_Statistics_and_Network_Traffic_with_sFlow.html">Monitoring System Statistics and Network Traffic with sFlow</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Using_netq_to_Troubleshoot_the_Network.html">Using netq to Troubleshoot the Network</a>

            </li>
                            </ul>
            </li>
                                        <li class="collapsed">
        <a class="ht-nav-page-link" href="SNMP_Monitoring.html">SNMP Monitoring</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Using_Nutanix_Prism_as_a_Monitoring_Tool.html">Using Nutanix Prism as a Monitoring Tool</a>

            </li>
                            </ul>
            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Monitoring_Best_Practices.html">Monitoring Best Practices</a>

            </li>
                            </ul>
            </li>
                                                <li class="collapsed">
        <a class="ht-nav-page-link" href="Network_Solutions.html">Network Solutions</a>

                    <span class="sp-toggle sp-aui-icon-small ht-pages-nav-toggle">
                <svg id="icon-minus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
                <svg id="icon-plus" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#CCCCCC">
                        <rect x="11" y="7" width="2" height="10"></rect>
                        <rect x="7" y="11" width="10" height="2"></rect>
                    </g>
                </svg>
            </span>

            <ul class="nav ht-pages-nav-sub">
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Data_Center_Host_to_ToR_Architecture.html">Data Center Host to ToR Architecture</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Cumulus_Networks_Services_Demos.html">Cumulus Networks Services Demos</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Docker_on_Cumulus_Linux.html">Docker on Cumulus Linux</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="OpenStack_Neutron_ML2_and_Cumulus_Linux.html">OpenStack Neutron ML2 and Cumulus Linux</a>

            </li>
                                        <li class="leaf">
        <a class="ht-nav-page-link" href="Anycast_Design_Guide.html">Anycast Design Guide</a>

            </li>
                            </ul>
            </li>
                                                <li class="leaf">
        <a class="ht-nav-page-link" href="Cumulus_Linux_Index.html">Cumulus Linux Index</a>

            </li>
                                    </ul>
            </nav>
        </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="Cumulus_Linux_User_Guide.html">Cumulus Linux 3.2.1</a></li>
                                                                                     <li><a href="Layer_Three.html">Layer Three</a></li>
                                                            </ul>
</div>            <h1 id="src-5127065"> <span>Virtual Routing and Forwarding - VRF</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">

    <p  >Cumulus Linux provides <i class=" ">virtual</i> <i class=" ">routing and forwarding</i> (VRF) to allow for the presence of multiple independent routing tables working simultaneously on the same router or switch. This permits multiple network paths without the need for multiple switches. Think of this feature as VLAN for layer 3, but unlike VLANs, there is no field in the IP header carrying it. Other implementations call this feature <i class=" ">VRF-Lite</i>.    </p>
    <p  >The primary use cases for VRF in a data center are similar to VLANs at layer 2: using common physical infrastructure to carry multiple isolated traffic streams for multi-tenant environments, where these streams are allowed to cross over only at configured boundary points, typically firewalls or IDS. You can also use it to burst traffic from private clouds to enterprise networks where the burst point is at layer 3. Or you can use it in an OpenStack deployment.    </p>
    <p  >VRF is fully supported in the Linux kernel, so it has the following characteristics:    </p>
<ul class=" "><li class=" ">    <p  >The VRF is presented as a layer 3 master network device with its own associated routing table.    </p>
</li><li class=" ">    <p  >The layer 3 interfaces (VLAN interfaces, bonds, switch virtual interfaces/SVIs) associated with the VRF are enslaved to that VRF; IP rules direct FIB (forwarding information base) lookups to the routing table for the VRF device.    </p>
</li><li class=" ">    <p  >The VRF device can have its own IP address, known as a <i class=" ">VRF-local loopback</i>.    </p>
</li><li class=" ">    <p  >Applications can use existing interfaces to operate in a VRF context &mdash; by binding sockets to the VRF device or passing the <tt class=" ">ifindex</tt> using <tt class=" ">cmsg</tt>.    </p>
</li><li class=" ">    <p  >Listen sockets used by services are VRF-global by default unless the application is configured to use a more limited scope. Connected sockets (like TCP) are then bound to the VRF domain in which the connection originates.    </p>
</li><li class=" ">    <p  >Connected and local routes are placed in appropriate VRF tables.    </p>
</li><li class=" ">    <p  >Neighbor entries continue to be per-interface, and you can view all entries associated with the VRF device.    </p>
</li><li class=" ">    <p  >A VRF does not map to its own network namespace; however, you can nest VRFs in a network namespace.    </p>
</li><li class=" ">    <p  >You can use existing Linux tools to interact with it, such as <tt class=" ">tcpdump</tt>.    </p>
</li></ul>    <p  >You configure VRF by associating each subset of interfaces to a VRF routing table, and configuring an instance of the routing protocol &mdash; BGP &mdash; for each routing table.    </p>
    <p  >    <img  class="confluence-embedded-image confluence-thumbnail" src="images/download/thumbnails/5127065/mrf2.png" alt="images/download/thumbnails/5127065/mrf2.png" width="300"  />
        </p>
    <div class="section section-1" id="src-5127065_VirtualRoutingandForwarding-VRF-Contents">
        <h1 class="heading "><span>Contents</span></h1>
    <p  class="expand-control-text">This chapter covers ...    </p>
    </div>
    <div class="section section-1" id="src-5127065_VirtualRoutingandForwarding-VRF-ConfiguringVRF">
        <h1 class="heading "><span>Configuring VRF</span></h1>
    <p  >Each routing table is called a <i class=" ">VRF table</i>, and has its own table ID. You configure VRF using <a   href="Network_Command_Line_Utility.html">NCLU</a>, then place the layer 3 interface in the VRF. You can have a maximum of 64 VRFs on a switch.    </p>
    <p  >When you configure a VRF, you follow a similar process to other network interfaces. Keep in mind the following for a VRF table:    </p>
<ul class=" "><li class=" ">    <p  >It can have an IP address, a loopback interface for the VRF.    </p>
</li><li class=" ">    <p  >Associated rules are added automatically.    </p>
</li><li class=" ">    <p  >You can also add a default route to avoid skipping across tables when the kernel forwards the packet.    </p>
</li><li class=" ">    <p  >Names for VRF tables can be up to 15 characters. However, you <strong class=" ">cannot</strong> use the name <i class=" ">mgmt</i>, as this name can <strong class=" ">only</strong> be used for <a   href="Management_VRF.html">management VRF</a>.    </p>
</li></ul>    <p  >To configure a VRF, run:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ net add vrf red vrf-table auto</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ net add interface swp1 vrf red</code></div>
</div>
    </div>
    <p  >These commands result in the following VRF configuration in the <tt class=" ">/etc/network/interfaces</tt> file:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">auto red</code></div>
<div class="line"><code class="plain">iface red</code></div>
<div class="line"><code class="plain">    vrf-table auto</code></div>
<div class="line"><code class="plain">  </code></div>
<div class="line"><code class="plain">auto swp1 </code></div>
<div class="line"><code class="plain">iface swp1</code></div>
<div class="line"><code class="plain">    vrf red</code></div>
</div>
    </div>
    <div class="section section-2" id="src-5127065_VirtualRoutingandForwarding-VRF-SpecifyingaTableID">
        <h2 class="heading "><span>Specifying a Table ID</span></h2>
    <p  >Instead of having Cumulus Linux assign a table ID for the VRF table, you can specify your own table ID in the configuration. The table ID to name mapping is saved in <tt class=" ">/etc/iproute2/rt_tables.d/</tt> for name-based references. So instead of using the <tt class=" ">auto</tt><span id="src-5127065_indexterm-3234568386854AE60228394A80A9A030"> option above, specify the </span>table ID like this:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus</code><code class="color1">@switch</code><code class="plain">:~$ net add vrf red vrf-table </code><code class="value">1016</code></div>
</div>
    </div>
    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <p  >If you do specify a table ID, it <strong class=" ">must</strong> be in the range of 1001 to 1255 which is reserved in Cumulus Linux for VRF table IDs.    </p>
        </div>
    </div>
    </div>
    <div class="section section-2" id="src-5127065_VirtualRoutingandForwarding-VRF-BringingaVRFUpafterDowningItwithifdown">
        <h2 class="heading "><span>Bringing a VRF Up after Downing It with ifdown</span></h2>
    <p  >If you take down a VRF using <tt class=" ">ifdown</tt>, to bring it back up you need to do one of two things:    </p>
<ul class=" "><li class=" ">    <p  >Use <tt class=" ">ifup --with-depends &lt;vrf&gt;</tt>    </p>
</li><li class=" ">    <p  >Use <tt class=" ">ifreload -a</tt>    </p>
</li></ul>    <p  >For example:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ sudo ifdown red</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ sudo ifup --with-depends red</code></div>
</div>
    </div>
    </div>
    <div class="section section-2" id="src-5127065_VirtualRoutingandForwarding-VRF-vrf_cmdUsingthevrfCommand">
        <h2 class="heading "><span id="src-5127065_VirtualRoutingandForwarding-VRF-vrf_cmd" class="confluence-anchor-link"></span><span>Using the vrf Command</span></h2>
    <p  >The <tt class=" ">vrf</tt> command returns information about VRF tables that is otherwise not available in other Linux commands, such as <tt class=" ">iproute</tt>. You can also use it to execute non-VRF-specific commands and perform other tasks related to VRF tables.    </p>
    <p  >To get a list of VRF tables, run:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ vrf list</code></div>
<div class="line"><code class="plain">  </code></div>
<div class="line"><code class="plain">VRF              Table</code></div>
<div class="line"><code class="plain">---------------- -----</code></div>
<div class="line"><code class="plain">red               1016</code></div>
</div>
    </div>
    <p  >To return a list of processes and PIDs associated with a specific VRF table, run <tt class=" ">vrf task list &lt;vrf-name&gt;</tt>. For example:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ vrf task list red</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">VRF: red            </code></div>
<div class="line"><code class="plain">-----------------------</code></div>
<div class="line"><code class="plain">dhclient           2508</code></div>
<div class="line"><code class="plain">sshd               2659</code></div>
<div class="line"><code class="plain">bash               2681</code></div>
<div class="line"><code class="plain">su                 2702</code></div>
<div class="line"><code class="plain">bash               2720</code></div>
<div class="line"><code class="plain">vrf                2829</code></div>
</div>
    </div>
    <p  >To determine which VRF table is associated with a particular PID, run <tt class=" ">vrf task identify &lt;pid&gt;</tt>. For example:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus</code><code class="color1">@switch</code><code class="plain">:~$ vrf task identify </code><code class="value">2829</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">red</code></div>
</div>
    </div>
    <div class="section section-3" id="src-5127065_VirtualRoutingandForwarding-VRF-execRunningIPv4andIPv6CommandsinaVRFContext">
        <h3 class="heading "><span id="src-5127065_VirtualRoutingandForwarding-VRF-exec" class="confluence-anchor-link"></span><span>Running IPv4 and IPv6 Commands in a VRF Context </span></h3>
    <p  >You can execute non-VRF-specific Linux commands and perform other tasks against a given VRF table. This typically applies to single-use commands started from a login shell, as they affect only AF_INET and AF_INET6 sockets opened by the command that gets executed; it has no impact on netlink sockets, associated with the <tt class=" ">ip</tt> command.    </p>
    <p  >To execute such a command against a VRF table, run <tt class=" ">vrf task exec &lt;vrf-name&gt; &lt;command&gt;</tt>. For example, to SSH from the switch to a device accessible through VRF <i class=" ">red</i>:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ sudo vrf task exec red ssh user@host</code></div>
</div>
    </div>
    <p  >You should manage long-running services with <tt class=" ">systemd</tt> using the <i class=" ">service@vrf</i> notation; for example, <tt class=" ">systemctl start ntp@mgmt</tt>. <tt class=" ">systemd</tt>-based services are stopped when a VRF is deleted and started when the VRF is created. For example, restarting networking or running an <tt class=" ">ifdown</tt>/<tt class=" ">ifup</tt> sequence.    </p>
    </div>
    </div>
    </div>
    <div class="section section-1" id="src-5127065_VirtualRoutingandForwarding-VRF-QuaggaOperationinaVRF">
        <h1 class="heading "><span>Quagga Operation in a VRF</span></h1>
    <p  >In Cumulus Linux 3.0 and later, BGP and static routing (IPv4 and IPv6) are supported within a VRF context. Various Quagga routing constructs, such as routing tables, nexthops, router-id, and related processing are also VRF-aware. However, OSPFv2 and OSPFv3 are not VRF-aware and can only operate in the default VRF.    </p>
    <p  ><a   href="Quagga_Overview.html">Quagga</a> learns of VRFs provisioned on the system as well as interface attachment to a VRF through notifications from the kernel.    </p>
    <p  >You can assign switch ports to each VRF table with an interface-level configuration, and BGP instances can be assigned to the table with a BGP router-level command. Note that OSPFv2 and OSPFv3 are <strong class=" ">not</strong> VRF-aware.    </p>
    <p  >Because BGP is VRF-aware, it supports per-VRF neighbors, both iBGP and eBGP as well as numbered and unnumbered interfaces. Non-interface-based VRF neighbors are bound to the VRF, which is how you can have overlapping address spaces in different VRFs. Each VRF can have its own parameters, such as address families and redistribution. Incoming connections rely on the Linux kernel for VRF-global sockets. BGP neighbors can be tracked using <a   href="Bidirectional_Forwarding_Detection_-_BFD.html">BFD</a>, both for single and multiple hops. You can configure multiple <a   href="Border_Gateway_Protocol_-_BGP.html">BGP</a> instances, associating each with a VRF.    </p>
    <p  >As mentioned above, VRFs are provisioned through <tt class=" ">/etc/network/interfaces</tt>. VRFs can be pre-provisioned in Quagga too, but they become active only when configured through <tt class=" ">/etc/network/interfaces</tt>.    </p>
<ul class=" "><li class=" ">    <p  >A VRF can be pre-provisioned in Quagga by running the command <tt class=" ">vrf vrf-name</tt>.    </p>
</li><li class=" ">    <p  >A BGP instance corresponding to a VRF can be pre-provisioned by configuring <tt class=" ">router bgp asn vrf vrf-name</tt>. Under this context, all existing BGP parameters can be configured - neighbors, peer-groups, address-family configuration, redistribution etc.    </p>
</li><li class=" ">    <p  >Static routes (IPv4 and IPv6) can be provisioned in a VRF by specifying the VRF along with the static route configuration. For example, <tt class=" ">ip route prefix nexthop vrf vrf-name</tt>. The VRF has to exist for this configuration to be accepted - either already defined through <tt class=" ">/etc/network/interfaces</tt> or pre-provisioned in Quagga.    </p>
</li></ul>    <div class="section section-2" id="src-5127065_VirtualRoutingandForwarding-VRF-ExampleConfiguration">
        <h2 class="heading "><span>Example Configuration</span></h2>
    <p  >Here's an example VRF configuration in BGP:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ net add bgp vrf vrf1012 autonomous-system 64900</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ net add bgp vrf vrf1012 router-id 6.0.2.7</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ net add bgp vrf vrf1012 neighbor ISL peer-group</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ net add bgp vrf vrf1012 neighbor ISLv6 peer-group</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ net add bgp vrf vrf1012 neighbor swp1.2 interface v6only peer-group ISLv6</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ net add bgp vrf vrf1012 neighbor swp1.2 remote-as external</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ net add bgp vrf vrf1012 neighbor swp3.2 interface v6only peer-group ISLv6</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ net add bgp vrf vrf1012 neighbor swp3.2 remote-as external</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ net add bgp vrf vrf1012 neighbor 169.254.2.18 remote-as external</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ net add bgp vrf vrf1012 neighbor 169.254.2.18 peer-group ISL</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ net add bgp vrf vrf1012 ipv4 unicast network 20.7.2.0/24</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ net add bgp vrf vrf1012 ipv4 unicast neighbor ISL activate</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ net add bgp vrf vrf1012 neighbor ISL route-map ALLOW_BR2 out</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ net add bgp vrf vrf1012 ipv6 unicast network 2003:7:2::/125</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ net add bgp vrf vrf1012 ipv6 unicast neighbor ISLv6 activate</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ net add bgp vrf vrf1012 neighbor ISLv6 route-map ALLOW_BR2_v6 out</code></div>
</div>
    </div>
    <p  >These commands produce the following configuration in the <tt class=" ">/etc/quagga/Quagga.conf</tt> file:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">router bgp 64900 vrf vrf1012</code></div>
<div class="line"><code class="plain">  bgp router-id 6.0.2.7</code></div>
<div class="line"><code class="plain">  no bgp default ipv4-unicast</code></div>
<div class="line"><code class="plain">  neighbor ISL peer-group</code></div>
<div class="line"><code class="plain">  neighbor ISLv6 peer-group</code></div>
<div class="line"><code class="plain">  neighbor swp1.2 interface v6only peer-group ISLv6</code></div>
<div class="line"><code class="plain">  neighbor swp1.2 remote-as external</code></div>
<div class="line"><code class="plain">  neighbor swp3.2 interface v6only peer-group ISLv6</code></div>
<div class="line"><code class="plain">  neighbor swp3.2 remote-as external</code></div>
<div class="line"><code class="plain">  neighbor 169.254.2.18 remote-as external</code></div>
<div class="line"><code class="plain">  neighbor 169.254.2.18 peer-group ISL</code></div>
<div class="line"><code class="plain">  !</code></div>
<div class="line"><code class="plain">  address-family ipv4 unicast</code></div>
<div class="line"><code class="plain">    network 20.7.2.0/24</code></div>
<div class="line"><code class="plain">    neighbor ISL activate</code></div>
<div class="line"><code class="plain">    neighbor ISL route-map ALLOW_BR2 out</code></div>
<div class="line"><code class="plain">  exit-address-family</code></div>
<div class="line"><code class="plain">  !</code></div>
<div class="line"><code class="plain">  address-family ipv6 unicast</code></div>
<div class="line"><code class="plain">    network 2003:7:2::/125</code></div>
<div class="line"><code class="plain">    neighbor ISLv6 activate</code></div>
<div class="line"><code class="plain">    neighbor ISLv6 route-map ALLOW_BR2_v6 out</code></div>
<div class="line"><code class="plain">  exit-address-family</code></div>
<div class="line"><code class="plain">!</code></div>
</div>
    </div>
    </div>
    </div>
    <div class="section section-1" id="src-5127065_VirtualRoutingandForwarding-VRF-ExampleCommandstoShowVRFData">
        <h1 class="heading "><span>Example Commands to Show VRF Data</span></h1>
    <p  >There are a number of ways to interact with VRFs, including NCLU, <tt class=" ">vtysh</tt> (the Quagga CLI) and <tt class=" ">iproute2</tt>.    </p>
    <div class="section section-2" id="src-5127065_VirtualRoutingandForwarding-VRF-ShowingVRFDataUsingNCLUCommands">
        <h2 class="heading "><span>Showing VRF Data Using NCLU Commands</span></h2>
    <p  >To show the routes in the VRF:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ net show route vrf red</code></div>
<div class="line"><code class="plain">RIB entry for red</code></div>
<div class="line"><code class="plain">=================</code></div>
<div class="line"><code class="plain">Codes: K - kernel route, C - connected, S - static, R - RIP,</code></div>
<div class="line"><code class="plain">       O - OSPF, I - IS-IS, B - BGP, T - Table,</code></div>
<div class="line"><code class="plain">       &gt; - selected route, * - FIB route</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">C&gt;* 169.254.2.8/30 is directly connected, swp1.2</code></div>
<div class="line"><code class="plain">C&gt;* 169.254.2.12/30 is directly connected, swp2.2</code></div>
<div class="line"><code class="plain">C&gt;* 169.254.2.16/30 is directly connected, swp3.2</code></div>
</div>
    </div>
    <p  >To show the BGP summary for the VRF:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ net show bgp vrf red summary</code></div>
<div class="line"><code class="plain">BGP router identifier 6.0.2.7, local AS number 64900 vrf-id 14</code></div>
<div class="line"><code class="plain">BGP table version 0</code></div>
<div class="line"><code class="plain">RIB entries 1, using 120 bytes of memory</code></div>
<div class="line"><code class="plain">Peers 6, using 97 KiB of memory</code></div>
<div class="line"><code class="plain">Peer groups 2, using 112 bytes of memory</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">Neighbor        V    AS MsgRcvd MsgSent   TblVer  InQ OutQ Up/Down  State/PfxRcd</code></div>
<div class="line"><code class="plain">s3(169.254.2.18)</code></div>
<div class="line"><code class="plain">                4 65000  102039  102040        0    0    0 3d13h03m        0</code></div>
<div class="line"><code class="plain">s1(169.254.2.10)</code></div>
<div class="line"><code class="plain">                4 65000  102039  102040        0    0    0 3d13h03m        0</code></div>
<div class="line"><code class="plain">s2(169.254.2.14)</code></div>
<div class="line"><code class="plain">                4 65000  102039  102040        0    0    0 3d13h03m        0</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">Total number of neighbors 3</code></div>
</div>
    </div>
    <p  >To show BGP (IPv4) routes in the VRF:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ net show bgp vrf vrf1012</code></div>
<div class="line"><code class="plain">BGP table version is 0, local router ID is 6.0.2.7</code></div>
<div class="line"><code class="plain">Status codes: s suppressed, d damped, h history, * valid, &gt; best, = multipath,</code></div>
<div class="line"><code class="plain">              i internal, r RIB-failure, S Stale, R Removed</code></div>
<div class="line"><code class="plain">Origin codes: i - IGP, e - EGP, ? - incomplete</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">   Network          Next Hop            Metric LocPrf Weight Path</code></div>
<div class="line"><code class="plain">   20.7.2.0/24      0.0.0.0                  0         32768 i</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">Total number of prefixes 1</code></div>
</div>
    </div>
    <p  >However, to show BGP IPv6 routes in the VRF, you need to use <tt class=" ">vtysh</tt>, the Quagga CLI:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ sudo vtysh</code></div>
<div class="line"><code class="plain">switch# show bgp vrf vrf1012</code></div>
<div class="line"><code class="plain">BGP table version is 0, local router ID is 6.0.2.7</code></div>
<div class="line"><code class="plain">Status codes: s suppressed, d damped, h history, * valid, &gt; best, = multipath,</code></div>
<div class="line"><code class="plain">              i internal, r RIB-failure, S Stale, R Removed</code></div>
<div class="line"><code class="plain">Origin codes: i - IGP, e - EGP, ? - incomplete</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">   Network          Next Hop            Metric LocPrf Weight Path</code></div>
<div class="line"><code class="plain">   2003:7:2::/125   ::                       0         32768 i</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">Total number of prefixes 1</code></div>
<div class="line"><code class="plain">switch# exit</code></div>
<div class="line"><code class="plain">cumulus@switch:~$</code></div>
</div>
    </div>
    </div>
    <div class="section section-2" id="src-5127065_VirtualRoutingandForwarding-VRF-ShowingVRFDataUsingQuaggaCommands">
        <h2 class="heading "><span>Showing VRF Data Using Quagga Commands</span></h2>
    <p  >Show all VRFs learned by Quagga from the kernel. The table ID shows the corresponding routing table in the kernel either automatically assigned or manually defined:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ sudo vtysh</code></div>
<div class="line"><code class="plain">switch# show vrf</code></div>
<div class="line"><code class="plain">vrf vrf1012 id 14 table 1012</code></div>
<div class="line"><code class="plain">vrf vrf1013 id 21 table 1013</code></div>
<div class="line"><code class="plain">vrf vrf1014 id 28 table 1014</code></div>
<div class="line"><code class="plain">switch# exit</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ </code></div>
</div>
    </div>
    <p  >Show VRFs configured in BGP, including the default. A non-zero ID is a VRF that has also been actually provisioned &mdash; that is, defined in <tt class=" ">/etc/network/interfaces</tt>:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ sudo vtysh</code></div>
<div class="line"><code class="plain">switch# show bgp vrfs</code></div>
<div class="line"><code class="plain">Type  Id     RouterId          #PeersCfg  #PeersEstb  Name</code></div>
<div class="line"><code class="plain">DFLT  0      6.0.0.7                   0           0  Default</code></div>
<div class="line"><code class="plain"> VRF  14     6.0.2.7                   6           6  vrf1012</code></div>
<div class="line"><code class="plain"> VRF  21     6.0.3.7                   6           6  vrf1013</code></div>
<div class="line"><code class="plain"> VRF  28     6.0.4.7                   6           6  vrf1014</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">Total number of VRFs (including default): 4</code></div>
<div class="line"><code class="plain">switch# exit</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ </code></div>
</div>
    </div>
    <p  >Display interfaces known to Quagga and attached to this VRF:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ sudo vtysh</code></div>
<div class="line"><code class="plain">switch# show interface vrf vrf1012</code></div>
<div class="line"><code class="plain">Interface br2 is up, line protocol is down</code></div>
<div class="line"><code class="plain">  PTM status: disabled</code></div>
<div class="line"><code class="plain">  vrf: vrf1012</code></div>
<div class="line"><code class="plain">  index 13 metric 0 mtu 1500</code></div>
<div class="line"><code class="plain">  flags: &lt;UP,BROADCAST,MULTICAST&gt;</code></div>
<div class="line"><code class="plain">  inet 20.7.2.1/24</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">  inet6 fe80::202:ff:fe00:a/64</code></div>
<div class="line"><code class="plain">  ND advertised reachable time is 0 milliseconds</code></div>
<div class="line"><code class="plain">  ND advertised retransmit interval is 0 milliseconds</code></div>
<div class="line"><code class="plain">  ND router advertisements are sent every 600 seconds</code></div>
<div class="line"><code class="plain">  ND router advertisements lifetime tracks ra-interval</code></div>
<div class="line"><code class="plain">  ND router advertisement default router preference is medium</code></div>
<div class="line"><code class="plain">  Hosts use stateless autoconfig for addresses.</code></div>
<div class="line"><code class="plain">switch# exit</code></div>
<div class="line"><code class="plain">cumulus@switch:~$</code></div>
</div>
    </div>
    </div>
    <div class="section section-2" id="src-5127065_VirtualRoutingandForwarding-VRF-ShowingVRFDataUsingipCommands">
        <h2 class="heading "><span>Showing VRF Data Using ip Commands</span></h2>
    <p  >To list all VRFs provisioned, showing the VRF ID (vrf1012, vrf1013 and vrf1014 below) as well as the table ID:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ ip -d link show type vrf      </code></div>
<div class="line"><code class="plain">14: vrf1012: &lt;NOARP,MASTER,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN mode DEFAULT group default qlen 1000</code></div>
<div class="line"><code class="plain">    link/ether 46:96:c7:64:4d:fa brd ff:ff:ff:ff:ff:ff promiscuity 0 </code></div>
<div class="line"><code class="plain">    vrf table 1012 addrgenmode eui64 </code></div>
<div class="line"><code class="plain">21: vrf1013: &lt;NOARP,MASTER,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN mode DEFAULT group default qlen 1000</code></div>
<div class="line"><code class="plain">    link/ether 7a:8a:29:0f:5e:52 brd ff:ff:ff:ff:ff:ff promiscuity 0 </code></div>
<div class="line"><code class="plain">    vrf table 1013 addrgenmode eui64 </code></div>
<div class="line"><code class="plain">28: vrf1014: &lt;NOARP,MASTER,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN mode DEFAULT group default qlen 1000</code></div>
<div class="line"><code class="plain">    link/ether e6:8c:4d:fc:eb:b1 brd ff:ff:ff:ff:ff:ff promiscuity 0 </code></div>
<div class="line"><code class="plain">    vrf table 1014 addrgenmode eui64 </code></div>
</div>
    </div>
    <p  >To list the interfaces attached to a specific VRF:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ ip -d link show vrf vrf1012</code></div>
<div class="line"><code class="plain">8: swp1.2@swp1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master vrf1012 state UP mode DEFAULT group default </code></div>
<div class="line"><code class="plain">    link/ether 00:02:00:00:00:07 brd ff:ff:ff:ff:ff:ff promiscuity 0 </code></div>
<div class="line"><code class="plain">    vlan protocol 802.1Q id 2 &lt;REORDER_HDR&gt; </code></div>
<div class="line"><code class="plain">    vrf_slave addrgenmode eui64 </code></div>
<div class="line"><code class="plain">9: swp2.2@swp2: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master vrf1012 state UP mode DEFAULT group default </code></div>
<div class="line"><code class="plain">    link/ether 00:02:00:00:00:08 brd ff:ff:ff:ff:ff:ff promiscuity 0 </code></div>
<div class="line"><code class="plain">    vlan protocol 802.1Q id 2 &lt;REORDER_HDR&gt; </code></div>
<div class="line"><code class="plain">    vrf_slave addrgenmode eui64 </code></div>
<div class="line"><code class="plain">10: swp3.2@swp3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master vrf1012 state UP mode DEFAULT group default </code></div>
<div class="line"><code class="plain">    link/ether 00:02:00:00:00:09 brd ff:ff:ff:ff:ff:ff promiscuity 0 </code></div>
<div class="line"><code class="plain">    vlan protocol 802.1Q id 2 &lt;REORDER_HDR&gt; </code></div>
<div class="line"><code class="plain">    vrf_slave addrgenmode eui64 </code></div>
<div class="line"><code class="plain">11: swp4.2@swp4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master vrf1012 state UP mode DEFAULT group default </code></div>
<div class="line"><code class="plain">    link/ether 00:02:00:00:00:0a brd ff:ff:ff:ff:ff:ff promiscuity 0 </code></div>
<div class="line"><code class="plain">    vlan protocol 802.1Q id 2 &lt;REORDER_HDR&gt; </code></div>
<div class="line"><code class="plain">    vrf_slave addrgenmode eui64 </code></div>
<div class="line"><code class="plain">12: swp5.2@swp5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master vrf1012 state UP mode DEFAULT group default </code></div>
<div class="line"><code class="plain">    link/ether 00:02:00:00:00:0b brd ff:ff:ff:ff:ff:ff promiscuity 0 </code></div>
<div class="line"><code class="plain">    vlan protocol 802.1Q id 2 &lt;REORDER_HDR&gt; </code></div>
<div class="line"><code class="plain">    vrf_slave addrgenmode eui64 </code></div>
<div class="line"><code class="plain">13: br2: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue master vrf1012 state DOWN mode DEFAULT group default </code></div>
<div class="line"><code class="plain">    link/ether 00:00:00:00:00:00 brd ff:ff:ff:ff:ff:ff promiscuity 0 </code></div>
<div class="line"><code class="plain">    bridge forward_delay 100 hello_time 200 max_age 2000 ageing_time 30000 stp_state 0 priority 32768 </code></div>
<div class="line"><code class="plain">    vlan_filtering 0 vlan_protocol 802.1Q bridge_id 8000.0:0:0:0:0:0 designated_root 8000.0:0:0:0:0:0 </code></div>
<div class="line"><code class="plain">    root_port 0 root_path_cost 0 topology_change 0 topology_change_detected 0 hello_timer    0.00 </code></div>
<div class="line"><code class="plain">    tcn_timer    0.00 topology_change_timer    0.00 gc_timer  202.23 vlan_default_pvid 1 group_fwd_mask 0 </code></div>
<div class="line"><code class="plain">    group_address 01:80:c2:00:00:00 mcast_snooping 1 mcast_router 1 mcast_query_use_ifaddr 0 mcast_querier 0 </code></div>
<div class="line"><code class="plain">    mcast_hash_elasticity 4096 mcast_hash_max 4096 mcast_last_member_count 2 mcast_startup_query_count 2 </code></div>
<div class="line"><code class="plain">    mcast_last_member_interval 100 mcast_membership_interval 26000 mcast_querier_interval 25500 </code></div>
<div class="line"><code class="plain">    mcast_query_interval 12500 mcast_query_response_interval 1000 mcast_startup_query_interval 3125 </code></div>
<div class="line"><code class="plain">    nf_call_iptables 0 nf_call_ip6tables 0 nf_call_arptables 0 </code></div>
<div class="line"><code class="plain">    vrf_slave addrgenmode eui64 </code></div>
</div>
    </div>
    <p  >To show IPv4 routes in a VRF:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ ip route show table vrf1012</code></div>
<div class="line"><code class="plain">unreachable default  metric 240 </code></div>
<div class="line"><code class="plain">broadcast 20.7.2.0 dev br2  proto kernel  scope link  src 20.7.2.1 dead linkdown </code></div>
<div class="line"><code class="plain">20.7.2.0/24 dev br2  proto kernel  scope link  src 20.7.2.1 dead linkdown </code></div>
<div class="line"><code class="plain">local 20.7.2.1 dev br2  proto kernel  scope host  src 20.7.2.1 </code></div>
<div class="line"><code class="plain">broadcast 20.7.2.255 dev br2  proto kernel  scope link  src 20.7.2.1 dead linkdown </code></div>
<div class="line"><code class="plain">broadcast 169.254.2.8 dev swp1.2  proto kernel  scope link  src 169.254.2.9 </code></div>
<div class="line"><code class="plain">169.254.2.8/30 dev swp1.2  proto kernel  scope link  src 169.254.2.9 </code></div>
<div class="line"><code class="plain">local 169.254.2.9 dev swp1.2  proto kernel  scope host  src 169.254.2.9 </code></div>
<div class="line"><code class="plain">broadcast 169.254.2.11 dev swp1.2  proto kernel  scope link  src 169.254.2.9 </code></div>
<div class="line"><code class="plain">broadcast 169.254.2.12 dev swp2.2  proto kernel  scope link  src 169.254.2.13 </code></div>
<div class="line"><code class="plain">169.254.2.12/30 dev swp2.2  proto kernel  scope link  src 169.254.2.13 </code></div>
<div class="line"><code class="plain">local 169.254.2.13 dev swp2.2  proto kernel  scope host  src 169.254.2.13 </code></div>
<div class="line"><code class="plain">broadcast 169.254.2.15 dev swp2.2  proto kernel  scope link  src 169.254.2.13 </code></div>
<div class="line"><code class="plain">broadcast 169.254.2.16 dev swp3.2  proto kernel  scope link  src 169.254.2.17 </code></div>
<div class="line"><code class="plain">169.254.2.16/30 dev swp3.2  proto kernel  scope link  src 169.254.2.17 </code></div>
<div class="line"><code class="plain">local 169.254.2.17 dev swp3.2  proto kernel  scope host  src 169.254.2.17 </code></div>
<div class="line"><code class="plain">broadcast 169.254.2.19 dev swp3.2  proto kernel  scope link  src 169.254.2.17 </code></div>
</div>
    </div>
    <p  >To show IPv6 routes in a VRF:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ ip -6 route show table vrf1012</code></div>
<div class="line"><code class="plain">local fe80:: dev lo  proto none  metric 0  pref medium</code></div>
<div class="line"><code class="plain">local fe80:: dev lo  proto none  metric 0  pref medium</code></div>
<div class="line"><code class="plain">local fe80:: dev lo  proto none  metric 0  pref medium</code></div>
<div class="line"><code class="plain">local fe80:: dev lo  proto none  metric 0  pref medium</code></div>
<div class="line"><code class="plain">local fe80::202:ff:fe00:7 dev lo  proto none  metric 0  pref medium</code></div>
<div class="line"><code class="plain">local fe80::202:ff:fe00:8 dev lo  proto none  metric 0  pref medium</code></div>
<div class="line"><code class="plain">local fe80::202:ff:fe00:9 dev lo  proto none  metric 0  pref medium</code></div>
<div class="line"><code class="plain">local fe80::202:ff:fe00:a dev lo  proto none  metric 0  pref medium</code></div>
<div class="line"><code class="plain">fe80::/64 dev br2  proto kernel  metric 256 dead linkdown  pref medium</code></div>
<div class="line"><code class="plain">fe80::/64 dev swp1.2  proto kernel  metric 256  pref medium</code></div>
<div class="line"><code class="plain">fe80::/64 dev swp2.2  proto kernel  metric 256  pref medium</code></div>
<div class="line"><code class="plain">fe80::/64 dev swp3.2  proto kernel  metric 256  pref medium</code></div>
<div class="line"><code class="plain">ff00::/8 dev br2  metric 256 dead linkdown  pref medium</code></div>
<div class="line"><code class="plain">ff00::/8 dev swp1.2  metric 256  pref medium</code></div>
<div class="line"><code class="plain">ff00::/8 dev swp2.2  metric 256  pref medium</code></div>
<div class="line"><code class="plain">ff00::/8 dev swp3.2  metric 256  pref medium</code></div>
<div class="line"><code class="plain">unreachable default dev lo  metric 240  error -101 pref medium	</code></div>
</div>
    </div>
    <p  >To see a list of links associated with a particular VRF table, <tt class=" ">run ip link list &lt;vrf-name&gt;</tt>. For example:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ ip link list red</code></div>
<div class="line"><code class="plain">  </code></div>
<div class="line"><code class="plain">VRF: red           </code></div>
<div class="line"><code class="plain">--------------------</code></div>
<div class="line"><code class="plain">swp1.10@swp1     UP             6c:64:1a:00:5a:0c &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; </code></div>
<div class="line"><code class="plain">swp2.10@swp2     UP             6c:64:1a:00:5a:0d &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</code></div>
</div>
    </div>
    <p  >To see a list of routes associated with a particular VRF table, run <tt class=" ">ip route list &lt;vrf-name&gt;</tt>. For example:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ ip route list red</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">VRF: red           </code></div>
<div class="line"><code class="plain">--------------------</code></div>
<div class="line"><code class="plain">unreachable default  metric 8192 </code></div>
<div class="line"><code class="plain">10.1.1.0/24 via 10.10.1.2 dev swp2.10 </code></div>
<div class="line"><code class="plain">10.1.2.0/24 via 10.99.1.2 dev swp1.10 </code></div>
<div class="line"><code class="plain">broadcast 10.10.1.0 dev swp2.10  proto kernel  scope link  src 10.10.1.1 </code></div>
<div class="line"><code class="plain">10.10.1.0/28 dev swp2.10  proto kernel  scope link  src 10.10.1.1 </code></div>
<div class="line"><code class="plain">local 10.10.1.1 dev swp2.10  proto kernel  scope host  src 10.10.1.1 </code></div>
<div class="line"><code class="plain">broadcast 10.10.1.15 dev swp2.10  proto kernel  scope link  src 10.10.1.1 </code></div>
<div class="line"><code class="plain">broadcast 10.99.1.0 dev swp1.10  proto kernel  scope link  src 10.99.1.1 </code></div>
<div class="line"><code class="plain">10.99.1.0/30 dev swp1.10  proto kernel  scope link  src 10.99.1.1 </code></div>
<div class="line"><code class="plain">local 10.99.1.1 dev swp1.10  proto kernel  scope host  src 10.99.1.1 </code></div>
<div class="line"><code class="plain">broadcast 10.99.1.3 dev swp1.10  proto kernel  scope link  src 10.99.1.1 </code></div>
<div class="line"> </div>
<div class="line"><code class="plain">local fe80:: dev lo  proto none  metric 0  pref medium</code></div>
<div class="line"><code class="plain">local fe80:: dev lo  proto none  metric 0  pref medium</code></div>
<div class="line"><code class="plain">local fe80::6e64:1aff:fe00:5a0c dev lo  proto none  metric 0  pref medium</code></div>
<div class="line"><code class="plain">local fe80::6e64:1aff:fe00:5a0d dev lo  proto none  metric 0  pref medium</code></div>
<div class="line"><code class="plain">fe80::/64 dev swp1.10  proto kernel  metric 256  pref medium</code></div>
<div class="line"><code class="plain">fe80::/64 dev swp2.10  proto kernel  metric 256  pref medium</code></div>
<div class="line"><code class="plain">ff00::/8 dev swp1.10  metric 256  pref medium</code></div>
<div class="line"><code class="plain">ff00::/8 dev swp2.10  metric 256  pref medium</code></div>
<div class="line"><code class="plain">unreachable default dev lo  metric 8192  error -101 pref medium</code></div>
</div>
    </div>
    <div  class="confbox admonition admonition-tip">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <p  >You can also show routes in a VRF using <tt class=" ">ip [-6] route show vrf &lt;name&gt;</tt>. This command omits local and broadcast routes, which can clutter the output.    </p>
        </div>
    </div>
    </div>
    </div>
    <div class="section section-1" id="src-5127065_VirtualRoutingandForwarding-VRF-UsingBGPUnnumberedInterfaceswithVRF">
        <h1 class="heading "><span>Using BGP Unnumbered Interfaces with VRF</span></h1>
    <p  ><a   href="Border_Gateway_Protocol_-_BGP.html">BGP unnumbered interface configurations</a> are supported with VRF. In BGP unnumbered, there are no addresses on any interface. However, debugging tools like <tt class=" ">traceroute</tt> need at least a single IP address per node as the node's source IP address. Typically, this address was assigned to the loopback device. With VRF, you need a loopback device for each VRF table since VRF is based on interfaces, not IP addresses. While Linux does not support multiple loopback devices, it does support the concept of a dummy interface, which is used to achieve the same goal.    </p>
    <p  >An IP address can be associated with the VRF device, which will then act as the dummy (loopback-like) interface for that VRF.    </p>
<ol class=" "><li class=" ">    <p  >Configure the BGP unnumbered configuration. The BGP unnumbered configuration is the same for a non-VRF, applied under the VRF context (<tt class=" ">router bgp asn vrf &lt;vrf-name&gt;</tt>).    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ net add vrf vrf1 vrf-table auto</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ net add vrf vrf1 ip address 6.1.0.6/32</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ net add vrf vrf1 ipv6 address 2001:6:1::6/128</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ net add interface swp1 link speed 10000 </code></div>
<div class="line"><code class="plain">cumulus@switch:~$ net add interface swp1 link autoneg off</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ net add interface swp1 vrf vrf1</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ net add vlan 101 ip address 20.1.6.1/24</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ net add vlan 101 ipv6 address 2001:20:1:6::1/80</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ net add bridge bridge ports vlan101</code></div>
</div>
    </div>
    <p  >These commands create the following configuration in the <tt class=" ">/etc/network/interfaces</tt> file:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">auto swp1</code></div>
<div class="line"><code class="plain">iface swp1</code></div>
<div class="line"><code class="plain">    link-autoneg on</code></div>
<div class="line"><code class="plain">    link-speed 10000</code></div>
<div class="line"><code class="plain">    vrf vrf1</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto bridge</code></div>
<div class="line"><code class="plain">iface bridge</code></div>
<div class="line"><code class="plain">    bridge-ports vlan101</code></div>
<div class="line"><code class="plain">    bridge-vids 101</code></div>
<div class="line"><code class="plain">    bridge-vlan-aware yes</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto vlan101</code></div>
<div class="line"><code class="plain">iface vlan101</code></div>
<div class="line"><code class="plain">    address 20.1.6.1/24</code></div>
<div class="line"><code class="plain">    address 2001:20:1:6::1/80</code></div>
<div class="line"><code class="plain">    vlan-id 101</code></div>
<div class="line"><code class="plain">    vlan-raw-device bridge</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">auto vrf1</code></div>
<div class="line"><code class="plain">iface vrf1</code></div>
<div class="line"><code class="plain">    address 6.1.0.6/32</code></div>
<div class="line"><code class="plain">    address 2001:6:1::6/128</code></div>
<div class="line"><code class="plain">    vrf-table auto</code></div>
</div>
    </div>
</li></ol>    <p  >Here is the Quagga BGP configuration:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ net add bgp vrf vrf1 autonomous-system 65001</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ net add bgp vrf vrf1 bestpath as-path multipath-relax</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ net add bgp vrf vrf1 bestpath compare-routerid</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ net add bgp vrf vrf1 neighbor LEAF peer-group</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ net add bgp vrf vrf1 neighbor LEAF remote-as external</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ net add bgp vrf vrf1 neighbor LEAF capability extended-nexthop</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ net add bgp vrf vrf1 neighbor swp1.101 interface peer-group LEAF</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ net add bgp vrf vrf1 neighbor swp2.101 interface peer-group LEAF</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ net add bgp vrf vrf1 ipv4 unicast redistribute connected</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ net add bgp vrf vrf1 ipv4 unicast neighbor LEAF activate</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ net add bgp vrf vrf1 ipv6 unicast redistribute connected</code></div>
<div class="line"><code class="plain">cumulus@switch:~$ net add bgp vrf vrf1 ipv6 unicast neighbor LEAF activate</code></div>
</div>
    </div>
    <p  >These commands create the following configuration in the <tt class=" ">/etc/quagga/Quagga.conf</tt> file:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">!</code></div>
<div class="line"><code class="plain">router bgp 65001 vrf vrf1</code></div>
<div class="line"><code class="plain"> no bgp default ipv4-unicast</code></div>
<div class="line"><code class="plain"> bgp bestpath as-path multipath-relax</code></div>
<div class="line"><code class="plain"> bgp bestpath compare-routerid</code></div>
<div class="line"><code class="plain"> neighbor LEAF peer-group</code></div>
<div class="line"><code class="plain"> neighbor LEAF remote-as external</code></div>
<div class="line"><code class="plain"> neighbor LEAF capability extended-nexthop</code></div>
<div class="line"><code class="plain"> neighbor swp1.101 interface peer-group LEAF</code></div>
<div class="line"><code class="plain"> neighbor swp2.101 interface peer-group LEAF</code></div>
<div class="line"><code class="plain"> !</code></div>
<div class="line"><code class="plain"> address-family ipv4 unicast</code></div>
<div class="line"><code class="plain">  redistribute connected</code></div>
<div class="line"><code class="plain">  neighbor LEAF activate</code></div>
<div class="line"><code class="plain"> exit-address-family</code></div>
<div class="line"><code class="plain"> !</code></div>
<div class="line"><code class="plain"> address-family ipv6 unicast</code></div>
<div class="line"><code class="plain">  redistribute connected</code></div>
<div class="line"><code class="plain">  neighbor LEAF activate</code></div>
<div class="line"><code class="plain"> exit-address-family</code></div>
<div class="line"><code class="plain">!</code></div>
</div>
    </div>
    </div>
    <div class="section section-1" id="src-5127065_VirtualRoutingandForwarding-VRF-UsingDHCPwithVRF">
        <h1 class="heading "><span>Using DHCP with VRF</span></h1>
    <p  >Since you can use VRF to bind IPv4 and IPv6 sockets to non-default VRF tables, you have the ability to start DHCP servers and relays in any non-default VRF table using the <tt class=" ">dhcpd</tt> and <tt class=" ">dhcrelay</tt> services, respectively. These services must be managed by <tt class=" ">systemd</tt> in order to run in a VRF context; in addition, the services must be listed in <tt class=" ">/etc/vrf/systemd.conf</tt>. By default, this file already lists these two services, as well as others like <tt class=" ">ntp</tt> and <tt class=" ">snmpd</tt>. You can add more services as needed, such as <tt class=" ">dhcpd6</tt> and <tt class=" ">dhcrelay6</tt> for IPv6.    </p>
    <p  >If you edit <tt class=" ">/etc/vrf/systemd.conf</tt>, run <tt class=" ">sudo systemctl daemon-reload</tt> to generate the <tt class=" ">systemd</tt> instance files for the newly added service(s). Then you can start the service in the VRF using <tt class=" ">systemctl start &lt;service&gt;@&lt;vrf-name&gt;.service</tt>, where <tt class=" ">&lt;service&gt;</tt> is the name of the service &mdash; such as <tt class=" ">dhcpd</tt> or <tt class=" ">dhcrelay</tt> &mdash; and <tt class=" ">&lt;vrf-name&gt;</tt> is the name of the VRF.    </p>
    <p  >For example, to start the <tt class=" ">dhcrelay</tt> service after you configured a VRF named <i class=" ">blue</i>, run:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ sudo systemctl start dhcrelay@blue.service</code></div>
</div>
    </div>
    <p  >To enable the service at boot time you should also run <tt class=" ">systemctl enable &lt;service&gt;@&lt;vrf-name&gt;</tt>. To continue with the previous example:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ sudo systemctl enable dhcrelay@blue.service</code></div>
</div>
    </div>
    <p  >In addition, you need to create a separate default file in <tt class=" ">/etc/default</tt> for every instance of a DHCP server and/or relay in a non-default VRF; this is where you set the server and relay options. To run multiple instances of any of these services, you need a separate file for each instance. The files must be named as follows:    </p>
<ul class=" "><li class=" ">    <p  >isc-dhcp-server-&lt;vrf-name&gt;    </p>
</li><li class=" ">    <p  >isc-dhcp-server6-&lt;vrf-name&gt;    </p>
</li><li class=" ">    <p  >isc-dhcp-relay-&lt;vrf-name&gt;    </p>
</li><li class=" ">    <p  >isc-dhcp-relay6-&lt;vrf-name&gt;    </p>
</li></ul>    <p  >See the example configuration below for more details.    </p>
    <div class="section section-2" id="src-5127065_VirtualRoutingandForwarding-VRF-CaveatsforDHCPwithVRF">
        <h2 class="heading "><span>Caveats for DHCP with VRF</span></h2>
<ul class=" "><li class=" ">    <p  >Cumulus Linux does <strong class=" ">not</strong> support DHCP server and relay across VRFs, so the server and host cannot be in different VRF tables. In addition, the server and relay cannot be in different VRF tables.    </p>
</li><li class=" ">    <p  >Typically a service running in the default VRF owns a port across all VRFs. If the VRF local instance is preferred, the global one may need to be disabled and stopped first.    </p>
</li><li class=" ">    <p  >VRF is a layer 3 routing feature. It only makes sense to run programs that use AF_INET and AF_INET6 sockets in a VRF. VRF context does not affect any other aspects of the operation of a program.    </p>
</li><li class=" ">    <p  >This method only works with <tt class=" ">systemd</tt>-based services.    </p>
</li></ul>    </div>
    <div class="section section-2" id="src-5127065_VirtualRoutingandForwarding-VRF-ExampleConfiguration.1">
        <h2 class="heading "><span>Example Configuration</span></h2>
    <p  >In the following example, there is one IPv4 network with a VRF named <i class=" ">red</i> and one IPv6 network with a VRF named <i class=" ">blue</i>.    </p>
    <div  class="tablewrap">
        <table class="confluenceTable">
        <thead class=" "></thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >The IPv4 DHCP server/relay network looks like this:    </p>
    <p  >    <img  class="confluence-embedded-image image-center" src="images/download/attachments/5127065/vrf_dhcpIPv4.png" alt="images/download/attachments/5127065/vrf_dhcpIPv4.png"  height="250" />
        </p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >The IPv6 DHCP server/relay network looks like this:    </p>
    <p  >    <img  class="confluence-embedded-image image-center" src="images/download/attachments/5127065/vrf_dhcpIPv6.png" alt="images/download/attachments/5127065/vrf_dhcpIPv6.png"  height="250" />
        </p>
            </td>
        </tr>
</tbody>        </table>
            </div>
    <p  >Configure each DHCP server and relay as follows:    </p>
    <div  class="tablewrap">
        <table class="confluenceTable">
                    <colgroup>
                                    <col />
                                    <col />
                            </colgroup>
        <thead class=" "></thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  ><strong class=" ">Sample DHCP Server Configuration</strong>    </p>
<ol class=" "><li class=" ">    <p  >Create the file <tt class=" ">isc-dhcp-server-red</tt> in <tt class=" ">/etc/default/</tt>. Here is sample content:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain"># Defaults for isc-dhcp-server initscript</code></div>
<div class="line"><code class="plain"># sourced by /etc/init.d/isc-dhcp-server</code></div>
<div class="line"><code class="plain"># installed at /etc/default/isc-dhcp-server by the maintainer scripts</code></div>
<div class="line"><code class="plain">#</code></div>
<div class="line"><code class="plain"># This is a POSIX shell fragment</code></div>
<div class="line"><code class="plain">#</code></div>
<div class="line"><code class="plain"># Path to dhcpd's config file (default: /etc/dhcp/dhcpd.conf).</code></div>
<div class="line"><code class="plain">DHCPD_CONF="-cf /etc/dhcp/dhcpd-red.conf"</code></div>
<div class="line"><code class="plain"># Path to dhcpd's PID file (default: /var/run/dhcpd.pid).</code></div>
<div class="line"><code class="plain">DHCPD_PID="-pf /var/run/dhcpd-red.pid"</code></div>
<div class="line"><code class="plain"># Additional options to start dhcpd with.</code></div>
<div class="line"><code class="plain"># Don't use options -cf or -pf here; use DHCPD_CONF/ DHCPD_PID instead</code></div>
<div class="line"><code class="plain">#OPTIONS=""</code></div>
<div class="line"><code class="plain"># On what interfaces should the DHCP server (dhcpd) serve DHCP requests?</code></div>
<div class="line"><code class="plain"># Separate multiple interfaces with spaces, e.g. "eth0 eth1".</code></div>
<div class="line"><code class="plain">INTERFACES="swp2"</code></div>
</div>
    </div>
</li><li class=" ">    <p  >Enable the DHCP server:<br/><tt class=" ">cumulus@switch:~$ sudo systemctl enable dhcpd@red.service</tt>    </p>
</li><li class=" ">    <p  >Start the DHCP server:<br/><tt class=" ">cumulus@switch:~$ sudo systemctl start dhcpd@red.service</tt><br/>or<br/><tt class=" ">cumulus@switch:~$ sudo systemctl restart dhcpd@red.service</tt>    </p>
</li><li class=" ">    <p  >Check status:<br/><tt class=" ">cumulus@switch:~$ sudo systemctl status dhcpd@red.service</tt>    </p>
</li></ol>    <div  class="confbox admonition admonition-tip">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <p  >You can create this configuration using the <tt class=" ">vrf</tt> command (<a   href="#src-5127065_VirtualRoutingandForwarding-VRF-exec">see above</a> for more details):    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ sudo vrf task exec red /usr/sbin/dhcpd -f -q -cf /</code></div>
<div class="line"><code class="plain">    /etc/dhcp/dhcpd-red.conf -pf /var/run/dhcpd-red.pid swp2</code></div>
</div>
    </div>
        </div>
    </div>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  ><strong class=" ">Sample DHCP6 Server Configuration</strong>    </p>
<ol class=" "><li class=" ">    <p  >Create the file isc-dhcp-server6-blue in /etc/default/. Here is sample content:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain"># Defaults for isc-dhcp-server initscript</code></div>
<div class="line"><code class="plain"># sourced by /etc/init.d/isc-dhcp-server</code></div>
<div class="line"><code class="plain"># installed at /etc/default/isc-dhcp-server by the maintainer scripts</code></div>
<div class="line"><code class="plain">#</code></div>
<div class="line"><code class="plain"># This is a POSIX shell fragment</code></div>
<div class="line"><code class="plain">#</code></div>
<div class="line"><code class="plain"># Path to dhcpd's config file (default: /etc/dhcp/dhcpd.conf).</code></div>
<div class="line"><code class="plain">DHCPD_CONF="-cf /etc/dhcp/dhcpd6-blue.conf"</code></div>
<div class="line"><code class="plain"># Path to dhcpd's PID file (default: /var/run/dhcpd.pid).</code></div>
<div class="line"><code class="plain">DHCPD_PID="-pf /var/run/dhcpd6-blue.pid"</code></div>
<div class="line"><code class="plain"># Additional options to start dhcpd with.</code></div>
<div class="line"><code class="plain"># Don't use options -cf or -pf here; use DHCPD_CONF/ DHCPD_PID instead</code></div>
<div class="line"><code class="plain">#OPTIONS=""</code></div>
<div class="line"><code class="plain"># On what interfaces should the DHCP server (dhcpd) serve DHCP requests?</code></div>
<div class="line"><code class="plain"># Separate multiple interfaces with spaces, e.g. "eth0 eth1".</code></div>
<div class="line"><code class="plain">INTERFACES="swp3"</code></div>
</div>
    </div>
</li><li class=" ">    <p  >Enable the DHCP server:<br/><tt class=" ">cumulus@switch:~$ sudo systemctl enable dhcpd6@blue.service</tt>    </p>
</li><li class=" ">    <p  >Start the DHCP server:<br/><tt class=" ">cumulus@switch:~$ sudo systemctl start dhcpd6@blue.service</tt><br/>or<br/><tt class=" ">cumulus@switch:~$ sudo systemctl restart dhcpd6@blue.service</tt>    </p>
</li><li class=" ">    <p  >Check status:<br/><tt class=" ">cumulus@switch:~$ sudo systemctl status dhcpd6@blue.service</tt>    </p>
</li></ol>    <div  class="confbox admonition admonition-tip">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <p  >You can create this configuration using the <tt class=" ">vrf</tt> command (<a   href="#src-5127065_VirtualRoutingandForwarding-VRF-exe">see above</a> for more details):    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ sudo vrf task exec blue dhcpd -6 -q -cf / </code></div>
<div class="line"><code class="plain">    /etc/dhcp/dhcpd6-blue.conf -pf /var/run/dhcpd6-blue.pid swp3</code></div>
</div>
    </div>
        </div>
    </div>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  ><strong class=" ">Sample DHCP Relay Configuration</strong>    </p>
<ol class=" "><li class=" ">    <p  >Create the file <tt class=" ">isc-dhcp-relay-red</tt> in <tt class=" ">/etc/default/</tt>. Here is sample content:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain"># Defaults for isc-dhcp-relay initscript</code></div>
<div class="line"><code class="plain"># sourced by /etc/init.d/isc-dhcp-relay</code></div>
<div class="line"><code class="plain"># installed at /etc/default/isc-dhcp-relay by the maintainer scripts</code></div>
<div class="line"><code class="plain">#</code></div>
<div class="line"><code class="plain"># This is a POSIX shell fragment</code></div>
<div class="line"><code class="plain">#</code></div>
<div class="line"><code class="plain"># What servers should the DHCP relay forward requests to?</code></div>
<div class="line"><code class="plain">SERVERS="102.0.0.2"</code></div>
<div class="line"><code class="plain"># On what interfaces should the DHCP relay (dhrelay) serve DHCP requests?</code></div>
<div class="line"><code class="plain"># Always include the interface towards the DHCP server.</code></div>
<div class="line"><code class="plain"># This variable requires a -i for each interface configured above.</code></div>
<div class="line"><code class="plain"># This will be used in the actual dhcrelay command</code></div>
<div class="line"><code class="plain"># For example, "-i eth0 -i eth1"</code></div>
<div class="line"><code class="plain">INTF_CMD="-i swp2s2 -i swp2s3"</code></div>
<div class="line"><code class="plain"># Additional options that are passed to the DHCP relay daemon?</code></div>
<div class="line"><code class="plain">OPTIONS=""</code></div>
</div>
    </div>
</li><li class=" ">    <p  >Enable the DHCP relay:<br/><tt class=" ">cumulus@switch:~$ sudo systemctl enable dhcrelay@red.service</tt>    </p>
</li><li class=" ">    <p  >Start the DHCP relay:<br/><tt class=" ">cumulus@switch:~$ sudo systemctl start dhcrelay@red.service</tt><br/>or<br/><tt class=" ">cumulus@switch:~$ sudo systemctl restart dhcrelay@red.service</tt>    </p>
</li><li class=" ">    <p  >Check status:<br/><tt class=" ">cumulus@switch:~$ sudo systemctl status dhcrelay@red.service</tt>    </p>
</li></ol>    <div  class="confbox admonition admonition-tip">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <p  >You can create this configuration using the <tt class=" ">vrf</tt> command (<a   href="#src-5127065_VirtualRoutingandForwarding-VRF-exec">see above</a> for more details):    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ sudo vrf task exec red /usr/sbin/dhcrelay -d -q -i /</code></div>
<div class="line"><code class="plain">    swp2s2 -i swp2s3 102.0.0.2</code></div>
</div>
    </div>
        </div>
    </div>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  ><strong class=" ">Sample DHCP6 Relay Configuration</strong>    </p>
<ol class=" "><li class=" ">    <p  >Create the file <tt class=" ">isc-dhcp-relay6-blue</tt> in <tt class=" ">/etc/default/</tt>. Here is sample content:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain"># Defaults for isc-dhcp-relay initscript</code></div>
<div class="line"><code class="plain"># sourced by /etc/init.d/isc-dhcp-relay</code></div>
<div class="line"><code class="plain"># installed at /etc/default/isc-dhcp-relay by the maintainer scripts</code></div>
<div class="line"><code class="plain">#</code></div>
<div class="line"><code class="plain"># This is a POSIX shell fragment</code></div>
<div class="line"><code class="plain">#</code></div>
<div class="line"><code class="plain"># What servers should the DHCP relay forward requests to?</code></div>
<div class="line"><code class="plain">#SERVERS="103.0.0.2"</code></div>
<div class="line"><code class="plain"># On what interfaces should the DHCP relay (dhrelay) serve DHCP requests?</code></div>
<div class="line"><code class="plain"># Always include the interface towards the DHCP server.</code></div>
<div class="line"><code class="plain"># This variable requires a -i for each interface configured above.</code></div>
<div class="line"><code class="plain"># This will be used in the actual dhcrelay command</code></div>
<div class="line"><code class="plain"># For example, "-i eth0 -i eth1"</code></div>
<div class="line"><code class="plain">INTF_CMD="-l swp18s0 -u swp18s1"</code></div>
<div class="line"><code class="plain"># Additional options that are passed to the DHCP relay daemon?</code></div>
<div class="line"><code class="plain">OPTIONS="-pf /var/run/dhcrelay6@blue.pid"</code></div>
</div>
    </div>
</li><li class=" ">    <p  >Enable the DHCP relay:<br/><tt class=" ">cumulus@switch:~$ sudo systemctl enable dhcrelay6@blue.service</tt>    </p>
</li><li class=" ">    <p  >Start the DHCP relay:<br/><tt class=" ">cumulus@switch:~$ sudo systemctl start dhcrelay6@blue.service</tt><br/>or<br/><tt class=" ">cumulus@switch:~$ sudo systemctl restart dhcrelay6@blue.service</tt>    </p>
</li><li class=" ">    <p  >Check status:<br/><tt class=" ">cumulus@switch:~$ sudo systemctl status dhcrelay6@blue.service</tt>    </p>
</li></ol>    <div  class="confbox admonition admonition-tip">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
    <p  >You can create this configuration using the <tt class=" ">vrf</tt> command (<a   href="#src-5127065_VirtualRoutingandForwarding-VRF-ex">see above</a> for more details):    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ sudo vrf task exec blue /usr/sbin/dhcrelay -d -q -6 -l /</code></div>
<div class="line"><code class="plain">    swp18s0 -u swp18s1 -pf /var/run/dhcrelay6@blue.pid</code></div>
</div>
    </div>
        </div>
    </div>
            </td>
        </tr>
</tbody>        </table>
            </div>
    </div>
    </div>
    <div class="section section-1" id="src-5127065_VirtualRoutingandForwarding-VRF-Usingpingortraceroute">
        <h1 class="heading "><span>Using ping or traceroute</span></h1>
    <p  >If you wish to use <tt class=" ">ping</tt> or <tt class=" ">traceroute</tt> on a VRF, use the <tt class=" ">-I &lt;vrf&gt;</tt> flag for ping and <tt class=" ">-i &lt;vrf&gt;</tt> for <tt class=" ">traceroute</tt>.    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ ping -I blue</code></div>
</div>
    </div>
    <p  >Or:    </p>
    <div  class="confbox programlisting">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">cumulus@switch:~$ sudo traceroute -i blue</code></div>
</div>
    </div>
    </div>
    <div class="section section-1" id="src-5127065_VirtualRoutingandForwarding-VRF-CaveatsandErrata">
        <h1 class="heading "><span>Caveats and Errata</span></h1>
<ul class=" "><li class=" ">    <p  >The Penguin Computing Arctica 4804IP switch does not support VRFs.    </p>
</li><li class=" ">    <p  >While there is a fixed limit of 64 VRF devices, Cumulus Networks has validated up to 20 VRF devices on a switch at one time.    </p>
</li><li class=" ">    <p  >Table selection based on the incoming interface only; currently, packet attributes or output-interface-based selection are not available.    </p>
</li><li class=" ">    <p  >BGP (IPv4/IPv6) is the only routing protocol supported currently. There is no support for OSPF (IPv4/IPv6) at this time.    </p>
</li><li class=" ">    <p  >Setting the router ID outside of BGP via the <tt class=" ">router-id</tt> option causes all BGP instances to get the same router ID. If you want each BGP instance to have its own router ID, specify the <tt class=" ">router-id</tt> under the BGP instance using <tt class=" ">bgp router-id</tt>. If both are specified, the one under the BGP instance overrides the one provided outside BGP.    </p>
</li><li class=" ">    <p  >It is not possible to leak routes across VRFs within Quagga.    </p>
</li><li class=" ">    <p  >You cannot configure <a   href="Ethernet_Virtual_Private_Network_-_EVPN.html">EVPN address families</a> within a VRF.    </p>
</li></ul>    </div>
        </div>

    </article>


            <nav id="ht-post-nav">
                <a href="Redistribute_Neighbor.html" class="ht-post-nav-prev">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-prev" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Redistribute Neighbor</span>
        </a>
                <a href="Management_VRF.html" class="ht-post-nav-next">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-next" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-225.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Management VRF</span>
        </a>
    </nav>    
            
            <article id="html-search-results" class="ht-content" style="display: none;">
            <header class="ht-content-header">
                <div id="ht-spacetitle">
                    <ul>
                        <li><a href="Cumulus_Linux_User_Guide.html">Cumulus Linux 3.2.1</a></li>
                    </ul>
                </div>
                <h1>Search results</h1>
            </header>
            <div id="search-results"></div>
        </article>
    
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>


</body>
</html>
